<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<base href="http://mycompiler.org/Commodore/roms.htm"><div style="background:#fff;border:1px solid #999;margin:-1px -1px 0;padding:0;"><div style="background:#ddd;border:1px solid #999;color:#000;font:13px arial,sans-serif;font-weight:normal;margin:12px;padding:8px;text-align:left">Questa è la copia cache di Google di <a href="http://mycompiler.org/Commodore/roms.htm" style="text-decoration:underline;color:#00c">http://mycompiler.org/Commodore/roms.htm</a>. È un&#39;istantanea della pagina visualizzata il 4 ago 2014 00:04:41 GMT. Nel frattempo la <a href="http://mycompiler.org/Commodore/roms.htm" style="text-decoration:underline;color:#00c">pagina corrente</a> potrebbe essere stata modificata. <a href="http://support.google.com/websearch/bin/answer.py?hl=it&amp;p=cached&amp;answer=1687222" style="text-decoration:underline;color:#00c">Ulteriori informazioni</a><br>Suggerimento. Per trovare rapidamente il termine di ricerca su questa pagina, digita <b>Ctrl+F</b> o <b>⌘-F</b> (Mac) e utilizza la barra di ricerca.<br><br><div style="float:right"><a href="http://webcache.googleusercontent.com/search?q=cache:HjS1rwiJozEJ:mycompiler.org/Commodore/roms.htm&amp;client=safari&amp;hl=it&amp;gl=it&strip=1" style="text-decoration:underline;color:#00c">Versione solo testo</a></div>
<div>&nbsp;</div></div></div><div style="position:relative">
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0065) -->
<HTML>
<HEAD>
<TITLE> Agent Friday's  --Annotated ROM Disassembly-- for Commodore 64 </TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<XBASE HREF="http://www.hut.fi/Misc/cbm/docs/c64-diss.html">
<LINK rev=MADE href="mailto:Marko.Makela@HUT.FI">
<META http-equiv="Content-Style-Type" content="text/css"> 

  <STYLE type="text/css" id="style">
    GREENISHGRAY {color: #749474; colorname: "Greenish Gray"}
    BLUISHGRAY   {color: #8080AA; colorname: "Bluish Gray"}
    CARAMEL      {color: #CA9866; colorname: "Caramel"}
    ROSE         {color: #F08090; colorname: "Rose"}
    TEAL         {color: #2299AA; colorname: "Teal"}
    AMBER        {color: #C0A600; colorname: "Amber"}

    PRE          {color: black}

    .LEVEL0      {color: black}
    .LEVEL1      {color: #CA9866; colorname: "Caramel"}
    .LEVEL2      {color: #749474; colorname: "Greenish Gray"}
    .LEVEL3      {color: #8080AA; colorname: "Bluish Gray"}
    .LEVEL4      {color: #2299AA; colorname: "Teal"}
    .LEVEL5      {color: brown}
    .LEVEL6      {color: green}
    .LEVEL7      {color: black}

    HR.boundaryX  {  color: #F08090; colorname: "Rose"; 
                    font-size: 20pt;
                    height:5px; width: 50%; align: center; margin-top:0; margin-bottom:0"
                    border: red solid}
    .boundary  { color: #F08090; colorname: "Rose"; font-size: 16pt; text-align:center
                 }
    HR.boundary{ height:5px; width: 50%; align: center; margin-top:0; margin-bottom:0;
                 border-top: red solid}
    
  </STYLE>

  <SCRIPT language="JavaScript">
    function elem( id)
    {
        return document.GetElementById( id);
    }
    
    function DoIt()   
    {
        elem("body").innerHTML = "hello";
    //    document.write("Hello");
        alert("Why not just wrok????");
    }
  
  </SCRIPT>

</HEAD>

<BODY text=#000000 link=#0000ff VLINK=#0000ff ALINK="#00b460" bgColor=#e0e8ff oldbgColor=#c0d0e8>
There are three sections, 
<A href="#basic">BASIC</A>, 
<A href="#kernal">KERNAL</A> and
<A href="#0073">CHRGET</A>. 



<HR>
<A name=basic></A>
<HR>



<H4> Original work by Marko Makela </H4>
<H4> Additional annotations by Agent Friday, 2009 - 2013 ... <i>(WORK IN PROGRESS.)</i> &nbsp; &nbsp; <A href="Notes.txt">Notes</A></H4>
<H4>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Last updated: 2013-07-06</H4>

<br>Level 1 or greater: &nbsp; 15%
<br>Level 2 or greater: &nbsp; 14% (est)
<br>Level 3 or greater: &nbsp; 09% (est)
<br>Level 4 or greater: &nbsp; 04% (est)
<br>Level 5 or greater: &nbsp; 01% (est)
<br>Level 6 or greater: &nbsp; 00%
<br>Level 7 or greater: &nbsp; 00%
<br> (stats last updated 2013-Jul-06

<HR>
<HR>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <!--div class="level2" .. see below-->
<!--------------------------------------------------------------------------------------------------------->

<H2>Commodore 64 <i>BASIC ROM</i> Disassembly</H2>
<HR>


<PRE>
<div class="level3">

<A name=A000></A>  <A name=A002></A>
 <a name=xxxx></a>A000   .WD $<A href="#E394">E394</A>           ; BASIC RESET vector    (redirect after <A href="#FCE2">KERNAL reset</A>.  Shows startup screen.)        
 <a name=xxxx></a>A002   .WD $<A href="#E37B">E37B</A>           ; Warm Start            (redirect from <A href="#FE66">BRK routine</A> and STOP/RESTORE)
 
<A name=A004> </A> 
; CBMBASIC  
 <a name=xxxx></a>A004   .BY $43,$42,$4D,$42,$41,$53,$49,$43     (??? Never referenced?)
 
<A name=A00C></A>
; <b>address table for commands</b>
; (address minus 1 used)
;
; All tokens located using formula: A00C + 2*(token - $80)
;
; Referenced in <A href="#A7ED">A7ED</A> -- Command Execute


 <a name=xxxx></a>A00C   .WD $<A href="#A831">A830</A>   ; end           80
 <a name=xxxx></a>A00E   .WD $<A href="#A742">A741</A>   ; for           81
 <a name=xxxx></a>A010   .WD $<A href="#AD1E">AD1D</A>   ; next          82
 <a name=xxxx></a>A012   .WD $<A href="#A8F8">A8F7</A>   ; data          83
 <a name=xxxx></a>A014   .WD $<A href="#ABA5">ABA4</A>   ; input#        84
 <a name=xxxx></a>A016   .WD $<A href="#ABBF">ABBE</A>   ; input         85
 <a name=xxxx></a>A018   .WD $<A href="#B081">B080</A>   ; dim           86
 <a name=xxxx></a>A01A   .WD $<A href="#AC06">AC05</A>   ; read          87
 <a name=xxxx></a>A01C   .WD $<A href="#A9A5">A9A4</A>   ; let           88
 <a name=xxxx></a>A01E   .WD $<A href="#A8A0">A89F</A>   ; goto          89      (see also "GO" + "TO", $<A href="#A80E">A80E</A>)   
 <a name=xxxx></a>A020   .WD $<A href="#A871">A870</A>   ; run           8A
 <a name=xxxx></a>A022   .WD $<A href="#A928">A927</A>   ; if            8B
 <a name=xxxx></a>A024   .WD $<A href="#A81D">A81C</A>   ; restore       8C
 <a name=xxxx></a>A026   .WD $<A href="#A883">A882</A>   ; gosub         8D
 <a name=xxxx></a>A028   .WD $<A href="#A8D2">A8D1</A>   ; return        8E
 <a name=xxxx></a>A02A   .WD $<A href="#A93B">A93A</A>   ; rem           8F
 <a name=xxxx></a>A02C   .WD $<A href="#A82F">A82E</A>   ; stop          90
 <a name=xxxx></a>A02E   .WD $<A href="#A94B">A94A</A>   ; on            91
 <a name=xxxx></a>A030   .WD $<A href="#B82D">B82C</A>   ; wait          92
 <a name=xxxx></a>A032   .WD $<A href="#E168">E167</A>   ; load          93
 <a name=xxxx></a>A034   .WD $<A href="#E156">E155</A>   ; save          94
 <a name=xxxx></a>A036   .WD $<A href="#E165">E164</A>   ; verify        95
 <a name=xxxx></a>A038   .WD $<A href="#B3B3">B3B2</A>   ; def           96
 <a name=xxxx></a>A03A   .WD $<A href="#B824">B823</A>   ; poke          97
 <a name=xxxx></a>A03C   .WD $<A href="#AA80">AA7F</A>   ; print#        98
 <a name=xxxx></a>A03E   .WD $<A href="#AAA0">AA9F</A>   ; print         99
 <a name=xxxx></a>A040   .WD $<A href="#A857">A856</A>   ; cont          9A
 <a name=xxxx></a>A042   .WD $<A href="#A69C">A69B</A>   ; list          9B
 <a name=xxxx></a>A044   .WD $<A href="#A65E">A65D</A>   ; clr           9C
 <a name=xxxx></a>A046   .WD $<A href="#AA86">AA85</A>   ; cmd           9D
 <a name=xxxx></a>A048   .WD $<A href="#E12A">E129</A>   ; sys           9E
 <a name=xxxx></a>A04A   .WD $<A href="#E1BE">E1BD</A>   ; open          9F
 <a name=xxxx></a>A04C   .WD $<A href="#E1C7">E1C6</A>   ; close         A0
 <a name=xxxx></a>A04E   .WD $<A href="#AB7B">AB7A</A>   ; get           A1
 <a name=xxxx></a>A050   .WD $<A href="#A642">A641</A>   ; new           A2
</soeupan>
 
<A name=A052></A>
; <b>address table for functions</b>
;
; Function entries located using formula: $9FEA + 2*(token - $80)
;
; Referenced in <A href="#AFD6">AFD6</A> -- "Apply Function"

 <a name=xxxx></a>A052   .WD $<A href="#BC39">BC39</A>   ; sgn           B4
 <a name=xxxx></a>A054   .WD $<A href="#BCCC">BCCC</A>   ; int           B5
 <a name=xxxx></a>A056   .WD $<A href="#BC58">BC58</A>   ; abs           B6
 <a name=xxxx></a>A058   .WD $<A href="ram.htm#0310">0310</A>   ; usr           B7
 <a name=xxxx></a>A05A   .WD $<A href="#B37D">B37D</A>   ; fre           B8
 <a name=xxxx></a>A05C   .WD $<A href="#B39E">B39E</A>   ; pos           B9
 <a name=xxxx></a>A05E   .WD $<A href="#BF71">BF71</A>   ; sqr           BA
 <a name=xxxx></a>A060   .WD $<A href="#E097">E097</A>   ; rnd           BB
 <a name=xxxx></a>A062   .WD $<A href="#B9EA">B9EA</A>   ; log           BC
 <a name=xxxx></a>A064   .WD $<A href="#BFED">BFED</A>   ; exp           BD
 <a name=xxxx></a>A066   .WD $<A href="#E264">E264</A>   ; cos           BE
 <a name=xxxx></a>A068   .WD $<A href="#E26B">E26B</A>   ; sin           BF
 <a name=xxxx></a>A06A   .WD $<A href="#E2B4">E2B4</A>   ; tan           C0
 <a name=xxxx></a>A06C   .WD $<A href="#E30E">E30E</A>   ; atn           C1
 <a name=xxxx></a>A06E   .WD $<A href="#B80D">B80D</A>   ; peek          C2
 <a name=xxxx></a>A070   .WD $<A href="#B77C">B77C</A>   ; len           C3
 <a name=xxxx></a>A072   .WD $<A href="#B465">B465</A>   ; str$          C4
 <a name=xxxx></a>A074   .WD $<A href="#B7AD">B7AD</A>   ; val           C5
 <a name=xxxx></a>A076   .WD $<A href="#B78B">B78B</A>   ; asc           C6
 <a name=xxxx></a>A078   .WD $<A href="#B6EC">B6EC</A>   ; chr$          C7
 <a name=xxxx></a>A07A   .WD $<A href="#B700">B700</A>   ; left$         C8
 <a name=xxxx></a>A07C   .WD $<A href="#B72C">B72C</A>   ; right$        C9
 <a name=xxxx></a>A07E   .WD $<A href="#B737">B737</A>   ; mid$          CA

<A name=A080></A>
; <b>priority and address table for operators</b>
; (address minus 1 used)
;
; Most operators (+ thru OR) can be looked up using: $A080 + 3*(token - $AA)
; Note that token AB appears twice... once as binary operator, and once as unary.  How are they differentiated?
; NOT and the comparison operators must be looked up by algorithm ???  Comparison ops are lumped together.
;
; Referenced by <A href="#ADF1">ADF1</A> -- Evaluate Expression

 <a name=xxxx></a>A080   .BY $79
 <a name=xxxx></a>A081   .WD $<A href="#B86A">B869</A>   ; plus          AA
 <a name=xxxx></a>A083   .BY $79
 <a name=xxxx></a>A084   .WD $<A href="#B853">B852</A>   ; minus         AB
 <a name=xxxx></a>A086   .BY $7B
 <a name=xxxx></a>A087   .WD $<A href="#BA2B">BA2A</A>   ; multiply      AC
 <a name=xxxx></a>A089   .BY $7B
 <a name=xxxx></a>A08A   .WD $<A href="#BB12">BB11</A>   ; divide        AD
 <a name=xxxx></a>A08C   .BY $7F
 <a name=xxxx></a>A08D   .WD $<A href="#BF7B">BF7A</A>   ; power (^)     AE
 <a name=xxxx></a>A08F   .BY $50
 <a name=xxxx></a>A090   .WD $<A href="#AFE9">AFE8</A>   ; AND (bitwise) AF
 <a name=xxxx></a>A092   .BY $46
 <a name=xxxx></a>A093   .WD $<A href="#AFE6">AFE5</A>   ; OR (bitwise)  B0
 <a name=xxxx></a>A095   .BY $7D
 <a name=xxxx></a>A096   .WD $<A href="#BFB4">BFB3</A>   ; negative      AB   (unary minus)
 <a name=xxxx></a>A098   .BY $5A
 <a name=xxxx></a>A099   .WD $<A href="#AED4">AED3</A>   ; NOT (bitwise) A8
 <a name=xxxx></a>A09B   .BY $64
 <a name=xxxx></a>A09C   .WD $<A href="#B016">B015</A>   ; compare: &lt; = &gt; B1/B2/B3

<A name=A09E></A>
; Table of command name text
; $80 added to last char
; Referenced by <a href="#No_Tokenize">Tokenize</a>, <a href="#No_List">LIST</a>

 <a name=xxxx></a>A09E   .BY $45,$4E,$C4                 ; end           80
 <a name=xxxx></a>A0A1   .BY $46,$4F,$D2                 ; for           81
 <a name=xxxx></a>A0A4   .BY $4E,$45,$58,$D4             ; next          82
 <a name=xxxx></a>A0A8   .BY $44,$41,$54,$C1             ; data          83
 <a name=xxxx></a>A0AC   .BY $49,$4E,$50,$55,$54,$A3     ; input#        84
 <a name=xxxx></a>A0B2   .BY $49,$4E,$50,$55,$D4         ; input         85
 <a name=xxxx></a>A0B7   .BY $44,$49,$CD                 ; dim           86
 <a name=xxxx></a>A0BA   .BY $52,$45,$41,$C4             ; read          87
 <a name=xxxx></a>A0BE   .BY $4C,$45,$D4                 ; let           88
 <a name=xxxx></a>A0C1   .BY $47,$4F,$54,$CF             ; goto          89
 <a name=xxxx></a>A0C5   .BY $52,$55,$CE                 ; run           8A
 <a name=xxxx></a>A0C8   .BY $49,$C6                     ; if            8B
 <a name=xxxx></a>A0CA   .BY $52,$45,$53,$54,$4F,$52,$C5 ; restore       8C
 <a name=xxxx></a>A0D1   .BY $47,$4F,$53,$55,$C2         ; gosub         8D
 <a name=xxxx></a>A0D6   .BY $52,$45,$54,$55,$52,$CE     ; return        8E
 <a name=xxxx></a>A0DC   .BY $52,$45,$CD                 ; rem           8F
 <a name=xxxx></a>A0DF   .BY $53,$54,$4F,$D0             ; stop          90
 <a name=xxxx></a>A0E3   .BY $4F,$CE                     ; on            91
 <a name=xxxx></a>A0E5   .BY $57,$41,$49,$D4             ; wait          92
 <a name=xxxx></a>A0E9   .BY $4C,$4F,$41,$C4             ; load          93
 <a name=xxxx></a>A0ED   .BY $53,$41,$56,$C5             ; save          94
 <a name=xxxx></a>A0F1   .BY $56,$45,$52,$49,$46,$D9     ; verify        95
 <a name=xxxx></a>A0F7   .BY $44,$45,$C6                 ; def           96
 <a name=xxxx></a>A0FA   .BY $50,$4F,$4B,$C5             ; poke          97
 <a name=xxxx></a>A0FE   .BY $50,$52,$49,$4E,$54,$A3     ; print#        98
 <a name=xxxx></a>A104   .BY $50,$52,$49,$4E,$D4         ; print         99
 <a name=xxxx></a>A109   .BY $43,$4F,$4E,$D4             ; cont          9A
 <a name=xxxx></a>A10D   .BY $4C,$49,$53,$D4             ; list          9B
 <a name=xxxx></a>A111   .BY $43,$4C,$D2                 ; clr           9C
 <a name=xxxx></a>A114   .BY $43,$4D,$C4                 ; cmd           9D
 <a name=xxxx></a>A117   .BY $53,$59,$D3                 ; sys           9E
 <a name=xxxx></a>A11A   .BY $4F,$50,$45,$CE             ; open          9F
 <a name=xxxx></a>A11E   .BY $43,$4C,$4F,$53,$C5         ; close         A0
 <a name=xxxx></a>A123   .BY $47,$45,$D4                 ; get           A1
 <a name=xxxx></a>A126   .BY $4E,$45,$D7                 ; new           A2


<A name=A129></A>
; Table of tokens other than commands 
; (functions, operators, and support tokens used w/ <i>if, for, "go to"</i>)
; $80 added to last char
;
; This table is logically treated as just a continuation of the one above.
;
; References:  <a href="#No_Tokenize">Tokenize</a>, <a href="#No_List">LIST</a>

 <a name=xxxx></a>A129   .BY $54,$41,$42,$A8             ; tab(          A3
 <a name=xxxx></a>A12D   .BY $54,$CF                     ; to            A4
 <a name=xxxx></a>A12F   .BY $46,$CE                     ; fn            A5
 <a name=xxxx></a>A131   .BY $53,$50,$43,$A8             ; spc(          A6
 <a name=xxxx></a>A135   .BY $54,$48,$45,$CE             ; then          A7
 <a name=xxxx></a>A139   .BY $4E,$4F,$D4                 ; not           A8
 <a name=xxxx></a>A13C   .BY $53,$54,$45,$D0             ; step          A9
 <a name=xxxx></a>A140   .BY $AB                         ; plus          AA
 <a name=xxxx></a>A141   .BY $AD                         ; minus         AB
 <a name=xxxx></a>A142   .BY $AA                         ; multiply      AC
 <a name=xxxx></a>A143   .BY $AF                         ; divide        AD
 <a name=xxxx></a>A144   .BY $DE                         ; power         AE
 <a name=xxxx></a>A145   .BY $41,$4E,$C4                 ; and           AF
 <a name=xxxx></a>A148   .BY $4F,$D2                     ; or            B0
 <a name=xxxx></a>A14A   .BY $BE                         ; greater       B1
 <a name=xxxx></a>A14B   .BY $BD                         ; equal         B2
 <a name=xxxx></a>A14C   .BY $BC                         ; less          B3
 <a name=xxxx></a>A14D   .BY $53,$47,$CE                 ; sgn           B4
 <a name=xxxx></a>A150   .BY $49,$4E,$D4                 ; int           B5
 <a name=xxxx></a>A153   .BY $41,$42,$D3                 ; abs           B6
 <a name=xxxx></a>A156   .BY $55,$53,$D2                 ; usr           B7
 <a name=xxxx></a>A159   .BY $46,$52,$C5                 ; fre           B8
 <a name=xxxx></a>A15C   .BY $50,$4F,$D3                 ; pos           B9
 <a name=xxxx></a>A15F   .BY $53,$51,$D2                 ; sqr           BA
 <a name=xxxx></a>A162   .BY $52,$4E,$C4                 ; rnd           BB
 <a name=xxxx></a>A165   .BY $4C,$4F,$C7                 ; log           BC
 <a name=xxxx></a>A168   .BY $45,$58,$D0                 ; exp           BD
 <a name=xxxx></a>A16B   .BY $43,$4F,$D3                 ; cos           BE
 <a name=xxxx></a>A16E   .BY $53,$49,$CE                 ; sin           BF
 <a name=xxxx></a>A171   .BY $54,$41,$CE                 ; tan           C0
 <a name=xxxx></a>A174   .BY $41,$54,$CE                 ; atn           C1
 <a name=xxxx></a>A177   .BY $50,$45,$45,$CB             ; peek          C2
 <a name=xxxx></a>A17B   .BY $4C,$45,$CE                 ; len           C3
 <a name=xxxx></a>A17E   .BY $53,$54,$52,$A4             ; str$          C4
 <a name=xxxx></a>A182   .BY $56,$41,$CC                 ; val           C5
 <a name=xxxx></a>A185   .BY $41,$53,$C3                 ; asc           C6
 <a name=xxxx></a>A188   .BY $43,$48,$52,$A4             ; chr$          C7
 <a name=xxxx></a>A18C   .BY $4C,$45,$46,$54,$A4         ; left$         C8
 <a name=xxxx></a>A191   .BY $52,$49,$47,$48,$54,$A4     ; right$        C9
 <a name=xxxx></a>A197   .BY $4D,$49,$44,$A4             ; mid$          CA
 <a name=xxxx></a>A19B   .BY $47,$CF                     ; go            CB (combine with <i>TO</i> as an alias for <i>goto</i>.  See <a href="#A80E">GO TO</a>)
 <a name=xxxx></a>A19D   .BY $00

 
<a name=A19E></a>
; <b>error message text</b>
; $80 added to last char of each message
; Referenced by address table (<A href="#A328">A328</A>)
; (??? Any direct references?  That wouldn't make too much sense...)
 <!--          -->                                                  ; 01  TOO MANY FILES        <A name=A19E> </A>
 <a name=xxxx></a>A19E   .BY $54,$4F,$4F                                                 
 <a name=xxxx></a>A1A1   .BY $20,$4D,$41,$4E,$59
 <a name=xxxx></a>A1A6   .BY $20,$46,$49,$4C,$45,$D3
 <!--          -->                                                  ; 02  FILE OPEN             <A name=A1AC> </A>
 <a name=xxxx></a>A1AC   .BY $46,$49,$4C,$45
 <a name=xxxx></a>A1B0   .BY $20,$4F,$50,$45,$CE
 <!--          -->                                                  ; 03  FILE NOT OPEN         <A name=A1B5> </A>
 <a name=xxxx></a>A1B5   .BY $46,$49,$4C,$45
 <a name=xxxx></a>A1B9   .BY $20,$4E,$4F,$54
 <a name=xxxx></a>A1BD   .BY $20,$4F,$50,$45,$CE
 <!--          -->                                                  ; 04  FILE NOT FOUND        <A name=A1C2> </A>
 <a name=xxxx></a>A1C2   .BY $46,$49,$4C,$45
 <a name=xxxx></a>A1C6   .BY $20,$4E,$4F,$54
 <a name=xxxx></a>A1CA   .BY $20,$46,$4F,$55,$4E,$C4
 <!--          -->                                                  ; 05  DEVICE NOT PRESENT    <A name=A1D0> </A>
 <a name=xxxx></a>A1D0   .BY $44,$45,$56,$49,$43,$45
 <a name=xxxx></a>A1D6   .BY $20,$4E,$4F,$54
 <a name=xxxx></a>A1DA   .BY $20,$50,$52,$45,$53,$45,$4E,$D4
 <!--          -->                                                  ; 06  NOT INPUT FILE        <A name=A1E2> </A>
 <a name=xxxx></a>A1E2   .BY $4E,$4F,$54
 <a name=xxxx></a>A1E5   .BY $20,$49,$4E,$50,$55,$54
 <a name=xxxx></a>A1EB   .BY $20,$46,$49,$4C,$C5
 <!--          -->                                                  ; 07  NOT OUTPUT FILE       <A name=A1F0> </A> 
 <a name=xxxx></a>A1F0   .BY $4E,$4F,$54
 <a name=xxxx></a>A1F3   .BY $20,$4F,$55,$54,$50,$55,$54
 <a name=xxxx></a>A1FA   .BY $20,$46,$49,$4C,$C5
 <!--          -->                                                  ; 08  MISSING FILE NAME     <A name=A1FF> </A> 
 <a name=xxxx></a>A1FF   .BY $4D,$49,$53,$53,$49,$4E,$47
 <a name=xxxx></a>A206   .BY $20,$46,$49,$4C,$45
 <a name=xxxx></a>A20B   .BY $20,$4E,$41,$4D,$C5
 <!--          -->                                                  ; 09  ILLEGAL DEVICE NUMBER <A name=A210> </A> 
 <a name=xxxx></a>A210   .BY $49,$4C,$4C,$45,$47,$41,$4C
 <a name=xxxx></a>A217   .BY $20,$44,$45,$56,$49,$43,$45
 <a name=xxxx></a>A21E   .BY $20,$4E,$55,$4D,$42,$45,$D2
 <!--          -->                                                  ; 0A  NEXT WITHOUT FOR      <A name=A225> </A>
 <a name=xxxx></a>A225   .BY $4E,$45,$58,$54
 <a name=xxxx></a>A229   .BY $20,$57,$49,$54,$48,$4F,$55,$54
 <a name=xxxx></a>A231   .BY $20,$46,$4F,$D2
 <!--          -->                                                  ; 0B  SYNTAX                <A name=A235> </A>
 <a name=xxxx></a>A235   .BY $53,$59,$4E,$54,$41,$D8
 <!--          -->                                                  ; 0C  RETURN WITHOUT GOSUB  <A name=A23B> </A>
 <a name=xxxx></a>A23B   .BY $52,$45,$54,$55,$52,$4E
 <a name=xxxx></a>A241   .BY $20,$57,$49,$54,$48,$4F,$55,$54
 <a name=xxxx></a>A249   .BY $20,$47,$4F,$53,$55,$C2
 <!--          -->                                                  ; 0D  OUT OF DATA           <A name=A24F> </A>
 <a name=xxxx></a>A24F   .BY $4F,$55,$54
 <a name=xxxx></a>A252   .BY $20,$4F,$46
 <a name=xxxx></a>A255   .BY $20,$44,$41,$54,$C1
 <!--          -->                                                  ; 0E  ILLEGAL QUANTITY      <A name=A25A> </A>
 <a name=xxxx></a>A25A   .BY $49,$4C,$4C,$45,$47,$41,$4C
 <a name=xxxx></a>A261   .BY $20,$51,$55,$41,$4E,$54,$49,$54,$D9
 <!--          -->                                                  ; 0F  OVERFLOW              <A name=A26A> </A>
 <a name=xxxx></a>A26A   .BY $4F,$56,$45,$52,$46,$4C,$4F,$D7
 <!--          -->                                                  ; 10  OUT OF MEMORY         <A name=A272> </A>
 <a name=xxxx></a>A272   .BY $4F,$55,$54
 <a name=xxxx></a>A275   .BY $20,$4F,$46
 <a name=xxxx></a>A278   .BY $20,$4D,$45,$4D,$4F,$52,$D9
 <!--          -->                                                  ; 11  UNDEF'D STATEMENT     <A name=A27F> </A>
 <a name=xxxx></a>A27F   .BY $55,$4E,$44,$45,$46,$27,$44,$20
 <a name=xxxx></a>A286   .BY $53,$54,$41,$54,$45,$4D,$45,$4E,$D4
 <!--          -->                                                  ; 12  BAD SUBSCRIPT         <A name=A290> </A>
 <a name=xxxx></a>A290   .BY $42,$41,$44,$20,
 <a name=xxxx></a>A293   .BY $53,$55,$42,$53,$43,$52,$49,$50,$D4
 <!--          -->                                                  ; 13  REDIM'D ARRAY         <A name=A29D> </A>
 <a name=xxxx></a>A29D   .BY $52,$45,$44,$49,$4D,$27,$44
 <a name=xxxx></a>A2A4   .BY $20,$41,$52,$52,$41,$D9
 <!--          -->                                                  ; 14  DIVISION BY ZERO      <A name=A2AA> </A>
 <a name=xxxx></a>A2AA   .BY $44,$49,$56,$49,$53,$49,$4F,$4E
 <a name=xxxx></a>A2B2   .BY $20,$42,$59
 <a name=xxxx></a>A2B5   .BY $20,$5A,$45,$52,$CF
 <!--          -->                                                  ; 15  ILLEGAL DIRECT        <A name=A2BA> </A>
 <a name=xxxx></a>A2BA   .BY $49,$4C,$4C,$45,$47,$41,$4C
 <a name=xxxx></a>A2C1   .BY $20,$44,$49,$52,$45,$43,$D4
 <!--          -->                                                  ; 16  TYPE MISMATCH         <A name=A2C8> </A>
 <a name=xxxx></a>A2C8   .BY $54,$59,$50,$45
 <a name=xxxx></a>A2CC   .BY $20,$4D,$49,$53,$4D,$41,$54,$43,$C8
 <!--          -->                                                  ; 17  STRING TOO LONG       <A name=A2D5> </A>
 <a name=xxxx></a>A2D5   .BY $53,$54,$52,$49,$4E,$47
 <a name=xxxx></a>A2DB   .BY $20,$54,$4F,$4F
 <a name=xxxx></a>A2DF   .BY $20,$4C,$4F,$4E,$C7
 <!--          -->                                                  ; 18  FILE DATA             <A name=A2E4> </A>
 <a name=xxxx></a>A2E4   .BY $46,$49,$4C,$45
 <a name=xxxx></a>A2E8   .BY $20,$44,$41,$54,$C1
 <!--          -->                                                  ; 19  FORMULA TOO COMPLEX   <A name=A2ED> </A>
 <a name=xxxx></a>A2ED   .BY $46,$4F,$52,$4D,$55,$4C,$41
 <a name=xxxx></a>A2F4   .BY $20,$54,$4F,$4F
 <a name=xxxx></a>A2F8   .BY $20,$43,$4F,$4D,$50,$4C,$45,$D8
 <!--          -->                                                  ; 1A  CAN'T CONTINUE        <A name=A300> </A>
 <a name=xxxx></a>A300   .BY $43,$41,$4E,$27,$54
 <a name=xxxx></a>A305   .BY $20,$43,$4F,$4E,$54,$49,$4E,$55,$C5
 <!--          -->                                                  ; 1B  UNDEF'D FUNCTION      <A name=A30E> </A>
 <a name=xxxx></a>A30E   .BY $55,$4E,$44,$45,$46,$27,$44
 <a name=xxxx></a>A315   .BY $20,$46,$55,$4E,$43,$54,$49,$4F,$CE
 <!--          -->                                                  ; 1C  VERIFY                <A name=A31E> </A>
 <a name=xxxx></a>A31E   .BY $56,$45,$52,$49,$46,$D9
 <!--          -->                                                  ; 1D  LOAD                  <A name=A324> </A>
 <a name=xxxx></a>A324   .BY $4C,$4F,$41,$C4
 
<A name=A328></A>
; <b>adress table for error text</b>
; Accessed by error message handler (<A href="#A43A">A43A</A>)
; Essentially an index to the error text above.
; These error numbers (1 thru 9 at least) correspond to error codes returned by KERNAL functions

 <a name=xxxx></a>A328   .WD $<A href="#A19E">A19E</A>          ; 01 too many files
 <a name=xxxx></a>A32A   .WD $<A href="#A1AC">A1AC</A>          ; 02 file open
 <a name=xxxx></a>A32C   .WD $<A href="#A1B5">A1B5</A>          ; 03 file not open
 <a name=xxxx></a>A32E   .WD $<A href="#A1C2">A1C2</A>          ; 04 file not found
 <a name=xxxx></a>A330   .WD $<A href="#A1D0">A1D0</A>          ; 05 device not present
 <a name=xxxx></a>A332   .WD $<A href="#A1E2">A1E2</A>          ; 06 not input file
 <a name=xxxx></a>A334   .WD $<A href="#A1F0">A1F0</A>          ; 07 not output file
 <a name=xxxx></a>A336   .WD $<A href="#A1FF">A1FF</A>          ; 08 missing file name
 <a name=xxxx></a>A338   .WD $<A href="#A210">A210</A>          ; 09 illegal device number
 <a name=xxxx></a>A33A   .WD $<A href="#A225">A225</A>          ; 0A next without for
 <a name=xxxx></a>A33C   .WD $<A href="#A235">A235</A>          ; 0B syntax
 <a name=xxxx></a>A33E   .WD $<A href="#A23B">A23B</A>          ; 0C return without gosub
 <a name=xxxx></a>A340   .WD $<A href="#A24F">A24F</A>          ; 0D out of data
 <a name=xxxx></a>A342   .WD $<A href="#A25A">A25A</A>          ; 0E illegal quantity
 <a name=xxxx></a>A344   .WD $<A href="#A26A">A26A</A>          ; 0F overflow
 <a name=xxxx></a>A346   .WD $<A href="#A272">A272</A>          ; 10 out of memory
 <a name=xxxx></a>A348   .WD $<A href="#A27F">A27F</A>          ; 11 undef'd statment
 <a name=xxxx></a>A34A   .WD $<A href="#A290">A290</A>          ; 12 bad subscript
 <a name=xxxx></a>A34C   .WD $<A href="#A29D">A29D</A>          ; 13 redim'd array
 <a name=xxxx></a>A34E   .WD $<A href="#A2AA">A2AA</A>          ; 14 devision by zero
 <a name=xxxx></a>A350   .WD $<A href="#A2BA">A2BA</A>          ; 15 illegal direct
 <a name=xxxx></a>A352   .WD $<A href="#A2C8">A2C8</A>          ; 16 type mismatch
 <a name=xxxx></a>A354   .WD $<A href="#A2D5">A2D5</A>          ; 17 string too long
 <a name=xxxx></a>A356   .WD $<A href="#A2E4">A2E4</A>          ; 18 file data
 <a name=xxxx></a>A358   .WD $<A href="#A2ED">A2ED</A>          ; 19 formula too complex
 <a name=xxxx></a>A35A   .WD $<A href="#A300">A300</A>          ; 1A can't continue
 <a name=xxxx></a>A35C   .WD $<A href="#A30E">A30E</A>          ; 1B undef'd function
 <a name=xxxx></a>A35E   .WD $<A href="#A31E">A31E</A>          ; 1C verify
 <a name=xxxx></a>A360   .WD $<A href="#A324">A324</A>          ; 1D load
 <a name=xxxx></a>A362   .WD $<A href="#A383">A383</A>          ; 1E break

<a name=A364></a>
; <b>other BASIC messages</b>
; Referenced in various places directly by address (except for maybe BREAK... which has an entry above ???)
; Note that these messages are null-terminated, rather than having MSB set in last letter.
;
; Referenced by:  ____  (Show references by each individual message...)

 <a name=A364></a>A364   .BY $0D,$4F,$4B,$0D                     ; "[cr]OK[cr]"             (E18F)
 <a name=A368></a>A368   .BY $00

 <a name=A369></a>A369   .BY $20,$20,$45,$52,$52,$4F,$52         ; "  ERROR"           
 <a name=A370></a>A370   .BY $00

 <a name=A371></a>A371   .BY $20,$49,$4E,$20                     ; " IN "              
 <a name=A375></a>A375   .BY $00

 <a name=A376></a>A376   .BY $0D,$0A,$52,$45,$41,$44,$59,$2E     ; "[crlf]READY.[crlf]"     (E1AD)
 <a name=A380></a>A380   .BY $0D,$0A,$00

 <a name=A381></a>A381   .BY $0D,$0A                             ; "[crlf]BREAK"       
 <a name=A383></a>A383   .BY $42,$52,$45,$41,$4B
 <a name=A388></a>A388   .BY $00
 
 <a name=A389></a>A389   .BY $A0                                 ; ??? What's this $A0 doing hanging out here ???

  
<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=A38A>
 ; search for "for" blocks on stack
 </A>
 <a name=A38A></a>A38A   BA         TSX
 <a name=A38B></a>A38B   E8         INX
 <a name=A38C></a>A38C   E8         INX
 <a name=A38D></a>A38D   E8         INX
 <a name=A38E></a>A38E   E8         INX
 <a name=A38F></a>A38F   BD 01 01   LDA $0101,X
 <a name=A392></a>A392   C9 81      CMP #$81   ; for block code
 <a name=A394></a>A394   D0 21      BNE $A3B7
 <a name=A396></a>A396   A5 4A      LDA $4A
 <a name=A398></a>A398   D0 0A      BNE $A3A4
 <a name=A39A></a>A39A   BD 02 01   LDA $0102,X
 <a name=A39D></a>A39D   85 49      STA $49
 <a name=A39F></a>A39F   BD 03 01   LDA $0103,X
 <a name=A3A2></a>A3A2   85 4A      STA $4A
 <a name=A3A4></a>A3A4   DD 03 01   CMP $0103,X
 <a name=A3A7></a>A3A7   D0 07      BNE $A3B0
 <a name=A3A9></a>A3A9   A5 49      LDA $49
 <a name=A3AB></a>A3AB   DD 02 01   CMP $0102,X
 <a name=A3AE></a>A3AE   F0 07      BEQ $A3B7
 <a name=A3B0></a>A3B0   8A         TXA
 <a name=A3B1></a>A3B1   18         CLC
 <a name=A3B2></a>A3B2   69 12      ADC #$12
 <a name=A3B4></a>A3B4   AA         TAX
 <a name=A3B5></a>A3B5   D0 D8      BNE $A38F
 <a name=A3B7></a>A3B7   60         RTS
 
 <A name=A3B8>
 ; move bytes after check for space
 </A>
 <a name=A3B8></a>A3B8   20 08 A4   JSR $<A href="#A408">A408</A>
 <a name=A3BB></a>A3BB   85 31      STA $31
 <a name=A3BD></a>A3BD   84 32      STY $32
 
 <A name=A3BF>
 ; move bytes routine
 ;  $5F/$60 source start address
 ;  $5A/$5B source end address
 ;  $58/$59 destination end address
 </A>
 <a name=A3BF></a>A3BF   38         SEC
 <a name=A3C0></a>A3C0   A5 5A      LDA $5A
 <a name=A3C2></a>A3C2   E5 5F      SBC $5F
 <a name=A3C4></a>A3C4   85 22      STA $22
 <a name=A3C6></a>A3C6   A8         TAY
 <a name=A3C7></a>A3C7   A5 5B      LDA $5B
 <a name=A3C9></a>A3C9   E5 60      SBC $60
 <a name=A3CB></a>A3CB   AA         TAX
 <a name=A3CC></a>A3CC   E8         INX
 <a name=A3CD></a>A3CD   98         TYA
 <a name=A3CE></a>A3CE   F0 23      BEQ $A3F3
 <a name=A3D0></a>A3D0   A5 5A      LDA $5A
 <a name=A3D2></a>A3D2   38         SEC
 <a name=A3D3></a>A3D3   E5 22      SBC $22
 <a name=A3D5></a>A3D5   85 5A      STA $5A
 <a name=A3D7></a>A3D7   B0 03      BCS $A3DC
 <a name=A3D9></a>A3D9   C6 5B      DEC $5B
 <a name=A3DB></a>A3DB   38         SEC
 <a name=A3DC></a>A3DC   A5 58      LDA $58
 <a name=A3DE></a>A3DE   E5 22      SBC $22
 <a name=A3E0></a>A3E0   85 58      STA $58
 <a name=A3E2></a>A3E2   B0 08      BCS $A3EC
 <a name=A3E4></a>A3E4   C6 59      DEC $59
 <a name=A3E6></a>A3E6   90 04      BCC $A3EC
 <a name=A3E8></a>A3E8   B1 5A      LDA ($5A),Y
 <a name=A3EA></a>A3EA   91 58      STA ($58),Y
 <a name=A3EC></a>A3EC   88         DEY
 <a name=A3ED></a>A3ED   D0 F9      BNE $A3E8
 <a name=A3EF></a>A3EF   B1 5A      LDA ($5A),Y
 <a name=A3F1></a>A3F1   91 58      STA ($58),Y
 <a name=A3F3></a>A3F3   C6 5B      DEC $5B
 <a name=A3F5></a>A3F5   C6 59      DEC $59
 <a name=A3F7></a>A3F7   CA         DEX
 <a name=A3F8></a>A3F8   D0 F2      BNE $A3EC
 <a name=A3FA></a>A3FA   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->


<A name=A3FB></A>
;<b> test for free space on stack </b>
;
; BASIC calls this before putting any BASIC-related data on the stack, such as
; for-loop info, GOSUB return info, and expression evaluation.
; This call prevents the stack from underflowing (causing undefined behavior)
; and instead generates an "out of memory" error.  It takes into account that
; the lowest 62 ($3E) bytes are reserved for use by BASIC/KERNAL (??? which?)
; so that the area is not trampled.
;
; IN: .A = # of 16-bit words needed on stack
; OUT: If function returns, you're OK.  Otherwise "out of memory" error
;
; Refernced by: <A href="#A757">A757</A>, <A href="#A885">A885</A>, <A href="#ADAE">ADAE</A>

 <a name=xxxx></a>A3FB   0A         ASL             ; #bytes = 2 x #words.  Always clears .C
 <a name=A3FC></a>A3FC   69 3E      ADC #$3E        ; Add # of bytes already reserved for other use.  .A = Reserved + Requested 
 <a name=A3FE></a>A3FE   B0 35      BCS $<A href="#A435">A435</A>       ; If that overflows, the request is too large no matter what the SP is
 <a name=A400></a>A400   85 22      STA $<A href="ram.htm#0022">22</A>         ; (Utility Pointer Area) store .A so that it can be compared to .SP
 <a name=A402></a>A402   BA         TSX
 <a name=A403></a>A403   E4 22      CPX $<A href="ram.htm#0022">22</A>         ; .SP must be greater than Reserved + Requested
 <a name=A405></a>A405   90 2E      BCC $<A href="#A435">A435</A>       ; underflow = "out of memory".  Will not return here
 <a name=A407></a>A407   60         RTS             ; A-OK


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=A408>
 ; array area overflow check
 </A>
 <a name=A408></a>A408   C4 34      CPY $34
 <a name=A40A></a>A40A   90 28      BCC $A434
 <a name=A40C></a>A40C   D0 04      BNE $A412
 <a name=A40E></a>A40E   C5 33      CMP $33
 <a name=A410></a>A410   90 22      BCC $A434
 <a name=A412></a>A412   48         PHA
 <a name=A413></a>A413   A2 09      LDX #$09
 <a name=A415></a>A415   98         TYA
 <a name=A416></a>A416   48         PHA
 <a name=A417></a>A417   B5 57      LDA $57,X
 <a name=A419></a>A419   CA         DEX
 <a name=A41A></a>A41A   10 FA      BPL $A416
 <a name=A41C></a>A41C   20 26 B5   JSR $<A href="#B526">B526</A>
 <a name=A41F></a>A41F   A2 F7      LDX #$F7
 <a name=A421></a>A421   68         PLA
 <a name=A422></a>A422   95 61      STA $61,X
 <a name=A424></a>A424   E8         INX
 <a name=A425></a>A425   30 FA      BMI $A421
 <a name=A427></a>A427   68         PLA
 <a name=A428></a>A428   A8         TAY
 <a name=A429></a>A429   68         PLA
 <a name=A42A></a>A42A   C4 34      CPY $34
 <a name=A42C></a>A42C   90 06      BCC $A434
 <a name=A42E></a>A42E   D0 05      BNE $<A href="#A435">A435</A>       ; Out of memory error
 <a name=A430></a>A430   C5 33      CMP $33
 <a name=A432></a>A432   B0 01      BCS $<A href="#A435">A435</A>       ; Out of memory error
 <a name=A434></a>A434   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->


<A name=A435> </A>
;<b> out of memory error </b>
;    Referenced by:  <A href="#A3FE">A3FE</A> <A href="#A405">A405</A> <A href="#B30B">B30B</A> 

*<a name=xxxx></a>A435   A2 10      LDX #$10        ; code for "OUT OF MEMORY"

<A name=A437></A>
;<b> handle error message </b>
;    Referenced by:  <A href="#A573">A573</A> <A href="#A85F">A85F</A> <A href="#A8E5">A8E5</A> <A href="#AB68">AB68</A> <A href="#AD32">AD32</A> <A href="#AD9B">AD9B</A> <A href="#AF0A">AF0A</A> <A href="#B24A">B24A</A> <A href="#B3B0">B3B0</A> <A href="#B4D2">B4D2</A> <A href="#B65A">B65A</A> <A href="#B980">B980</A> <A href="#BB8C">BB8C</A> <A href="#E109">E109</A> <A href="#E19E">E19E</A>

 <a name=xxxx></a>A437   6C 00 03   JMP ($<a href="ram.htm#0300">0300</a>)      ; <A href="#A43A">A43A</A> by default

 
<A name=A43A></A>
;<b> standard error message handler </b>
;    Refernced by:  All calls go through the vector above (<A href="#A437">A437</A>) EXCEPT one direct call from <A href="#E38E">E38E</A> !!! why direct???

 <a name=xxxx></a>A43A   8A         TXA
 <a name=A43B></a>A43B   0A         ASL             ; Table index = 2 x msg #
 <a name=A43C></a>A43C   AA         TAX
 <a name=A43D></a>A43D   BD 26 A3   LDA $<A href="#A328">A326</A>,X     ; Msg nums are 1-based, so table is indexed from table start - 2
 <a name=A440></a>A440   85 22      STA $<A href="ram.htm#0022">22</A>
 <a name=A442></a>A442   BD 27 A3   LDA $<A href="#A328">A327</A>,X            
 <a name=A445></a>A445   85 23      STA $<A href="ram.htm#0023">23</A>         ; String addr copied to ZP "Utility ptr area"
 <a name=A447></a>A447   20 CC FF   JSR $<A href="#FFCC">FFCC</A>       ; normally redirects to $<A href="#F333">F333</A>, via vector <a href="ram.htm#0322">0322</a>.   "restore I/O devices to default"
                                                                        

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->


 <a name=A44A></a>A44A   A9 00      LDA #$00        ;        
 <a name=A44C></a>A44C   85 13      STA $<A href="ram.htm#0013">13</A>         ; Flag: INPUT Prompt ???  Used for temp. storage?
 <a name=A44E></a>A44E   20 D7 AA   JSR $<A href="#AAD7">AAD7</A>       ;
 <a name=A451></a>A451   20 45 AB   JSR $<A href="#AB45">AB45</A>       ;
 <a name=A454></a>A454   A0 00      LDY #$00        ;   xxxx
 <a name=A456></a>A456   B1 22      LDA ($22),Y     ;
 <a name=A458></a>A458   48         PHA             ;
 <a name=A459></a>A459   29 7F      AND #$7F        ;
 <a name=A45B></a>A45B   20 47 AB   JSR $<A href="#AB47">AB47</A>       ;
 <a name=A45E></a>A45E   C8         INY             ;
 <a name=A45F></a>A45F   68         PLA             ;
 <a name=A460></a>A460   10 F4      BPL $A456       ;
 <a name=A462></a>A462   20 7A A6   JSR $<A href="#A67A">A67A</A>       ;
 <a name=A465></a>A465   A9 69      LDA #$69   ; low  <A href="#A369">A369</A>
 <a name=A467></a>A467   A0 A3      LDY #$A3   ; high <A href="#A369">A369</A>
 <a name=A469></a>A469   20 1E AB   JSR $<A href="#AB1E">AB1E</A>
 <a name=A46C></a>A46C   A4 3A      LDY $3A
 <a name=A46E></a>A46E   C8         INY
 <a name=A46F></a>A46F   F0 03      BEQ $A474
 <a name=A471></a>A471   20 C2 BD   JSR $<A href="#BDC2">BDC2</A>
 <a name=A474></a>A474   A9 76      LDA #$76   ; low <A href="#A376">A376</A>
 <a name=A476></a>A476   A0 A3      LDY #$A3   ; low <A href="#A376">A376</A>
 <a name=A478></a>A478   20 1E AB   JSR $<A href="#AB1E">AB1E</A>
 <a name=A47B></a>A47B   A9 80      LDA #$80
 <a name=A47D></a>A47D   20 90 FF   JSR $<A href="#FF90">FF90</A>

 <A name=A480></A>
 ; <b>BASIC warm start</b>
 
 <a name=A480></a>A480   6C 02 03   JMP ($0302)   ; normally <A href="#A483">A483</A>
 <A name=A483> </A>
 ; standard warm start routine

 <a name=A483></a>A483   20 60 A5   JSR $<A href="#A560">A560</A>
 <a name=A486></a>A486   86 7A      STX $7A
 <a name=A488></a>A488   84 7B      STY $7B 
 <a name=A48A></a>A48A   20 73 00   JSR $0073
 <a name=A48D></a>A48D   AA         TAX
 <a name=A48E></a>A48E   F0 F0      BEQ $A480
 <a name=A490></a>A490   A2 FF      LDX #$FF
 <a name=A492></a>A492   86 3A      STX $3A
 <a name=A494></a>A494   90 06      BCC $A49C
 <a name=A496></a>A496   20 79 A5   JSR $<A href="#A579">A579</A>
 <a name=A499></a>A499   4C E1 A7   JMP $<A href="#A7E1">A7E1</A>
 
 <A name=A49C>
 ; handle insert/delete basic lines
 </A>
 <a name=A49C></a>A49C   20 6B A9   JSR $<A href="#A96B">A96B</A>
 <a name=A49F></a>A49F   20 79 A5   JSR $<A href="#A579">A579</A>
 <a name=A4A2></a>A4A2   84 0B      STY $0B
 <a name=A4A4></a>A4A4   20 13 A6   JSR $<A href="#A613">A613</A>
 <a name=A4A7></a>A4A7   90 44      BCC $A4ED
 
 <A name=A4A9>
 ; delete old line
 </A>
 <a name=A4A9></a>A4A9   A0 01      LDY #$01
 <a name=A4AB></a>A4AB   B1 5F      LDA ($5F),Y
 <a name=A4AD></a>A4AD   85 23      STA $23
 <a name=A4AF></a>A4AF   A5 2D      LDA $2D
 <a name=A4B1></a>A4B1   85 22      STA $22
 <a name=A4B3></a>A4B3   A5 60      LDA $60
 <a name=A4B5></a>A4B5   85 25      STA $25
 <a name=A4B7></a>A4B7   A5 5F      LDA $5F
 <a name=A4B9></a>A4B9   88         DEY
 <a name=A4BA></a>A4BA   F1 5F      SBC ($5F),Y
 <a name=A4BC></a>A4BC   18         CLC
 <a name=A4BD></a>A4BD   65 2D      ADC $2D
 <a name=A4BF></a>A4BF   85 2D      STA $2D
 <a name=A4C1></a>A4C1   85 24      STA $24
 <a name=A4C3></a>A4C3   A5 2E      LDA $2E
 <a name=A4C5></a>A4C5   69 FF      ADC #$FF
 <a name=A4C7></a>A4C7   85 2E      STA $2E
 <a name=A4C9></a>A4C9   E5 60      SBC $60
 <a name=A4CB></a>A4CB   AA         TAX
 <a name=A4CC></a>A4CC   38         SEC
 <a name=A4CD></a>A4CD   A5 5F      LDA $5F
 <a name=A4CF></a>A4CF   E5 2D      SBC $2D
 <a name=A4D1></a>A4D1   A8         TAY
 <a name=A4D2></a>A4D2   B0 03      BCS $A4D7
 <a name=A4D4></a>A4D4   E8         INX
 <a name=A4D5></a>A4D5   C6 25      DEC $25
 <a name=A4D7></a>A4D7   18         CLC
 <a name=A4D8></a>A4D8   65 22      ADC $22
 <a name=A4DA></a>A4DA   90 03      BCC $A4DF
 <a name=A4DC></a>A4DC   C6 23      DEC $23
 <a name=A4DE></a>A4DE   18         CLC
 <a name=A4DF></a>A4DF   B1 22      LDA ($22),Y
 <a name=A4E1></a>A4E1   91 24      STA ($24),Y
 <a name=A4E3></a>A4E3   C8         INY
 <a name=A4E4></a>A4E4   D0 F9      BNE $A4DF
 <a name=A4E6></a>A4E6   E6 23      INC $23
 <a name=A4E8></a>A4E8   E6 25      INC $25
 <a name=A4EA></a>A4EA   CA         DEX
 <a name=A4EB></a>A4EB   D0 F2      BNE $A4DF
 
 <A name=A4ED>
 ; insert new line
 </A>
 <a name=A4ED></a>A4ED   20 59 A6   JSR $<A href="#A659">A659</A>
 <a name=A4F0></a>A4F0   20 33 A5   JSR $<A href="#A533">A533</A>
 <a name=A4F3></a>A4F3   AD 00 02   LDA $0200
 <a name=A4F6></a>A4F6   F0 88      BEQ $A480
 <a name=A4F8></a>A4F8   18         CLC
 <a name=A4F9></a>A4F9   A5 2D      LDA $2D
 <a name=A4FB></a>A4FB   85 5A      STA $5A
 <a name=A4FD></a>A4FD   65 0B      ADC $0B
 <a name=A4FF></a>A4FF   85 58      STA $58
 <a name=A501></a>A501   A4 2E      LDY $2E
 <a name=A503></a>A503   84 5B      STY $5B
 <a name=A505></a>A505   90 01      BCC $A508
 <a name=A507></a>A507   C8         INY
 <a name=A508></a>A508   84 59      STY $59
 <a name=A50A></a>A50A   20 B8 A3   JSR $<A href="#A3B8">A3B8</A>
 <a name=A50D></a>A50D   A5 14      LDA $14
 <a name=A50F></a>A50F   A4 15      LDY $15
 <a name=A511></a>A511   8D FE 01   STA $01FE
 <a name=A514></a>A514   8C FF 01   STY $01FF
 <a name=A517></a>A517   A5 31      LDA $31
 <a name=A519></a>A519   A4 32      LDY $32
 <a name=A51B></a>A51B   85 2D      STA $2D
 <a name=A51D></a>A51D   84 2E      STY $2E
 <a name=A51F></a>A51F   A4 0B      LDY $0B
 <a name=A521></a>A521   88         DEY
 <a name=A522></a>A522   B9 FC 01   LDA $01FC,Y
 <a name=A525></a>A525   91 5F      STA ($5F),Y
 <a name=A527></a>A527   88         DEY
 <a name=A528></a>A528   10 F8      BPL $A522
 <A name=A52A>
 <a name=A52A></a>A52A   20 59 A6   JSR $<A href="#A659">A659</A>
 </A>
 <a name=A52D></a>A52D   20 33 A5   JSR $<A href="#A533">A533</A>
 <a name=A530></a>A530   4C 80 A4   JMP $<A href="#A480">A480</A>
 
 <A name=A533>
 ; relink basic program
 </A>
 <a name=A533></a>A533   A5 2B      LDA $2B
 <a name=A535></a>A535   A4 2C      LDY $2C
 <a name=A537></a>A537   85 22      STA $22
 <a name=A539></a>A539   84 23      STY $23
 <a name=A53B></a>A53B   18         CLC
 <a name=A53C></a>A53C   A0 01      LDY #$01
 <a name=A53E></a>A53E   B1 22      LDA ($22),Y
 <a name=A540></a>A540   F0 1D      BEQ $A55F
 <a name=A542></a>A542   A0 04      LDY #$04
 <a name=A544></a>A544   C8         INY
 <a name=A545></a>A545   B1 22      LDA ($22),Y
 <a name=A547></a>A547   D0 FB      BNE $A544
 <a name=A549></a>A549   C8         INY
 <a name=A54A></a>A54A   98         TYA
 <a name=A54B></a>A54B   65 22      ADC $22
 <a name=A54D></a>A54D   AA         TAX
 <a name=A54E></a>A54E   A0 00      LDY #$00
 <a name=A550></a>A550   91 22      STA ($22),Y
 <a name=A552></a>A552   A5 23      LDA $23
 <a name=A554></a>A554   69 00      ADC #$00
 <a name=A556></a>A556   C8         INY
 <a name=A557></a>A557   91 22      STA ($22),Y
 <a name=A559></a>A559   86 22      STX $22
 <a name=A55B></a>A55B   85 23      STA $23
 <a name=A55D></a>A55D   90 DD      BCC $A53C
 <a name=A55F></a>A55F   60         RTS
 
 <A name=A560>
 ; get statement into buffer
 </A>
 <a name=A560></a>A560   A2 00      LDX #$00
 <a name=A562></a>A562   20 12 E1   JSR $<A href="#E112">E112</A>
 <a name=A565></a>A565   C9 0D      CMP #$0D
 <a name=A567></a>A567   F0 0D      BEQ $A576
 <a name=A569></a>A569   9D 00 02   STA $0200,X
 <a name=A56C></a>A56C   E8         INX
 <a name=A56D></a>A56D   E0 59      CPX #$59
 <a name=A56F></a>A56F   90 F1      BCC $A562
 <a name=A571></a>A571   A2 17      LDX #$17   ; error number
 <a name=A573></a>A573   4C 37 A4   JMP $<A href="#A437">A437</A>
 <a name=A576></a>A576   4C CA AA   JMP $<A href="#AACA">AACA</A>   ; goto end of line
 
 <A name=A579>
 ; crunch tokens
 </A>
 <a name=A579></a>A579   6C 04 03   JMP ($0304)   ; normally <A href="#A57C">A57C</A>
 
 <A name=A57C>
 ; standard token cruncher
 </A>
 <a name=A57C></a>A57C   A6 7A      LDX $7A
 <a name=A57E></a>A57E   A0 04      LDY #$04
 <a name=A580></a>A580   84 0F      STY $0F
 <a name=A582></a>A582   BD 00 02   LDA $0200,X
 <a name=A585></a>A585   10 07      BPL $A58E
 <a name=A587></a>A587   C9 FF      CMP #$FF   ; PI
 <a name=A589></a>A589   F0 3E      BEQ $A5C9
 <a name=A58B></a>A58B   E8         INX
 <a name=A58C></a>A58C   D0 F4      BNE $A582
 <a name=A58E></a>A58E   C9 20      CMP #$20   ; space
 <a name=A590></a>A590   F0 37      BEQ $A5C9
 <a name=A592></a>A592   85 08      STA $08
 <a name=A594></a>A594   C9 22      CMP #$22    ; quote mark
 <a name=A596></a>A596   F0 56      BEQ $A5EE
 <a name=A598></a>A598   24 0F      BIT $0F
 <a name=A59A></a>A59A   70 2D      BVS $A5C9
 <a name=A59C></a>A59C   C9 3F      CMP #$3F   ; question mark
 <a name=A59E></a>A59E   D0 04      BNE $A5A4
 <a name=A5A0></a>A5A0   A9 99      LDA #$99   ; PRINT code
 <a name=A5A2></a>A5A2   D0 25      BNE $A5C9
 <a name=A5A4></a>A5A4   C9 30      CMP #$30    ; 0
 <a name=A5A6></a>A5A6   90 04      BCC $A5AC
 <a name=A5A8></a>A5A8   C9 3C      CMP #$3C
 <a name=A5AA></a>A5AA   90 1D      BCC $A5C9
 <a name=A5AC></a>A5AC   84 71      STY $71
 <a name=A5AE></a>A5AE   A0 00      LDY #$00
 <a name=A5B0></a>A5B0   84 0B      STY $0B
 <a name=A5B2></a>A5B2   88         DEY
 <a name=A5B3></a>A5B3   86 7A      STX $7A
 <a name=A5B5></a>A5B5   CA         DEX
 <a name=A5B6></a>A5B6   C8         INY
 <a name=A5B7></a>A5B7   E8         INX
 <a name=A5B8></a>A5B8   BD 00 02   LDA $0200,X
 <a name=A5BB></a>A5BB   38         SEC
 <a name=A5BC></a>A5BC   F9 9E A0   SBC $<A href="#A09E">A09E</A>,Y
 <a name=A5BF></a>A5BF   F0 F5      BEQ $A5B6
 <a name=A5C1></a>A5C1   C9 80      CMP #$80
 <a name=A5C3></a>A5C3   D0 30      BNE $A5F5
 <a name=A5C5></a>A5C5   05 0B      ORA $0B
 <a name=A5C7></a>A5C7   A4 71      LDY $71
 <a name=A5C9></a>A5C9   E8         INX
 <a name=A5CA></a>A5CA   C8         INY
 <a name=A5CB></a>A5CB   99 FB 01   STA $01FB,Y
 <a name=A5CE></a>A5CE   B9 FB 01   LDA $01FB,Y
 <a name=A5D1></a>A5D1   F0 36      BEQ $A609
 <a name=A5D3></a>A5D3   38         SEC
 <a name=A5D4></a>A5D4   E9 3A      SBC #$3A   ; colon
 <a name=A5D6></a>A5D6   F0 04      BEQ $A5DC
 <a name=A5D8></a>A5D8   C9 49      CMP #$49   ; DATA code
 <a name=A5DA></a>A5DA   D0 02      BNE $A5DE
 <a name=A5DC></a>A5DC   85 0F      STA $0F
 <a name=A5DE></a>A5DE   38         SEC
 <a name=A5DF></a>A5DF   E9 55      SBC #$55   ; REM code
 <a name=A5E1></a>A5E1   D0 9F      BNE $A582
 <a name=A5E3></a>A5E3   85 08      STA $08
 <a name=A5E5></a>A5E5   BD 00 02   LDA $0200,X
 <a name=A5E8></a>A5E8   F0 DF      BEQ $A5C9
 <a name=A5EA></a>A5EA   C5 08      CMP $08
 <a name=A5EC></a>A5EC   F0 DB      BEQ $A5C9
 <a name=A5EE></a>A5EE   C8         INY
 <a name=A5EF></a>A5EF   99 FB 01   STA $01FB,Y
 <a name=A5F2></a>A5F2   E8         INX
 <a name=A5F3></a>A5F3   D0 F0      BNE $A5E5
 <a name=A5F5></a>A5F5   A6 7A      LDX $7A
 <a name=A5F7></a>A5F7   E6 0B      INC $0B
 <a name=A5F9></a>A5F9   C8         INY
 <a name=A5FA></a>A5FA   B9 9D A0   LDA $A09D,Y
 <a name=A5FD></a>A5FD   10 FA      BPL $A5F9
 <a name=A5FF></a>A5FF   B9 9E A0   LDA $<A href="#A09E">A09E</A>,Y
 <a name=A602></a>A602   D0 B4      BNE $A5B8
 <a name=A604></a>A604   BD 00 02   LDA $0200,X
 <a name=A607></a>A607   10 BE      BPL $A5C7
 <a name=A609></a>A609   99 FD 01   STA $01FD,Y
 <a name=A60C></a>A60C   C6 7B      DEC $7B
 <a name=A60E></a>A60E   A9 FF      LDA #$FF
 <a name=A610></a>A610   85 7A      STA $7A
 <a name=A612></a>A612   60         RTS
 
 <A name=A613>
 ; search for a line in a program
 </A>
 <a name=A613></a>A613   A5 2B      LDA $2B
 <a name=A615></a>A615   A6 2C      LDX $2C
 <A name=A617>
 <a name=A617></a>A617   A0 01      LDY #$01
 </A>
 <a name=A619></a>A619   85 5F      STA $5F
 <a name=A61B></a>A61B   86 60      STX $60
 <a name=A61D></a>A61D   B1 5F      LDA ($5F),Y
 <a name=A61F></a>A61F   F0 1F      BEQ $A640
 <a name=A621></a>A621   C8         INY
 <a name=A622></a>A622   C8         INY
 <a name=A623></a>A623   A5 15      LDA $15
 <a name=A625></a>A625   D1 5F      CMP ($5F),Y
 <a name=A627></a>A627   90 18      BCC $A641
 <a name=A629></a>A629   F0 03      BEQ $A62E
 <a name=A62B></a>A62B   88         DEY
 <a name=A62C></a>A62C   D0 09      BNE $A637
 <a name=A62E></a>A62E   A5 14      LDA $14
 <a name=A630></a>A630   88         DEY
 <a name=A631></a>A631   D1 5F      CMP ($5F),Y
 <a name=A633></a>A633   90 0C      BCC $A641
 <a name=A635></a>A635   F0 0A      BEQ $A641
 <a name=A637></a>A637   88         DEY
 <a name=A638></a>A638   B1 5F      LDA ($5F),Y
 <a name=A63A></a>A63A   AA         TAX
 <a name=A63B></a>A63B   88         DEY
 <a name=A63C></a>A63C   B1 5F      LDA ($5F),Y
 <a name=A63E></a>A63E   B0 D7      BCS $A617
 <a name=A640></a>A640   18         CLC
 <a name=A641></a>A641   60         RTS


 
<A name=A642> </A>
; <b>NEW command</b>
;
; 

 <a name=xxxx></a>A642   D0 FD      BNE $A641
 <A name=A644>
 <a name=A644></a>A644   A9 00      LDA #$00
 </A>
 <a name=A646></a>A646   A8         TAY
 <a name=A647></a>A647   91 2B      STA ($2B),Y
 <a name=A649></a>A649   C8         INY
 <a name=A64A></a>A64A   91 2B      STA ($2B),Y
 <a name=A64C></a>A64C   A5 2B      LDA $2B
 <a name=A64E></a>A64E   18         CLC
 <a name=A64F></a>A64F   69 02      ADC #$02
 <a name=A651></a>A651   85 2D      STA $2D
 <a name=A653></a>A653   A5 2C      LDA $2C
 <a name=A655></a>A655   69 00      ADC #$00
 <a name=A657></a>A657   85 2E      STA $2E
 <A name=A659>
 <a name=A659></a>A659   20 8E A6   JSR $<A href="#A68E">A68E</A>
 </A>
 <a name=A65C></a>A65C   A9 00      LDA #$00
 
 <A name=A65E>
 ; CLR command
 </A>
 <a name=A65E></a>A65E   D0 2D      BNE $A68D
 <A name=A660>
 <a name=A660></a>A660   20 E7 FF   JSR $<A href="#FFE7">FFE7</A>
 </A>
 <A name=A663>
 <a name=A663></a>A663   A5 37      LDA $37
 </A>
 <a name=A665></a>A665   A4 38      LDY $38
 <a name=A667></a>A667   85 33      STA $33
 <a name=A669></a>A669   84 34      STY $34
 <a name=A66B></a>A66B   A5 2D      LDA $2D
 <a name=A66D></a>A66D   A4 2E      LDY $2E
 <a name=A66F></a>A66F   85 2F      STA $2F
 <a name=A671></a>A671   84 30      STY $30
 <a name=A673></a>A673   85 31      STA $31
 <a name=A675></a>A675   84 32      STY $32
 <A name=A677>
 <a name=A677></a>A677   20 1D A8   JSR $<A href="#A81D">A81D</A>
 </A>
 
 <A name=A67A>
 ; reset stack and program pointers
 </A>
 <a name=A67A></a>A67A   A2 19      LDX #$19
 <a name=A67C></a>A67C   86 16      STX $16
 <a name=A67E></a>A67E   68         PLA
 <a name=A67F></a>A67F   A8         TAY
 <a name=A680></a>A680   68         PLA
 <a name=A681></a>A681   A2 FA      LDX #$FA
 <a name=A683></a>A683   9A         TXS
 <a name=A684></a>A684   48         PHA
 <a name=A685></a>A685   98         TYA
 <a name=A686></a>A686   48         PHA
 <a name=A687></a>A687   A9 00      LDA #$00
 <a name=A689></a>A689   85 3E      STA $3E
 <a name=A68B></a>A68B   85 10      STA $10
 <a name=A68D></a>A68D   60         RTS
 
 <A name=A68E>
 ; set current character pointer to start of basic - 1
 </A>
 <a name=A68E></a>A68E   18         CLC
 <a name=A68F></a>A68F   A5 2B      LDA $2B
 <a name=A691></a>A691   69 FF      ADC #$FF
 <a name=A693></a>A693   85 7A      STA $7A
 <a name=A695></a>A695   A5 2C      LDA $2C
 <a name=A697></a>A697   69 FF      ADC #$FF
 <a name=A699></a>A699   85 7B      STA $7B
 <a name=A69B></a>A69B   60         RTS
 
 <A name=A69C>
 ; LIST command
 </A>
 <a name=A69C></a>A69C   90 06      BCC $A6A4
 <a name=A69E></a>A69E   F0 04      BEQ $A6A4
 <a name=A6A0></a>A6A0   C9 AB      CMP #$AB
 <a name=A6A2></a>A6A2   D0 E9      BNE $A68D
 <a name=A6A4></a>A6A4   20 6B A9   JSR $<A href="#A96B">A96B</A>
 <a name=A6A7></a>A6A7   20 13 A6   JSR $<A href="#A613">A613</A>
 <a name=A6AA></a>A6AA   20 79 00   JSR $0079
 <a name=A6AD></a>A6AD   F0 0C      BEQ $A6BB
 <a name=A6AF></a>A6AF   C9 AB      CMP #$AB
 <a name=A6B1></a>A6B1   D0 8E      BNE $A641
 <a name=A6B3></a>A6B3   20 73 00   JSR $0073
 <a name=A6B6></a>A6B6   20 6B A9   JSR $<A href="#A96B">A96B</A>
 <a name=A6B9></a>A6B9   D0 86      BNE $A641
 <a name=A6BB></a>A6BB   68         PLA
 <a name=A6BC></a>A6BC   68         PLA
 <a name=A6BD></a>A6BD   A5 14      LDA $14
 <a name=A6BF></a>A6BF   05 15      ORA $15
 <a name=A6C1></a>A6C1   D0 06      BNE $A6C9
 <a name=A6C3></a>A6C3   A9 FF      LDA #$FF
 <a name=A6C5></a>A6C5   85 14      STA $14
 <a name=A6C7></a>A6C7   85 15      STA $15
 
 <A name=A6C9>
 ; list lines from $5F/$60 to $14/$15
 </A>
 <a name=A6C9></a>A6C9   A0 01      LDY #$01
 <a name=A6CB></a>A6CB   84 0F      STY $0F
 <a name=A6CD></a>A6CD   B1 5F      LDA ($5F),Y
 <a name=A6CF></a>A6CF   F0 43      BEQ $A714
 <a name=A6D1></a>A6D1   20 2C A8   JSR $<A href="#A82C">A82C</A>
 <a name=A6D4></a>A6D4   20 D7 AA   JSR $<A href="#AAD7">AAD7</A>
 <a name=A6D7></a>A6D7   C8         INY
 <a name=A6D8></a>A6D8   B1 5F      LDA ($5F),Y
 <a name=A6DA></a>A6DA   AA         TAX
 <a name=A6DB></a>A6DB   C8         INY
 <a name=A6DC></a>A6DC   B1 5F      LDA ($5F),Y
 <a name=A6DE></a>A6DE   C5 15      CMP $15
 <a name=A6E0></a>A6E0   D0 04      BNE $A6E6
 <a name=A6E2></a>A6E2   E4 14      CPX $14
 <a name=A6E4></a>A6E4   F0 02      BEQ $A6E8
 <a name=A6E6></a>A6E6   B0 2C      BCS $A714
 <a name=A6E8></a>A6E8   84 49      STY $49
 <a name=A6EA></a>A6EA   20 CD BD   JSR $<A href="#BDCD">BDCD</A>
 <a name=A6ED></a>A6ED   A9 20      LDA #$20
 <a name=A6EF></a>A6EF   A4 49      LDY $49
 <a name=A6F1></a>A6F1   29 7F      AND #$7F
 <a name=A6F3></a>A6F3   20 47 AB   JSR $<A href="#AB47">AB47</A>
 <a name=A6F6></a>A6F6   C9 22      CMP #$22
 <a name=A6F8></a>A6F8   D0 06      BNE $A700
 <a name=A6FA></a>A6FA   A5 0F      LDA $0F
 <a name=A6FC></a>A6FC   49 FF      EOR #$FF
 <a name=A6FE></a>A6FE   85 0F      STA $0F
 <a name=A700></a>A700   C8         INY
 <a name=A701></a>A701   F0 11      BEQ $A714
 <a name=A703></a>A703   B1 5F      LDA ($5F),Y
 <a name=A705></a>A705   D0 10      BNE $A717
 <a name=A707></a>A707   A8         TAY
 <a name=A708></a>A708   B1 5F      LDA ($5F),Y
 <a name=A70A></a>A70A   AA         TAX
 <a name=A70B></a>A70B   C8         INY
 <a name=A70C></a>A70C   B1 5F      LDA ($5F),Y
 <a name=A70E></a>A70E   86 5F      STX $5F
 <a name=A710></a>A710   85 60      STA $60
 <a name=A712></a>A712   D0 B5      BNE $A6C9
 <a name=A714></a>A714   4C 86 E3   JMP $<A href="#E386">E386</A>
 
 <A name=A717>
 ; print tokens routine
 </A>
 <a name=A717></a>A717   6C 06 03   JMP ($0306)   ; normally <A href="#A71A">A71A</A>
 
 <A name=A71A>
 ; standard token printer
 </A>
 <a name=A71A></a>A71A   10 D7      BPL $A6F3
 <a name=A71C></a>A71C   C9 FF      CMP #$FF
 <a name=A71E></a>A71E   F0 D3      BEQ $A6F3
 <a name=A720></a>A720   24 0F      BIT $0F
 <a name=A722></a>A722   30 CF      BMI $A6F3
 <a name=A724></a>A724   38         SEC
 <a name=A725></a>A725   E9 7F      SBC #$7F
 <a name=A727></a>A727   AA         TAX
 <a name=A728></a>A728   84 49      STY $49
 <a name=A72A></a>A72A   A0 FF      LDY #$FF
 <a name=A72C></a>A72C   CA         DEX
 <a name=A72D></a>A72D   F0 08      BEQ $A737
 <a name=A72F></a>A72F   C8         INY
 <a name=A730></a>A730   B9 9E A0   LDA $<A href="#A09E">A09E</A>,Y
 <a name=A733></a>A733   10 FA      BPL $A72F
 <a name=A735></a>A735   30 F5      BMI $A72C
 
 <A name=A737>
 ; print keyword
 </A>
 <a name=A737></a>A737   C8         INY
 <a name=A738></a>A738   B9 9E A0   LDA $<A href="#A09E">A09E</A>,Y
 <a name=A73B></a>A73B   30 B2      BMI $A6EF
 <a name=A73D></a>A73D   20 47 AB   JSR $<A href="#AB47">AB47</A>
 <a name=A740></a>A740   D0 F5      BNE $A737
 
 <A name=A742>
 ; FOR command
 </A>
 <a name=A742></a>A742   A9 80      LDA #$80
 <a name=A744></a>A744   85 10      STA $10
 <a name=A746></a>A746   20 A5 A9   JSR $<A href="#A9A5">A9A5</A>
 <a name=A749></a>A749   20 8A A3   JSR $<A href="#A38A">A38A</A>
 <a name=A74C></a>A74C   D0 05      BNE $A753
 <a name=A74E></a>A74E   8A         TXA
 <a name=A74F></a>A74F   69 0F      ADC #$0F
 <a name=A751></a>A751   AA         TAX
 <a name=A752></a>A752   9A         TXS
 <a name=A753></a>A753   68         PLA
 <a name=A754></a>A754   68         PLA
 <a name=A755></a>A755   A9 09      LDA #$09
 <a name=A757></a>A757   20 FB A3   JSR $<A href="#A3FB">A3FB</A>
 <a name=A75A></a>A75A   20 06 A9   JSR $<A href="#A906">A906</A>
 <a name=A75D></a>A75D   18         CLC
 <a name=A75E></a>A75E   98         TYA
 <a name=A75F></a>A75F   65 7A      ADC $7A
 <a name=A761></a>A761   48         PHA
 <a name=A762></a>A762   A5 7B      LDA $7B
 <a name=A764></a>A764   69 00      ADC #$00
 <a name=A766></a>A766   48         PHA
 <a name=A767></a>A767   A5 3A      LDA $3A
 <a name=A769></a>A769   48         PHA
 <a name=A76A></a>A76A   A5 39      LDA $39
 <a name=A76C></a>A76C   48         PHA
 <a name=A76D></a>A76D   A9 A4      LDA #$A4
 <a name=A76F></a>A76F   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=A772></a>A772   20 8D AD   JSR $<A href="#AD8D">AD8D</A>
 <a name=A775></a>A775   20 8A AD   JSR $<A href="#AD8A">AD8A</A>
 <a name=A778></a>A778   A5 66      LDA $66
 <a name=A77A></a>A77A   09 7F      ORA #$7F
 <a name=A77C></a>A77C   25 62      AND $62
 <a name=A77E></a>A77E   85 62      STA $62
 <a name=A780></a>A780   A9 8B      LDA #$8B   ; low  <A href="#A78B">A78B</A>
 <a name=A782></a>A782   A0 A7      LDY #$A7   ; high <A href="#A78B">A78B</A>
 <a name=A784></a>A784   85 22      STA $22
 <a name=A786></a>A786   84 23      STY $23
 <a name=A788></a>A788   4C 43 AE   JMP $<A href="#AE43">AE43</A>
 
 <A name=A78B>
 <a name=A78B></a>A78B   A9 BC      LDA #$BC   ; low  <A href="#B9BC">B9BC</A>
 </A>
 <a name=A78D></a>A78D   A0 B9      LDY #$B9   ; high <A href="#B9BC">B9BC</A>
 <a name=A78F></a>A78F   20 A2 BB   JSR $<A href="#BBA2">BBA2</A>
 <a name=A792></a>A792   20 79 00   JSR $0079
 <a name=A795></a>A795   C9 A9      CMP #$A9
 <a name=A797></a>A797   D0 06      BNE $A79F
 <a name=A799></a>A799   20 73 00   JSR $0073
 <a name=A79C></a>A79C   20 8A AD   JSR $<A href="#AD8A">AD8A</A>
 <a name=A79F></a>A79F   20 2B BC   JSR $<A href="#BC2B">BC2B</A>
 <a name=A7A2></a>A7A2   20 38 AE   JSR $<A href="#AE38">AE38</A>
 <a name=A7A5></a>A7A5   A5 4A      LDA $4A
 <a name=A7A7></a>A7A7   48         PHA
 <a name=A7A8></a>A7A8   A5 49      LDA $49
 <a name=A7AA></a>A7AA   48         PHA
 <a name=A7AB></a>A7AB   A9 81      LDA #$81   ; FOR block code
 <a name=A7AD></a>A7AD   48         PHA
 
 <A name=A7AE>
 ; execute next statement
 </A>
 <a name=A7AE></a>A7AE   20 2C A8   JSR $<A href="#A82C">A82C</A>
 <a name=A7B1></a>A7B1   A5 7A      LDA $7A
 <a name=A7B3></a>A7B3   A4 7B      LDY $7B
 <a name=A7B5></a>A7B5   C0 02      CPY #$02
 <a name=A7B7></a>A7B7   EA         NOP
 <a name=A7B8></a>A7B8   F0 04      BEQ $A7BE
 <a name=A7BA></a>A7BA   85 3D      STA $3D
 <a name=A7BC></a>A7BC   84 3E      STY $3E
 <a name=A7BE></a>A7BE   A0 00      LDY #$00
 <a name=A7C0></a>A7C0   B1 7A      LDA ($7A),Y
 <a name=A7C2></a>A7C2   D0 43      BNE $A807
 <a name=A7C4></a>A7C4   A0 02      LDY #$02
 <a name=A7C6></a>A7C6   B1 7A      LDA ($7A),Y
 <a name=A7C8></a>A7C8   18         CLC
 <a name=A7C9></a>A7C9   D0 03      BNE $A7CE
 <a name=A7CB></a>A7CB   4C 4B A8   JMP $<A href="#A84B">A84B</A>
 
 <a name=A7CE></a>A7CE   C8         INY
 <a name=A7CF></a>A7CF   B1 7A      LDA ($7A),Y
 <a name=A7D1></a>A7D1   85 39      STA $39
 <a name=A7D3></a>A7D3   C8         INY
 <a name=A7D4></a>A7D4   B1 7A      LDA ($7A),Y
 <a name=A7D6></a>A7D6   85 3A      STA $3A
 <a name=A7D8></a>A7D8   98         TYA
 <a name=A7D9></a>A7D9   65 7A      ADC $7A
 <a name=A7DB></a>A7DB   85 7A      STA $7A
 <a name=A7DD></a>A7DD   90 02      BCC $A7E1
 <a name=A7DF></a>A7DF   E6 7B      INC $7B
 <A name=A7E1>
 <a name=A7E1></a>A7E1   6C 08 03   JMP ($0308)   ; normally <A href="#A7E4">A7E4</A>
 </A>
 
 <A name=A7E4>
 ; execute a statement
 </A>
 <a name=A7E4></a>A7E4   20 73 00   JSR $0073
 <a name=A7E7></a>A7E7   20 ED A7   JSR $<A href="#A7ED">A7ED</A>
 <a name=A7EA></a>A7EA   4C AE A7   JMP $<A href="#A7AE">A7AE</A>
 
 <A name=A7ED>
 ; execute command in A
 </A>
 <a name=A7ED></a>A7ED   F0 3C      BEQ $A82B
 <A name=A7EF>
 <a name=A7EF></a>A7EF   E9 80      SBC #$80
 </A>
 <a name=A7F1></a>A7F1   90 11      BCC $A804
 <a name=A7F3></a>A7F3   C9 23      CMP #$23
 <a name=A7F5></a>A7F5   B0 17      BCS $A80E
 <a name=A7F7></a>A7F7   0A         ASL
 <a name=A7F8></a>A7F8   A8         TAY
 <a name=A7F9></a>A7F9   B9 0D A0   LDA $A00D,Y
 <a name=A7FC></a>A7FC   48         PHA
 <a name=A7FD></a>A7FD   B9 0C A0   LDA $<A href="#A00C">A00C</A>,Y
 <a name=A800></a>A800   48         PHA
 <a name=A801></a>A801   4C 73 00   JMP $0073
 
 <a name=A804></a>A804   4C A5 A9   JMP $<A href="#A9A5">A9A5</A>
 
 <a name=A807></a>A807   C9 3A      CMP #$3A   ; colon
 <a name=A809></a>A809   F0 D6      BEQ $A7E1
 <a name=A80B></a>A80B   4C 08 AF   JMP $<A href="#AF08">AF08</A>
 
 <a name=A80E></a>A80E   C9 4B      CMP #$4B   ; GO code
 <a name=A810></a>A810   D0 F9      BNE $A80B
 <a name=A812></a>A812   20 73 00   JSR $0073
 <a name=A815></a>A815   A9 A4      LDA #$A4   ; TO code
 <a name=A817></a>A817   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=A81A></a>A81A   4C A0 A8   JMP $<A href="#A8A0">A8A0</A>   ; do GOTO
 
 <A name=A81D>
 ; RESTORE command
 </A>
 <a name=A81D></a>A81D   38         SEC         ;
 <a name=A81E></a>A81E   A5 2B      LDA $2B     ;
 <a name=A820></a>A820   E9 01      SBC #$01    ;
 <a name=A822></a>A822   A4 2C      LDY $2C     ;
 <a name=A824></a>A824   B0 01      BCS $A827   ;
 <a name=A826></a>A826   88         DEY         ;
 <A name=A827>
 <a name=A827></a>A827   85 41      STA $<A href="ram.htm#0041">41</A>     ;
 </A>
 <a name=A829></a>A829   84 42      STY $<A href="ram.htm#0042">42</A>     ;
 <a name=A82B></a>A82B   60         RTS
 
 <A name=A82C>
 <a name=A82C></a>A82C   20 E1 FF   JSR $<A href="#FFE1">FFE1</A>   ; test stop key
 </A>
 
 <A name=A82F>
 ; STOP command
 </A>
 <a name=A82F></a>A82F   B0 01      BCS $A832
 
 <A name=A831>
 ; END command
 </A>
 <a name=A831></a>A831   18         CLC
 <a name=A832></a>A832   D0 3C      BNE $A870
 <a name=A834></a>A834   A5 7A      LDA $7A
 <a name=A836></a>A836   A4 7B      LDY $7B
 <a name=A838></a>A838   A6 3A      LDX $3A
 <a name=A83A></a>A83A   E8         INX
 <a name=A83B></a>A83B   F0 0C      BEQ $A849
 <a name=A83D></a>A83D   85 3D      STA $3D
 <a name=A83F></a>A83F   84 3E      STY $3E
 <a name=A841></a>A841   A5 39      LDA $39
 <a name=A843></a>A843   A4 3A      LDY $3A
 <a name=A845></a>A845   85 3B      STA $3B
 <a name=A847></a>A847   84 3C      STY $3C
 <a name=A849></a>A849   68         PLA
 <a name=A84A></a>A84A   68         PLA
 <A name=A84B>
 <a name=A84B></a>A84B   A9 81      LDA #$81   ; low  <A href="#A381">A381</A>
 </A>
 <a name=A84D></a>A84D   A0 A3      LDY #$A3   ; high <A href="#A381">A381</A>
 <a name=A84F></a>A84F   90 03      BCC $A854
 <a name=A851></a>A851   4C 69 A4   JMP $<A href="#A469">A469</A>
 <a name=A854></a>A854   4C 86 E3   JMP $<A href="#E386">E386</A>
 
 <A name=A857>
 ; CONT command
 </A>
 <a name=A857></a>A857   D0 17      BNE $A870
 <a name=A859></a>A859   A2 1A      LDX #$1A   ; error number
 <a name=A85B></a>A85B   A4 3E      LDY $3E
 <a name=A85D></a>A85D   D0 03      BNE $A862
 <a name=A85F></a>A85F   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <a name=A862></a>A862   A5 3D      LDA $3D
 <a name=A864></a>A864   85 7A      STA $7A
 <a name=A866></a>A866   84 7B      STY $7B
 <a name=A868></a>A868   A5 3B      LDA $3B
 <a name=A86A></a>A86A   A4 3C      LDY $3C
 <a name=A86C></a>A86C   85 39      STA $39
 <a name=A86E></a>A86E   84 3A      STY $3A
 <a name=A870></a>A870   60         RTS
 
 <A name=A871>
 ; RUN command
 </A>
 <a name=A871></a>A871   08         PHP
 <a name=A872></a>A872   A9 00      LDA #$00
 <a name=A874></a>A874   20 90 FF   JSR $<A href="#FF90">FF90</A>
 <a name=A877></a>A877   28         PLP
 <a name=A878></a>A878   D0 03      BNE $A87D
 <a name=A87A></a>A87A   4C 59 A6   JMP $<A href="#A659">A659</A>
 
 <a name=A87D></a>A87D   20 60 A6   JSR $<A href="#A660">A660</A>   ; do CLR
 <a name=A880></a>A880   4C 97 A8   JMP $<A href="#A897">A897</A>   ; do GOTO
 
 <A name=A883>
 ; GOSUB command
 </A>
 <a name=A883></a>A883   A9 03      LDA #$03
 <a name=A885></a>A885   20 FB A3   JSR $<A href="#A3FB">A3FB</A>
 <a name=A888></a>A888   A5 7B      LDA $7B
 <a name=A88A></a>A88A   48         PHA
 <a name=A88B></a>A88B   A5 7A      LDA $7A
 <a name=A88D></a>A88D   48         PHA
 <a name=A88E></a>A88E   A5 3A      LDA $3A
 <a name=A890></a>A890   48         PHA
 <a name=A891></a>A891   A5 39      LDA $39
 <a name=A893></a>A893   48         PHA
 <a name=A894></a>A894   A9 8D      LDA #$8D
 <a name=A896></a>A896   48         PHA
 <A name=A897>
 <a name=A897></a>A897   20 79 00   JSR $0079
 </A>
 <a name=A89A></a>A89A   20 A0 A8   JSR $<A href="#A8A0">A8A0</A>
 <a name=A89D></a>A89D   4C AE A7   JMP $<A href="#A7AE">A7AE</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=A8A0>
 ; GOTO command
 </A>
 <a name=A8A0></a>A8A0   20 6B A9   JSR $<A href="#A96B">A96B</A>       ; 
 <a name=A8A3></a>A8A3   20 09 A9   JSR $<A href="#A909">A909</A>       ; skip forward to end of BASIC line... This is necessary 
                                   ; because if searching forward from current line, search 
                                   ; starts from $7A/7B and assumes that points to an EOL marker...
 <a name=A8A6></a>A8A6   38         SEC             ; 
 <a name=A8A7></a>A8A7   A5 39      LDA $39         ; Subtract destination from current line# to see
 <a name=A8A9></a>A8A9   E5 14      SBC $14         ;   if it is a forward or backward reference...
 <a name=A8AB></a>A8AB   A5 3A      LDA $3A         ; 
 <a name=A8AD></a>A8AD   E5 15      SBC $15         ; 
 <a name=A8AF></a>A8AF   B0 0B      BCS $A8BC       ; Current line# is >= new line# ... search from beginning
 <a name=A8B1></a>A8B1   98         TYA             ; 
 <a name=A8B2></a>A8B2   38         SEC             ; 
 <a name=A8B3></a>A8B3   65 7A      ADC $7A         ; 
 <a name=A8B5></a>A8B5   A6 7B      LDX $7B         ; 
 <a name=A8B7></a>A8B7   90 07      BCC $A8C0       ; 
 <a name=A8B9></a>A8B9   E8         INX             ; 
 <a name=A8BA></a>A8BA   B0 04      BCS $A8C0       ; 
 <a name=A8BC></a>A8BC   A5 2B      LDA $2B         ; 
 <a name=A8BE></a>A8BE   A6 2C      LDX $2C         ; 
 <a name=A8C0></a>A8C0   20 17 A6   JSR $<A href="#A617">A617</A>       ; 
 <a name=A8C3></a>A8C3   90 1E      BCC $A8E3       ; 
 <a name=A8C5></a>A8C5   A5 5F      LDA $5F         ; 
 <a name=A8C7></a>A8C7   E9 01      SBC #$01        ; 
 <a name=A8C9></a>A8C9   85 7A      STA $7A         ; 
 <a name=A8CB></a>A8CB   A5 60      LDA $60         ; 
 <a name=A8CD></a>A8CD   E9 00      SBC #$00        ; 
 <a name=A8CF></a>A8CF   85 7B      STA $7B         ; 
 <a name=A8D1></a>A8D1   60         RTS             ; 


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=A8D2>
 ; RETURN command
 </A>
 <a name=A8D2></a>A8D2   D0 FD      BNE $A8D1
 <a name=A8D4></a>A8D4   A9 FF      LDA #$FF
 <a name=A8D6></a>A8D6   85 4A      STA $4A
 <a name=A8D8></a>A8D8   20 8A A3   JSR $<A href="#A38A">A38A</A>
 <a name=A8DB></a>A8DB   9A         TXS
 <a name=A8DC></a>A8DC   C9 8D      CMP #$8D
 <a name=A8DE></a>A8DE   F0 0B      BEQ $A8EB
 <a name=A8E0></a>A8E0   A2 0C      LDX #$0C
 <a name=A8E2></a>A8E2   .BY $2C
 <a name=A8E3></a>A8E3   A2 11      LDX #$11
 <a name=A8E5></a>A8E5   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <a name=A8E8></a>A8E8   4C 08 AF   JMP $<A href="#AF08">AF08</A>
 
 <A name=A8EB>
 ; remove GOSUB block from stack
 </A>
 <a name=A8EB></a>A8EB   68         PLA
 <a name=A8EC></a>A8EC   68         PLA
 <a name=A8ED></a>A8ED   85 39      STA $39
 <a name=A8EF></a>A8EF   68         PLA
 <a name=A8F0></a>A8F0   85 3A      STA $3A
 <a name=A8F2></a>A8F2   68         PLA
 <a name=A8F3></a>A8F3   85 7A      STA $7A
 <a name=A8F5></a>A8F5   68         PLA
 <a name=A8F6></a>A8F6   85 7B      STA $7B
 
 <A name=A8F8>
 ; DATA command
 </A>
 <a name=A8F8></a>A8F8   20 06 A9   JSR $<A href="#A906">A906</A>
 <A name=A8FB>
 <a name=A8FB></a>A8FB   98         TYA
 </A>
 <a name=A8FC></a>A8FC   18         CLC
 <a name=A8FD></a>A8FD   65 7A      ADC $7A
 <a name=A8FF></a>A8FF   85 7A      STA $7A
 <a name=A901></a>A901   90 02      BCC $A905
 <a name=A903></a>A903   E6 7B      INC $7B
 <a name=A905></a>A905   60         RTS
 
 <A name=A906>
 ; get end of statement
 </A>
 <a name=A906></a>A906   A2 3A      LDX #$3A   ; colon
 <a name=A908></a>A908   .BY $2C
 
 <A name=A909>
 ; get end of line
 </A>
 <a name=A909></a>A909   A2 00      LDX #$00
 <a name=A90B></a>A90B   86 07      STX $07
 <a name=A90D></a>A90D   A0 00      LDY #$00
 <a name=A90F></a>A90F   84 08      STY $08
 <a name=A911></a>A911   A5 08      LDA $08
 <a name=A913></a>A913   A6 07      LDX $07
 <a name=A915></a>A915   85 07      STA $07
 <a name=A917></a>A917   86 08      STX $08
 <a name=A919></a>A919   B1 7A      LDA ($7A),Y
 <a name=A91B></a>A91B   F0 E8      BEQ $A905
 <a name=A91D></a>A91D   C5 08      CMP $08
 <a name=A91F></a>A91F   F0 E4      BEQ $A905
 <a name=A921></a>A921   C8         INY
 <a name=A922></a>A922   C9 22      CMP #$22   ; quote mark
 <a name=A924></a>A924   D0 F3      BNE $A919
 <a name=A926></a>A926   F0 E9      BEQ $A911

 <A name=A928>
 ; IF command
 </A>
 <a name=A928></a>A928   20 9E AD   JSR $<A href="#AD9E">AD9E</A>
 <a name=A92B></a>A92B   20 79 00   JSR $0079
 <a name=A92E></a>A92E   C9 89      CMP #$89
 <a name=A930></a>A930   F0 05      BEQ $A937
 <a name=A932></a>A932   A9 A7      LDA #$A7
 <a name=A934></a>A934   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=A937></a>A937   A5 61      LDA $61
 <a name=A939></a>A939   D0 05      BNE $A940
 
 <A name=A93B>
 ; REM command
 </A>
 <a name=A93B></a>A93B   20 09 A9   JSR $<A href="#A909">A909</A>
 <a name=A93E></a>A93E   F0 BB      BEQ $A8FB
 
 <A name=A940>
 ; THEN part of IF
 </A>
 <a name=A940></a>A940   20 79 00   JSR $0079
 <a name=A943></a>A943   B0 03      BCS $A948
 <a name=A945></a>A945   4C A0 A8   JMP $<A href="#A8A0">A8A0</A>   ; do GOTO
 <a name=A948></a>A948   4C ED A7   JMP $<A href="#A7ED">A7ED</A>
 
 <A name=A94B>
 ; ON command
 </A>
 <a name=A94B></a>A94B   20 9E B7   JSR $<A href="#B79E">B79E</A>
 <a name=A94E></a>A94E   48         PHA
 <a name=A94F></a>A94F   C9 8D      CMP #$8D   ; GOSUB code
 <a name=A951></a>A951   F0 04      BEQ $A957
 <a name=A953></a>A953   C9 89      CMP #$89   ; GOTO code
 <a name=A955></a>A955   D0 91      BNE $A8E8
 <a name=A957></a>A957   C6 65      DEC $65
 <a name=A959></a>A959   D0 04      BNE $A95F
 <a name=A95B></a>A95B   68         PLA
 <a name=A95C></a>A95C   4C EF A7   JMP $<A href="#A7EF">A7EF</A>
 <a name=A95F></a>A95F   20 73 00   JSR $0073
 <a name=A962></a>A962   20 6B A9   JSR $<A href="#A96B">A96B</A>
 <a name=A965></a>A965   C9 2C      CMP #$2C   ; comma
 <a name=A967></a>A967   F0 EE      BEQ $A957
 <a name=A969></a>A969   68         PLA
 <a name=A96A></a>A96A   60         RTS
 
 <A name=A96B>
 ; get decimal number into $14/$15
 </A>
 <a name=A96B></a>A96B   A2 00      LDX #$00
 <a name=A96D></a>A96D   86 14      STX $14
 <a name=A96F></a>A96F   86 15      STX $15
 <A name=A971>
 <a name=A971></a>A971   B0 F7      BCS $A96A
 </A>
 <a name=A973></a>A973   E9 2F      SBC #$2F
 <a name=A975></a>A975   85 07      STA $07
 <a name=A977></a>A977   A5 15      LDA $15
 <a name=A979></a>A979   85 22      STA $22
 <a name=A97B></a>A97B   C9 19      CMP #$19
 <a name=A97D></a>A97D   B0 D4      BCS $A953
 <a name=A97F></a>A97F   A5 14      LDA $14
 <a name=A981></a>A981   0A         ASL   ; times 2
 <a name=A982></a>A982   26 22      ROL $22
 <a name=A984></a>A984   0A         ASL   ; times 2
 <a name=A985></a>A985   26 22      ROL $22
 <a name=A987></a>A987   65 14      ADC $14   ; add original
 <a name=A989></a>A989   85 14      STA $14
 <a name=A98B></a>A98B   A5 22      LDA $22
 <a name=A98D></a>A98D   65 15      ADC $15
 <a name=A98F></a>A98F   85 15      STA $15
 <a name=A991></a>A991   06 14      ASL $14   ; times 2
 <a name=A993></a>A993   26 15      ROL $15   ; = times 10 overall
 <a name=A995></a>A995   A5 14      LDA $14
 <a name=A997></a>A997   65 07      ADC $07
 <a name=A999></a>A999   85 14      STA $14
 <a name=A99B></a>A99B   90 02      BCC $A99F
 <a name=A99D></a>A99D   E6 15      INC $15
 <a name=A99F></a>A99F   20 73 00   JSR $0073
 <a name=A9A2></a>A9A2   4C 71 A9   JMP $<A href="#A971">A971</A>
 
 <A name=A9A5>
 ; LET command
 </A>
 <a name=A9A5></a>A9A5   20 8B B0   JSR $<A href="#B08B">B08B</A>
 <a name=A9A8></a>A9A8   85 49      STA $49
 <a name=A9AA></a>A9AA   84 4A      STY $4A
 <a name=A9AC></a>A9AC   A9 B2      LDA #$B2    ; equals code
 <a name=A9AE></a>A9AE   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=A9B1></a>A9B1   A5 0E      LDA $0E
 <a name=A9B3></a>A9B3   48         PHA
 <a name=A9B4></a>A9B4   A5 0D      LDA $0D
 <a name=A9B6></a>A9B6   48         PHA
 <a name=A9B7></a>A9B7   20 9E AD   JSR $<A href="#AD9E">AD9E</A>
 <a name=A9BA></a>A9BA   68         PLA
 <a name=A9BB></a>A9BB   2A         ROL
 <a name=A9BC></a>A9BC   20 90 AD   JSR $<A href="#AD90">AD90</A>
 <a name=A9BF></a>A9BF   D0 18      BNE $A9D9
 <a name=A9C1></a>A9C1   68         PLA
 <A name=A9C2>
 <a name=A9C2></a>A9C2   10 12      BPL $A9D6
 </A>
 
 <A name=A9C4>
 ; assign to integer
 </A>
 <a name=A9C4></a>A9C4   20 1B BC   JSR $<A href="#BC1B">BC1B</A>
 <a name=A9C7></a>A9C7   20 BF B1   JSR $<A href="#B1BF">B1BF</A>
 <a name=A9CA></a>A9CA   A0 00      LDY #$00
 <a name=A9CC></a>A9CC   A5 64      LDA $64
 <a name=A9CE></a>A9CE   91 49      STA ($49),Y
 <a name=A9D0></a>A9D0   C8         INY
 <a name=A9D1></a>A9D1   A5 65      LDA $65
 <a name=A9D3></a>A9D3   91 49      STA ($49),Y
 <a name=A9D5></a>A9D5   60         RTS
 
 <A name=A9D6>
 ; assign to float
 </A>
 <a name=A9D6></a>A9D6   4C D0 BB   JMP $<A href="#BBD0">BBD0</A>
 
 <A name=A9D9>
 ; assign to string
 </A>
 <a name=A9D9></a>A9D9   68         PLA
 <A name=A9DA>
 <a name=A9DA></a>A9DA   A4 4A      LDY $4A
 </A>
 <a name=A9DC></a>A9DC   C0 BF      CPY #$BF
 <a name=A9DE></a>A9DE   D0 4C      BNE $AA2C
 
 <A name=A9E0>
 ; assign to TI$
 </A>
 <a name=A9E0></a>A9E0   20 A6 B6   JSR $<A href="#B6A6">B6A6</A>
 <a name=A9E3></a>A9E3   C9 06      CMP #$06   ; length 6
 <a name=A9E5></a>A9E5   D0 3D      BNE $AA24
 <a name=A9E7></a>A9E7   A0 00      LDY #$00
 <a name=A9E9></a>A9E9   84 61      STY $61
 <a name=A9EB></a>A9EB   84 66      STY $66
 <a name=A9ED></a>A9ED   84 71      STY $71
 <a name=A9EF></a>A9EF   20 1D AA   JSR $<A href="#AA1D">AA1D</A>
 <a name=A9F2></a>A9F2   20 E2 BA   JSR $<A href="#BAE2">BAE2</A>
 <a name=A9F5></a>A9F5   E6 71      INC $71
 <a name=A9F7></a>A9F7   A4 71      LDY $71
 <a name=A9F9></a>A9F9   20 1D AA   JSR $<A href="#AA1D">AA1D</A>
 <a name=A9FC></a>A9FC   20 0C BC   JSR $<A href="#BC0C">BC0C</A>
 <a name=A9FF></a>A9FF   AA         TAX
 <a name=AA00></a>AA00   F0 05      BEQ $AA07
 <a name=AA02></a>AA02   E8         INX
 <a name=AA03></a>AA03   8A         TXA
 <a name=AA04></a>AA04   20 ED BA   JSR $<A href="#BAED">BAED</A>
 <a name=AA07></a>AA07   A4 71      LDY $71
 <a name=AA09></a>AA09   C8         INY
 <a name=AA0A></a>AA0A   C0 06      CPY #$06
 <a name=AA0C></a>AA0C   D0 DF      BNE $A9ED
 <a name=AA0E></a>AA0E   20 E2 BA   JSR $<A href="#BAE2">BAE2</A>
 <a name=AA11></a>AA11   20 9B BC   JSR $<A href="#BC9B">BC9B</A>
 <a name=AA14></a>AA14   A6 64      LDX $64
 <a name=AA16></a>AA16   A4 63      LDY $63
 <a name=AA18></a>AA18   A5 65      LDA $65
 <a name=AA1A></a>AA1A   4C DB FF   JMP $<A href="#FFDB">FFDB</A>
 
 <A name=AA1D>
 ; add next digit to float accum
 </A>
 <a name=AA1D></a>AA1D   B1 22      LDA ($22),Y
 <a name=AA1F></a>AA1F   20 80 00   JSR $0080
 <a name=AA22></a>AA22   90 03      BCC $AA27
 <a name=AA24></a>AA24   4C 48 B2   JMP $<A href="#B248">B248</A>
 
 <a name=AA27></a>AA27   E9 2F      SBC #$2F
 <a name=AA29></a>AA29   4C 7E BD   JMP $<A href="#BD7E">BD7E</A>
 
 <A name=AA2C>
 ; assign to string variable
 </A>
 <a name=AA2C></a>AA2C   A0 02      LDY #$02
 <a name=AA2E></a>AA2E   B1 64      LDA ($64),Y
 <a name=AA30></a>AA30   C5 34      CMP $34
 <a name=AA32></a>AA32   90 17      BCC $AA4B
 <a name=AA34></a>AA34   D0 07      BNE $AA3D
 <a name=AA36></a>AA36   88         DEY
 <a name=AA37></a>AA37   B1 64      LDA ($64),Y
 <a name=AA39></a>AA39   C5 33      CMP $33
 <a name=AA3B></a>AA3B   90 0E      BCC $AA4B
 <a name=AA3D></a>AA3D   A4 65      LDY $65
 <a name=AA3F></a>AA3F   C4 2E      CPY $2E
 <a name=AA41></a>AA41   90 08      BCC $AA4B
 <a name=AA43></a>AA43   D0 0D      BNE $AA52
 <a name=AA45></a>AA45   A5 64      LDA $64
 <a name=AA47></a>AA47   C5 2D      CMP $2D
 <a name=AA49></a>AA49   B0 07      BCS $AA52
 <a name=AA4B></a>AA4B   A5 64      LDA $64
 <a name=AA4D></a>AA4D   A4 65      LDY $65
 <a name=AA4F></a>AA4F   4C 68 AA   JMP $<A href="#AA68">AA68</A>
 
 <a name=AA52></a>AA52   A0 00      LDY #$00
 <a name=AA54></a>AA54   B1 64      LDA ($64),Y
 <a name=AA56></a>AA56   20 75 B4   JSR $<A href="#B475">B475</A>
 <a name=AA59></a>AA59   A5 50      LDA $50
 <a name=AA5B></a>AA5B   A4 51      LDY $51
 <a name=AA5D></a>AA5D   85 6F      STA $6F
 <a name=AA5F></a>AA5F   84 70      STY $70
 <a name=AA61></a>AA61   20 7A B6   JSR $<A href="#B67A">B67A</A>
 <a name=AA64></a>AA64   A9 61      LDA #$61   ; low  0061
 <a name=AA66></a>AA66   A0 00      LDY #$00   ; high 0061
 
 <A name=AA68>
 ; move descriptor into variable
 </A>
 <a name=AA68></a>AA68   85 50      STA $50
 <a name=AA6A></a>AA6A   84 51      STY $51
 <a name=AA6C></a>AA6C   20 DB B6   JSR $<A href="#B6DB">B6DB</A>
 <a name=AA6F></a>AA6F   A0 00      LDY #$00
 <a name=AA71></a>AA71   B1 50      LDA ($50),Y
 <a name=AA73></a>AA73   91 49      STA ($49),Y
 <a name=AA75></a>AA75   C8         INY
 <a name=AA76></a>AA76   B1 50      LDA ($50),Y
 <a name=AA78></a>AA78   91 49      STA ($49),Y
 <a name=AA7A></a>AA7A   C8         INY
 <a name=AA7B></a>AA7B   B1 50      LDA ($50),Y
 <a name=AA7D></a>AA7D   91 49      STA ($49),Y
 <a name=AA7F></a>AA7F   60         RTS
 
 <A name=AA80>
 ; PRINT# comand
 </A>
 <a name=AA80></a>AA80   20 86 AA   JSR $<A href="#AA86">AA86</A>
 <a name=AA83></a>AA83   4C B5 AB   JMP $<A href="#ABB5">ABB5</A>
 
 <A name=AA86>
 ; CMD command
 </A>
 <a name=AA86></a>AA86   20 9E B7   JSR $<A href="#B79E">B79E</A>
 <a name=AA89></a>AA89   F0 05      BEQ $AA90
 <a name=AA8B></a>AA8B   A9 2C      LDA #$2C    ; comma
 <a name=AA8D></a>AA8D   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=AA90></a>AA90   08         PHP
 <a name=AA91></a>AA91   86 13      STX $13
 <a name=AA93></a>AA93   20 18 E1   JSR $<A href="#E118">E118</A>
 <a name=AA96></a>AA96   28         PLP
 <a name=AA97></a>AA97   4C A0 AA   JMP $<A href="#AAA0">AAA0</A>   ; do PRINT
 
 <a name=AA9A></a>AA9A   20 21 AB   JSR $<A href="#AB21">AB21</A>
 <a name=AA9D></a>AA9D   20 79 00   JSR $0079
 
 <A name=AAA0>
 ; PRINT command
 </A>
 <a name=AAA0></a>AAA0   F0 35      BEQ $AAD7
 <A name=AAA2>
 <a name=AAA2></a>AAA2   F0 43      BEQ $AAE7
 </A>
 <a name=AAA4></a>AAA4   C9 A3      CMP #$A3   ; TAB( code
 <a name=AAA6></a>AAA6   F0 50      BEQ $AAF8
 <a name=AAA8></a>AAA8   C9 A6      CMP #$A6   ; SPC( code
 <a name=AAAA></a>AAAA   18         CLC
 <a name=AAAB></a>AAAB   F0 4B      BEQ $AAF8
 <a name=AAAD></a>AAAD   C9 2C      CMP #$2C   ; comma
 <a name=AAAF></a>AAAF   F0 37      BEQ $AAE8
 <a name=AAB1></a>AAB1   C9 3B      CMP #$3B   ; semi-colon
 <a name=AAB3></a>AAB3   F0 5E      BEQ $AB13
 <a name=AAB5></a>AAB5   20 9E AD   JSR $<A href="#AD9E">AD9E</A>
 <a name=AAB8></a>AAB8   24 0D      BIT $0D
 <a name=AABA></a>AABA   30 DE      BMI $AA9A
 <a name=AABC></a>AABC   20 DD BD   JSR $<A href="#BDDD">BDDD</A>
 <a name=AABF></a>AABF   20 87 B4   JSR $<A href="#B487">B487</A>
 <a name=AAC2></a>AAC2   20 21 AB   JSR $<A href="#AB21">AB21</A>
 <a name=AAC5></a>AAC5   20 3B AB   JSR $<A href="#AB3B">AB3B</A>
 <a name=AAC8></a>AAC8   D0 D3      BNE $AA9D
 
 <A name=AACA>
 ; end statement in buffer and screen
 </A>
 <a name=AACA></a>AACA   A9 00      LDA #$00
 <a name=AACC></a>AACC   9D 00 02   STA $0200,X
 <a name=AACF></a>AACF   A2 FF      LDX #$FF
 <a name=AAD1></a>AAD1   A0 01      LDY #$01
 <a name=AAD3></a>AAD3   A5 13      LDA $13
 <a name=AAD5></a>AAD5   D0 10      BNE $AAE7
 
 <A name=AAD7>
 ; end line on CMD output file
 </A>
 <a name=AAD7></a>AAD7   A9 0D      LDA #$0D
 <a name=AAD9></a>AAD9   20 47 AB   JSR $<A href="#AB47">AB47</A>
 <a name=AADC></a>AADC   24 13      BIT $13
 <a name=AADE></a>AADE   10 05      BPL $AAE5
 <a name=AAE0></a>AAE0   A9 0A      LDA #$0A
 <a name=AAE2></a>AAE2   20 47 AB   JSR $<A href="#AB47">AB47</A>
 <A name=AAE5>
 <a name=AAE5></a>AAE5   49 FF      EOR #$FF
 </A>
 <a name=AAE7></a>AAE7   60         RTS
 
 <A name=AAE8>
 ; routine for printing TAB( and SPC(
 </A>
 <a name=AAE8></a>AAE8   38         SEC
 <a name=AAE9></a>AAE9   20 F0 FF   JSR $<A href="#FFF0">FFF0</A>
 <a name=AAEC></a>AAEC   98         TYA
 <a name=AAED></a>AAED   38         SEC
 <a name=AAEE></a>AAEE   E9 0A      SBC #$0A
 <a name=AAF0></a>AAF0   B0 FC      BCS $AAEE
 <a name=AAF2></a>AAF2   49 FF      EOR #$FF
 <a name=AAF4></a>AAF4   69 01      ADC #$01
 <a name=AAF6></a>AAF6   D0 16      BNE $AB0E
 <a name=AAF8></a>AAF8   08         PHP
 <a name=AAF9></a>AAF9   38         SEC
 <a name=AAFA></a>AAFA   20 F0 FF   JSR $<A href="#FFF0">FFF0</A>
 <a name=AAFD></a>AAFD   84 09      STY $09
 <a name=AAFF></a>AAFF   20 9B B7   JSR $<A href="#B79B">B79B</A>
 <a name=AB02></a>AB02   C9 29      CMP #$29   ; )
 <a name=AB04></a>AB04   D0 59      BNE $AB5F
 <a name=AB06></a>AB06   28         PLP
 <a name=AB07></a>AB07   90 06      BCC $AB0F
 <a name=AB09></a>AB09   8A         TXA
 <a name=AB0A></a>AB0A   E5 09      SBC $09
 <a name=AB0C></a>AB0C   90 05      BCC $AB13
 <a name=AB0E></a>AB0E   AA         TAX
 <a name=AB0F></a>AB0F   E8         INX
 <a name=AB10></a>AB10   CA         DEX
 <a name=AB11></a>AB11   D0 06      BNE $AB19
 <a name=AB13></a>AB13   20 73 00   JSR $0073
 <a name=AB16></a>AB16   4C A2 AA   JMP $<A href="#AAA2">AAA2</A>
 <a name=AB19></a>AB19   20 3B AB   JSR $<A href="#AB3B">AB3B</A>
 <a name=AB1C></a>AB1C   D0 F2      BNE $AB10
 
 <A name=AB1E>
 ; print string form AY
 </A>
 <a name=AB1E></a>AB1E   20 87 B4   JSR $<A href="#B487">B487</A>
 
 <A name=AB21>
 ; print string from $22/$23
 </A>
 <a name=AB21></a>AB21   20 A6 B6   JSR $<A href="#B6A6">B6A6</A>
 <a name=AB24></a>AB24   AA         TAX
 <a name=AB25></a>AB25   A0 00      LDY #$00
 <a name=AB27></a>AB27   E8         INX
 <A name=AB28>
 <a name=AB28></a>AB28   CA         DEX
 </A>
 <a name=AB29></a>AB29   F0 BC      BEQ $AAE7
 <a name=AB2B></a>AB2B   B1 22      LDA ($22),Y
 <a name=AB2D></a>AB2D   20 47 AB   JSR $<A href="#AB47">AB47</A>
 <a name=AB30></a>AB30   C8         INY
 <a name=AB31></a>AB31   C9 0D      CMP #$0D
 <a name=AB33></a>AB33   D0 F3      BNE $AB28
 <a name=AB35></a>AB35   20 E5 AA   JSR $<A href="#AAE5">AAE5</A>
 <a name=AB38></a>AB38   4C 28 AB   JMP $<A href="#AB28">AB28</A>
 
 <A name=AB3B>
 ; print character on CMD output file
 </A>
 <a name=AB3B></a>AB3B   A5 13      LDA $13
 <a name=AB3D></a>AB3D   F0 03      BEQ $AB42
 <a name=AB3F></a>AB3F   A9 20      LDA #$20   ; space
 <a name=AB41></a>AB41   .BY $2C
 <a name=AB42></a>AB42   A9 1D      LDA #$1D   ; csr right
 <a name=AB44></a>AB44   .BY $2C
 <A name=AB45>
 <a name=AB45></a>AB45   A9 3F      LDA #$3F   ; question mark
 </A>
 <A name=AB47>
 <a name=AB47></a>AB47   20 0C E1   JSR $<A href="#E10C">E10C</A>
 </A>
 <a name=AB4A></a>AB4A   29 FF      AND #$FF
 <a name=AB4C></a>AB4C   60         RTS
 
 <A name=AB4D>
 ; read errors
 </A>
 <a name=AB4D></a>AB4D   A5 11      LDA $11
 <a name=AB4F></a>AB4F   F0 11      BEQ $AB62
 <a name=AB51></a>AB51   30 04      BMI $AB57
 <a name=AB53></a>AB53   A0 FF      LDY #$FF
 <a name=AB55></a>AB55   D0 04      BNE $AB5B
 <a name=AB57></a>AB57   A5 3F      LDA $3F
 <a name=AB59></a>AB59   A4 40      LDY $40
 <a name=AB5B></a>AB5B   85 39      STA $39
 <a name=AB5D></a>AB5D   84 3A      STY $3A
 <a name=AB5F></a>AB5F   4C 08 AF   JMP $<A href="#AF08">AF08</A>
 <a name=AB62></a>AB62   A5 13      LDA $13
 <a name=AB64></a>AB64   F0 05      BEQ $AB6B
 <a name=AB66></a>AB66   A2 18      LDX #$18
 <a name=AB68></a>AB68   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <a name=AB6B></a>AB6B   A9 0C      LDA #$0C   ; low  <A href="#AD0C">AD0C</A>
 <a name=AB6D></a>AB6D   A0 AD      LDY #$AD   ; high <A href="#AD0C">AD0C</A>
 <a name=AB6F></a>AB6F   20 1E AB   JSR $<A href="#AB1E">AB1E</A>
 <a name=AB72></a>AB72   A5 3D      LDA $3D
 <a name=AB74></a>AB74   A4 3E      LDY $3E
 <a name=AB76></a>AB76   85 7A      STA $7A
 <a name=AB78></a>AB78   84 7B      STY $7B
 <a name=AB7A></a>AB7A   60         RTS
 
 <A name=AB7B>
 ; GET command
 </A>
 <a name=AB7B></a>AB7B   20 A6 B3   JSR $<A href="#B3A6">B3A6</A>
 <a name=AB7E></a>AB7E   C9 23      CMP #$23   ; #
 <a name=AB80></a>AB80   D0 10      BNE $AB92
 <a name=AB82></a>AB82   20 73 00   JSR $0073
 <a name=AB85></a>AB85   20 9E B7   JSR $<A href="#B79E">B79E</A>
 <a name=AB88></a>AB88   A9 2C      LDA #$2C   ; comma
 <a name=AB8A></a>AB8A   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=AB8D></a>AB8D   86 13      STX $13
 <a name=AB8F></a>AB8F   20 1E E1   JSR $<A href="#E11E">E11E</A>
 <a name=AB92></a>AB92   A2 01      LDX #$01
 <a name=AB94></a>AB94   A0 02      LDY #$02
 <a name=AB96></a>AB96   A9 00      LDA #$00
 <a name=AB98></a>AB98   8D 01 02   STA $0201
 <a name=AB9B></a>AB9B   A9 40      LDA #$40   ; GET code
 <a name=AB9D></a>AB9D   20 0F AC   JSR $<A href="#AC0F">AC0F</A>
 <a name=ABA0></a>ABA0   A6 13      LDX $13
 <a name=ABA2></a>ABA2   D0 13      BNE $ABB7
 <a name=ABA4></a>ABA4   60         RTS
 
 <A name=ABA5>
 ; INPUT# command
 </A>
 <a name=ABA5></a>ABA5   20 9E B7   JSR $<A href="#B79E">B79E</A>
 <a name=ABA8></a>ABA8   A9 2C      LDA #$2C   ; comma
 <a name=ABAA></a>ABAA   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=ABAD></a>ABAD   86 13      STX $13
 <a name=ABAF></a>ABAF   20 1E E1   JSR $<A href="#E11E">E11E</A>
 <a name=ABB2></a>ABB2   20 CE AB   JSR $<A href="#ABCE">ABCE</A>
 <A name=ABB5>
 <a name=ABB5></a>ABB5   A5 13      LDA $13
 </A>
 <a name=ABB7></a>ABB7   20 CC FF   JSR $<A href="#FFCC">FFCC</A>
 <a name=ABBA></a>ABBA   A2 00      LDX #$00
 <a name=ABBC></a>ABBC   86 13      STX $13
 <a name=ABBE></a>ABBE   60         RTS
 
 <A name=ABBF>
 ; INPUT command
 </A>
 <a name=ABBF></a>ABBF   C9 22      CMP #$22   ; quote mark
 <a name=ABC1></a>ABC1   D0 0B      BNE $ABCE
 <a name=ABC3></a>ABC3   20 BD AE   JSR $<A href="#AEBD">AEBD</A>
 <a name=ABC6></a>ABC6   A9 3B      LDA #$3B   ; semi-colon
 <a name=ABC8></a>ABC8   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=ABCB></a>ABCB   20 21 AB   JSR $<A href="#AB21">AB21</A>
 <A name=ABCE>
 <a name=ABCE></a>ABCE   20 A6 B3   JSR $<A href="#B3A6">B3A6</A>
 </A>
 <a name=ABD1></a>ABD1   A9 2C      LDA #$2C   ; comma
 <a name=ABD3></a>ABD3   8D FF 01   STA $01FF
 <a name=ABD6></a>ABD6   20 F9 AB   JSR $<A href="#ABF9">ABF9</A>
 <a name=ABD9></a>ABD9   A5 13      LDA $13
 <a name=ABDB></a>ABDB   F0 0D      BEQ $ABEA
 <a name=ABDD></a>ABDD   20 B7 FF   JSR $<A href="#FFB7">FFB7</A>                                                                          
 <a name=ABE0></a>ABE0   29 02      AND #$02
 <a name=ABE2></a>ABE2   F0 06      BEQ $ABEA
 <a name=ABE4></a>ABE4   20 B5 AB   JSR $<A href="#ABB5">ABB5</A>
 <a name=ABE7></a>ABE7   4C F8 A8   JMP $<A href="#A8F8">A8F8</A>   ; do DATA
 
 <a name=ABEA></a>ABEA   AD 00 02   LDA $0200
 <a name=ABED></a>ABED   D0 1E      BNE $AC0D
 <a name=ABEF></a>ABEF   A5 13      LDA $13
 <a name=ABF1></a>ABF1   D0 E3      BNE $ABD6
 <a name=ABF3></a>ABF3   20 06 A9   JSR $<A href="#A906">A906</A>
 <a name=ABF6></a>ABF6   4C FB A8   JMP $<A href="#A8FB">A8FB</A>
 
 <A name=ABF9>
 ; get line into input buffer
 </A>
 <a name=ABF9></a>ABF9   A5 13      LDA $13
 <a name=ABFB></a>ABFB   D0 06      BNE $AC03
 <a name=ABFD></a>ABFD   20 45 AB   JSR $<A href="#AB45">AB45</A>
 <a name=AC00></a>AC00   20 3B AB   JSR $<A href="#AB3B">AB3B</A>
 <a name=AC03></a>AC03   4C 60 A5   JMP $<A href="#A560">A560</A>
 
 <A name=AC06>
 ; READ command
 </A>
 <a name=AC06></a>AC06   A6 41      LDX $41
 <a name=AC08></a>AC08   A4 42      LDY $42
 <a name=AC0A></a>AC0A   A9 98      LDA #$98   ; READ code
 <a name=AC0C></a>AC0C   .BY $2C
 <a name=AC0D></a>AC0D   A9 00      LDA #$00
 <A name=AC0F>
 <a name=AC0F></a>AC0F   85 11      STA $11
 </A>
 <a name=AC11></a>AC11   86 43      STX $43
 <a name=AC13></a>AC13   84 44      STY $44
 <A name=AC15>
 <a name=AC15></a>AC15   20 8B B0   JSR $<A href="#B08B">B08B</A>
 </A>
 <a name=AC18></a>AC18   85 49      STA $49
 <a name=AC1A></a>AC1A   84 4A      STY $4A
 <a name=AC1C></a>AC1C   A5 7A      LDA $7A
 <a name=AC1E></a>AC1E   A4 7B      LDY $7B
 <a name=AC20></a>AC20   85 4B      STA $4B
 <a name=AC22></a>AC22   84 4C      STY $4C
 <a name=AC24></a>AC24   A6 43      LDX $43
 <a name=AC26></a>AC26   A4 44      LDY $44
 <a name=AC28></a>AC28   86 7A      STX $7A
 <a name=AC2A></a>AC2A   84 7B      STY $7B
 <a name=AC2C></a>AC2C   20 79 00   JSR $0079
 <a name=AC2F></a>AC2F   D0 20      BNE $AC51
 <a name=AC31></a>AC31   24 11      BIT $11
 <a name=AC33></a>AC33   50 0C      BVC $AC41
 <a name=AC35></a>AC35   20 24 E1   JSR $<A href="#E124">E124</A>
 <a name=AC38></a>AC38   8D 00 02   STA $0200
 <a name=AC3B></a>AC3B   A2 FF      LDX #$FF
 <a name=AC3D></a>AC3D   A0 01      LDY #$01
 <a name=AC3F></a>AC3F   D0 0C      BNE $AC4D
 <a name=AC41></a>AC41   30 75      BMI $ACB8
 <a name=AC43></a>AC43   A5 13      LDA $13
 <a name=AC45></a>AC45   D0 03      BNE $AC4A
 <a name=AC47></a>AC47   20 45 AB   JSR $<A href="#AB45">AB45</A>
 <a name=AC4A></a>AC4A   20 F9 AB   JSR $<A href="#ABF9">ABF9</A>
 <a name=AC4D></a>AC4D   86 7A      STX $7A
 <a name=AC4F></a>AC4F   84 7B      STY $7B
 <A name=AC51>
 <a name=AC51></a>AC51   20 73 00   JSR $0073
 </A>
 <a name=AC54></a>AC54   24 0D      BIT $0D
 <a name=AC56></a>AC56   10 31      BPL $AC89
 <a name=AC58></a>AC58   24 11      BIT $11
 <a name=AC5A></a>AC5A   50 09      BVC $AC65
 <a name=AC5C></a>AC5C   E8         INX
 <a name=AC5D></a>AC5D   86 7A      STX $7A
 <a name=AC5F></a>AC5F   A9 00      LDA #$00
 <a name=AC61></a>AC61   85 07      STA $07
 <a name=AC63></a>AC63   F0 0C      BEQ $AC71
 <a name=AC65></a>AC65   85 07      STA $07
 <a name=AC67></a>AC67   C9 22      CMP #$22   ; quote mark
 <a name=AC69></a>AC69   F0 07      BEQ $AC72
 <a name=AC6B></a>AC6B   A9 3A      LDA #$3A   ; colon
 <a name=AC6D></a>AC6D   85 07      STA $07
 <a name=AC6F></a>AC6F   A9 2C      LDA #$2C   ; comma
 <a name=AC71></a>AC71   18         CLC
 <a name=AC72></a>AC72   85 08      STA $08
 <a name=AC74></a>AC74   A5 7A      LDA $7A
 <a name=AC76></a>AC76   A4 7B      LDY $7B
 <a name=AC78></a>AC78   69 00      ADC #$00
 <a name=AC7A></a>AC7A   90 01      BCC $AC7D
 <a name=AC7C></a>AC7C   C8         INY
 <a name=AC7D></a>AC7D   20 8D B4   JSR $<A href="#B48D">B48D</A>
 <a name=AC80></a>AC80   20 E2 B7   JSR $<A href="#B7E2">B7E2</A>
 <a name=AC83></a>AC83   20 DA A9   JSR $<A href="#A9DA">A9DA</A>
 <a name=AC86></a>AC86   4C 91 AC   JMP $<A href="#AC91">AC91</A>
 
 <a name=AC89></a>AC89   20 F3 BC   JSR $<A href="#BCF3">BCF3</A>
 <a name=AC8C></a>AC8C   A5 0E      LDA $0E
 <a name=AC8E></a>AC8E   20 C2 A9   JSR $<A href="#A9C2">A9C2</A>
 <A name=AC91>
 <a name=AC91></a>AC91   20 79 00   JSR $0079
 </A>
 <a name=AC94></a>AC94   F0 07      BEQ $AC9D
 <a name=AC96></a>AC96   C9 2C      CMP #$2C   ; comma
 <a name=AC98></a>AC98   F0 03      BEQ $AC9D
 <a name=AC9A></a>AC9A   4C 4D AB   JMP $<A href="#AB4D">AB4D</A>
 
 <a name=AC9D></a>AC9D   A5 7A      LDA $7A
 <a name=AC9F></a>AC9F   A4 7B      LDY $7B
 <a name=ACA1></a>ACA1   85 43      STA $43
 <a name=ACA3></a>ACA3   84 44      STY $44
 <a name=ACA5></a>ACA5   A5 4B      LDA $4B
 <a name=ACA7></a>ACA7   A4 4C      LDY $4C
 <a name=ACA9></a>ACA9   85 7A      STA $7A
 <a name=ACAB></a>ACAB   84 7B      STY $7B
 <a name=ACAD></a>ACAD   20 79 00   JSR $0079
 <a name=ACB0></a>ACB0   F0 2D      BEQ $ACDF
 <a name=ACB2></a>ACB2   20 FD AE   JSR $<A href="#AEF7">AEFD</A>

 <a name=ACB5></a>ACB5   4C 15 AC   JMP $<A href="#AC15">AC15</A>
 
 <a name=ACB8></a>ACB8   20 06 A9   JSR $<A href="#A906">A906</A>
 <a name=ACBB></a>ACBB   C8         INY
 <a name=ACBC></a>ACBC   AA         TAX
 <a name=ACBD></a>ACBD   D0 12      BNE $ACD1
 <a name=ACBF></a>ACBF   A2 0D      LDX #$0D   ; error number
 <a name=ACC1></a>ACC1   C8         INY
 <a name=ACC2></a>ACC2   B1 7A      LDA ($7A),Y
 <a name=ACC4></a>ACC4   F0 6C      BEQ $AD32
 <a name=ACC6></a>ACC6   C8         INY
 <a name=ACC7></a>ACC7   B1 7A      LDA ($7A),Y
 <a name=ACC9></a>ACC9   85 3F      STA $3F
 <a name=ACCB></a>ACCB   C8         INY
 <a name=ACCC></a>ACCC   B1 7A      LDA ($7A),Y
 <a name=ACCE></a>ACCE   C8         INY
 <a name=ACCF></a>ACCF   85 40      STA $40
 <a name=ACD1></a>ACD1   20 FB A8   JSR $<A href="#A8FB">A8FB</A>
 <a name=ACD4></a>ACD4   20 79 00   JSR $0079
 <a name=ACD7></a>ACD7   AA         TAX
 <a name=ACD8></a>ACD8   E0 83      CPX #$83   ; DATA code
 <a name=ACDA></a>ACDA   D0 DC      BNE $ACB8
 <a name=ACDC></a>ACDC   4C 51 AC   JMP $<A href="#AC51">AC51</A>
 
 <a name=ACDF></a>ACDF   A5 43      LDA $43
 <a name=ACE1></a>ACE1   A4 44      LDY $44
 <a name=ACE3></a>ACE3   A6 11      LDX $11
 <a name=ACE5></a>ACE5   10 03      BPL $ACEA
 <a name=ACE7></a>ACE7   4C 27 A8   JMP $<A href="#A827">A827</A>
 
 <a name=ACEA></a>ACEA   A0 00      LDY #$00
 <a name=ACEC></a>ACEC   B1 43      LDA ($43),Y
 <a name=ACEE></a>ACEE   F0 0B      BEQ $ACFB
 <a name=ACF0></a>ACF0   A5 13      LDA $13
 <a name=ACF2></a>ACF2   D0 07      BNE $ACFB
 <a name=ACF4></a>ACF4   A9 FC      LDA #$FC   ; low  <A href="#ACFC">ACFC</A>
 <a name=ACF6></a>ACF6   A0 AC      LDY #$AC   ; high <A href="#ACFC">ACFC</A>
 <a name=ACF8></a>ACF8   4C 1E AB   JMP $<A href="#AB1E">AB1E</A>
 
 <a name=ACFB></a>ACFB   60         RTS
 
 ; messages used dring READ
 <A name=ACFC>
 ; ?EXTRA IGNORED
 </A>
 <a name=ACFC></a>ACFC   .BY $3F,$45,$58,$54,$52,$41
 <a name=AD02></a>AD02   .BY $20,$49,$47,$4E,$4F,$52,$45,$44
 <a name=AD0A></a>AD0A   .BY $0D,$00
 <A name=AD0C>
 ; ?REDO FROM START
 </A>
 <a name=AD0C></a>AD0C   .BY $3F,$52,$45,$44,$4F
 <a name=AD11></a>AD11   .BY $20,$46,$52,$4F,$4D
 <a name=AD16></a>AD16   .BY $20,$53,$54,$41,$52,$54
 <a name=AD1C></a>AD1C   .BY $0D,$00
 
 <A name=AD1E>
 ; NEXT command
 </A>
 <a name=AD1E></a>AD1E   D0 04      BNE $AD24
 <a name=AD20></a>AD20   A0 00      LDY #$00
 <a name=AD22></a>AD22   F0 03      BEQ $AD27
 <A name=AD24>
 <a name=AD24></a>AD24   20 8B B0   JSR $<A href="#B08B">B08B</A>
 </A>
 <a name=AD27></a>AD27   85 49      STA $49
 <a name=AD29></a>AD29   84 4A      STY $4A
 <a name=AD2B></a>AD2B   20 8A A3   JSR $<A href="#A38A">A38A</A>
 <a name=AD2E></a>AD2E   F0 05      BEQ $AD35
 <a name=AD30></a>AD30   A2 0A      LDX #$0A   ; error number
 <a name=AD32></a>AD32   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <a name=AD35></a>AD35   9A         TXS
 <a name=AD36></a>AD36   8A         TXA
 <a name=AD37></a>AD37   18         CLC
 <a name=AD38></a>AD38   69 04      ADC #$04
 <a name=AD3A></a>AD3A   48         PHA
 <a name=AD3B></a>AD3B   69 06      ADC #$06
 <a name=AD3D></a>AD3D   85 24      STA $24
 <a name=AD3F></a>AD3F   68         PLA
 <a name=AD40></a>AD40   A0 01      LDY #$01
 <a name=AD42></a>AD42   20 A2 BB   JSR $<A href="#BBA2">BBA2</A>
 <a name=AD45></a>AD45   BA         TSX
 <a name=AD46></a>AD46   BD 09 01   LDA $0109,X
 <a name=AD49></a>AD49   85 66      STA $66
 <a name=AD4B></a>AD4B   A5 49      LDA $49
 <a name=AD4D></a>AD4D   A4 4A      LDY $4A
 <a name=AD4F></a>AD4F   20 67 B8   JSR $<A href="#B867">B867</A>
 <a name=AD52></a>AD52   20 D0 BB   JSR $<A href="#BBD0">BBD0</A>
 <a name=AD55></a>AD55   A0 01      LDY #$01
 <a name=AD57></a>AD57   20 5D BC   JSR $<A href="#BC5D">BC5D</A>
 <a name=AD5A></a>AD5A   BA         TSX
 <a name=AD5B></a>AD5B   38         SEC
 <a name=AD5C></a>AD5C   FD 09 01   SBC $0109,X
 <a name=AD5F></a>AD5F   F0 17      BEQ $AD78
 <a name=AD61></a>AD61   BD 0F 01   LDA $010F,X
 <a name=AD64></a>AD64   85 39      STA $39
 <a name=AD66></a>AD66   BD 10 01   LDA $0110,X
 <a name=AD69></a>AD69   85 3A      STA $3A
 <a name=AD6B></a>AD6B   BD 12 01   LDA $0112,X
 <a name=AD6E></a>AD6E   85 7A      STA $7A
 <a name=AD70></a>AD70   BD 11 01   LDA $0111,X
 <a name=AD73></a>AD73   85 7B      STA $7B
 
 <a name=AD75></a>AD75   4C AE A7   JMP $<A href="#A7AE">A7AE</A>
 <a name=AD78></a>AD78   8A         TXA
 <a name=AD79></a>AD79   69 11      ADC #$11
 <a name=AD7B></a>AD7B   AA         TAX
 <a name=AD7C></a>AD7C   9A         TXS
 <a name=AD7D></a>AD7D   20 79 00   JSR $0079
 <a name=AD80></a>AD80   C9 2C      CMP #$2C   ; comma
 <a name=AD82></a>AD82   D0 F1      BNE $AD75
 <a name=AD84></a>AD84   20 73 00   JSR $0073
 <a name=AD87></a>AD87   20 24 AD   JSR $<A href="#AD24">AD24</A>
 
 <A name=AD8A>
 ; get next non-string value
 </A>
 <a name=AD8A></a>AD8A   20 9E AD   JSR $<A href="#AD9E">AD9E</A>
 
 <A name=AD8D>
 <a name=AD8D></a>AD8D   18         CLC
 </A>
 <a name=AD8E></a>AD8E   .BY $24                         ; $24 = BIT $xx.  Bypasses SEC as a param of BIT
 
 <A name=AD8F>
 ; check value to be string
 </A>
 <a name=AD8F></a>AD8F   38         SEC
 
 <A name=AD90>
 ; check value according to C flag
 </A>
 <a name=AD90></a>AD90   24 0D      BIT $0D
 <a name=AD92></a>AD92   30 03      BMI $AD97
 <a name=AD94></a>AD94   B0 03      BCS $AD99
 <a name=AD96></a>AD96   60         RTS
 
 <a name=AD97></a>AD97   B0 FD      BCS $AD96
 <a name=AD99></a>AD99   A2 16      LDX #$16
 <a name=AD9B></a>AD9B   4C 37 A4   JMP $<A href="#A437">A437</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 2 </b></i>      <HR align=center width=50%>
</div> <div class="level2">
<!--------------------------------------------------------------------------------------------------------->

              
 <A name=AD9E></A>
;<b> evaluate expression </b>
;    Referenced by:  <A href="#A928">A928</A> <A href="#A9B7">A9B7</A> <A href="#AAB5">AAB5</A> <A href="#AD8A">AD8A</A>

 <a name=xxxx></a>AD9E   A6 7A      LDX $<A href="ram.htm#007A">7A</A>         ; Decrement TXTPTR (ptr to BASIC token).  Why?  The loop uses 
 <a name=ADA0></a>ADA0   D0 02      BNE $ADA4    +  ;| CHRGET for each character it reads, but the first token to evaluate
 <a name=ADA2></a>ADA2   C6 7B      DEC $<A href="ram.htm#007A">7B</A>         ;| has already been read and would require CHRGOT.
*<a name=ADA4></a>ADA4   C6 7A      DEC $<A href="ram.htm#007A">7A</A>         ;| Summary... This is a pre-loop fixup.
 <a name=ADA6></a>ADA6   A2 00      LDX #$00
 <a name=ADA8></a>ADA8   .BY $24                    ; BIT opcode <a href="#rom_BIT_trick">trick</a> to skip over the next PHA
 <a name=ADA9></a>ADA9   48         PHA             ; First time through, push only 00 on the stack  Why???
 <a name=ADAA></a>ADAA   8A         TXA             ; The remaining loop iterations will push A then X 
 <a name=ADAB></a>ADAB   48         PHA             ; What's the significance of .A and .X ???
 <a name=ADAC></a>ADAC   A9 01      LDA #$01        ; Each element in expression requires 1 word on stack (2 bytes)
 <a name=ADAE></a>ADAE   20 FB A3   JSR $<A href="#A3FB">A3FB</A>       ; Check stack space.  if no room, won't come back
 <a name=ADB1></a>ADB1   20 83 AE   JSR $<A href="#AE83">AE83</A>       ; "Get Arithmetic Element" -- Where is that element put???
 <a name=ADB4></a>ADB4   A9 00      LDA #$00
 <a name=ADB6></a>ADB6   85 4D      STA $<A href="ram.htm#004D">4D</A>         ; PRG... Temp Pointer / Data Area
 <a name=ADB8></a>ADB8   20 79 00   JSR $0079       ; CHRGOT... re-get character that was encountered after the arithmetic element


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 2   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->


 <a name=ADBB></a>ADBB   38         SEC
 <a name=ADBC></a>ADBC   E9 B1      SBC #$B1            ; code for greater than
 <a name=ADBE></a>ADBE   90 17      BCC $ADD7    +
 <a name=ADC0></a>ADC0   C9 03      CMP #$03
 <a name=ADC2></a>ADC2   B0 13      BCS $ADD7    +
 <a name=ADC4></a>ADC4   C9 01      CMP #$01
 <a name=ADC6></a>ADC6   2A         ROL
 <a name=ADC7></a>ADC7   49 01      EOR #$01
 <a name=ADC9></a>ADC9   45 4D      EOR $4D
 <a name=ADCB></a>ADCB   C5 4D      CMP $4D
 <a name=ADCD></a>ADCD   90 61      BCC $<A href="#AE30">AE30</A>
 <a name=ADCF></a>ADCF   85 4D      STA $4D
 <a name=ADD1></a>ADD1   20 73 00   JSR $0073
 <a name=ADD4></a>ADD4   4C BB AD   JMP $<A href="#ADBB">ADBB</A>
 
*<a name=ADD7></a>ADD7   A6 4D      LDX $4D
 <a name=ADD9></a>ADD9   D0 2C      BNE $AE07
 <a name=ADDB></a>ADDB   B0 7B      BCS $AE58
 <a name=ADDD></a>ADDD   69 07      ADC #$07
 <a name=ADDF></a>ADDF   90 77      BCC $AE58
 <a name=ADE1></a>ADE1   65 0D      ADC $0D
 <a name=ADE3></a>ADE3   D0 03      BNE $ADE8
 <a name=ADE5></a>ADE5   4C 3D B6   JMP $<A href="#B63D">B63D</A>
 
 <a name=ADE8></a>ADE8   69 FF      ADC #$FF
 <a name=ADEA></a>ADEA   85 22      STA $22              ; A=A*3  (entries in op priority table are 3-byte)
 <a name=ADEC></a>ADEC   0A         ASL
 <a name=ADED></a>ADED   65 22      ADC $22
 <a name=ADEF></a>ADEF   A8         TAY
 <a name=ADF0></a>ADF0   68         PLA
 <a name=ADF1></a>ADF1   D9 80 A0   CMP $<A href="#A080">A080</A>,Y
 <a name=ADF4></a>ADF4   B0 67      BCS $AE5D
 <a name=ADF6></a>ADF6   20 8D AD   JSR $<A href="#AD8D">AD8D</A>
 <a name=ADF9></a>ADF9   48         PHA
 <A name=ADFA>
 <a name=ADFA></a>ADFA   20 20 AE   JSR $<A href="#AE20">AE20</A>
 </A>
 <a name=ADFD></a>ADFD   68         PLA
 <a name=ADFE></a>ADFE   A4 4B      LDY $4B
 <a name=AE00></a>AE00   10 17      BPL $AE19
 <a name=AE02></a>AE02   AA         TAX
 <a name=AE03></a>AE03   F0 56      BEQ $AE5B
 <a name=AE05></a>AE05   D0 5F      BNE $AE66
 <a name=AE07></a>AE07   46 0D      LSR $0D
 <a name=AE09></a>AE09   8A         TXA
 <a name=AE0A></a>AE0A   2A         ROL
 <a name=AE0B></a>AE0B   A6 7A      LDX $7A
 <a name=AE0D></a>AE0D   D0 02      BNE $AE11
 <a name=AE0F></a>AE0F   C6 7B      DEC $7B
 <a name=AE11></a>AE11   C6 7A      DEC $7A
 <a name=AE13></a>AE13   A0 1B      LDY #$1B
 <a name=AE15></a>AE15   85 4D      STA $4D
 <a name=AE17></a>AE17   D0 D7      BNE $ADF0
 <a name=AE19></a>AE19   D9 80 A0   CMP $<A href="#A080">A080</A>,Y
 <a name=AE1C></a>AE1C   B0 48      BCS $AE66
 <a name=AE1E></a>AE1E   90 D9      BCC $ADF9
 
 <A name=AE20>
 ; recursive entry for evaluation of expressions
 </A>
 <a name=AE20></a>AE20   B9 82 A0   LDA $<A href="#A080">A082</A>,Y
 <a name=AE23></a>AE23   48         PHA
 <a name=AE24></a>AE24   B9 81 A0   LDA $<A href="#A080">A081</A>,Y
 <a name=AE27></a>AE27   48         PHA
 <a name=AE28></a>AE28   20 33 AE   JSR $<A href="#AE33">AE33</A>
 <a name=AE2B></a>AE2B   A5 4D      LDA $4D
 <a name=AE2D></a>AE2D   4C A9 AD   JMP $<A href="#ADA9">ADA9</A>            ; Why 2 jmps in a row?  Does the first one somehow return??
 <a name=AE30></a>AE30   4C 08 AF   JMP $<A href="#AF08">AF08</A>            ; This is branched to from one place.  This may just be a convenient place to branch to 
 
 <A name=AE33>
 ; save rounded value of left operand
 </A>
 <a name=AE33></a>AE33   A5 66      LDA $66
 <a name=AE35></a>AE35   BE 80 A0   LDX $<A href="#A080">A080</A>,Y
 <A name=AE38>
 <a name=AE38></a>AE38   A8         TAY
 </A>
 <a name=AE39></a>AE39   68         PLA   ; pull return address
 <a name=AE3A></a>AE3A   85 22      STA $22
 <a name=AE3C></a>AE3C   E6 22      INC $22
 <a name=AE3E></a>AE3E   68         PLA   ; and store in $22/$23
 <a name=AE3F></a>AE3F   85 23      STA $23
 <a name=AE41></a>AE41   98         TYA
 <a name=AE42></a>AE42   48         PHA
 <A name=AE43>
 <a name=AE43></a>AE43   20 1B BC   JSR $<A href="#BC1B">BC1B</A>
 </A>
 <a name=AE46></a>AE46   A5 65      LDA $65
 <a name=AE48></a>AE48   48         PHA
 <a name=AE49></a>AE49   A5 64      LDA $64
 <a name=AE4B></a>AE4B   48         PHA
 <a name=AE4C></a>AE4C   A5 63      LDA $63
 <a name=AE4E></a>AE4E   48         PHA
 <a name=AE4F></a>AE4F   A5 62      LDA $62
 <a name=AE51></a>AE51   48         PHA
 <a name=AE52></a>AE52   A5 61      LDA $61
 <a name=AE54></a>AE54   48         PHA
 <a name=AE55></a>AE55   6C 22 00   JMP ($0022)   ; return to caller
 
 <A name=AE58>
 ; apply operator
 </A>
 <a name=AE58></a>AE58   A0 FF      LDY #$FF
 <a name=AE5A></a>AE5A   68         PLA
 <a name=AE5B></a>AE5B   F0 23      BEQ $AE80
 <a name=AE5D></a>AE5D   C9 64      CMP #$64
 <a name=AE5F></a>AE5F   F0 03      BEQ $AE64
 <a name=AE61></a>AE61   20 8D AD   JSR $<A href="#AD8D">AD8D</A>
 <a name=AE64></a>AE64   84 4B      STY $4B
 <a name=AE66></a>AE66   68         PLA
 <a name=AE67></a>AE67   4A         LSR
 <a name=AE68></a>AE68   85 12      STA $12
 <a name=AE6A></a>AE6A   68         PLA
 <a name=AE6B></a>AE6B   85 69      STA $69
 <a name=AE6D></a>AE6D   68         PLA
 <a name=AE6E></a>AE6E   85 6A      STA $6A
 <a name=AE70></a>AE70   68         PLA
 <a name=AE71></a>AE71   85 6B      STA $6B
 <a name=AE73></a>AE73   68         PLA
 <a name=AE74></a>AE74   85 6C      STA $6C
 <a name=AE76></a>AE76   68         PLA
 <a name=AE77></a>AE77   85 6D      STA $6D
 <a name=AE79></a>AE79   68         PLA
 <a name=AE7A></a>AE7A   85 6E      STA $6E
 <a name=AE7C></a>AE7C   45 66      EOR $66
 <a name=AE7E></a>AE7E   85 6F      STA $6F
 <a name=AE80></a>AE80   A5 61      LDA $61
 <a name=AE82></a>AE82   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->


 <A name=AE83></A>
; <b>get arithmetic element</b>
;
; referenced by:  <A href="#ADB1">ADB1</A> <A href="#B643">B643</A>

 <a name=AE83></a>AE83   6C 0A 03   JMP ($<a href="ram.htm#030A">030A</a>)     ; Normally <A href="#AE86">AE86</A>


 <A name=AE86> </A>
; <b>standard "get arithmetic element" routine</b>

 <a name=AE86></a>AE86   A9 00      LDA #$00
 <a name=AE88></a>AE88   85 0D      STA $<A href="ram.htm#000D">0D</A>         ; VALTYP: Assume numeric for now
 <a name=AE8A></a>AE8A   20 73 00   JSR $<A href="#0073">0073</A>       ; CHRGET, get next byte of program
 <a name=AE8D></a>AE8D   B0 03      BCS $AE92   +   ; .C set?  not a numeral
 <a name=AE8F></a>AE8F   4C F3 BC   JMP $<A href="#BCF3">BCF3</A>       ; .C=0: digit encountered... read literal value
 
*<a name=AE92></a>AE92   20 13 B1   JSR $<A href="#B113">B113</A>       ; Check for letter
 <a name=AE95></a>AE95   90 03      BCC $AE9A   +   ; .C=0? not a letter
 <a name=AE97></a>AE97   4C 28 AF   JMP $<A href="#AF28">AF28</A>       ; .C=1: letter found; get variable name
 
*<a name=AE9A></a>AE9A   C9 FF      CMP #$FF        ; code for PI (PETSCII)
 <a name=AE9C></a>AE9C   D0 0F      BNE $AEAD   +   ; not PI
 <a name=AE9E></a>AE9E   A9 A8      LDA #$A8        ; .A/.Y = <A href="#AEA8">AEA8</A> -- address of floating-point PI constant
 <a name=AEA0></a>AEA0   A0 AE      LDY #$AE        ;
 <a name=AEA2></a>AEA2   20 A2 BB   JSR $<A href="#BBA2">BBA2</A>       ; Copy numeric constant into FAC
 <a name=AEA5></a>AEA5   4C 73 00   JMP $<A href="#0073">0073</A>       ; Get next character, RTS

 
<A name=AEA8> </A>
;<b> float value of PI </b>
 <a name=AEA8></a>AEA8   .BY $82,$49,$0F,$DA,$A1


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
*<a name=AEAD></a>AEAD   C9 2E      CMP #$2E   ; decimal point
 <a name=AEAF></a>AEAF   F0 DE      BEQ $AE8F
 <a name=AEB1></a>AEB1   C9 AB      CMP #$AB   ; plus code
 <a name=AEB3></a>AEB3   F0 58      BEQ $AF0D
 <a name=AEB5></a>AEB5   C9 AA      CMP #$AA   ; times code
 <a name=AEB7></a>AEB7   F0 D1      BEQ $AE8A
 <a name=AEB9></a>AEB9   C9 22      CMP #$22   ; quote mark
 <a name=AEBB></a>AEBB   D0 0F      BNE $AECC
 <A name=AEBD>
 <a name=AEBD></a>AEBD   A5 7A      LDA $7A
 </A>
 <a name=AEBF></a>AEBF   A4 7B      LDY $7B
 <a name=AEC1></a>AEC1   69 00      ADC #$00
 <a name=AEC3></a>AEC3   90 01      BCC $AEC6
 <a name=AEC5></a>AEC5   C8         INY
 <a name=AEC6></a>AEC6   20 87 B4   JSR $<A href="#B487">B487</A>
 <a name=AEC9></a>AEC9   4C E2 B7   JMP $<A href="#B7E2">B7E2</A>
 
 <a name=AECC></a>AECC   C9 A8      CMP #$A8   ; NOT code
 <a name=AECE></a>AECE   D0 13      BNE $AEE3
 <a name=AED0></a>AED0   A0 18      LDY #$18
 <a name=AED2></a>AED2   D0 3B      BNE $AF0F
 
 <A name=AED4>
 ; NOT operator
 </A>
 <a name=AED4></a>AED4   20 BF B1   JSR $<A href="#B1BF">B1BF</A>
 <a name=AED7></a>AED7   A5 65      LDA $65
 <a name=AED9></a>AED9   49 FF      EOR #$FF
 <a name=AEDB></a>AEDB   A8         TAY
 <a name=AEDC></a>AEDC   A5 64      LDA $64
 <a name=AEDE></a>AEDE   49 FF      EOR #$FF
 <a name=AEE0></a>AEE0   4C 91 B3   JMP $<A href="#B391">B391</A>
 
 <A name=AEE3>
 ; GET operand
 </A>
 <a name=AEE3></a>AEE3   C9 A5      CMP #$A5
 <a name=AEE5></a>AEE5   D0 03      BNE $AEEA
 <a name=AEE7></a>AEE7   4C F4 B3   JMP $<A href="#B3F4">B3F4</A>
 
 <a name=AEEA></a>AEEA   C9 B4      CMP #$B4    ; SGN code or higher
 <a name=AEEC></a>AEEC   90 03      BCC $AEF1
 <a name=AEEE></a>AEEE   4C A7 AF   JMP $<A href="#AFA7">AFA7</A>
 
 <a name=AEF1></a>AEF1   20 FA AE   JSR $<A href="#AEFA">AEFA</A>
 <a name=AEF4></a>AEF4   20 9E AD   JSR $<A href="#AD9E">AD9E</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->


 <A name=AEF7> </A>
; <b>check and skip character</b>
; The most commonly checked characters have their own entry points below
;      These are for right-paren (<A href="#AEF7">AEF7</A>), left-paren (<A href="#AEFA">AEFA</A>), and comma (<A href="#AEFD">AEFD</A>)
;      Use the main entry point, <A href="#AEFF">AEFF</A>, to check for <i>any character</i>. (See below for more details)

; ----- <b>entry to check for ")"</b> -----                 <A name="AEF7">
; <i>References:  <A href="#B20B">B20B</A> <A href="#B3C6">B3C6</A> <A href="#B761">B761</A> </i>
 <a name=xxxx></a>AEF7   A9 29      LDA #$29        ; check right paren ")"
 <a name=AEF9></a>AEF9   .BY 2C                     ; BIT trick.  BIT $zzzz hides next 2-byte instruc as a 2-byte operand
; ----- <b>entry to check for "("</b> -----                 <a name=AEFA></a> 
; <i>References:  <A href="#AEF1">AEF1</A> <A href="#AFB1">AFB1</A> <A href="#B3B9">B3B9</A></i>
 <a name=xxxx></a>AEFA   A9 28      LDA #$28        ; check left paren "("
 <a name=AEFC></a>AEFC   .BY 2C                     ; BIT trick.  BIT $zzzz hides next 2-byte instruc as a 2-byte operand
; ----- <b>entry to check for "," -----                     </b> <a name=AEFD></a>
; <i>References:  <A href="#ACB2">ACB2</A> <A href="#AFB7">AFB7</A> <A href="#B07E">B07E</A> <A href="#B742">B742</A> <A href="#B7F1">B7F1</A> <A href="#E20E">E20E</A></i>
 <a name=xxxx></a>AEFD   A9 2C      LDA #$2C        ; check comma ","

<a name=AEFF></a>
; <b>main entry point: check and skip character</b>
; Makes sure that the current token at <a href="ram.htm#007A">TXTPTR</a> matches 
; the one specified in .A.  A mismatch results in a "SYNTAX ERROR".
; If they match, the token is consumed.
; <i>The specific entry points above will slip through to this point.</i>
; <b>Inputs:</b> A=character to check for
;
; References:  <A href="#A76F">A76F</A> <A href="#A817">A817</A> <A href="#A934">A934</A> <A href="#A9AE">A9AE</A> <A href="#AA8D">AA8D</A> <A href="#AB8A">AB8A</A> <A href="#ABAA">ABAA</A> <A href="#ABC8">ABC8</A> <A href="#B3CB">B3CB</A> <A href="#B3E3">B3E3</A> 

 <a name=xxxx></a>AEFF   A0 00      LDY #$00
 <a name=AF01></a>AF01   D1 7A      CMP ($<A href="ram.htm#007A">7A</A>),Y     ; Test for character.  Acesses (TXTPTR) directly
 <a name=AF03></a>AF03   D0 03      BNE $AF08   +   ; mismatch? yes, syntax error
 <a name=AF05></a>AF05   4C 73 00   JMP $<A href="#0073">0073</A>       ; no. Consume token then RTS
*<a name=AF08></a>AF08   A2 0B      LDX #$0B        ; error code for "SYNTAX"
 <a name=AF0A></a>AF0A   4C 37 A4   JMP $<A href="#A437">A437</A>       ; output error.  Return to Warm Start?


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=AF0D>
 ; recursive get value
 </A>
 <a name=AF0D></a>AF0D   A0 15      LDY #$15
 <a name=AF0F></a>AF0F   68         PLA
 <a name=AF10></a>AF10   68         PLA
 <a name=AF11></a>AF11   4C FA AD   JMP $<A href="#ADFA">ADFA</A>
 
 <A name=AF14>
 ; check variable pointer range
 </A>
 <a name=AF14></a>AF14   38         SEC
 <a name=AF15></a>AF15   A5 64      LDA $64
 <a name=AF17></a>AF17   E9 00      SBC #$00
 <a name=AF19></a>AF19   A5 65      LDA $65
 <a name=AF1B></a>AF1B   E9 A0      SBC #$A0
 <a name=AF1D></a>AF1D   90 08      BCC $AF27
 <a name=AF1F></a>AF1F   A9 A2      LDA #$A2
 <a name=AF21></a>AF21   E5 64      SBC $64
 <a name=AF23></a>AF23   A9 E3      LDA #$E3
 <a name=AF25></a>AF25   E5 65      SBC $65
 <a name=AF27></a>AF27   60         RTS
 
 <A name=AF28>
 ; get value of variable
 </A>
 <a name=AF28></a>AF28   20 8B B0   JSR $<A href="#B08B">B08B</A>
 <a name=AF2B></a>AF2B   85 64      STA $64
 <a name=AF2D></a>AF2D   84 65      STY $65
 <a name=AF2F></a>AF2F   A6 45      LDX $45
 <a name=AF31></a>AF31   A4 46      LDY $46
 <a name=AF33></a>AF33   A5 0D      LDA $0D
 <a name=AF35></a>AF35   F0 26      BEQ $AF5D
 <a name=AF37></a>AF37   A9 00      LDA #$00
 <a name=AF39></a>AF39   85 70      STA $70
 <a name=AF3B></a>AF3B   20 14 AF   JSR $<A href="#AF14">AF14</A>
 <a name=AF3E></a>AF3E   90 1C      BCC $AF5C
 <a name=AF40></a>AF40   E0 54      CPX #$54   ; T
 <a name=AF42></a>AF42   D0 18      BNE $AF5C
 <a name=AF44></a>AF44   C0 C9      CPY #$C9   ; I$
 <a name=AF46></a>AF46   D0 14      BNE $AF5C
 <a name=AF48></a>AF48   20 84 AF   JSR $<A href="#AF84">AF84</A>
 <a name=AF4B></a>AF4B   84 5E      STY $5E
 <a name=AF4D></a>AF4D   88         DEY
 <a name=AF4E></a>AF4E   84 71      STY $71
 <a name=AF50></a>AF50   A0 06      LDY #$06
 <a name=AF52></a>AF52   84 5D      STY $5D
 <a name=AF54></a>AF54   A0 24      LDY #$24
 <a name=AF56></a>AF56   20 68 BE   JSR $<A href="#BE68">BE68</A>
 <a name=AF59></a>AF59   4C 6F B4   JMP $<A href="#B46F">B46F</A>
 
 <a name=AF5C></a>AF5C   60         RTS
 
 <a name=AF5D></a>AF5D   24 0E      BIT $0E
 <a name=AF5F></a>AF5F   10 0D      BPL $AF6E
 <a name=AF61></a>AF61   A0 00      LDY #$00
 <a name=AF63></a>AF63   B1 64      LDA ($64),Y
 <a name=AF65></a>AF65   AA         TAX
 <a name=AF66></a>AF66   C8         INY
 <a name=AF67></a>AF67   B1 64      LDA ($64),Y
 <a name=AF69></a>AF69   A8         TAY
 <a name=AF6A></a>AF6A   8A         TXA
 <a name=AF6B></a>AF6B   4C 91 B3   JMP $<A href="#B391">B391</A>
 
 <a name=AF6E></a>AF6E   20 14 AF   JSR $<A href="#AF14">AF14</A>
 <a name=AF71></a>AF71   90 2D      BCC $AFA0
 <a name=AF73></a>AF73   E0 54      CPX #$54   ; T
 <a name=AF75></a>AF75   D0 1B      BNE $AF92
 <a name=AF77></a>AF77   C0 49      CPY #$49   ; I
 <a name=AF79></a>AF79   D0 25      BNE $AFA0
 <a name=AF7B></a>AF7B   20 84 AF   JSR $<A href="#AF84">AF84</A>
 <a name=AF7E></a>AF7E   98         TYA
 <a name=AF7F></a>AF7F   A2 A0      LDX #$A0
 <a name=AF81></a>AF81   4C 4F BC   JMP $<A href="#BC4F">BC4F</A>
 
 <A name=AF84>
 ; get time in float accu
 </A>
 <a name=AF84></a>AF84   20 DE FF   JSR $<A href="#FFDE">FFDE</A>
 <a name=AF87></a>AF87   86 64      STX $64
 <a name=AF89></a>AF89   84 63      STY $63
 <a name=AF8B></a>AF8B   85 65      STA $65
 <a name=AF8D></a>AF8D   A0 00      LDY #$00
 <a name=AF8F></a>AF8F   84 62      STY $62
 <a name=AF91></a>AF91   60         RTS
 
 <A name=AF92>
 ; continue of get value of variable
 </A>
 <a name=AF92></a>AF92   E0 53      CPX #$53   ; S
 <a name=AF94></a>AF94   D0 0A      BNE $AFA0
 <a name=AF96></a>AF96   C0 54      CPY #$54   ; T
 <a name=AF98></a>AF98   D0 06      BNE $AFA0
 <a name=AF9A></a>AF9A   20 B7 FF   JSR $<A href="#FFB7">FFB7</A>                                                                          
 <a name=AF9D></a>AF9D   4C 3C BC   JMP $<A href="#BC3C">BC3C</A>
 
 <a name=AFA0></a>AFA0   A5 64      LDA $64
 <a name=AFA2></a>AFA2   A4 65      LDY $65
 <a name=AFA4></a>AFA4   4C A2 BB   JMP $<A href="#BBA2">BBA2</A>
 
 <A name=AFA7>
 ; apply function
 </A>
 <a name=AFA7></a>AFA7   0A         ASL
 <a name=AFA8></a>AFA8   48         PHA
 <a name=AFA9></a>AFA9   AA         TAX
 <a name=AFAA></a>AFAA   20 73 00   JSR $0073
 <a name=AFAD></a>AFAD   E0 8F      CPX #$8F
 <a name=AFAF></a>AFAF   90 20      BCC $AFD1
 <a name=AFB1></a>AFB1   20 FA AE   JSR $<A href="#AEFA">AEFA</A>
 <a name=AFB4></a>AFB4   20 9E AD   JSR $<A href="#AD9E">AD9E</A>
 <a name=AFB7></a>AFB7   20 FD AE   JSR $<A href="#AEF7">AEFD</A>
 <a name=AFBA></a>AFBA   20 8F AD   JSR $<A href="#AD8F">AD8F</A>
 <a name=AFBD></a>AFBD   68         PLA
 <a name=AFBE></a>AFBE   AA         TAX
 <a name=AFBF></a>AFBF   A5 65      LDA $65
 <a name=AFC1></a>AFC1   48         PHA
 <a name=AFC2></a>AFC2   A5 64      LDA $64
 <a name=AFC4></a>AFC4   48         PHA
 <a name=AFC5></a>AFC5   8A         TXA
 <a name=AFC6></a>AFC6   48         PHA
 <a name=AFC7></a>AFC7   20 9E B7   JSR $<A href="#B79E">B79E</A>
 <a name=AFCA></a>AFCA   68         PLA
 <a name=AFCB></a>AFCB   A8         TAY
 <a name=AFCC></a>AFCC   8A         TXA
 <a name=AFCD></a>AFCD   48         PHA
 <a name=AFCE></a>AFCE   4C D6 AF   JMP $<A href="#AFD6">AFD6</A>
 
 <a name=AFD1></a>AFD1   20 F1 AE   JSR $<A href="#AEF1">AEF1</A>
 <a name=AFD4></a>AFD4   68         PLA
 <a name=AFD5></a>AFD5   A8         TAY
 <A name=AFD6>
 <a name=AFD6></a>AFD6   B9 EA 9F   LDA $9FEA,Y
 </A>
 <a name=AFD9></a>AFD9   85 55      STA $55
 <a name=AFDB></a>AFDB   B9 EB 9F   LDA $9FEB,Y
 <a name=AFDE></a>AFDE   85 56      STA $56
 <a name=AFE0></a>AFE0   20 54 00   JSR $0054
 <a name=AFE3></a>AFE3   4C 8D AD   JMP $<A href="#AD8D">AD8D</A>
 
 <A name=AFE6>
 ; OR operator
 </A>
 <a name=AFE6></a>AFE6   A0 FF      LDY #$FF
 <a name=AFE8></a>AFE8   .BY $2C
 
 <A name=AFE9>
 ; AND operator
 </A>
 <a name=AFE9></a>AFE9   A0 00      LDY #$00
 <a name=AFEB></a>AFEB   84 0B      STY $0B
 <a name=AFED></a>AFED   20 BF B1   JSR $<A href="#B1BF">B1BF</A>
 <a name=AFF0></a>AFF0   A5 64      LDA $64
 <a name=AFF2></a>AFF2   45 0B      EOR $0B
 <a name=AFF4></a>AFF4   85 07      STA $07
 <a name=AFF6></a>AFF6   A5 65      LDA $65
 <a name=AFF8></a>AFF8   45 0B      EOR $0B
 <a name=AFFA></a>AFFA   85 08      STA $08
 <a name=AFFC></a>AFFC   20 FC BB   JSR $<A href="#BBFC">BBFC</A>
 <a name=AFFF></a>AFFF   20 BF B1   JSR $<A href="#B1BF">B1BF</A>
 <a name=B002></a>B002   A5 65      LDA $65
 <a name=B004></a>B004   45 0B      EOR $0B
 <a name=B006></a>B006   25 08      AND $08
 <a name=B008></a>B008   45 0B      EOR $0B
 <a name=B00A></a>B00A   A8         TAY
 <a name=B00B></a>B00B   A5 64      LDA $64
 <a name=B00D></a>B00D   45 0B      EOR $0B
 <a name=B00F></a>B00F   25 07      AND $07
 <a name=B011></a>B011   45 0B      EOR $0B
 <a name=B013></a>B013   4C 91 B3   JMP $<A href="#B391">B391</A>
 
 <A name=B016>
 ; greater/equal/less operator
 </A>
 <a name=B016></a>B016   20 90 AD   JSR $<A href="#AD90">AD90</A>
 <a name=B019></a>B019   B0 13      BCS $B02E
 <a name=B01B></a>B01B   A5 6E      LDA $6E
 <a name=B01D></a>B01D   09 7F      ORA #$7F
 <a name=B01F></a>B01F   25 6A      AND $6A
 <a name=B021></a>B021   85 6A      STA $6A
 <a name=B023></a>B023   A9 69      LDA #$69
 <a name=B025></a>B025   A0 00      LDY #$00
 <a name=B027></a>B027   20 5B BC   JSR $<A href="#BC5B">BC5B</A>
 <a name=B02A></a>B02A   AA         TAX
 <a name=B02B></a>B02B   4C 61 B0   JMP $<A href="#B061">B061</A>
 
 <a name=B02E></a>B02E   A9 00      LDA #$00
 <a name=B030></a>B030   85 0D      STA $0D
 <a name=B032></a>B032   C6 4D      DEC $4D
 <a name=B034></a>B034   20 A6 B6   JSR $<A href="#B6A6">B6A6</A>
 <a name=B037></a>B037   85 61      STA $61
 <a name=B039></a>B039   86 62      STX $62
 <a name=B03B></a>B03B   84 63      STY $63
 <a name=B03D></a>B03D   A5 6C      LDA $6C
 <a name=B03F></a>B03F   A4 6D      LDY $6D
 <a name=B041></a>B041   20 AA B6   JSR $<A href="#B6AA">B6AA</A>
 <a name=B044></a>B044   86 6C      STX $6C
 <a name=B046></a>B046   84 6D      STY $6D
 <a name=B048></a>B048   AA         TAX
 <a name=B049></a>B049   38         SEC
 <a name=B04A></a>B04A   E5 61      SBC $61
 <a name=B04C></a>B04C   F0 08      BEQ $B056
 <a name=B04E></a>B04E   A9 01      LDA #$01
 <a name=B050></a>B050   90 04      BCC $B056
 <a name=B052></a>B052   A6 61      LDX $61
 <a name=B054></a>B054   A9 FF      LDA #$FF
 <a name=B056></a>B056   85 66      STA $66
 <a name=B058></a>B058   A0 FF      LDY #$FF
 <a name=B05A></a>B05A   E8         INX
 <a name=B05B></a>B05B   C8         INY
 <a name=B05C></a>B05C   CA         DEX
 <a name=B05D></a>B05D   D0 07      BNE $B066
 <a name=B05F></a>B05F   A6 66      LDX $66
 <A name=B061>
 <a name=B061></a>B061   30 0F      BMI $B072
 </A>
 <a name=B063></a>B063   18         CLC
 <a name=B064></a>B064   90 0C      BCC $B072
 <a name=B066></a>B066   B1 6C      LDA ($6C),Y
 <a name=B068></a>B068   D1 62      CMP ($62),Y
 <a name=B06A></a>B06A   F0 EF      BEQ $B05B
 <a name=B06C></a>B06C   A2 FF      LDX #$FF
 <a name=B06E></a>B06E   B0 02      BCS $B072
 <a name=B070></a>B070   A2 01      LDX #$01
 <a name=B072></a>B072   E8         INX
 <a name=B073></a>B073   8A         TXA
 <a name=B074></a>B074   2A         ROL
 <a name=B075></a>B075   25 12      AND $12
 <a name=B077></a>B077   F0 02      BEQ $B07B
 <a name=B079></a>B079   A9 FF      LDA #$FF
 <a name=B07B></a>B07B   4C 3C BC   JMP $<A href="#BC3C">BC3C</A>
 
 <A name=B07E>
 ; DIM command
 </A>
 <a name=B07E></a>B07E   20 FD AE   JSR $<A href="#AEF7">AEFD</A>
 <A name=B081>
 <a name=B081></a>B081   AA         TAX
 </A>
 <a name=B082></a>B082   20 90 B0   JSR $<A href="#B090">B090</A>
 <a name=B085></a>B085   20 79 00   JSR $0079
 <a name=B088></a>B088   D0 F4      BNE $B07E
 <a name=B08A></a>B08A   60         RTS
 
 <A name=B08B>
 ; get name and pointer to a variable
 </A>
 <a name=B08B></a>B08B   A2 00      LDX #$00
 <a name=B08D></a>B08D   20 79 00   JSR $0079
 <A name=B090>
 <a name=B090></a>B090   86 0C      STX $0C
 </A>
 <A name=B092>
 <a name=B092></a>B092   85 45      STA $45
 </A>
 <a name=B094></a>B094   20 79 00   JSR $0079
 <a name=B097></a>B097   20 13 B1   JSR $<A href="#B113">B113</A>
 <a name=B09A></a>B09A   B0 03      BCS $B09F
 <a name=B09C></a>B09C   4C 08 AF   JMP $<A href="#AF08">AF08</A>
 
 <a name=B09F></a>B09F   A2 00      LDX #$00
 <a name=B0A1></a>B0A1   86 0D      STX $0D
 <a name=B0A3></a>B0A3   86 0E      STX $0E
 <a name=B0A5></a>B0A5   20 73 00   JSR $0073
 <a name=B0A8></a>B0A8   90 05      BCC $B0AF
 <a name=B0AA></a>B0AA   20 13 B1   JSR $<A href="#B113">B113</A>
 <a name=B0AD></a>B0AD   90 0B      BCC $B0BA
 <a name=B0AF></a>B0AF   AA         TAX
 <a name=B0B0></a>B0B0   20 73 00   JSR $0073
 <a name=B0B3></a>B0B3   90 FB      BCC $B0B0
 <a name=B0B5></a>B0B5   20 13 B1   JSR $<A href="#B113">B113</A>
 <a name=B0B8></a>B0B8   B0 F6      BCS $B0B0
 <a name=B0BA></a>B0BA   C9 24      CMP #$24   ; $
 <a name=B0BC></a>B0BC   D0 06      BNE $B0C4
 <a name=B0BE></a>B0BE   A9 FF      LDA #$FF
 <a name=B0C0></a>B0C0   85 0D      STA $0D
 <a name=B0C2></a>B0C2   D0 10      BNE $B0D4
 <a name=B0C4></a>B0C4   C9 25      CMP #$25   ; %
 <a name=B0C6></a>B0C6   D0 13      BNE $B0DB
 <a name=B0C8></a>B0C8   A5 10      LDA $10
 <a name=B0CA></a>B0CA   D0 D0      BNE $B09C
 <a name=B0CC></a>B0CC   A9 80      LDA #$80
 <a name=B0CE></a>B0CE   85 0E      STA $0E
 <a name=B0D0></a>B0D0   05 45      ORA $45
 <a name=B0D2></a>B0D2   85 45      STA $45
 <a name=B0D4></a>B0D4   8A         TXA
 <a name=B0D5></a>B0D5   09 80      ORA #$80
 <a name=B0D7></a>B0D7   AA         TAX
 <a name=B0D8></a>B0D8   20 73 00   JSR $0073
 <a name=B0DB></a>B0DB   86 46      STX $46
 <a name=B0DD></a>B0DD   38         SEC
 <a name=B0DE></a>B0DE   05 10      ORA $10
 <a name=B0E0></a>B0E0   E9 28      SBC #$28    ; (
 <a name=B0E2></a>B0E2   D0 03      BNE $B0E7
 <a name=B0E4></a>B0E4   4C D1 B1   JMP $<A href="#B1D1">B1D1</A>
 
 <a name=B0E7></a>B0E7   A0 00      LDY #$00
 <a name=B0E9></a>B0E9   84 10      STY $10
 <a name=B0EB></a>B0EB   A5 2D      LDA $2D
 <a name=B0ED></a>B0ED   A6 2E      LDX $2E
 <a name=B0EF></a>B0EF   86 60      STX $60
 <a name=B0F1></a>B0F1   85 5F      STA $5F
 <a name=B0F3></a>B0F3   E4 30      CPX $30
 <a name=B0F5></a>B0F5   D0 04      BNE $B0FB
 <a name=B0F7></a>B0F7   C5 2F      CMP $2F
 <a name=B0F9></a>B0F9   F0 22      BEQ $B11D
 <a name=B0FB></a>B0FB   A5 45      LDA $45
 <a name=B0FD></a>B0FD   D1 5F      CMP ($5F),Y
 <a name=B0FF></a>B0FF   D0 08      BNE $B109
 <a name=B101></a>B101   A5 46      LDA $46
 <a name=B103></a>B103   C8         INY
 <a name=B104></a>B104   D1 5F      CMP ($5F),Y
 <a name=B106></a>B106   F0 7D      BEQ $B185
 <a name=B108></a>B108   88         DEY
 <a name=B109></a>B109   18         CLC
 <a name=B10A></a>B10A   A5 5F      LDA $5F
 <a name=B10C></a>B10C   69 07      ADC #$07
 <a name=B10E></a>B10E   90 E1      BCC $B0F1
 <a name=B110></a>B110   E8         INX
 <a name=B111></a>B111   D0 DC      BNE $B0EF
 
 <A name=B113>
 ; check character in A
 ; C=1 if alphabetic, C=0 if not
 </A>
 <a name=B113></a>B113   C9 41      CMP #$41   ; A
 <a name=B115></a>B115   90 05      BCC $B11C
 <a name=B117></a>B117   E9 5B      SBC #$5B   ; Z
 <a name=B119></a>B119   38         SEC
 <a name=B11A></a>B11A   E9 A5      SBC #$A5
 <a name=B11C></a>B11C   60         RTS
 
 <A name=B11D>
 ; variable not found
 </A>
 <a name=B11D></a>B11D   68         PLA
 <a name=B11E></a>B11E   48         PHA
 <a name=B11F></a>B11F   C9 2A      CMP #$2A
 <a name=B121></a>B121   D0 05      BNE $B128
 <a name=B123></a>B123   A9 13      LDA #$13
 <a name=B125></a>B125   A0 BF      LDY #$BF
 <a name=B127></a>B127   60         RTS
 
 <a name=B128></a>B128   A5 45      LDA $45
 <a name=B12A></a>B12A   A4 46      LDY $46
 <a name=B12C></a>B12C   C9 54      CMP #$54   ; T
 <a name=B12E></a>B12E   D0 0B      BNE $B13B
 <a name=B130></a>B130   C0 C9      CPY #$C9   ; I$
 <a name=B132></a>B132   F0 EF      BEQ $B123
 <a name=B134></a>B134   C0 49      CPY #$49   ; I
 <a name=B136></a>B136   D0 03      BNE $B13B
 <a name=B138></a>B138   4C 08 AF   JMP $<A href="#AF08">AF08</A>
 
 <a name=B13B></a>B13B   C9 53      CMP #$53   ; S
 <a name=B13D></a>B13D   D0 04      BNE $B143
 <a name=B13F></a>B13F   C0 54      CPY #$54   ; T
 <a name=B141></a>B141   F0 F5      BEQ $B138
 <a name=B143></a>B143   A5 2F      LDA $2F
 <a name=B145></a>B145   A4 30      LDY $30
 <a name=B147></a>B147   85 5F      STA $5F
 <a name=B149></a>B149   84 60      STY $60
 <a name=B14B></a>B14B   A5 31      LDA $31
 <a name=B14D></a>B14D   A4 32      LDY $32
 <a name=B14F></a>B14F   85 5A      STA $5A
 <a name=B151></a>B151   84 5B      STY $5B
 <a name=B153></a>B153   18         CLC
 <a name=B154></a>B154   69 07      ADC #$07
 <a name=B156></a>B156   90 01      BCC $B159
 <a name=B158></a>B158   C8         INY
 <a name=B159></a>B159   85 58      STA $58
 <a name=B15B></a>B15B   84 59      STY $59
 <a name=B15D></a>B15D   20 B8 A3   JSR $<A href="#A3B8">A3B8</A>
 <a name=B160></a>B160   A5 58      LDA $58
 <a name=B162></a>B162   A4 59      LDY $59
 <a name=B164></a>B164   C8         INY
 <a name=B165></a>B165   85 2F      STA $2F
 <a name=B167></a>B167   84 30      STY $30
 <a name=B169></a>B169   A0 00      LDY #$00
 <a name=B16B></a>B16B   A5 45      LDA $45
 <a name=B16D></a>B16D   91 5F      STA ($5F),Y
 <a name=B16F></a>B16F   C8         INY
 <a name=B170></a>B170   A5 46      LDA $46
 <a name=B172></a>B172   91 5F      STA ($5F),Y
 <a name=B174></a>B174   A9 00      LDA #$00
 <a name=B176></a>B176   C8         INY
 <a name=B177></a>B177   91 5F      STA ($5F),Y
 <a name=B179></a>B179   C8         INY
 <a name=B17A></a>B17A   91 5F      STA ($5F),Y
 <a name=B17C></a>B17C   C8         INY
 <a name=B17D></a>B17D   91 5F      STA ($5F),Y
 <a name=B17F></a>B17F   C8         INY
 <a name=B180></a>B180   91 5F      STA ($5F),Y
 <a name=B182></a>B182   C8         INY
 <a name=B183></a>B183   91 5F      STA ($5F),Y
 
 <A name=B185>
 ; variable found
 </A>
 <a name=B185></a>B185   A5 5F      LDA $5F
 <a name=B187></a>B187   18         CLC
 <a name=B188></a>B188   69 02      ADC #$02
 <a name=B18A></a>B18A   A4 60      LDY $60
 <a name=B18C></a>B18C   90 01      BCC $B18F
 <a name=B18E></a>B18E   C8         INY
 <a name=B18F></a>B18F   85 47      STA $47
 <a name=B191></a>B191   84 48      STY $48
 <a name=B193></a>B193   60         RTS
 
 <A name=B194>
 ; compute pointer to array body
 </A>
 <a name=B194></a>B194   A5 0B      LDA $0B
 <a name=B196></a>B196   0A         ASL
 <a name=B197></a>B197   69 05      ADC #$05
 <a name=B199></a>B199   65 5F      ADC $5F
 <a name=B19B></a>B19B   A4 60      LDY $60
 <a name=B19D></a>B19D   90 01      BCC $B1A0
 <a name=B19F></a>B19F   C8         INY
 <a name=B1A0></a>B1A0   85 58      STA $58
 <a name=B1A2></a>B1A2   84 59      STY $59
 <a name=B1A4></a>B1A4   60         RTS
 
 <A name=B1A5>
 ; float number for conversion to integer
 </A>
 <a name=B1A5></a>B1A5   .BY $90,$80,$00,$00,$00
 
 <A name=B1AA>
 ; routine to convert float to fixed point
 </A>
 <a name=B1AA></a>B1AA   20 BF B1   JSR $<A href="#B1BF">B1BF</A>
 <a name=B1AD></a>B1AD   A5 64      LDA $64
 <a name=B1AF></a>B1AF   A4 65      LDY $65
 <a name=B1B1></a>B1B1   60         RTS
 
 <A name=B1B2>
 ; convert value from statement to integer
 </A>
 <a name=B1B2></a>B1B2   20 73 00   JSR $0073
 <a name=B1B5></a>B1B5   20 9E AD   JSR $<A href="#AD9E">AD9E</A>
 <A name=B1B8>
 <a name=B1B8></a>B1B8   20 8D AD   JSR $<A href="#AD8D">AD8D</A>
 </A>
 <a name=B1BB></a>B1BB   A5 66      LDA $66
 <a name=B1BD></a>B1BD   30 0D      BMI $B1CC
 
 <A name=B1BF>
 ; convert float number to integer
 </A>
 <a name=B1BF></a>B1BF   A5 61      LDA $61
 <a name=B1C1></a>B1C1   C9 90      CMP #$90
 <a name=B1C3></a>B1C3   90 09      BCC $B1CE
 <a name=B1C5></a>B1C5   A9 A5      LDA #$A5   ; low  <A href="#B1A5">B1A5</A>
 <a name=B1C7></a>B1C7   A0 B1      LDY #$B1   ; high <A href="#B1A5">B1A5</A>
 <a name=B1C9></a>B1C9   20 5B BC   JSR $<A href="#BC5B">BC5B</A>
 <a name=B1CC></a>B1CC   D0 7A      BNE $B248
 <a name=B1CE></a>B1CE   4C 9B BC   JMP $<A href="#BC9B">BC9B</A>
 
 <A name=B1D1>
 ; get pointer to dimensioned variable
 </A>
 <a name=B1D1></a>B1D1   A5 0C      LDA $0C
 <a name=B1D3></a>B1D3   05 0E      ORA $0E
 <a name=B1D5></a>B1D5   48         PHA
 <a name=B1D6></a>B1D6   A5 0D      LDA $0D
 <a name=B1D8></a>B1D8   48         PHA
 <a name=B1D9></a>B1D9   A0 00      LDY #$00
 <a name=B1DB></a>B1DB   98         TYA
 <a name=B1DC></a>B1DC   48         PHA
 <a name=B1DD></a>B1DD   A5 46      LDA $46
 <a name=B1DF></a>B1DF   48         PHA
 <a name=B1E0></a>B1E0   A5 45      LDA $45
 <a name=B1E2></a>B1E2   48         PHA
 <a name=B1E3></a>B1E3   20 B2 B1   JSR $<A href="#B1B2">B1B2</A>
 <a name=B1E6></a>B1E6   68         PLA
 <a name=B1E7></a>B1E7   85 45      STA $45
 <a name=B1E9></a>B1E9   68         PLA
 <a name=B1EA></a>B1EA   85 46      STA $46
 <a name=B1EC></a>B1EC   68         PLA
 <a name=B1ED></a>B1ED   A8         TAY
 <a name=B1EE></a>B1EE   BA         TSX
 <a name=B1EF></a>B1EF   BD 02 01   LDA $0102,X
 <a name=B1F2></a>B1F2   48         PHA
 <a name=B1F3></a>B1F3   BD 01 01   LDA $0101,X
 <a name=B1F6></a>B1F6   48         PHA
 <a name=B1F7></a>B1F7   A5 64      LDA $64
 <a name=B1F9></a>B1F9   9D 02 01   STA $0102,X
 <a name=B1FC></a>B1FC   A5 65      LDA $65
 <a name=B1FE></a>B1FE   9D 01 01   STA $0101,X
 <a name=B201></a>B201   C8         INY
 <a name=B202></a>B202   20 79 00   JSR $0079
 <a name=B205></a>B205   C9 2C      CMP #$2C   ; comma
 <a name=B207></a>B207   F0 D2      BEQ $B1DB
 <a name=B209></a>B209   84 0B      STY $0B
 <a name=B20B></a>B20B   20 F7 AE   JSR $<A href="#AEF7">AEF7</A>
 <a name=B20E></a>B20E   68         PLA
 <a name=B20F></a>B20F   85 0D      STA $0D
 <a name=B211></a>B211   68         PLA
 <a name=B212></a>B212   85 0E      STA $0E
 <a name=B214></a>B214   29 7F      AND #$7F
 <a name=B216></a>B216   85 0C      STA $0C
 <a name=B218></a>B218   A6 2F      LDX $2F
 <a name=B21A></a>B21A   A5 30      LDA $30
 <a name=B21C></a>B21C   86 5F      STX $5F
 <a name=B21E></a>B21E   85 60      STA $60
 <a name=B220></a>B220   C5 32      CMP $32
 <a name=B222></a>B222   D0 04      BNE $B228
 <a name=B224></a>B224   E4 31      CPX $31
 <a name=B226></a>B226   F0 39      BEQ $B261
 <a name=B228></a>B228   A0 00      LDY #$00
 <a name=B22A></a>B22A   B1 5F      LDA ($5F),Y
 <a name=B22C></a>B22C   C8         INY
 <a name=B22D></a>B22D   C5 45      CMP $45
 <a name=B22F></a>B22F   D0 06      BNE $B237
 <a name=B231></a>B231   A5 46      LDA $46
 <a name=B233></a>B233   D1 5F      CMP ($5F),Y
 <a name=B235></a>B235   F0 16      BEQ $B24D
 <a name=B237></a>B237   C8         INY
 <a name=B238></a>B238   B1 5F      LDA ($5F),Y
 <a name=B23A></a>B23A   18         CLC
 <a name=B23B></a>B23B   65 5F      ADC $5F
 <a name=B23D></a>B23D   AA         TAX
 <a name=B23E></a>B23E   C8         INY
 <a name=B23F></a>B23F   B1 5F      LDA ($5F),Y
 <a name=B241></a>B241   65 60      ADC $60
 <a name=B243></a>B243   90 D7      BCC $B21C
 <A name=B245>
 <a name=B245></a>B245   A2 12      LDX #$12   ; error number
 </A>
 <a name=B247></a>B247   .BY 2C
 <A name=B248>
 <a name=B248></a>B248   A2 0E      LDX #$0E   ; error number
 </A>
 <a name=B24A></a>B24A   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <a name=B24D></a>B24D   A2 13      LDX #$13   ; error number
 <a name=B24F></a>B24F   A5 0C      LDA $0C
 <a name=B251></a>B251   D0 F7      BNE $B24A
 <a name=B253></a>B253   20 94 B1   JSR $<A href="#B194">B194</A>
 <a name=B256></a>B256   A5 0B      LDA $0B
 <a name=B258></a>B258   A0 04      LDY #$04
 <a name=B25A></a>B25A   D1 5F      CMP ($5F),Y
 <a name=B25C></a>B25C   D0 E7      BNE $B245
 <a name=B25E></a>B25E   4C EA B2   JMP $<A href="#B2EA">B2EA</A>
 
 <A name=B261>
 ; allocate array
 </A>
 <a name=B261></a>B261   20 94 B1   JSR $<A href="#B194">B194</A>
 <a name=B264></a>B264   20 08 A4   JSR $<A href="#A408">A408</A>
 <a name=B267></a>B267   A0 00      LDY #$00
 <a name=B269></a>B269   84 72      STY $72
 <a name=B26B></a>B26B   A2 05      LDX #$05
 <a name=B26D></a>B26D   A5 45      LDA $45
 <a name=B26F></a>B26F   91 5F      STA ($5F),Y
 <a name=B271></a>B271   10 01      BPL $B274
 <a name=B273></a>B273   CA         DEX
 <a name=B274></a>B274   C8         INY
 <a name=B275></a>B275   A5 46      LDA $46
 <a name=B277></a>B277   91 5F      STA ($5F),Y
 <a name=B279></a>B279   10 02      BPL $B27D
 <a name=B27B></a>B27B   CA         DEX
 <a name=B27C></a>B27C   CA         DEX
 <a name=B27D></a>B27D   86 71      STX $71
 <a name=B27F></a>B27F   A5 0B      LDA $0B
 <a name=B281></a>B281   C8         INY
 <a name=B282></a>B282   C8         INY
 <a name=B283></a>B283   C8         INY
 <a name=B284></a>B284   91 5F      STA ($5F),Y
 <a name=B286></a>B286   A2 0B      LDX #$0B
 <a name=B288></a>B288   A9 00      LDA #$00
 <a name=B28A></a>B28A   24 0C      BIT $0C
 <a name=B28C></a>B28C   50 08      BVC $B296
 <a name=B28E></a>B28E   68         PLA
 <a name=B28F></a>B28F   18         CLC
 <a name=B290></a>B290   69 01      ADC #$01
 <a name=B292></a>B292   AA         TAX
 <a name=B293></a>B293   68         PLA
 <a name=B294></a>B294   69 00      ADC #$00
 <a name=B296></a>B296   C8         INY
 <a name=B297></a>B297   91 5F      STA ($5F),Y
 <a name=B299></a>B299   C8         INY
 <a name=B29A></a>B29A   8A         TXA
 <a name=B29B></a>B29B   91 5F      STA ($5F),Y
 <a name=B29D></a>B29D   20 4C B3   JSR $<A href="#B34C">B34C</A>
 <a name=B2A0></a>B2A0   86 71      STX $71
 <a name=B2A2></a>B2A2   85 72      STA $72
 <a name=B2A4></a>B2A4   A4 22      LDY $22
 <a name=B2A6></a>B2A6   C6 0B      DEC $0B
 <a name=B2A8></a>B2A8   D0 DC      BNE $B286
 <a name=B2AA></a>B2AA   65 59      ADC $59
 <a name=B2AC></a>B2AC   B0 5D      BCS $B30B
 <a name=B2AE></a>B2AE   85 59      STA $59
 <a name=B2B0></a>B2B0   A8         TAY
 <a name=B2B1></a>B2B1   8A         TXA
 <a name=B2B2></a>B2B2   65 58      ADC $58
 <a name=B2B4></a>B2B4   90 03      BCC $B2B9
 <a name=B2B6></a>B2B6   C8         INY
 <a name=B2B7></a>B2B7   F0 52      BEQ $B30B
 <a name=B2B9></a>B2B9   20 08 A4   JSR $<A href="#A408">A408</A>
 <a name=B2BC></a>B2BC   85 31      STA $31
 <a name=B2BE></a>B2BE   84 32      STY $32
 <a name=B2C0></a>B2C0   A9 00      LDA #$00
 <a name=B2C2></a>B2C2   E6 72      INC $72
 <a name=B2C4></a>B2C4   A4 71      LDY $71
 <a name=B2C6></a>B2C6   F0 05      BEQ $B2CD
 <a name=B2C8></a>B2C8   88         DEY
 <a name=B2C9></a>B2C9   91 58      STA ($58),Y
 <a name=B2CB></a>B2CB   D0 FB      BNE $B2C8
 <a name=B2CD></a>B2CD   C6 59      DEC $59
 <a name=B2CF></a>B2CF   C6 72      DEC $72
 <a name=B2D1></a>B2D1   D0 F5      BNE $B2C8
 <a name=B2D3></a>B2D3   E6 59      INC $59
 <a name=B2D5></a>B2D5   38         SEC
 <a name=B2D6></a>B2D6   A5 31      LDA $31
 <a name=B2D8></a>B2D8   E5 5F      SBC $5F
 <a name=B2DA></a>B2DA   A0 02      LDY #$02
 <a name=B2DC></a>B2DC   91 5F      STA ($5F),Y
 <a name=B2DE></a>B2DE   A5 32      LDA $32
 <a name=B2E0></a>B2E0   C8         INY
 <a name=B2E1></a>B2E1   E5 60      SBC $60
 <a name=B2E3></a>B2E3   91 5F      STA ($5F),Y
 <a name=B2E5></a>B2E5   A5 0C      LDA $0C
 <a name=B2E7></a>B2E7   D0 62      BNE $B34B
 <a name=B2E9></a>B2E9   C8         INY
 
 <A name=B2EA>
 ; compute reference to array element
 </A>
 <a name=B2EA></a>B2EA   B1 5F      LDA ($5F),Y
 <a name=B2EC></a>B2EC   85 0B      STA $0B
 <a name=B2EE></a>B2EE   A9 00      LDA #$00
 <a name=B2F0></a>B2F0   85 71      STA $71
 <a name=B2F2></a>B2F2   85 72      STA $72
 <a name=B2F4></a>B2F4   C8         INY
 <a name=B2F5></a>B2F5   68         PLA
 <a name=B2F6></a>B2F6   AA         TAX
 <a name=B2F7></a>B2F7   85 64      STA $64
 <a name=B2F9></a>B2F9   68         PLA
 <a name=B2FA></a>B2FA   85 65      STA $65
 <a name=B2FC></a>B2FC   D1 5F      CMP ($5F),Y
 <a name=B2FE></a>B2FE   90 0E      BCC $B30E
 <a name=B300></a>B300   D0 06      BNE $B308
 <a name=B302></a>B302   C8         INY
 <a name=B303></a>B303   8A         TXA
 <a name=B304></a>B304   D1 5F      CMP ($5F),Y
 <a name=B306></a>B306   90 07      BCC $B30F
 <a name=B308></a>B308   4C 45 B2   JMP $<A href="#B245">B245</A>
 
 <a name=B30B></a>B30B   4C 35 A4   JMP $<A href="#A435">A435</A>
 
 <a name=B30E></a>B30E   C8         INY
 <a name=B30F></a>B30F   A5 72      LDA $72
 <a name=B311></a>B311   05 71      ORA $71
 <a name=B313></a>B313   18         CLC
 <a name=B314></a>B314   F0 0A      BEQ $B320
 <a name=B316></a>B316   20 4C B3   JSR $<A href="#B34C">B34C</A>
 <a name=B319></a>B319   8A         TXA
 <a name=B31A></a>B31A   65 64      ADC $64
 <a name=B31C></a>B31C   AA         TAX
 <a name=B31D></a>B31D   98         TYA
 <a name=B31E></a>B31E   A4 22      LDY $22
 <a name=B320></a>B320   65 65      ADC $65
 <a name=B322></a>B322   86 71      STX $71
 <a name=B324></a>B324   C6 0B      DEC $0B
 <a name=B326></a>B326   D0 CA      BNE $B2F2
 <a name=B328></a>B328   85 72      STA $72
 <a name=B32A></a>B32A   A2 05      LDX #$05
 <a name=B32C></a>B32C   A5 45      LDA $45
 <a name=B32E></a>B32E   10 01      BPL $B331
 <a name=B330></a>B330   CA         DEX
 <a name=B331></a>B331   A5 46      LDA $46
 <a name=B333></a>B333   10 02      BPL $B337
 <a name=B335></a>B335   CA         DEX
 <a name=B336></a>B336   CA         DEX
 <a name=B337></a>B337   86 28      STX $28
 <a name=B339></a>B339   A9 00      LDA #$00
 <a name=B33B></a>B33B   20 55 B3   JSR $<A href="#B355">B355</A>
 <a name=B33E></a>B33E   8A         TXA
 <a name=B33F></a>B33F   65 58      ADC $58
 <a name=B341></a>B341   85 47      STA $47
 <a name=B343></a>B343   98         TYA
 <a name=B344></a>B344   65 59      ADC $59
 <a name=B346></a>B346   85 48      STA $48
 <a name=B348></a>B348   A8         TAY
 <a name=B349></a>B349   A5 47      LDA $47
 <a name=B34B></a>B34B   60         RTS
 
 <A name=B34C>
 ; XY = XA = length * limit from array data
 </A>
 <a name=B34C></a>B34C   84 22      STY $22
 <a name=B34E></a>B34E   B1 5F      LDA ($5F),Y
 <a name=B350></a>B350   85 28      STA $28
 <a name=B352></a>B352   88         DEY
 <a name=B353></a>B353   B1 5F      LDA ($5F),Y
 <A name=B355>
 <a name=B355></a>B355   85 29      STA $29
 </A>
 <a name=B357></a>B357   A9 10      LDA #$10
 <a name=B359></a>B359   85 5D      STA $5D
 <a name=B35B></a>B35B   A2 00      LDX #$00
 <a name=B35D></a>B35D   A0 00      LDY #$00
 <a name=B35F></a>B35F   8A         TXA
 <a name=B360></a>B360   0A         ASL
 <a name=B361></a>B361   AA         TAX
 <a name=B362></a>B362   98         TYA
 <a name=B363></a>B363   2A         ROL
 <a name=B364></a>B364   A8         TAY
 <a name=B365></a>B365   B0 A4      BCS $B30B
 <a name=B367></a>B367   06 71      ASL $71
 <a name=B369></a>B369   26 72      ROL $72
 <a name=B36B></a>B36B   90 0B      BCC $B378
 <a name=B36D></a>B36D   18         CLC
 <a name=B36E></a>B36E   8A         TXA
 <a name=B36F></a>B36F   65 28      ADC $28
 <a name=B371></a>B371   AA         TAX
 <a name=B372></a>B372   98         TYA
 <a name=B373></a>B373   65 29      ADC $29
 <a name=B375></a>B375   A8         TAY
 <a name=B376></a>B376   B0 93      BCS $B30B
 <a name=B378></a>B378   C6 5D      DEC $5D
 <a name=B37A></a>B37A   D0 E3      BNE $B35F
 <a name=B37C></a>B37C   60         RTS
 
 <A name=B37D>
 ; FRE function
 </A>
 <a name=B37D></a>B37D   A5 0D      LDA $0D
 <a name=B37F></a>B37F   F0 03      BEQ $B384
 <a name=B381></a>B381   20 A6 B6   JSR $<A href="#B6A6">B6A6</A>
 <a name=B384></a>B384   20 26 B5   JSR $<A href="#B526">B526</A>
 <a name=B387></a>B387   38         SEC
 <a name=B388></a>B388   A5 33      LDA $33
 <a name=B38A></a>B38A   E5 31      SBC $31
 <a name=B38C></a>B38C   A8         TAY
 <a name=B38D></a>B38D   A5 34      LDA $34
 <a name=B38F></a>B38F   E5 32      SBC $32
 
 <A name=B391>
 ; routine to convert integer to float
 </A>
 <a name=B391></a>B391   A2 00      LDX #$00
 <a name=B393></a>B393   86 0D      STX $0D
 <a name=B395></a>B395   85 62      STA $62
 <a name=B397></a>B397   84 63      STY $63
 <a name=B399></a>B399   A2 90      LDX #$90
 <a name=B39B></a>B39B   4C 44 BC   JMP $<A href="#BC44">BC44</A>
 
 <A name=B39E>
 ; POS function
 </A>
 <a name=B39E></a>B39E   38         SEC
 <a name=B39F></a>B39F   20 F0 FF   JSR $<A href="#FFF0">FFF0</A>
 <A name=B3A2>
 <a name=B3A2></a>B3A2   A9 00      LDA #$00
 </A>
 <a name=B3A4></a>B3A4   F0 EB      BEQ $B391
 
 <A name=B3A6>
 ; check for non-direct mode
 </A>
 <a name=B3A6></a>B3A6   A6 3A      LDX $3A
 <a name=B3A8></a>B3A8   E8         INX
 <a name=B3A9></a>B3A9   D0 A0      BNE $B34B
 <a name=B3AB></a>B3AB   A2 15      LDX #$15        ; code for ILLEGAL DIRECT error
 <a name=B3AD></a>B3AD   .BY $2C
*<a name=B3AE></a>B3AE   A2 1B      LDX #$1B        ; code for UNDEF'D FUNCTION error
 <a name=B3B0></a>B3B0   4C 37 A4   JMP $<A href="#A437">A437</A>        ; output error
 
 <A name=B3B3>
 ; DEF command
 </A>
 <a name=B3B3></a>B3B3   20 E1 B3   JSR $<A href="#B3E1">B3E1</A>
 <a name=B3B6></a>B3B6   20 A6 B3   JSR $<A href="#B3A6">B3A6</A>
 <a name=B3B9></a>B3B9   20 FA AE   JSR $<A href="#AEFA">AEFA</A>
 <a name=B3BC></a>B3BC   A9 80      LDA #$80
 <a name=B3BE></a>B3BE   85 10      STA $10
 <a name=B3C0></a>B3C0   20 8B B0   JSR $<A href="#B08B">B08B</A>
 <a name=B3C3></a>B3C3   20 8D AD   JSR $<A href="#AD8D">AD8D</A>
 <a name=B3C6></a>B3C6   20 F7 AE   JSR $<A href="#AEF7">AEF7</A>
 <a name=B3C9></a>B3C9   A9 B2      LDA #$B2
 <a name=B3CB></a>B3CB   20 FF AE   JSR $<A href="#AEFF">AEFF</A>
 <a name=B3CE></a>B3CE   48         PHA
 <a name=B3CF></a>B3CF   A5 48      LDA $48
 <a name=B3D1></a>B3D1   48         PHA
 <a name=B3D2></a>B3D2   A5 47      LDA $47
 <a name=B3D4></a>B3D4   48         PHA
 <a name=B3D5></a>B3D5   A5 7B      LDA $7B
 <a name=B3D7></a>B3D7   48         PHA
 <a name=B3D8></a>B3D8   A5 7A      LDA $7A
 <a name=B3DA></a>B3DA   48         PHA
 <a name=B3DB></a>B3DB   20 F8 A8   JSR $<A href="#A8F8">A8F8</A>
 <a name=B3DE></a>B3DE   4C 4F B4   JMP $<A href="#B44F">B44F</A>

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->
 
<A name=B3E1> </A>
;<b> get function name </b>
;    referenced by: <A href="#B3B3">B3B3</A> <A href="#B3F4">B3F4</A>
;
; Reads FN token followed by a variable name for a function.  Name is left in VARNAM ($<A href="ram.htm#0045">45</A>) and 
; $<A href="ram.htm#004E">4E</A> points to FN descriptor.  If not found, generates UNDEF'D FUNCTION error

 <a name=xxxx></a>B3E1   A9 A5      LDA #$A5        ; token for FN
 <a name=B3E3></a>B3E3   20 FF AE   JSR $<A href="#AEFF">AEFF</A>       ; require FN
 <a name=B3E6></a>B3E6   09 80      ORA #$80        ; Dual purpose: FN name needs MSB set in both bytes...
 <a name=B3E8></a>B3E8   85 10      STA $<A href="ram.htm#0010">10</A>         ; ... and set MSB of SUBFLG (means that B092 will reject var%)
 <a name=B3EA></a>B3EA   20 92 B0   JSR $<A href="#B092">B092</A>       ; Get name/ptr to variable
 <a name=B3ED></a>B3ED   85 4E      STA $<A href="ram.htm#004E">4E</A>         ; point to current FN descriptor... points to name or +2?
 <a name=B3EF></a>B3EF   84 4F      STY $<A href="ram.htm#004F">4F</A>
 <a name=B3F1></a>B3F1   4C 8D AD   JMP $<A href="#AD8D">AD8D</A>       ; Require that var is "numeric" (can't DEF FN A$...)

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 2 </b></i>      <HR align=center width=50%>
</div> <div class="level2">
<!--------------------------------------------------------------------------------------------------------->
 
 <A name=B3F4> </A>
;<b> expand FN call </b>
;    referenced by: <A href="#AEE7">AEE7</A>
;
; Executes the code for a defined function and leaves its result in FAC

 <a name=xxxx></a>B3F4   20 E1 B3   JSR $<A href="#B3E1">B3E1</A>       ; get function name
 <a name=B3F7></a>B3F7   A5 4F      LDA $<A href="ram.htm#004F">4F</A>         ; Save ptr to FN descriptor on stack (while evaluating argument)
 <a name=B3F9></a>B3F9   48         PHA             ;
 <a name=B3FA></a>B3FA   A5 4E      LDA $<A href="ram.htm#004E">4E</A>         ;
 <a name=B3FC></a>B3FC   48         PHA             ;
 <a name=B3FD></a>B3FD   20 F1 AE   JSR $<A href="#AEF1">AEF1</A>       ; Get expression enclosed in parentheses (argument)
 <a name=B400></a>B400   20 8D AD   JSR $<A href="#AD8D">AD8D</A>       ; require that argument passed is numeric
 <a name=B403></a>B403   68         PLA             ; restore ptr to FN descriptor
 <a name=B404></a>B404   85 4E      STA $<A href="ram.htm#004E">4E</A>         ; 
 <a name=B406></a>B406   68         PLA             ;
 <a name=B407></a>B407   85 4F      STA $<A href="ram.htm#004F">4F</A>         ;
 <a name=B409></a>B409   A0 02      LDY #$02        ; Point VARPTR to variable with name of parameter
 <a name=B40B></a>B40B   B1 4E      LDA ($<A href="ram.htm#004E">4E</A>),Y     ;   lo byte 
 <a name=B40D></a>B40D   85 47      STA $<A href="ram.htm#0047">47</A>         ; 
 <a name=B40F></a>B40F   AA         TAX             ; Save low byte of param var in .X (for use at B420
 <a name=B410></a>B410   C8         INY             ;
 <a name=B411></a>B411   B1 4E      LDA ($<A href="ram.htm#004E">4E</A>),Y     ;   hi byte
 <a name=B413></a>B413   F0 99      BEQ $B3AE   -   ; if hi byte of param ptr is 0, generate UNDEF'D FUNCTION error ???
 <a name=B415></a>B415   85 48      STA $<A href="ram.htm#0048">48</A>         ;
 <a name=B417></a>B417   C8         INY             ; (.Y=4) 
*<a name=B418></a>B418   B1 47      LDA ($<A href="ram.htm#0047">47</A>),Y     ; Save value of actual variable on stack, before usurping it as local to the FN
 <a name=B41A></a>B41A   48         PHA             ;
 <a name=B41B></a>B41B   88         DEY             ;
 <a name=B41C></a>B41C   10 FA      BPL $B418   -   ;
 <a name=B41E></a>B41E   A4 48      LDY $<A href="ram.htm#0048">48</A>         ;
 <a name=B420></a>B420   20 D4 BB   JSR $<A href="#BBD4">BBD4</A>       ; Store FAC (passed argument value) into parameter var
 <a name=B423></a>B423   A5 7B      LDA $<A href="ram.htm#007B">7B</A>         ; Save current expression evaluation address (TXTPTR) on stack...
 <a name=B425></a>B425   48         PHA             ;
 <a name=B426></a>B426   A5 7A      LDA $<A href="ram.htm#007A">7A</A>         ;
 <a name=B428></a>B428   48         PHA             ;
 <a name=B429></a>B429   B1 4E      LDA ($4E),Y     ; Divert TXTPTR to where its definition is stored
 <a name=B42B></a>B42B   85 7A      STA $7A         ; 
 <a name=B42D></a>B42D   C8         INY             ;
 <a name=B42E></a>B42E   B1 4E      LDA ($4E),Y     ;
 <a name=B430></a>B430   85 7B      STA $7B         ;
 <a name=B432></a>B432   A5 48      LDA $48         ; Save address of usurped variable on stack (for restoring its original value)
 <a name=B434></a>B434   48         PHA             ;
 <a name=B435></a>B435   A5 47      LDA $47         ;
 <a name=B437></a>B437   48         PHA             ;
 <a name=B438></a>B438   20 8A AD   JSR $<A href="#AD8A">AD8A</A>       ; Evaluate expression (FN body) and require numeric result
 <a name=B43B></a>B43B   68         PLA             ; Retrieve param var address (into $4E/4F??)
 <a name=B43C></a>B43C   85 4E      STA $4E         ;
 <a name=B43E></a>B43E   68         PLA             ;
 <a name=B43F></a>B43F   85 4F      STA $4F         ;
 <a name=B441></a>B441   20 79 00   JSR $0079       ; Check what ended expression
 <a name=B444></a>B444   F0 03      BEQ $B449   +   ; After evaluating FN body, must be at end of statement...
 <a name=B446></a>B446   4C 08 AF   JMP $<A href="#AF08">AF08</A>       ; ... or SYNTAX ERROR
 
*<a name=B449></a>B449   68         PLA             ; Restore TXTPTR to just after FN xx(x) reference
 <a name=B44A></a>B44A   85 7A      STA $7A         ;
 <a name=B44C></a>B44C   68         PLA             ;
 <a name=B44D></a>B44D   85 7B      STA $7B         ;
 <A name=B44F> </A>
; ref: JMP from B3DE...  Store 5 bytes from stack into location pointed to by $4E/4F
 <a name=B44F></a>B44F   A0 00      LDY #$00        ; Restore value of variable, saved on stack before repurposing
 <a name=B451></a>B451   68         PLA             ;    as FN parameter
 <a name=B452></a>B452   91 4E      STA ($4E),Y     ;
 <a name=B454></a>B454   68         PLA             ;
 <a name=B455></a>B455   C8         INY             ;
 <a name=B456></a>B456   91 4E      STA ($4E),Y     ;
 <a name=B458></a>B458   68         PLA             ;
 <a name=B459></a>B459   C8         INY             ;
 <a name=B45A></a>B45A   91 4E      STA ($4E),Y     ;
 <a name=B45C></a>B45C   68         PLA             ;
 <a name=B45D></a>B45D   C8         INY             ;
 <a name=B45E></a>B45E   91 4E      STA ($4E),Y     ;
 <a name=B460></a>B460   68         PLA             ;
 <a name=B461></a>B461   C8         INY             ;
 <a name=B462></a>B462   91 4E      STA ($4E),Y     ;
 <a name=B464></a>B464   60         RTS             ;

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 2   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->
 
 <A name=B465>
 ; STR$ function
 </A>
 <a name=B465></a>B465   20 8D AD   JSR $<A href="#AD8D">AD8D</A>
 <a name=B468></a>B468   A0 00      LDY #$00
 <a name=B46A></a>B46A   20 DF BD   JSR $<A href="#BDDF">BDDF</A>
 <a name=B46D></a>B46D   68         PLA
 <a name=B46E></a>B46E   68         PLA
 <A name=B46F>
 <a name=B46F></a>B46F   A9 FF      LDA #$FF
 </A>
 <a name=B471></a>B471   A0 00      LDY #$00
 <a name=B473></a>B473   F0 12      BEQ $B487
 <A name=B475>
 <a name=B475></a>B475   A6 64      LDX $64
 </A>
 <a name=B477></a>B477   A4 65      LDY $65
 <a name=B479></a>B479   86 50      STX $50
 <a name=B47B></a>B47B   84 51      STY $51
 
 <A name=B47D>
 ; allocate area according to A
 </A>
 <a name=B47D></a>B47D   20 F4 B4   JSR $<A href="#B4F4">B4F4</A>
 <a name=B480></a>B480   86 62      STX $62
 <a name=B482></a>B482   84 63      STY $63
 <a name=B484></a>B484   85 61      STA $61
 <a name=B486></a>B486   60         RTS
 
 <A name=B487>
 ; get description of string into float accu
 </A>
 <a name=B487></a>B487   A2 22      LDX #$22   ; quote mark
 <a name=B489></a>B489   86 07      STX $07
 <a name=B48B></a>B48B   86 08      STX $08
 <A name=B48D>
 <a name=B48D></a>B48D   85 6F      STA $6F
 </A>
 <a name=B48F></a>B48F   84 70      STY $70
 <a name=B491></a>B491   85 62      STA $62
 <a name=B493></a>B493   84 63      STY $63
 <a name=B495></a>B495   A0 FF      LDY #$FF
 <a name=B497></a>B497   C8         INY
 <a name=B498></a>B498   B1 6F      LDA ($6F),Y
 <a name=B49A></a>B49A   F0 0C      BEQ $B4A8
 <a name=B49C></a>B49C   C5 07      CMP $07
 <a name=B49E></a>B49E   F0 04      BEQ $B4A4
 <a name=B4A0></a>B4A0   C5 08      CMP $08
 <a name=B4A2></a>B4A2   D0 F3      BNE $B497
 <a name=B4A4></a>B4A4   C9 22      CMP #$22   ; quote mark
 <a name=B4A6></a>B4A6   F0 01      BEQ $B4A9
 <a name=B4A8></a>B4A8   18         CLC
 <a name=B4A9></a>B4A9   84 61      STY $61
 <a name=B4AB></a>B4AB   98         TYA
 <a name=B4AC></a>B4AC   65 6F      ADC $6F
 <a name=B4AE></a>B4AE   85 71      STA $71
 <a name=B4B0></a>B4B0   A6 70      LDX $70
 <a name=B4B2></a>B4B2   90 01      BCC $B4B5
 <a name=B4B4></a>B4B4   E8         INX
 <a name=B4B5></a>B4B5   86 72      STX $72
 <a name=B4B7></a>B4B7   A5 70      LDA $70
 <a name=B4B9></a>B4B9   F0 04      BEQ $B4BF
 <a name=B4BB></a>B4BB   C9 02      CMP #$02
 <a name=B4BD></a>B4BD   D0 0B      BNE $B4CA
 <a name=B4BF></a>B4BF   98         TYA
 <a name=B4C0></a>B4C0   20 75 B4   JSR $<A href="#B475">B475</A>
 <a name=B4C3></a>B4C3   A6 6F      LDX $6F
 <a name=B4C5></a>B4C5   A4 70      LDY $70
 <a name=B4C7></a>B4C7   20 88 B6   JSR $<A href="#B688">B688</A>
 
 <A name=B4CA>
 ; save descriptor from $61-$63 on stack
 </A>
 <a name=B4CA></a>B4CA   A6 16      LDX $16
 <a name=B4CC></a>B4CC   E0 22      CPX #$22
 <a name=B4CE></a>B4CE   D0 05      BNE $B4D5
 <a name=B4D0></a>B4D0   A2 19      LDX #$19
 <a name=B4D2></a>B4D2   4C 37 A4   JMP $<A href="#A437">A437</A>
 <a name=B4D5></a>B4D5   A5 61      LDA $61
 <a name=B4D7></a>B4D7   95 00      STA $00,X
 <a name=B4D9></a>B4D9   A5 62      LDA $62
 <a name=B4DB></a>B4DB   95 01      STA $01,X
 <a name=B4DD></a>B4DD   A5 63      LDA $63
 <a name=B4DF></a>B4DF   95 02      STA $02,X
 <a name=B4E1></a>B4E1   A0 00      LDY #$00
 <a name=B4E3></a>B4E3   86 64      STX $64
 <a name=B4E5></a>B4E5   84 65      STY $65
 <a name=B4E7></a>B4E7   84 70      STY $70
 <a name=B4E9></a>B4E9   88         DEY
 <a name=B4EA></a>B4EA   84 0D      STY $0D
 <a name=B4EC></a>B4EC   86 17      STX $17
 <a name=B4EE></a>B4EE   E8         INX
 <a name=B4EF></a>B4EF   E8         INX
 <a name=B4F0></a>B4F0   E8         INX
 <a name=B4F1></a>B4F1   86 16      STX $16
 <a name=B4F3></a>B4F3   60         RTS
 
 <A name=B4F4>
 ; allocate number of bytes in A
 </A>
 <a name=B4F4></a>B4F4   46 0F      LSR $0F
 <a name=B4F6></a>B4F6   48         PHA
 <a name=B4F7></a>B4F7   49 FF      EOR #$FF
 <a name=B4F9></a>B4F9   38         SEC
 <a name=B4FA></a>B4FA   65 33      ADC $33
 <a name=B4FC></a>B4FC   A4 34      LDY $34
 <a name=B4FE></a>B4FE   B0 01      BCS $B501
 <a name=B500></a>B500   88         DEY
 <a name=B501></a>B501   C4 32      CPY $32
 <a name=B503></a>B503   90 11      BCC $B516
 <a name=B505></a>B505   D0 04      BNE $B50B
 <a name=B507></a>B507   C5 31      CMP $31
 <a name=B509></a>B509   90 0B      BCC $B516
 <a name=B50B></a>B50B   85 33      STA $33
 <a name=B50D></a>B50D   84 34      STY $34
 <a name=B50F></a>B50F   85 35      STA $35
 <a name=B511></a>B511   84 36      STY $36
 <a name=B513></a>B513   AA         TAX
 <a name=B514></a>B514   68         PLA
 <a name=B515></a>B515   60         RTS
 
 <a name=B516></a>B516   A2 10      LDX #$10
 <a name=B518></a>B518   A5 0F      LDA $0F
 <a name=B51A></a>B51A   30 B6      BMI $B4D2
 <a name=B51C></a>B51C   20 26 B5   JSR $<A href="#B526">B526</A>
 <a name=B51F></a>B51F   A9 80      LDA #$80
 <a name=B521></a>B521   85 0F      STA $0F
 <a name=B523></a>B523   68         PLA
 <a name=B524></a>B524   D0 D0      BNE $B4F6
 
 <A name=B526>
 ; string garbage clean up
 </A>
 <a name=B526></a>B526   A6 37      LDX $37
 <a name=B528></a>B528   A5 38      LDA $38
 <A name=B52A>
 <a name=B52A></a>B52A   86 33      STX $33
 </A>
 <a name=B52C></a>B52C   85 34      STA $34
 <a name=B52E></a>B52E   A0 00      LDY #$00
 <a name=B530></a>B530   84 4F      STY $4F
 <a name=B532></a>B532   84 4E      STY $4E
 <a name=B534></a>B534   A5 31      LDA $31
 <a name=B536></a>B536   A6 32      LDX $32
 <a name=B538></a>B538   85 5F      STA $5F
 <a name=B53A></a>B53A   86 60      STX $60
 <a name=B53C></a>B53C   A9 19      LDA #$19   ; low  0019
 <a name=B53E></a>B53E   A2 00      LDX #$00   ; high 0019
 <a name=B540></a>B540   85 22      STA $22
 <a name=B542></a>B542   86 23      STX $23
 <a name=B544></a>B544   C5 16      CMP $16
 <a name=B546></a>B546   F0 05      BEQ $B54D
 <a name=B548></a>B548   20 C7 B5   JSR $<A href="#B5C7">B5C7</A>
 <a name=B54B></a>B54B   F0 F7      BEQ $B544
 <a name=B54D></a>B54D   A9 07      LDA #$07
 <a name=B54F></a>B54F   85 53      STA $53
 <a name=B551></a>B551   A5 2D      LDA $2D
 <a name=B553></a>B553   A6 2E      LDX $2E
 <a name=B555></a>B555   85 22      STA $22
 <a name=B557></a>B557   86 23      STX $23
 <a name=B559></a>B559   E4 30      CPX $30
 <a name=B55B></a>B55B   D0 04      BNE $B561
 <a name=B55D></a>B55D   C5 2F      CMP $2F
 <a name=B55F></a>B55F   F0 05      BEQ $B566
 <a name=B561></a>B561   20 BD B5   JSR $<A href="#B5BD">B5BD</A>
 <a name=B564></a>B564   F0 F3      BEQ $B559
 <a name=B566></a>B566   85 58      STA $58
 <a name=B568></a>B568   86 59      STX $59
 <a name=B56A></a>B56A   A9 03      LDA #$03
 <a name=B56C></a>B56C   85 53      STA $53
 <a name=B56E></a>B56E   A5 58      LDA $58
 <a name=B570></a>B570   A6 59      LDX $59
 <a name=B572></a>B572   E4 32      CPX $32
 <a name=B574></a>B574   D0 07      BNE $B57D
 <a name=B576></a>B576   C5 31      CMP $31
 <a name=B578></a>B578   D0 03      BNE $B57D
 <a name=B57A></a>B57A   4C 06 B6   JMP $<A href="#B606">B606</A>
 <a name=B57D></a>B57D   85 22      STA $22
 <a name=B57F></a>B57F   86 23      STX $23
 <a name=B581></a>B581   A0 00      LDY #$00
 <a name=B583></a>B583   B1 22      LDA ($22),Y
 <a name=B585></a>B585   AA         TAX
 <a name=B586></a>B586   C8         INY
 <a name=B587></a>B587   B1 22      LDA ($22),Y
 <a name=B589></a>B589   08         PHP
 <a name=B58A></a>B58A   C8         INY
 <a name=B58B></a>B58B   B1 22      LDA ($22),Y
 <a name=B58D></a>B58D   65 58      ADC $58
 <a name=B58F></a>B58F   85 58      STA $58
 <a name=B591></a>B591   C8         INY
 <a name=B592></a>B592   B1 22      LDA ($22),Y
 <a name=B594></a>B594   65 59      ADC $59
 <a name=B596></a>B596   85 59      STA $59
 <a name=B598></a>B598   28         PLP
 <a name=B599></a>B599   10 D3      BPL $B56E
 <a name=B59B></a>B59B   8A         TXA
 <a name=B59C></a>B59C   30 D0      BMI $B56E
 <a name=B59E></a>B59E   C8         INY
 <a name=B59F></a>B59F   B1 22      LDA ($22),Y
 <a name=B5A1></a>B5A1   A0 00      LDY #$00
 <a name=B5A3></a>B5A3   0A         ASL
 <a name=B5A4></a>B5A4   69 05      ADC #$05
 <a name=B5A6></a>B5A6   65 22      ADC $22
 <a name=B5A8></a>B5A8   85 22      STA $22
 <a name=B5AA></a>B5AA   90 02      BCC $B5AE
 <a name=B5AC></a>B5AC   E6 23      INC $23
 <a name=B5AE></a>B5AE   A6 23      LDX $23
 <a name=B5B0></a>B5B0   E4 59      CPX $59
 <a name=B5B2></a>B5B2   D0 04      BNE $B5B8
 <a name=B5B4></a>B5B4   C5 58      CMP $58
 <a name=B5B6></a>B5B6   F0 BA      BEQ $B572
 <a name=B5B8></a>B5B8   20 C7 B5   JSR $<A href="#B5C7">B5C7</A>
 <a name=B5BB></a>B5BB   F0 F3      BEQ $B5B0
 
 <A name=B5BD>
 ; check string area
 </A>
 <a name=B5BD></a>B5BD   B1 22      LDA ($22),Y
 <a name=B5BF></a>B5BF   30 35      BMI $B5F6
 <a name=B5C1></a>B5C1   C8         INY
 <a name=B5C2></a>B5C2   B1 22      LDA ($22),Y
 <a name=B5C4></a>B5C4   10 30      BPL $B5F6
 <a name=B5C6></a>B5C6   C8         INY
 
 <A name=B5C7>
 ; check string area
 </A>
 <a name=B5C7></a>B5C7   B1 22      LDA ($22),Y
 <a name=B5C9></a>B5C9   F0 2B      BEQ $B5F6
 <a name=B5CB></a>B5CB   C8         INY
 <a name=B5CC></a>B5CC   B1 22      LDA ($22),Y
 <a name=B5CE></a>B5CE   AA         TAX
 <a name=B5CF></a>B5CF   C8         INY
 <a name=B5D0></a>B5D0   B1 22      LDA ($22),Y
 <a name=B5D2></a>B5D2   C5 34      CMP $34
 <a name=B5D4></a>B5D4   90 06      BCC $B5DC
 <a name=B5D6></a>B5D6   D0 1E      BNE $B5F6
 <a name=B5D8></a>B5D8   E4 33      CPX $33
 <a name=B5DA></a>B5DA   B0 1A      BCS $B5F6
 <a name=B5DC></a>B5DC   C5 60      CMP $60
 <a name=B5DE></a>B5DE   90 16      BCC $B5F6
 <a name=B5E0></a>B5E0   D0 04      BNE $B5E6
 <a name=B5E2></a>B5E2   E4 5F      CPX $5F
 <a name=B5E4></a>B5E4   90 10      BCC $B5F6
 <a name=B5E6></a>B5E6   86 5F      STX $5F
 <a name=B5E8></a>B5E8   85 60      STA $60
 <a name=B5EA></a>B5EA   A5 22      LDA $22
 <a name=B5EC></a>B5EC   A6 23      LDX $23
 <a name=B5EE></a>B5EE   85 4E      STA $4E
 <a name=B5F0></a>B5F0   86 4F      STX $4F
 <a name=B5F2></a>B5F2   A5 53      LDA $53
 <a name=B5F4></a>B5F4   85 55      STA $55
 <a name=B5F6></a>B5F6   A5 53      LDA $53
 <a name=B5F8></a>B5F8   18         CLC
 <a name=B5F9></a>B5F9   65 22      ADC $22
 <a name=B5FB></a>B5FB   85 22      STA $22
 <a name=B5FD></a>B5FD   90 02      BCC $B601
 <a name=B5FF></a>B5FF   E6 23      INC $23
 <a name=B601></a>B601   A6 23      LDX $23
 <a name=B603></a>B603   A0 00      LDY #$00
 <a name=B605></a>B605   60         RTS
 
 <A name=B606>
 ; continuation of garbage clean up
 </A>
 <a name=B606></a>B606   A5 4F      LDA $4F
 <a name=B608></a>B608   05 4E      ORA $4E
 <a name=B60A></a>B60A   F0 F5      BEQ $B601
 <a name=B60C></a>B60C   A5 55      LDA $55
 <a name=B60E></a>B60E   29 04      AND #$04
 <a name=B610></a>B610   4A         LSR
 <a name=B611></a>B611   A8         TAY
 <a name=B612></a>B612   85 55      STA $55
 <a name=B614></a>B614   B1 4E      LDA ($4E),Y
 <a name=B616></a>B616   65 5F      ADC $5F
 <a name=B618></a>B618   85 5A      STA $5A
 <a name=B61A></a>B61A   A5 60      LDA $60
 <a name=B61C></a>B61C   69 00      ADC #$00
 <a name=B61E></a>B61E   85 5B      STA $5B
 <a name=B620></a>B620   A5 33      LDA $33
 <a name=B622></a>B622   A6 34      LDX $34
 <a name=B624></a>B624   85 58      STA $58
 <a name=B626></a>B626   86 59      STX $59
 <a name=B628></a>B628   20 BF A3   JSR $<A href="#A3BF">A3BF</A>
 <a name=B62B></a>B62B   A4 55      LDY $55
 <a name=B62D></a>B62D   C8         INY
 <a name=B62E></a>B62E   A5 58      LDA $58
 <a name=B630></a>B630   91 4E      STA ($4E),Y
 <a name=B632></a>B632   AA         TAX
 <a name=B633></a>B633   E6 59      INC $59
 <a name=B635></a>B635   A5 59      LDA $59
 <a name=B637></a>B637   C8         INY
 <a name=B638></a>B638   91 4E      STA ($4E),Y
 <a name=B63A></a>B63A   4C 2A B5   JMP $<A href="#B52A">B52A</A>
 
 <A name=B63D>
 ; joining strings
 </A>
 <a name=B63D></a>B63D   A5 65      LDA $65
 <a name=B63F></a>B63F   48         PHA
 <a name=B640></a>B640   A5 64      LDA $64
 <a name=B642></a>B642   48         PHA
 <a name=B643></a>B643   20 83 AE   JSR $<A href="#AE83">AE83</A>
 <a name=B646></a>B646   20 8F AD   JSR $<A href="#AD8F">AD8F</A>
 <a name=B649></a>B649   68         PLA
 <a name=B64A></a>B64A   85 6F      STA $6F
 <a name=B64C></a>B64C   68         PLA
 <a name=B64D></a>B64D   85 70      STA $70
 <a name=B64F></a>B64F   A0 00      LDY #$00
 <a name=B651></a>B651   B1 6F      LDA ($6F),Y
 <a name=B653></a>B653   18         CLC
 <a name=B654></a>B654   71 64      ADC ($64),Y
 <a name=B656></a>B656   90 05      BCC $B65D
 <a name=B658></a>B658   A2 17      LDX #$17
 <a name=B65A></a>B65A   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <a name=B65D></a>B65D   20 75 B4   JSR $<A href="#B475">B475</A>
 <a name=B660></a>B660   20 7A B6   JSR $<A href="#B67A">B67A</A>
 <a name=B663></a>B663   A5 50      LDA $50
 <a name=B665></a>B665   A4 51      LDY $51
 <a name=B667></a>B667   20 AA B6   JSR $<A href="#B6AA">B6AA</A>
 <a name=B66A></a>B66A   20 8C B6   JSR $<A href="#B68C">B68C</A>
 <a name=B66D></a>B66D   A5 6F      LDA $6F
 <a name=B66F></a>B66F   A4 70      LDY $70
 <a name=B671></a>B671   20 AA B6   JSR $<A href="#B6AA">B6AA</A>
 <a name=B674></a>B674   20 CA B4   JSR $<A href="#B4CA">B4CA</A>
 <a name=B677></a>B677   4C B8 AD   JMP $<A href="#ADB8">ADB8</A>
 
 <A name=B67A>
 ; move string
 </A>
 <a name=B67A></a>B67A   A0 00      LDY #$00
 <a name=B67C></a>B67C   B1 6F      LDA ($6F),Y
 <a name=B67E></a>B67E   48         PHA
 <a name=B67F></a>B67F   C8         INY
 <a name=B680></a>B680   B1 6F      LDA ($6F),Y
 <a name=B682></a>B682   AA         TAX
 <a name=B683></a>B683   C8         INY
 <a name=B684></a>B684   B1 6F      LDA ($6F),Y
 <a name=B686></a>B686   A8         TAY
 <a name=B687></a>B687   68         PLA
 
 <A name=B688>
 ; move string with length A, pointer in XY
 </A>
 <a name=B688></a>B688   86 22      STX $22
 <a name=B68A></a>B68A   84 23      STY $23
 <A name=B68C>
 <a name=B68C></a>B68C   A8         TAY
 </A>
 <a name=B68D></a>B68D   F0 0A      BEQ $B699
 <a name=B68F></a>B68F   48         PHA
 <a name=B690></a>B690   88         DEY
 <a name=B691></a>B691   B1 22      LDA ($22),Y
 <a name=B693></a>B693   91 35      STA ($35),Y
 <a name=B695></a>B695   98         TYA
 <a name=B696></a>B696   D0 F8      BNE $B690
 <a name=B698></a>B698   68         PLA
 <a name=B699></a>B699   18         CLC
 <a name=B69A></a>B69A   65 35      ADC $35
 <a name=B69C></a>B69C   85 35      STA $35
 <a name=B69E></a>B69E   90 02      BCC $B6A2
 <a name=B6A0></a>B6A0   E6 36      INC $36
 <a name=B6A2></a>B6A2   60         RTS
 
 <A name=B6A3>
 ; de-allocate temporary string                     ; !!! Also used as "check on string".  Huh???
 </A>
 <a name=B6A3></a>B6A3   20 8F AD   JSR $<A href="#AD8F">AD8F</A>
 <A name=B6A6>
 <a name=B6A6></a>B6A6   A5 64      LDA $64
 </A>
 <a name=B6A8></a>B6A8   A4 65      LDY $65
 <A name=B6AA>
 <a name=B6AA></a>B6AA   85 22      STA $22
 </A>
 <a name=B6AC></a>B6AC   84 23      STY $23
 <a name=B6AE></a>B6AE   20 DB B6   JSR $<A href="#B6DB">B6DB</A>
 <a name=B6B1></a>B6B1   08         PHP
 <a name=B6B2></a>B6B2   A0 00      LDY #$00
 <a name=B6B4></a>B6B4   B1 22      LDA ($22),Y
 <a name=B6B6></a>B6B6   48         PHA
 <a name=B6B7></a>B6B7   C8         INY
 <a name=B6B8></a>B6B8   B1 22      LDA ($22),Y
 <a name=B6BA></a>B6BA   AA         TAX
 <a name=B6BB></a>B6BB   C8         INY
 <a name=B6BC></a>B6BC   B1 22      LDA ($22),Y
 <a name=B6BE></a>B6BE   A8         TAY
 <a name=B6BF></a>B6BF   68         PLA
 <a name=B6C0></a>B6C0   28         PLP
 <a name=B6C1></a>B6C1   D0 13      BNE $B6D6
 <a name=B6C3></a>B6C3   C4 34      CPY $34
 <a name=B6C5></a>B6C5   D0 0F      BNE $B6D6
 <a name=B6C7></a>B6C7   E4 33      CPX $33
 <a name=B6C9></a>B6C9   D0 0B      BNE $B6D6
 <a name=B6CB></a>B6CB   48         PHA
 <a name=B6CC></a>B6CC   18         CLC
 <a name=B6CD></a>B6CD   65 33      ADC $33
 <a name=B6CF></a>B6CF   85 33      STA $33
 <a name=B6D1></a>B6D1   90 02      BCC $B6D5
 <a name=B6D3></a>B6D3   E6 34      INC $34
 <a name=B6D5></a>B6D5   68         PLA
 <a name=B6D6></a>B6D6   86 22      STX $22
 <a name=B6D8></a>B6D8   84 23      STY $23
 <a name=B6DA></a>B6DA   60         RTS
 
 <A name=B6DB>
 ; check descriptor stack
 </A>
 <a name=B6DB></a>B6DB   C4 18      CPY $18
 <a name=B6DD></a>B6DD   D0 0C      BNE $B6EB
 <a name=B6DF></a>B6DF   C5 17      CMP $17
 <a name=B6E1></a>B6E1   D0 08      BNE $B6EB
 <a name=B6E3></a>B6E3   85 16      STA $16
 <a name=B6E5></a>B6E5   E9 03      SBC #$03
 <a name=B6E7></a>B6E7   85 17      STA $17
 <a name=B6E9></a>B6E9   A0 00      LDY #$00
 <a name=B6EB></a>B6EB   60         RTS
 
 <A name=B6EC>
 ; CHR$ function
 </A>
 <a name=B6EC></a>B6EC   20 A1 B7   JSR $<A href="#B7A1">B7A1</A>
 <a name=B6EF></a>B6EF   8A         TXA
 <a name=B6F0></a>B6F0   48         PHA
 <a name=B6F1></a>B6F1   A9 01      LDA #$01
 <a name=B6F3></a>B6F3   20 7D B4   JSR $<A href="#B47D">B47D</A>
 <a name=B6F6></a>B6F6   68         PLA
 <a name=B6F7></a>B6F7   A0 00      LDY #$00
 <a name=B6F9></a>B6F9   91 62      STA ($62),Y
 <a name=B6FB></a>B6FB   68         PLA
 <a name=B6FC></a>B6FC   68         PLA
 <a name=B6FD></a>B6FD   4C CA B4   JMP $<A href="#B4CA">B4CA</A>
 
 <A name=B700>
 ; LEFT$ function
 </A>
 <a name=B700></a>B700   20 61 B7   JSR $<A href="#B761">B761</A>
 <a name=B703></a>B703   D1 50      CMP ($50),Y
 <a name=B705></a>B705   98         TYA
 <A name=B706>
 <a name=B706></a>B706   90 04      BCC $B70C
 </A>
 <a name=B708></a>B708   B1 50      LDA ($50),Y
 <a name=B70A></a>B70A   AA         TAX
 <a name=B70B></a>B70B   98         TYA
 <a name=B70C></a>B70C   48         PHA
 <a name=B70D></a>B70D   8A         TXA
 <a name=B70E></a>B70E   48         PHA
 <a name=B70F></a>B70F   20 7D B4   JSR $<A href="#B47D">B47D</A>
 <a name=B712></a>B712   A5 50      LDA $50
 <a name=B714></a>B714   A4 51      LDY $51
 <a name=B716></a>B716   20 AA B6   JSR $<A href="#B6AA">B6AA</A>
 <a name=B719></a>B719   68         PLA
 <a name=B71A></a>B71A   A8         TAY
 <a name=B71B></a>B71B   68         PLA
 <a name=B71C></a>B71C   18         CLC
 <a name=B71D></a>B71D   65 22      ADC $22
 <a name=B71F></a>B71F   85 22      STA $22
 <a name=B721></a>B721   90 02      BCC $B725
 <a name=B723></a>B723   E6 23      INC $23
 <a name=B725></a>B725   98         TYA
 <a name=B726></a>B726   20 8C B6   JSR $<A href="#B68C">B68C</A>
 <a name=B729></a>B729   4C CA B4   JMP $<A href="#B4CA">B4CA</A>
 
 <A name=B72C>
 ; RIGHT$ function
 </A>
 <a name=B72C></a>B72C   20 61 B7   JSR $<A href="#B761">B761</A>
 <a name=B72F></a>B72F   18         CLC
 <a name=B730></a>B730   F1 50      SBC ($50),Y
 <a name=B732></a>B732   49 FF      EOR #$FF
 <a name=B734></a>B734   4C 06 B7   JMP $<A href="#B706">B706</A>
 
 <A name=B737>
 ; MID$ function
 </A>
 <a name=B737></a>B737   A9 FF      LDA #$FF   ; default 3 parameter
 <a name=B739></a>B739   85 65      STA $65
 <a name=B73B></a>B73B   20 79 00   JSR $0079
 <a name=B73E></a>B73E   C9 29      CMP #$29   ; )
 <a name=B740></a>B740   F0 06      BEQ $B748
 <a name=B742></a>B742   20 FD AE   JSR $<A href="#AEF7">AEFD</A>
 <a name=B745></a>B745   20 9E B7   JSR $<A href="#B79E">B79E</A>
 <a name=B748></a>B748   20 61 B7   JSR $<A href="#B761">B761</A>
 <a name=B74B></a>B74B   F0 4B      BEQ $B798
 <a name=B74D></a>B74D   CA         DEX
 <a name=B74E></a>B74E   8A         TXA
 <a name=B74F></a>B74F   48         PHA
 <a name=B750></a>B750   18         CLC
 <a name=B751></a>B751   A2 00      LDX #$00
 <a name=B753></a>B753   F1 50      SBC ($50),Y
 <a name=B755></a>B755   B0 B6      BCS $B70D
 <a name=B757></a>B757   49 FF      EOR #$FF
 <a name=B759></a>B759   C5 65      CMP $65
 <a name=B75B></a>B75B   90 B1      BCC $B70E
 <a name=B75D></a>B75D   A5 65      LDA $65
 <a name=B75F></a>B75F   B0 AD      BCS $B70E
 
 <A name=B761>
 ; get first 2 parameters for
 ; LEFT$, RIGHT$ and MID$
 </A>
 <a name=B761></a>B761   20 F7 AE   JSR $<A href="#AEF7">AEF7</A>
 <a name=B764></a>B764   68         PLA
 <a name=B765></a>B765   A8         TAY
 <a name=B766></a>B766   68         PLA
 <a name=B767></a>B767   85 55      STA $55
 <a name=B769></a>B769   68         PLA
 <a name=B76A></a>B76A   68         PLA
 <a name=B76B></a>B76B   68         PLA
 <a name=B76C></a>B76C   AA         TAX
 <a name=B76D></a>B76D   68         PLA
 <a name=B76E></a>B76E   85 50      STA $50
 <a name=B770></a>B770   68         PLA
 <a name=B771></a>B771   85 51      STA $51
 <a name=B773></a>B773   A5 55      LDA $55
 <a name=B775></a>B775   48         PHA
 <a name=B776></a>B776   98         TYA
 <a name=B777></a>B777   48         PHA
 <a name=B778></a>B778   A0 00      LDY #$00
 <a name=B77A></a>B77A   8A         TXA
 <a name=B77B></a>B77B   60         RTS
 
 <A name=B77C>
 ; LEN function
 </A>
 <a name=B77C></a>B77C   20 82 B7   JSR $<A href="#B782">B782</A>
 <a name=B77F></a>B77F   4C A2 B3   JMP $<A href="#B3A2">B3A2</A>
 
 <A name=B782>
 <a name=B782></a>B782   20 A3 B6   JSR $<A href="#B6A3">B6A3</A>
 </A>
 <a name=B785></a>B785   A2 00      LDX #$00
 <a name=B787></a>B787   86 0D      STX $0D
 <a name=B789></a>B789   A8         TAY
 <a name=B78A></a>B78A   60         RTS
 
 <A name=B78B>
 ; ASC function
 </A>
 <a name=B78B></a>B78B   20 82 B7   JSR $<A href="#B782">B782</A>
 <a name=B78E></a>B78E   F0 08      BEQ $B798
 <a name=B790></a>B790   A0 00      LDY #$00
 <a name=B792></a>B792   B1 22      LDA ($22),Y
 <a name=B794></a>B794   A8         TAY
 <a name=B795></a>B795   4C A2 B3   JMP $<A href="#B3A2">B3A2</A>
 
 <a name=B798></a>B798   4C 48 B2   JMP $<A href="#B248">B248</A>
 
<A name=B79B></A>
 ; fetch integer value in X and check range

 <a name=xxxx></a>B79B   20 73 00   JSR $0073
; Entry called by <A href="#E221">E221</A>
 <a name=B79E></a>B79E   20 8A AD   JSR $<A href="#AD8A">AD8A</A>

<A name=B7A1>
 <a name=B7A1></a>B7A1   20 B8 B1   JSR $<A href="#B1B8">B1B8</A>
</A>
 <a name=B7A4></a>B7A4   A6 64      LDX $64
 <a name=B7A6></a>B7A6   D0 F0      BNE $B798
 <a name=B7A8></a>B7A8   A6 65      LDX $65
 <a name=B7AA></a>B7AA   4C 79 00   JMP $0079
 
 <A name=B7AD>
 ; VAL function
 </A>
 <a name=B7AD></a>B7AD   20 82 B7   JSR $<A href="#B782">B782</A>
 <a name=B7B0></a>B7B0   D0 03      BNE $B7B5
 <a name=B7B2></a>B7B2   4C F7 B8   JMP $<A href="#B8F7">B8F7</A>
 <a name=B7B5></a>B7B5   A6 7A      LDX $7A
 <a name=B7B7></a>B7B7   A4 7B      LDY $7B
 <a name=B7B9></a>B7B9   86 71      STX $71
 <a name=B7BB></a>B7BB   84 72      STY $72
 <a name=B7BD></a>B7BD   A6 22      LDX $22
 <a name=B7BF></a>B7BF   86 7A      STX $7A
 <a name=B7C1></a>B7C1   18         CLC
 <a name=B7C2></a>B7C2   65 22      ADC $22
 <a name=B7C4></a>B7C4   85 24      STA $24
 <a name=B7C6></a>B7C6   A6 23      LDX $23
 <a name=B7C8></a>B7C8   86 7B      STX $7B
 <a name=B7CA></a>B7CA   90 01      BCC $B7CD
 <a name=B7CC></a>B7CC   E8         INX
 <a name=B7CD></a>B7CD   86 25      STX $25
 <a name=B7CF></a>B7CF   A0 00      LDY #$00
 <a name=B7D1></a>B7D1   B1 24      LDA ($24),Y
 <a name=B7D3></a>B7D3   48         PHA
 <a name=B7D4></a>B7D4   98         TYA
 <a name=B7D5></a>B7D5   91 24      STA ($24),Y
 <a name=B7D7></a>B7D7   20 79 00   JSR $0079
 <a name=B7DA></a>B7DA   20 F3 BC   JSR $<A href="#BCF3">BCF3</A>
 <a name=B7DD></a>B7DD   68         PLA
 <a name=B7DE></a>B7DE   A0 00      LDY #$00
 <a name=B7E0></a>B7E0   91 24      STA ($24),Y
 <A name=B7E2>
 <a name=B7E2></a>B7E2   A6 71      LDX $71
 </A>
 <a name=B7E4></a>B7E4   A4 72      LDY $72
 <a name=B7E6></a>B7E6   86 7A      STX $7A
 <a name=B7E8></a>B7E8   84 7B      STY $7B
 <a name=B7EA></a>B7EA   60         RTS
 
 <A name=B7EB>
 ; get address into $14/$15 and integer in X
 </A>
 <a name=B7EB></a>B7EB   20 8A AD   JSR $<A href="#AD8A">AD8A</A>
 <a name=B7EE></a>B7EE   20 F7 B7   JSR $<A href="#B7F7">B7F7</A>
 <A name=B7F1>
 <a name=B7F1></a>B7F1   20 FD AE   JSR $<A href="#AEF7">AEFD</A>
 </A>
 <a name=B7F4></a>B7F4   4C 9E B7   JMP $<A href="#B79E">B79E</A>
 
 <A name=B7F7>
 ; convert float ti integer in $14/$15
 </A>
 <a name=B7F7></a>B7F7   A5 66      LDA $66
 <a name=B7F9></a>B7F9   30 9D      BMI $B798
 <a name=B7FB></a>B7FB   A5 61      LDA $61
 <a name=B7FD></a>B7FD   C9 91      CMP #$91
 <a name=B7FF></a>B7FF   B0 97      BCS $B798
 <a name=B801></a>B801   20 9B BC   JSR $<A href="#BC9B">BC9B</A>
 <a name=B804></a>B804   A5 64      LDA $64
 <a name=B806></a>B806   A4 65      LDY $65
 <a name=B808></a>B808   84 14      STY $14
 <a name=B80A></a>B80A   85 15      STA $15
 <a name=B80C></a>B80C   60         RTS
 
 <A name=B80D>
 ; PEEK function
 </A>
 <a name=B80D></a>B80D   A5 15      LDA $15
 <a name=B80F></a>B80F   48         PHA
 <a name=B810></a>B810   A5 14      LDA $14
 <a name=B812></a>B812   48         PHA
 <a name=B813></a>B813   20 F7 B7   JSR $<A href="#B7F7">B7F7</A>
 <a name=B816></a>B816   A0 00      LDY #$00
 <a name=B818></a>B818   B1 14      LDA ($14),Y
 <a name=B81A></a>B81A   A8         TAY
 <a name=B81B></a>B81B   68         PLA
 <a name=B81C></a>B81C   85 14      STA $14
 <a name=B81E></a>B81E   68         PLA
 <a name=B81F></a>B81F   85 15      STA $15
 <a name=B821></a>B821   4C A2 B3   JMP $<A href="#B3A2">B3A2</A>
 
 <A name=B824>
 ; POKE command
 </A>
 <a name=B824></a>B824   20 EB B7   JSR $<A href="#B7EB">B7EB</A>
 <a name=B827></a>B827   8A         TXA
 <a name=B828></a>B828   A0 00      LDY #$00
 <a name=B82A></a>B82A   91 14      STA ($14),Y
 <a name=B82C></a>B82C   60         RTS
 
 <A name=B82D>
 ; WAIT command
 </A>
 <a name=B82D></a>B82D   20 EB B7   JSR $<A href="#B7EB">B7EB</A>
 <a name=B830></a>B830   86 49      STX $49
 <a name=B832></a>B832   A2 00      LDX #$00
 <a name=B834></a>B834   20 79 00   JSR $0079
 <a name=B837></a>B837   F0 03      BEQ $B83C
 <a name=B839></a>B839   20 F1 B7   JSR $<A href="#B7F1">B7F1</A>
 <a name=B83C></a>B83C   86 4A      STX $4A
 <a name=B83E></a>B83E   A0 00      LDY #$00
 <a name=B840></a>B840   B1 14      LDA ($14),Y
 <a name=B842></a>B842   45 4A      EOR $4A
 <a name=B844></a>B844   25 49      AND $49
 <a name=B846></a>B846   F0 F8      BEQ $B840
 <a name=B848></a>B848   60         RTS
 
 <A name=B849>
 ; add 0.5 to float accu (rounding)
 </A>
 <a name=B849></a>B849   A9 11      LDA #$11   ; low  <A href="#BF11">BF11</A>
 <a name=B84B></a>B84B   A0 BF      LDY #$BF   ; high <A href="#BF11">BF11</A>
 <a name=B84D></a>B84D   4C 67 B8   JMP $<A href="#B867">B867</A>
 
 <A name=B850>
 ; minus operator
 </A>
 <a name=B850></a>B850   20 8C BA   JSR $<A href="#BA8C">BA8C</A>
 <A name=B853>
 <a name=B853></a>B853   A5 66      LDA $66
 </A>
 <a name=B855></a>B855   49 FF      EOR #$FF
 <a name=B857></a>B857   85 66      STA $66
 <a name=B859></a>B859   45 6E      EOR $6E
 <a name=B85B></a>B85B   85 6F      STA $6F
 <a name=B85D></a>B85D   A5 61      LDA $61
 <a name=B85F></a>B85F   4C 6A B8   JMP $<A href="#B86A">B86A</A>
 
 <a name=B862></a>B862   20 99 B9   JSR $<A href="#B999">B999</A>
 <a name=B865></a>B865   90 3C      BCC $B8A3
 
 <A name=B867>
 ; add float indexed by AY to float accu
 </A>
 <a name=B867></a>B867   20 8C BA   JSR $<A href="#BA8C">BA8C</A>
 
 <A name=B86A>
 ; plus operator
 </A>
 <a name=B86A></a>B86A   D0 03      BNE $B86F
 <a name=B86C></a>B86C   4C FC BB   JMP $<A href="#BBFC">BBFC</A>
 
 <a name=B86F></a>B86F   A6 70      LDX $70
 <a name=B871></a>B871   86 56      STX $56
 <a name=B873></a>B873   A2 69      LDX #$69
 <a name=B875></a>B875   A5 69      LDA $69
 <A name=B877>
 <a name=B877></a>B877   A8         TAY
 </A>
 <a name=B878></a>B878   F0 CE      BEQ $B848
 <a name=B87A></a>B87A   38         SEC
 <a name=B87B></a>B87B   E5 61      SBC $61
 <a name=B87D></a>B87D   F0 24      BEQ $B8A3
 <a name=B87F></a>B87F   90 12      BCC $B893
 <a name=B881></a>B881   84 61      STY $61
 <a name=B883></a>B883   A4 6E      LDY $6E
 <a name=B885></a>B885   84 66      STY $66
 <a name=B887></a>B887   49 FF      EOR #$FF
 <a name=B889></a>B889   69 00      ADC #$00
 <a name=B88B></a>B88B   A0 00      LDY #$00
 <a name=B88D></a>B88D   84 56      STY $56
 <a name=B88F></a>B88F   A2 61      LDX #$61
 <a name=B891></a>B891   D0 04      BNE $B897
 <a name=B893></a>B893   A0 00      LDY #$00
 <a name=B895></a>B895   84 70      STY $70
 <a name=B897></a>B897   C9 F9      CMP #$F9
 <a name=B899></a>B899   30 C7      BMI $B862
 <a name=B89B></a>B89B   A8         TAY
 <a name=B89C></a>B89C   A5 70      LDA $70
 <a name=B89E></a>B89E   56 01      LSR $01,X
 <a name=B8A0></a>B8A0   20 B0 B9   JSR $<A href="#B9B0">B9B0</A>
 <a name=B8A3></a>B8A3   24 6F      BIT $6F
 <a name=B8A5></a>B8A5   10 57      BPL $B8FE
 <a name=B8A7></a>B8A7   A0 61      LDY #$61
 <a name=B8A9></a>B8A9   E0 69      CPX #$69
 <a name=B8AB></a>B8AB   F0 02      BEQ $B8AF
 <a name=B8AD></a>B8AD   A0 69      LDY #$69
 <a name=B8AF></a>B8AF   38         SEC
 <a name=B8B0></a>B8B0   49 FF      EOR #$FF
 <a name=B8B2></a>B8B2   65 56      ADC $56
 <a name=B8B4></a>B8B4   85 70      STA $70
 <a name=B8B6></a>B8B6   B9 04 00   LDA $0004,Y
 <a name=B8B9></a>B8B9   F5 04      SBC $04,X
 <a name=B8BB></a>B8BB   85 65      STA $65
 <a name=B8BD></a>B8BD   B9 03 00   LDA $0003,Y
 <a name=B8C0></a>B8C0   F5 03      SBC $03,X
 <a name=B8C2></a>B8C2   85 64      STA $64
 <a name=B8C4></a>B8C4   B9 02 00   LDA $0002,Y
 <a name=B8C7></a>B8C7   F5 02      SBC $02,X
 <a name=B8C9></a>B8C9   85 63      STA $63
 <a name=B8CB></a>B8CB   B9 01 00   LDA $0001,Y
 <a name=B8CE></a>B8CE   F5 01      SBC $01,X
 <a name=B8D0></a>B8D0   85 62      STA $62
 <A name=B8D2>
 <a name=B8D2></a>B8D2   B0 03      BCS $B8D7
 </A>
 <a name=B8D4></a>B8D4   20 47 B9   JSR $<A href="#B947">B947</A>
 <A name=B8D7>
 <a name=B8D7></a>B8D7   A0 00      LDY #$00
 </A>
 <a name=B8D9></a>B8D9   98         TYA
 <a name=B8DA></a>B8DA   18         CLC
 <a name=B8DB></a>B8DB   A6 62      LDX $62
 <a name=B8DD></a>B8DD   D0 4A      BNE $B929
 <a name=B8DF></a>B8DF   A6 63      LDX $63
 <a name=B8E1></a>B8E1   86 62      STX $62
 <a name=B8E3></a>B8E3   A6 64      LDX $64
 <a name=B8E5></a>B8E5   86 63      STX $63
 <a name=B8E7></a>B8E7   A6 65      LDX $65
 <a name=B8E9></a>B8E9   86 64      STX $64
 <a name=B8EB></a>B8EB   A6 70      LDX $70
 <a name=B8ED></a>B8ED   86 65      STX $65
 <a name=B8EF></a>B8EF   84 70      STY $70
 <a name=B8F1></a>B8F1   69 08      ADC #$08
 <a name=B8F3></a>B8F3   C9 20      CMP #$20
 <a name=B8F5></a>B8F5   D0 E4      BNE $B8DB
 <A name=B8F7>
 <a name=B8F7></a>B8F7   A9 00      LDA #$00
 </A>
 <A name=B8F9>
 <a name=B8F9></a>B8F9   85 61      STA $61
 </A>
 <A name=B8FB>
 <a name=B8FB></a>B8FB   85 66      STA $66
 </A>
 <a name=B8FD></a>B8FD   60         RTS
 
 <A name=B8FE>
 ; add fractions
 </A>
 <a name=B8FE></a>B8FE   65 56      ADC $56
 <a name=B900></a>B900   85 70      STA $70
 <a name=B902></a>B902   A5 65      LDA $65
 <a name=B904></a>B904   65 6D      ADC $6D
 <a name=B906></a>B906   85 65      STA $65
 <a name=B908></a>B908   A5 64      LDA $64
 <a name=B90A></a>B90A   65 6C      ADC $6C
 <a name=B90C></a>B90C   85 64      STA $64
 <a name=B90E></a>B90E   A5 63      LDA $63
 <a name=B910></a>B910   65 6B      ADC $6B
 <a name=B912></a>B912   85 63      STA $63
 <a name=B914></a>B914   A5 62      LDA $62
 <a name=B916></a>B916   65 6A      ADC $6A
 <a name=B918></a>B918   85 62      STA $62
 <a name=B91A></a>B91A   4C 36 B9   JMP $<A href="#B936">B936</A>
 
 <A name=B91D>
 ; postshift
 </A>
 <a name=B91D></a>B91D   69 01      ADC #$01
 <a name=B91F></a>B91F   06 70      ASL $70
 <a name=B921></a>B921   26 65      ROL $65
 <a name=B923></a>B923   26 64      ROL $64
 <a name=B925></a>B925   26 63      ROL $63
 <a name=B927></a>B927   26 62      ROL $62
 <a name=B929></a>B929   10 F2      BPL $B91D
 <a name=B92B></a>B92B   38         SEC
 <a name=B92C></a>B92C   E5 61      SBC $61
 <a name=B92E></a>B92E   B0 C7      BCS $B8F7
 <a name=B930></a>B930   49 FF      EOR #$FF
 <a name=B932></a>B932   69 01      ADC #$01
 <a name=B934></a>B934   85 61      STA $61
 <A name=B936>
 <a name=B936></a>B936   90 0E      BCC $B946
 </A>
 <A name=B938>
 <a name=B938></a>B938   E6 61      INC $61
 </A>
 <a name=B93A></a>B93A   F0 42      BEQ $B97E
 <a name=B93C></a>B93C   66 62      ROR $62
 <a name=B93E></a>B93E   66 63      ROR $63
 <a name=B940></a>B940   66 64      ROR $64
 <a name=B942></a>B942   66 65      ROR $65
 <a name=B944></a>B944   66 70      ROR $70
 <a name=B946></a>B946   60         RTS
 
 <A name=B947>
 ; negate float accu
 </A>
 <a name=B947></a>B947   A5 66      LDA $66
 <a name=B949></a>B949   49 FF      EOR #$FF
 <a name=B94B></a>B94B   85 66      STA $66
 <A name=B94D>
 <a name=B94D></a>B94D   A5 62      LDA $62
 </A>
 <a name=B94F></a>B94F   49 FF      EOR #$FF
 <a name=B951></a>B951   85 62      STA $62
 <a name=B953></a>B953   A5 63      LDA $63
 <a name=B955></a>B955   49 FF      EOR #$FF
 <a name=B957></a>B957   85 63      STA $63
 <a name=B959></a>B959   A5 64      LDA $64
 <a name=B95B></a>B95B   49 FF      EOR #$FF
 <a name=B95D></a>B95D   85 64      STA $64
 <a name=B95F></a>B95F   A5 65      LDA $65
 <a name=B961></a>B961   49 FF      EOR #$FF
 <a name=B963></a>B963   85 65      STA $65
 <a name=B965></a>B965   A5 70      LDA $70
 <a name=B967></a>B967   49 FF      EOR #$FF
 <a name=B969></a>B969   85 70      STA $70
 <a name=B96B></a>B96B   E6 70      INC $70
 <a name=B96D></a>B96D   D0 0E      BNE $B97D
 
 <A name=B96F>
 ; increment fraction
 </A>
 <a name=B96F></a>B96F   E6 65      INC $65
 <a name=B971></a>B971   D0 0A      BNE $B97D
 <a name=B973></a>B973   E6 64      INC $64
 <a name=B975></a>B975   D0 06      BNE $B97D
 <a name=B977></a>B977   E6 63      INC $63
 <a name=B979></a>B979   D0 02      BNE $B97D
 <a name=B97B></a>B97B   E6 62      INC $62
 <a name=B97D></a>B97D   60         RTS
 
 <A name=B97E>
 <a name=B97E></a>B97E   A2 0F      LDX #$0F   ; error number
 </A>
 <a name=B980></a>B980   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <A name=B983>
 ; preshift
 </A>
 <a name=B983></a>B983   A2 25      LDX #$25
 <a name=B985></a>B985   B4 04      LDY $04,X
 <a name=B987></a>B987   84 70      STY $70
 <a name=B989></a>B989   B4 03      LDY $03,X
 <a name=B98B></a>B98B   94 04      STY $04,X
 <a name=B98D></a>B98D   B4 02      LDY $02,X
 <a name=B98F></a>B98F   94 03      STY $03,X
 <a name=B991></a>B991   B4 01      LDY $01,X
 <a name=B993></a>B993   94 02      STY $02,X
 <a name=B995></a>B995   A4 68      LDY $68
 <a name=B997></a>B997   94 01      STY $01,X
 <A name=B999>
 <a name=B999></a>B999   69 08      ADC #$08
 </A>
 <a name=B99B></a>B99B   30 E8      BMI $B985
 <a name=B99D></a>B99D   F0 E6      BEQ $B985
 <a name=B99F></a>B99F   E9 08      SBC #$08
 <a name=B9A1></a>B9A1   A8         TAY
 <a name=B9A2></a>B9A2   A5 70      LDA $70
 <a name=B9A4></a>B9A4   B0 14      BCS $B9BA
 <a name=B9A6></a>B9A6   16 01      ASL $01,X
 <a name=B9A8></a>B9A8   90 02      BCC $B9AC
 <a name=B9AA></a>B9AA   F6 01      INC $01,X
 <a name=B9AC></a>B9AC   76 01      ROR $01,X
 <a name=B9AE></a>B9AE   76 01      ROR $01,X
 <A name=B9B0>
 <a name=B9B0></a>B9B0   76 02      ROR $02,X
 </A>
 <a name=B9B2></a>B9B2   76 03      ROR $03,X
 <a name=B9B4></a>B9B4   76 04      ROR $04,X
 <a name=B9B6></a>B9B6   6A         ROR
 <a name=B9B7></a>B9B7   C8         INY
 <a name=B9B8></a>B9B8   D0 EC      BNE $B9A6
 <a name=B9BA></a>B9BA   18         CLC
 <a name=B9BB></a>B9BB   60         RTS
 
 <A name=B9BC>
 ; 1
 </A>
 <a name=B9BC></a>B9BC   .BY $81,$00,$00,$00,$00
 
 <A name=B9C1>
 ; LOG polynomial table
 </A>
 <a name=B9C1></a>B9C1   .BY $03   ; degree 4
 <a name=B9C2></a>B9C2   .BY $7F,$5E,$56,$CB,$79
 <a name=B9C7></a>B9C7   .BY $80,$13,$9B,$0B,$64
 <a name=B9CC></a>B9CC   .BY $80,$76,$38,$93,$16
 <a name=B9D1></a>B9D1   .BY $82,$38,$AA,$3B,$20
 
 <A name=B9D6>
 ; 0,5 * SQR(2)
 </A>
 <a name=B9D6></a>B9D6   .BY $80,$35,$04,$F3,$34
 <A name=B9DB>
 ; SQR(2)
 </A>
 <a name=B9DB></a>B9DB   .BY $81,$35,$04,$F3,$34
 <A name=B9E0>
 ; -0.5
 </A>
 <a name=B9E0></a>B9E0   .BY $80,$80,$00,$00,$00
 <A name=B9E5>
 ; LOG(2)
 </A>
 <a name=B9E5></a>B9E5   .BY $80,$31,$72,$17,$F8
 
 <A name=B9EA>
 ; LOG function
 </A>
 <a name=B9EA></a>B9EA   20 2B BC   JSR $<A href="#BC2B">BC2B</A>
 <a name=B9ED></a>B9ED   F0 02      BEQ $B9F1
 <a name=B9EF></a>B9EF   10 03      BPL $B9F4
 <a name=B9F1></a>B9F1   4C 48 B2   JMP $<A href="#B248">B248</A>
 
 <a name=B9F4></a>B9F4   A5 61      LDA $61
 <a name=B9F6></a>B9F6   E9 7F      SBC #$7F
 <a name=B9F8></a>B9F8   48         PHA
 <a name=B9F9></a>B9F9   A9 80      LDA #$80
 <a name=B9FB></a>B9FB   85 61      STA $61
 <a name=B9FD></a>B9FD   A9 D6      LDA #$D6   ; low  <A href="#B9D6">B9D6</A>
 <a name=B9FF></a>B9FF   A0 B9      LDY #$B9   ; high <A href="#B9D6">B9D6</A>
 <a name=BA01></a>BA01   20 67 B8   JSR $<A href="#B867">B867</A>
 <a name=BA04></a>BA04   A9 DB      LDA #$DB   ; low  <A href="#B9DB">B9DB</A>
 <a name=BA06></a>BA06   A0 B9      LDY #$B9   ; high <A href="#B9DB">B9DB</A>
 <a name=BA08></a>BA08   20 0F BB   JSR $<A href="#BB0F">BB0F</A>
 <a name=BA0B></a>BA0B   A9 BC      LDA #$BC   ; low  <A href="#B9BC">B9BC</A>
 <a name=BA0D></a>BA0D   A0 B9      LDY #$B9   ; high <A href="#B9BC">B9BC</A>
 <a name=BA0F></a>BA0F   20 50 B8   JSR $<A href="#B850">B850</A>
 <a name=BA12></a>BA12   A9 C1      LDA #$C1   ; low  <A href="#B9C1">B9C1</A>
 <a name=BA14></a>BA14   A0 B9      LDY #$B9   ; high <A href="#B9C1">B9C1</A>
 <a name=BA16></a>BA16   20 43 E0   JSR $<A href="#E043">E043</A>
 <a name=BA19></a>BA19   A9 E0      LDA #$E0   ; low  <A href="#B9E0">B9E0</A>
 <a name=BA1B></a>BA1B   A0 B9      LDY #$B9   ; high <A href="#B9E0">B9E0</A>
 <a name=BA1D></a>BA1D   20 67 B8   JSR $<A href="#B867">B867</A>
 <a name=BA20></a>BA20   68         PLA
 <a name=BA21></a>BA21   20 7E BD   JSR $<A href="#BD7E">BD7E</A>
 <a name=BA24></a>BA24   A9 E5      LDA #$E5   ; low  <A href="#B9E5">B9E5</A>
 <a name=BA26></a>BA26   A0 B9      LDY #$B9   ; high <A href="#B9E5">B9E5</A>
 <A name=BA28>
 <a name=BA28></a>BA28   20 8C BA   JSR $<A href="#BA8C">BA8C</A>
 </A>
 
 <A name=BA2B>
 ; times operator
 </A>
 <a name=BA2B></a>BA2B   D0 03      BNE $BA30
 <a name=BA2D></a>BA2D   4C 8B BA   JMP $<A href="#BA8B">BA8B</A>
 
 <a name=BA30></a>BA30   20 B7 BA   JSR $<A href="#BAB7">BAB7</A>
 <a name=BA33></a>BA33   A9 00      LDA #$00
 <a name=BA35></a>BA35   85 26      STA $26
 <a name=BA37></a>BA37   85 27      STA $27
 <a name=BA39></a>BA39   85 28      STA $28
 <a name=BA3B></a>BA3B   85 29      STA $29
 <a name=BA3D></a>BA3D   A5 70      LDA $70
 <a name=BA3F></a>BA3F   20 59 BA   JSR $<A href="#BA59">BA59</A>
 <a name=BA42></a>BA42   A5 65      LDA $65
 <a name=BA44></a>BA44   20 59 BA   JSR $<A href="#BA59">BA59</A>
 <a name=BA47></a>BA47   A5 64      LDA $64
 <a name=BA49></a>BA49   20 59 BA   JSR $<A href="#BA59">BA59</A>
 <a name=BA4C></a>BA4C   A5 63      LDA $63
 <a name=BA4E></a>BA4E   20 59 BA   JSR $<A href="#BA59">BA59</A>
 <a name=BA51></a>BA51   A5 62      LDA $62
 <a name=BA53></a>BA53   20 5E BA   JSR $<A href="#BA5E">BA5E</A>
 <a name=BA56></a>BA56   4C 8F BB   JMP $<A href="#BB8F">BB8F</A>
 
 <A name=BA59>
 <a name=BA59></a>BA59   D0 03      BNE $BA5E
 </A>
 <a name=BA5B></a>BA5B   4C 83 B9   JMP $<A href="#B983">B983</A>
 
 <A name=BA5E>
 <a name=BA5E></a>BA5E   4A         LSR
 </A>
 <a name=BA5F></a>BA5F   09 80      ORA #$80
 <a name=BA61></a>BA61   A8         TAY
 <a name=BA62></a>BA62   90 19      BCC $BA7D
 <a name=BA64></a>BA64   18         CLC
 <a name=BA65></a>BA65   A5 29      LDA $29
 <a name=BA67></a>BA67   65 6D      ADC $6D
 <a name=BA69></a>BA69   85 29      STA $29
 <a name=BA6B></a>BA6B   A5 28      LDA $28
 <a name=BA6D></a>BA6D   65 6C      ADC $6C
 <a name=BA6F></a>BA6F   85 28      STA $28
 <a name=BA71></a>BA71   A5 27      LDA $27
 <a name=BA73></a>BA73   65 6B      ADC $6B
 <a name=BA75></a>BA75   85 27      STA $27
 <a name=BA77></a>BA77   A5 26      LDA $26
 <a name=BA79></a>BA79   65 6A      ADC $6A
 <a name=BA7B></a>BA7B   85 26      STA $26
 <a name=BA7D></a>BA7D   66 26      ROR $26
 <a name=BA7F></a>BA7F   66 27      ROR $27
 <a name=BA81></a>BA81   66 28      ROR $28
 <a name=BA83></a>BA83   66 29      ROR $29
 <a name=BA85></a>BA85   66 70      ROR $70
 <a name=BA87></a>BA87   98         TYA
 <a name=BA88></a>BA88   4A         LSR
 <a name=BA89></a>BA89   D0 D6      BNE $BA61
 <A name=BA8B>
 <a name=BA8B></a>BA8B   60         RTS
 </A>
 
 <A name=BA8C>
 ; move float indexed by AY into second float accu
 </A>
 <a name=BA8C></a>BA8C   85 22      STA $22
 <a name=BA8E></a>BA8E   84 23      STY $23
 <a name=BA90></a>BA90   A0 04      LDY #$04
 <a name=BA92></a>BA92   B1 22      LDA ($22),Y
 <a name=BA94></a>BA94   85 6D      STA $6D
 <a name=BA96></a>BA96   88         DEY
 <a name=BA97></a>BA97   B1 22      LDA ($22),Y
 <a name=BA99></a>BA99   85 6C      STA $6C
 <a name=BA9B></a>BA9B   88         DEY
 <a name=BA9C></a>BA9C   B1 22      LDA ($22),Y
 <a name=BA9E></a>BA9E   85 6B      STA $6B
 <a name=BAA0></a>BAA0   88         DEY
 <a name=BAA1></a>BAA1   B1 22      LDA ($22),Y
 <a name=BAA3></a>BAA3   85 6E      STA $6E
 <a name=BAA5></a>BAA5   45 66      EOR $66
 <a name=BAA7></a>BAA7   85 6F      STA $6F
 <a name=BAA9></a>BAA9   A5 6E      LDA $6E
 <a name=BAAB></a>BAAB   09 80      ORA #$80
 <a name=BAAD></a>BAAD   85 6A      STA $6A
 <a name=BAAF></a>BAAF   88         DEY
 <a name=BAB0></a>BAB0   B1 22      LDA ($22),Y
 <a name=BAB2></a>BAB2   85 69      STA $69
 <a name=BAB4></a>BAB4   A5 61      LDA $61
 <a name=BAB6></a>BAB6   60         RTS
 
 <A name=BAB7>
 ; add exponents
 </A>
 <a name=BAB7></a>BAB7   A5 69      LDA $69
 <A name=BAB9>
 <a name=BAB9></a>BAB9   F0 1F      BEQ $BADA
 </A>
 <a name=BABB></a>BABB   18         CLC
 <a name=BABC></a>BABC   65 61      ADC $61
 <a name=BABE></a>BABE   90 04      BCC $BAC4
 <a name=BAC0></a>BAC0   30 1D      BMI $BADF
 <a name=BAC2></a>BAC2   18         CLC
 <a name=BAC3></a>BAC3   .BY $2C
 <a name=BAC4></a>BAC4   10 14      BPL $BADA
 <a name=BAC6></a>BAC6   69 80      ADC #$80
 <a name=BAC8></a>BAC8   85 61      STA $61
 <a name=BACA></a>BACA   D0 03      BNE $BACF
 <a name=BACC></a>BACC   4C FB B8   JMP $<A href="#B8FB">B8FB</A>
 
 <a name=BACF></a>BACF   A5 6F      LDA $6F
 <a name=BAD1></a>BAD1   85 66      STA $66
 <a name=BAD3></a>BAD3   60         RTS
 
 <A name=BAD4>
 <a name=BAD4></a>BAD4   A5 66      LDA $66
 </A>
 <a name=BAD6></a>BAD6   49 FF      EOR #$FF
 <a name=BAD8></a>BAD8   30 05      BMI $BADF
 <a name=BADA></a>BADA   68         PLA
 <a name=BADB></a>BADB   68         PLA
 <a name=BADC></a>BADC   4C F7 B8   JMP $<A href="#B8F7">B8F7</A>
 
 <a name=BADF></a>BADF   4C 7E B9   JMP $<A href="#B97E">B97E</A>
 
 <A name=BAE2>
 ; multiply float accu by 10
 </A>
 <a name=BAE2></a>BAE2   20 0C BC   JSR $<A href="#BC0C">BC0C</A>
 <a name=BAE5></a>BAE5   AA         TAX
 <a name=BAE6></a>BAE6   F0 10      BEQ $BAF8
 <a name=BAE8></a>BAE8   18         CLC
 <a name=BAE9></a>BAE9   69 02      ADC #$02
 <a name=BAEB></a>BAEB   B0 F2      BCS $BADF
 <A name=BAED>
 <a name=BAED></a>BAED   A2 00      LDX #$00
 </A>
 <a name=BAEF></a>BAEF   86 6F      STX $6F
 <a name=BAF1></a>BAF1   20 77 B8   JSR $<A href="#B877">B877</A>
 <a name=BAF4></a>BAF4   E6 61      INC $61
 <a name=BAF6></a>BAF6   F0 E7      BEQ $BADF
 <a name=BAF8></a>BAF8   60         RTS
 
 <A name=BAF9>
 ; constant 10 for division
 </A>
 <a name=BAF9></a>BAF9   .BY $84,$20,$00,$00,$00
 
 <A name=BAFE>
 ; divide float by 10
 </A>
 <a name=BAFE></a>BAFE   20 0C BC   JSR $<A href="#BC0C">BC0C</A>
 <a name=BB01></a>BB01   A9 F9      LDA #$F9   ; low  <A href="#BAF9">BAF9</A>
 <a name=BB03></a>BB03   A0 BA      LDY #$BA   ; high <A href="#BAF9">BAF9</A>
 <a name=BB05></a>BB05   A2 00      LDX #$00
 <A name=BB07>
 <a name=BB07></a>BB07   86 6F      STX $6F
 </A>
 <a name=BB09></a>BB09   20 A2 BB   JSR $<A href="#BBA2">BBA2</A>
 <a name=BB0C></a>BB0C   4C 12 BB   JMP $<A href="#BB12">BB12</A>
 
 <A name=BB0F>
 ; divide number indexed by AY by float accu
 </A>
 <a name=BB0F></a>BB0F   20 8C BA   JSR $<A href="#BA8C">BA8C</A>
 
 <A name=BB12>
 ; divide operator
 </A>
 <a name=BB12></a>BB12   F0 76      BEQ $BB8A
 <a name=BB14></a>BB14   20 1B BC   JSR $<A href="#BC1B">BC1B</A>
 <a name=BB17></a>BB17   A9 00      LDA #$00
 <a name=BB19></a>BB19   38         SEC
 <a name=BB1A></a>BB1A   E5 61      SBC $61
 <a name=BB1C></a>BB1C   85 61      STA $61
 <a name=BB1E></a>BB1E   20 B7 BA   JSR $<A href="#BAB7">BAB7</A>
 <a name=BB21></a>BB21   E6 61      INC $61
 <a name=BB23></a>BB23   F0 BA      BEQ $BADF
 <a name=BB25></a>BB25   A2 FC      LDX #$FC
 <a name=BB27></a>BB27   A9 01      LDA #$01
 <a name=BB29></a>BB29   A4 6A      LDY $6A
 <a name=BB2B></a>BB2B   C4 62      CPY $62
 <a name=BB2D></a>BB2D   D0 10      BNE $BB3F
 <a name=BB2F></a>BB2F   A4 6B      LDY $6B
 <a name=BB31></a>BB31   C4 63      CPY $63
 <a name=BB33></a>BB33   D0 0A      BNE $BB3F
 <a name=BB35></a>BB35   A4 6C      LDY $6C
 <a name=BB37></a>BB37   C4 64      CPY $64
 <a name=BB39></a>BB39   D0 04      BNE $BB3F
 <a name=BB3B></a>BB3B   A4 6D      LDY $6D
 <a name=BB3D></a>BB3D   C4 65      CPY $65
 <a name=BB3F></a>BB3F   08         PHP
 <a name=BB40></a>BB40   2A         ROL
 <a name=BB41></a>BB41   90 09      BCC $BB4C
 <a name=BB43></a>BB43   E8         INX
 <a name=BB44></a>BB44   95 29      STA $29,X
 <a name=BB46></a>BB46   F0 32      BEQ $BB7A
 <a name=BB48></a>BB48   10 34      BPL $BB7E
 <a name=BB4A></a>BB4A   A9 01      LDA #$01
 <a name=BB4C></a>BB4C   28         PLP
 <a name=BB4D></a>BB4D   B0 0E      BCS $BB5D
 <A name=BB4F>
 <a name=BB4F></a>BB4F   06 6D      ASL $6D
 </A>
 <a name=BB51></a>BB51   26 6C      ROL $6C
 <a name=BB53></a>BB53   26 6B      ROL $6B
 <a name=BB55></a>BB55   26 6A      ROL $6A
 <a name=BB57></a>BB57   B0 E6      BCS $BB3F
 <a name=BB59></a>BB59   30 CE      BMI $BB29
 <a name=BB5B></a>BB5B   10 E2      BPL $BB3F
 <a name=BB5D></a>BB5D   A8         TAY
 <a name=BB5E></a>BB5E   A5 6D      LDA $6D
 <a name=BB60></a>BB60   E5 65      SBC $65
 <a name=BB62></a>BB62   85 6D      STA $6D
 <a name=BB64></a>BB64   A5 6C      LDA $6C
 <a name=BB66></a>BB66   E5 64      SBC $64
 <a name=BB68></a>BB68   85 6C      STA $6C
 <a name=BB6A></a>BB6A   A5 6B      LDA $6B
 <a name=BB6C></a>BB6C   E5 63      SBC $63
 <a name=BB6E></a>BB6E   85 6B      STA $6B
 <a name=BB70></a>BB70   A5 6A      LDA $6A
 <a name=BB72></a>BB72   E5 62      SBC $62
 <a name=BB74></a>BB74   85 6A      STA $6A
 <a name=BB76></a>BB76   98         TYA
 <a name=BB77></a>BB77   4C 4F BB   JMP $<A href="#BB4F">BB4F</A>
 
 <a name=BB7A></a>BB7A   A9 40      LDA #$40
 <a name=BB7C></a>BB7C   D0 CE      BNE $BB4C
 <a name=BB7E></a>BB7E   0A         ASL
 <a name=BB7F></a>BB7F   0A         ASL
 <a name=BB80></a>BB80   0A         ASL
 <a name=BB81></a>BB81   0A         ASL
 <a name=BB82></a>BB82   0A         ASL
 <a name=BB83></a>BB83   0A         ASL
 <a name=BB84></a>BB84   85 70      STA $70
 <a name=BB86></a>BB86   28         PLP
 <a name=BB87></a>BB87   4C 8F BB   JMP $<A href="#BB8F">BB8F</A>
 
 <a name=BB8A></a>BB8A   A2 14      LDX #$14   ; error number
 <a name=BB8C></a>BB8C   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <A name=BB8F>
 <a name=BB8F></a>BB8F   A5 26      LDA $26
 </A>
 <a name=BB91></a>BB91   85 62      STA $62
 <a name=BB93></a>BB93   A5 27      LDA $27
 <a name=BB95></a>BB95   85 63      STA $63
 <a name=BB97></a>BB97   A5 28      LDA $28
 <a name=BB99></a>BB99   85 64      STA $64
 <a name=BB9B></a>BB9B   A5 29      LDA $29
 <a name=BB9D></a>BB9D   85 65      STA $65
 <a name=BB9F></a>BB9F   4C D7 B8   JMP $<A href="#B8D7">B8D7</A>
 
 <A name=BBA2>
 <a name=BBA2></a>BBA2   85 22      STA $22
 </A>
 <a name=BBA4></a>BBA4   84 23      STY $23
 <a name=BBA6></a>BBA6   A0 04      LDY #$04
 <a name=BBA8></a>BBA8   B1 22      LDA ($22),Y
 <a name=BBAA></a>BBAA   85 65      STA $65
 <a name=BBAC></a>BBAC   88         DEY
 <a name=BBAD></a>BBAD   B1 22      LDA ($22),Y
 <a name=BBAF></a>BBAF   85 64      STA $64
 <a name=BBB1></a>BBB1   88         DEY
 <a name=BBB2></a>BBB2   B1 22      LDA ($22),Y
 <a name=BBB4></a>BBB4   85 63      STA $63
 <a name=BBB6></a>BBB6   88         DEY
 <a name=BBB7></a>BBB7   B1 22      LDA ($22),Y
 <a name=BBB9></a>BBB9   85 66      STA $66
 <a name=BBBB></a>BBBB   09 80      ORA #$80
 <a name=BBBD></a>BBBD   85 62      STA $62
 <a name=BBBF></a>BBBF   88         DEY
 <a name=BBC0></a>BBC0   B1 22      LDA ($22),Y
 <a name=BBC2></a>BBC2   85 61      STA $61
 <a name=BBC4></a>BBC4   84 70      STY $70
 <a name=BBC6></a>BBC6   60         RTS
 
 <A name=BBC7>
 ; store float accu at $5C-$60
 </A>
 <a name=BBC7></a>BBC7   A2 5C      LDX #$5C   ; low  005C
 <a name=BBC9></a>BBC9   .BY $2C
 
 <A name=BBCA>
 ; store float accu at $57-$5B
 </A>
 <a name=BBCA></a>BBCA   A2 57      LDX #$57   ; low  0057
 <a name=BBCC></a>BBCC   A0 00      LDY #$00   ; high 0057
 <a name=BBCE></a>BBCE   F0 04      BEQ $BBD4
 
 <A name=BBD0>
 ; store float accu in index at $49/$4A
 </A>
 <a name=BBD0></a>BBD0   A6 49      LDX $49
 <a name=BBD2></a>BBD2   A4 4A      LDY $4A
 
 <A name=BBD4>
 ; store float accu in index XY
 </A>
 <a name=BBD4></a>BBD4   20 1B BC   JSR $<A href="#BC1B">BC1B</A>
 <a name=BBD7></a>BBD7   86 22      STX $22
 <a name=BBD9></a>BBD9   84 23      STY $23
 <a name=BBDB></a>BBDB   A0 04      LDY #$04
 <a name=BBDD></a>BBDD   A5 65      LDA $65
 <a name=BBDF></a>BBDF   91 22      STA ($22),Y
 <a name=BBE1></a>BBE1   88         DEY
 <a name=BBE2></a>BBE2   A5 64      LDA $64
 <a name=BBE4></a>BBE4   91 22      STA ($22),Y
 <a name=BBE6></a>BBE6   88         DEY
 <a name=BBE7></a>BBE7   A5 63      LDA $63
 <a name=BBE9></a>BBE9   91 22      STA ($22),Y
 <a name=BBEB></a>BBEB   88         DEY
 <a name=BBEC></a>BBEC   A5 66      LDA $66
 <a name=BBEE></a>BBEE   09 7F      ORA #$7F
 <a name=BBF0></a>BBF0   25 62      AND $62
 <a name=BBF2></a>BBF2   91 22      STA ($22),Y
 <a name=BBF4></a>BBF4   88         DEY
 <a name=BBF5></a>BBF5   A5 61      LDA $61
 <a name=BBF7></a>BBF7   91 22      STA ($22),Y
 <a name=BBF9></a>BBF9   84 70      STY $70
 <a name=BBFB></a>BBFB   60         RTS
 
 <A name=BBFC>
 ; move second float accu into first
 </A>
 <a name=BBFC></a>BBFC   A5 6E      LDA $6E
 <A name=BBFE>
 <a name=BBFE></a>BBFE   85 66      STA $66
 </A>
 <a name=BC00></a>BC00   A2 05      LDX #$05
 <a name=BC02></a>BC02   B5 68      LDA $68,X
 <a name=BC04></a>BC04   95 60      STA $60,X
 <a name=BC06></a>BC06   CA         DEX
 <a name=BC07></a>BC07   D0 F9      BNE $BC02
 <a name=BC09></a>BC09   86 70      STX $70
 <a name=BC0B></a>BC0B   60         RTS
 
 <A name=BC0C>
 ; move rounded float accu into second
 </A>
 <a name=BC0C></a>BC0C   20 1B BC   JSR $<A href="#BC1B">BC1B</A>
 <A name=BC0F>
 <a name=BC0F></a>BC0F   A2 06      LDX #$06
 </A>
 <a name=BC11></a>BC11   B5 60      LDA $60,X
 <a name=BC13></a>BC13   95 68      STA $68,X
 <a name=BC15></a>BC15   CA         DEX
 <a name=BC16></a>BC16   D0 F9      BNE $BC11
 <a name=BC18></a>BC18   86 70      STX $70
 <a name=BC1A></a>BC1A   60         RTS
 
 <A name=BC1B>
 ; round float accu according to guard bit
 </A>
 <a name=BC1B></a>BC1B   A5 61      LDA $61
 <a name=BC1D></a>BC1D   F0 FB      BEQ $BC1A
 <a name=BC1F></a>BC1F   06 70      ASL $70
 <a name=BC21></a>BC21   90 F7      BCC $BC1A
 <A name=BC23>
 <a name=BC23></a>BC23   20 6F B9   JSR $<A href="#B96F">B96F</A>
 </A>
 <a name=BC26></a>BC26   D0 F2      BNE $BC1A
 <a name=BC28></a>BC28   4C 38 B9   JMP $<A href="#B938">B938</A>
 
 <A name=BC2B>
 ; get sign of float accu in A
 </A>
 <a name=BC2B></a>BC2B   A5 61      LDA $61
 <a name=BC2D></a>BC2D   F0 09      BEQ $BC38
 <a name=BC2F></a>BC2F   A5 66      LDA $66
 <A name=BC31>
 <a name=BC31></a>BC31   2A         ROL
 </A>
 <a name=BC32></a>BC32   A9 FF      LDA #$FF
 <a name=BC34></a>BC34   B0 02      BCS $BC38
 <a name=BC36></a>BC36   A9 01      LDA #$01
 <a name=BC38></a>BC38   60         RTS
 
 <A name=BC39>
 ; SGN function
 </A>
 <a name=BC39></a>BC39   20 2B BC   JSR $<A href="#BC2B">BC2B</A>
 
 <A name=BC3C>
 ; move signed number from A into float accu
 </A>
 <a name=BC3C></a>BC3C   85 62      STA $62
 <a name=BC3E></a>BC3E   A9 00      LDA #$00
 <a name=BC40></a>BC40   85 63      STA $63
 <a name=BC42></a>BC42   A2 88      LDX #$88
 <A name=BC44>
 <a name=BC44></a>BC44   A5 62      LDA $62
 </A>
 <a name=BC46></a>BC46   49 FF      EOR #$FF
 <a name=BC48></a>BC48   2A         ROL
 <A name=BC49>
 <a name=BC49></a>BC49   A9 00      LDA #$00
 </A>
 <a name=BC4B></a>BC4B   85 65      STA $65
 <a name=BC4D></a>BC4D   85 64      STA $64
 <A name=BC4F>
 <a name=BC4F></a>BC4F   86 61      STX $61
 </A>
 <a name=BC51></a>BC51   85 70      STA $70
 <a name=BC53></a>BC53   85 66      STA $66
 <a name=BC55></a>BC55   4C D2 B8   JMP $<A href="#B8D2">B8D2</A>
 
 <A name=BC58>
 ; ABS function
 </A>
 <a name=BC58></a>BC58   46 66      LSR $66
 <a name=BC5A></a>BC5A   60         RTS
 
 <A name=BC5B>
 ; compare float accu to float indexed by XY
 </A>
 <a name=BC5B></a>BC5B   85 24      STA $24
 <A name=BC5D>
 <a name=BC5D></a>BC5D   84 25      STY $25
 </A>
 <a name=BC5F></a>BC5F   A0 00      LDY #$00
 <a name=BC61></a>BC61   B1 24      LDA ($24),Y
 <a name=BC63></a>BC63   C8         INY
 <a name=BC64></a>BC64   AA         TAX
 <a name=BC65></a>BC65   F0 C4      BEQ $BC2B
 <a name=BC67></a>BC67   B1 24      LDA ($24),Y
 <a name=BC69></a>BC69   45 66      EOR $66
 <a name=BC6B></a>BC6B   30 C2      BMI $BC2F
 <a name=BC6D></a>BC6D   E4 61      CPX $61
 <a name=BC6F></a>BC6F   D0 21      BNE $BC92
 <a name=BC71></a>BC71   B1 24      LDA ($24),Y
 <a name=BC73></a>BC73   09 80      ORA #$80
 <a name=BC75></a>BC75   C5 62      CMP $62
 <a name=BC77></a>BC77   D0 19      BNE $BC92
 <a name=BC79></a>BC79   C8         INY
 <a name=BC7A></a>BC7A   B1 24      LDA ($24),Y
 <a name=BC7C></a>BC7C   C5 63      CMP $63
 <a name=BC7E></a>BC7E   D0 12      BNE $BC92
 <a name=BC80></a>BC80   C8         INY
 <a name=BC81></a>BC81   B1 24      LDA ($24),Y
 <a name=BC83></a>BC83   C5 64      CMP $64
 <a name=BC85></a>BC85   D0 0B      BNE $BC92
 <a name=BC87></a>BC87   C8         INY
 <a name=BC88></a>BC88   A9 7F      LDA #$7F
 <a name=BC8A></a>BC8A   C5 70      CMP $70
 <a name=BC8C></a>BC8C   B1 24      LDA ($24),Y
 <a name=BC8E></a>BC8E   E5 65      SBC $65
 <a name=BC90></a>BC90   F0 28      BEQ $BCBA
 <a name=BC92></a>BC92   A5 66      LDA $66
 <a name=BC94></a>BC94   90 02      BCC $BC98
 <a name=BC96></a>BC96   49 FF      EOR #$FF
 <a name=BC98></a>BC98   4C 31 BC   JMP $<A href="#BC31">BC31</A>
 
 <A name=BC9B>
 ; convert float to a 4 byte signed integer
 </A>
 <a name=BC9B></a>BC9B   A5 61      LDA $61
 <a name=BC9D></a>BC9D   F0 4A      BEQ $BCE9
 <a name=BC9F></a>BC9F   38         SEC
 <a name=BCA0></a>BCA0   E9 A0      SBC #$A0
 <a name=BCA2></a>BCA2   24 66      BIT $66
 <a name=BCA4></a>BCA4   10 09      BPL $BCAF
 <a name=BCA6></a>BCA6   AA         TAX
 <a name=BCA7></a>BCA7   A9 FF      LDA #$FF
 <a name=BCA9></a>BCA9   85 68      STA $68
 <a name=BCAB></a>BCAB   20 4D B9   JSR $<A href="#B94D">B94D</A>
 <a name=BCAE></a>BCAE   8A         TXA
 <a name=BCAF></a>BCAF   A2 61      LDX #$61
 <a name=BCB1></a>BCB1   C9 F9      CMP #$F9
 <a name=BCB3></a>BCB3   10 06      BPL $BCBB
 <a name=BCB5></a>BCB5   20 99 B9   JSR $<A href="#B999">B999</A>
 <a name=BCB8></a>BCB8   84 68      STY $68
 <a name=BCBA></a>BCBA   60         RTS
 
 <a name=BCBB></a>BCBB   A8         TAY
 <a name=BCBC></a>BCBC   A5 66      LDA $66
 <a name=BCBE></a>BCBE   29 80      AND #$80
 <a name=BCC0></a>BCC0   46 62      LSR $62
 <a name=BCC2></a>BCC2   05 62      ORA $62
 <a name=BCC4></a>BCC4   85 62      STA $62
 <a name=BCC6></a>BCC6   20 B0 B9   JSR $<A href="#B9B0">B9B0</A>
 <a name=BCC9></a>BCC9   84 68      STY $68
 <a name=BCCB></a>BCCB   60         RTS
 
 <A name=BCCC>
 ; INT function
 </A>
 <a name=BCCC></a>BCCC   A5 61      LDA $61
 <a name=BCCE></a>BCCE   C9 A0      CMP #$A0
 <a name=BCD0></a>BCD0   B0 20      BCS $BCF2
 <a name=BCD2></a>BCD2   20 9B BC   JSR $<A href="#BC9B">BC9B</A>
 <a name=BCD5></a>BCD5   84 70      STY $70
 <a name=BCD7></a>BCD7   A5 66      LDA $66
 <a name=BCD9></a>BCD9   84 66      STY $66
 <a name=BCDB></a>BCDB   49 80      EOR #$80
 <a name=BCDD></a>BCDD   2A         ROL
 <a name=BCDE></a>BCDE   A9 A0      LDA #$A0
 <a name=BCE0></a>BCE0   85 61      STA $61
 <a name=BCE2></a>BCE2   A5 65      LDA $65
 <a name=BCE4></a>BCE4   85 07      STA $07
 <a name=BCE6></a>BCE6   4C D2 B8   JMP $<A href="#B8D2">B8D2</A>
 
 <A name=BCE9>
 ; clear float accu
 </A>
 <a name=BCE9></a>BCE9   85 62      STA $62
 <a name=BCEB></a>BCEB   85 63      STA $63
 <a name=BCED></a>BCED   85 64      STA $64
 <a name=BCEF></a>BCEF   85 65      STA $65
 <a name=BCF1></a>BCF1   A8         TAY
 <a name=BCF2></a>BCF2   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=BCF3> </A>
 ; <b>convert ASCII text to float</b>
 ; 
 ; IN: .C = ??? (Looks like if you call w/ .C=0, leading +/- NOT allowed ???)
 ;
 ; Referenced by: <A href="#AC89">AC89</A> <A href="#AE8F">AE8F</A> <A href="#B7DA">B7DA</A>

 <a name=xxxx></a>BCF3   A0 00      LDY #$00        ;
 <a name=BCF5></a>BCF5   A2 0A      LDX #$0A        ; Loop counter, $0..$A = 11 iterations
 <a name=BCF7></a>BCF7   94 5D      STY $<A href="ram.htm#005D">5D</A>,X
 <a name=BCF9></a>BCF9   CA         DEX             ;
 <a name=BCFA></a>BCFA   10 FB      BPL $BCF7       ; Clears address range $5D thru $67.  Why?? FAC is just $61 to $65
 <a name=BCFC></a>BCFC   90 0F      BCC $BD0D   +   ; ??? .C has not been set here... Must be an input?  
 <a name=BCFE></a>BCFE   C9 2D      CMP #$2D        ; Starts w/ leading "-"?
*<a name=BD00></a>BD00   D0 04      BNE $BD06   +   ;    nope
 <a name=BD02></a>BD02   86 67      STX $<A href="ram.htm#0067">67</A>         ; Yes; Set sign to negative (.X=$FF from DEX)
 <a name=BD04></a>BD04   F0 04      BEQ $BD0A   +   ; (always) Consume it
 <a name=BD06></a>BD06   C9 2B      CMP #$2B        ; Starts w/ leading "+"?
 <a name=BD08></a>BD08   D0 05      BNE $BD0F   +   ;    nope; don't consume

*<a name=BD0A></a>BD0A   20 73 00   JSR $<A href="#0073">0073</A>       ; Next digit...


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

*<a name=BD0D></a>BD0D   90 5B      BCC $BD6A
 <a name=BD0F></a>BD0F   C9 2E      CMP #$2E   ; decimal point
 <a name=BD11></a>BD11   F0 2E      BEQ $BD41
 <a name=BD13></a>BD13   C9 45      CMP #$45   ; E
 <a name=BD15></a>BD15   D0 30      BNE $BD47
 <a name=BD17></a>BD17   20 73 00   JSR $0073
 <a name=BD1A></a>BD1A   90 17      BCC $BD33
 <a name=BD1C></a>BD1C   C9 AB      CMP #$AB   ; minus code
 <a name=BD1E></a>BD1E   F0 0E      BEQ $BD2E
 <a name=BD20></a>BD20   C9 2D      CMP #$2D   ; minus
 <a name=BD22></a>BD22   F0 0A      BEQ $BD2E
 <a name=BD24></a>BD24   C9 AA      CMP #$AA   ; plus code
 <a name=BD26></a>BD26   F0 08      BEQ $BD30
 <a name=BD28></a>BD28   C9 2B      CMP #$2B   ; plus
 <a name=BD2A></a>BD2A   F0 04      BEQ $BD30
 <a name=BD2C></a>BD2C   D0 07      BNE $BD35
 <a name=BD2E></a>BD2E   66 60      ROR $60
 <A name=BD30>
 <a name=BD30></a>BD30   20 73 00   JSR $0073
 </A>
 <a name=BD33></a>BD33   90 5C      BCC $BD91
 <a name=BD35></a>BD35   24 60      BIT $60
 <a name=BD37></a>BD37   10 0E      BPL $BD47
 <a name=BD39></a>BD39   A9 00      LDA #$00
 <a name=BD3B></a>BD3B   38         SEC
 <a name=BD3C></a>BD3C   E5 5E      SBC $5E
 <a name=BD3E></a>BD3E   4C 49 BD   JMP $<A href="#BD49">BD49</A>
 
 <a name=BD41></a>BD41   66 5F      ROR $5F
 <a name=BD43></a>BD43   24 5F      BIT $5F
 <a name=BD45></a>BD45   50 C3      BVC $BD0A
 <a name=BD47></a>BD47   A5 5E      LDA $5E
 <A name=BD49>
 <a name=BD49></a>BD49   38         SEC
 </A>
 <a name=BD4A></a>BD4A   E5 5D      SBC $5D
 <a name=BD4C></a>BD4C   85 5E      STA $5E
 <a name=BD4E></a>BD4E   F0 12      BEQ $BD62
 <a name=BD50></a>BD50   10 09      BPL $BD5B
 <a name=BD52></a>BD52   20 FE BA   JSR $<A href="#BAFE">BAFE</A>
 <a name=BD55></a>BD55   E6 5E      INC $5E
 <a name=BD57></a>BD57   D0 F9      BNE $BD52
 <a name=BD59></a>BD59   F0 07      BEQ $BD62
 <a name=BD5B></a>BD5B   20 E2 BA   JSR $<A href="#BAE2">BAE2</A>
 <a name=BD5E></a>BD5E   C6 5E      DEC $5E
 <a name=BD60></a>BD60   D0 F9      BNE $BD5B
 <a name=BD62></a>BD62   A5 67      LDA $67
 <a name=BD64></a>BD64   30 01      BMI $BD67
 <a name=BD66></a>BD66   60         RTS
 
 <a name=BD67></a>BD67   4C B4 BF   JMP $<A href="#BFB4">BFB4</A>
 
 <a name=BD6A></a>BD6A   48         PHA
 <a name=BD6B></a>BD6B   24 5F      BIT $5F
 <a name=BD6D></a>BD6D   10 02      BPL $BD71
 <a name=BD6F></a>BD6F   E6 5D      INC $5D
 <a name=BD71></a>BD71   20 E2 BA   JSR $<A href="#BAE2">BAE2</A>
 <a name=BD74></a>BD74   68         PLA
 <a name=BD75></a>BD75   38         SEC
 <a name=BD76></a>BD76   E9 30      SBC #$30        ; "0"
 <a name=BD78></a>BD78   20 7E BD   JSR $<A href="#BD7E">BD7E</A>
 <a name=BD7B></a>BD7B   4C 0A BD   JMP $<A href="#BD0A">BD0A</A>       ; Next digit?
 
 <A name=BD7E>
 ; add signed integer from A to float accu
 </A>
 <a name=BD7E></a>BD7E   48         PHA
 <a name=BD7F></a>BD7F   20 0C BC   JSR $<A href="#BC0C">BC0C</A>
 <a name=BD82></a>BD82   68         PLA
 <a name=BD83></a>BD83   20 3C BC   JSR $<A href="#BC3C">BC3C</A>
 <a name=BD86></a>BD86   A5 6E      LDA $6E
 <a name=BD88></a>BD88   45 66      EOR $66
 <a name=BD8A></a>BD8A   85 6F      STA $6F
 <a name=BD8C></a>BD8C   A6 61      LDX $61
 <a name=BD8E></a>BD8E   4C 6A B8   JMP $<A href="#B86A">B86A</A>
 
 <A name=BD91>
 ; get exponent of number from string
 </A>
 <a name=BD91></a>BD91   A5 5E      LDA $5E
 <a name=BD93></a>BD93   C9 0A      CMP #$0A
 <a name=BD95></a>BD95   90 09      BCC $BDA0
 <a name=BD97></a>BD97   A9 64      LDA #$64
 <a name=BD99></a>BD99   24 60      BIT $60
 <a name=BD9B></a>BD9B   30 11      BMI $BDAE
 <a name=BD9D></a>BD9D   4C 7E B9   JMP $<A href="#B97E">B97E</A>
 
 <a name=BDA0></a>BDA0   0A         ASL
 <a name=BDA1></a>BDA1   0A         ASL
 <a name=BDA2></a>BDA2   18         CLC
 <a name=BDA3></a>BDA3   65 5E      ADC $5E
 <a name=BDA5></a>BDA5   0A         ASL
 <a name=BDA6></a>BDA6   18         CLC
 <a name=BDA7></a>BDA7   A0 00      LDY #$00
 <a name=BDA9></a>BDA9   71 7A      ADC ($7A),Y
 <a name=BDAB></a>BDAB   38         SEC
 <a name=BDAC></a>BDAC   E9 30      SBC #$30   ; 0
 <a name=BDAE></a>BDAE   85 5E      STA $5E
 <a name=BDB0></a>BDB0   4C 30 BD   JMP $<A href="#BD30">BD30</A>
 
 <A name=BDB3>
 ; constants for float to string conversion
 </A>
 <a name=BDB3></a>BDB3   .BY $9B,$3E,$BC,$1F,$FD
 <A name=BDB8>
 <a name=BDB8></a>BDB8   .BY $9E,$6E,$6B,$27,$FD
 </A>
 <A name=BDBD>
 <a name=BDBD></a>BDBD   .BY $9E,$6E,$6B,$28,$00
 </A>
 
 <A name=BDC2>
 ; print IN followed by line number
 </A>
 <a name=BDC2></a>BDC2   A9 71      LDA #$71   ; low  <A href="#A371">A371</A>
 <a name=BDC4></a>BDC4   A0 A3      LDY #$A3   ; high <A href="#A371">A371</A>
 <a name=BDC6></a>BDC6   20 DA BD   JSR $<A href="#BDDA">BDDA</A>
 <a name=BDC9></a>BDC9   A5 3A      LDA $3A
 <a name=BDCB></a>BDCB   A6 39      LDX $39
 
 <A name=BDCD>
 ; print number from AX
 </A>
 <a name=BDCD></a>BDCD   85 62      STA $62
 <a name=BDCF></a>BDCF   86 63      STX $63
 <a name=BDD1></a>BDD1   A2 90      LDX #$90
 <a name=BDD3></a>BDD3   38         SEC
 <a name=BDD4></a>BDD4   20 49 BC   JSR $<A href="#BC49">BC49</A>
 <a name=BDD7></a>BDD7   20 DF BD   JSR $<A href="#BDDF">BDDF</A>
 <A name=BDDA>
 <a name=BDDA></a>BDDA   4C 1E AB   JMP $<A href="#AB1E">AB1E</A>
 </A>
 
 <A name=BDDD>
 ; convert number in float accu to string
 </A>
 <a name=BDDD></a>BDDD   A0 01      LDY #$01
 <A name=BDDF>
 <a name=BDDF></a>BDDF   A9 20      LDA #$20
 </A>
 <a name=BDE1></a>BDE1   24 66      BIT $66
 <a name=BDE3></a>BDE3   10 02      BPL $BDE7
 <a name=BDE5></a>BDE5   A9 2D      LDA #$2D   ; minus
 <a name=BDE7></a>BDE7   99 FF 00   STA $00FF,Y
 <a name=BDEA></a>BDEA   85 66      STA $66
 <a name=BDEC></a>BDEC   84 71      STY $71
 <a name=BDEE></a>BDEE   C8         INY
 <a name=BDEF></a>BDEF   A9 30      LDA #$30   ; 0
 <a name=BDF1></a>BDF1   A6 61      LDX $61
 <a name=BDF3></a>BDF3   D0 03      BNE $BDF8
 <a name=BDF5></a>BDF5   4C 04 BF   JMP $<A href="#BF04">BF04</A>
 
 <a name=BDF8></a>BDF8   A9 00      LDA #$00
 <a name=BDFA></a>BDFA   E0 80      CPX #$80
 <a name=BDFC></a>BDFC   F0 02      BEQ $BE00
 <a name=BDFE></a>BDFE   B0 09      BCS $BE09
 <a name=BE00></a>BE00   A9 BD      LDA #$BD   ; low  <A href="#BDBD">BDBD</A>
 <a name=BE02></a>BE02   A0 BD      LDY #$BD   ; high <A href="#BDBD">BDBD</A>
 <a name=BE04></a>BE04   20 28 BA   JSR $<A href="#BA28">BA28</A>
 <a name=BE07></a>BE07   A9 F7      LDA #$F7
 <a name=BE09></a>BE09   85 5D      STA $5D
 <a name=BE0B></a>BE0B   A9 B8      LDA #$B8   ; low  <A href="#BDB8">BDB8</A>
 <a name=BE0D></a>BE0D   A0 BD      LDY #$BD   ; high <A href="#BDB8">BDB8</A>
 <a name=BE0F></a>BE0F   20 5B BC   JSR $<A href="#BC5B">BC5B</A>
 <a name=BE12></a>BE12   F0 1E      BEQ $BE32
 <a name=BE14></a>BE14   10 12      BPL $BE28
 <a name=BE16></a>BE16   A9 B3      LDA #$B3   ; low  <A href="#BDB3">BDB3</A>
 <a name=BE18></a>BE18   A0 BD      LDY #$BD   ; high <A href="#BDB3">BDB3</A>
 <a name=BE1A></a>BE1A   20 5B BC   JSR $<A href="#BC5B">BC5B</A>
 <a name=BE1D></a>BE1D   F0 02      BEQ $BE21
 <a name=BE1F></a>BE1F   10 0E      BPL $BE2F
 <a name=BE21></a>BE21   20 E2 BA   JSR $<A href="#BAE2">BAE2</A>
 <a name=BE24></a>BE24   C6 5D      DEC $5D
 <a name=BE26></a>BE26   D0 EE      BNE $BE16
 <a name=BE28></a>BE28   20 FE BA   JSR $<A href="#BAFE">BAFE</A>
 <a name=BE2B></a>BE2B   E6 5D      INC $5D
 <a name=BE2D></a>BE2D   D0 DC      BNE $BE0B
 <a name=BE2F></a>BE2F   20 49 B8   JSR $<A href="#B849">B849</A>
 <a name=BE32></a>BE32   20 9B BC   JSR $<A href="#BC9B">BC9B</A>
 <a name=BE35></a>BE35   A2 01      LDX #$01
 <a name=BE37></a>BE37   A5 5D      LDA $5D
 <a name=BE39></a>BE39   18         CLC
 <a name=BE3A></a>BE3A   69 0A      ADC #$0A
 <a name=BE3C></a>BE3C   30 09      BMI $BE47
 <a name=BE3E></a>BE3E   C9 0B      CMP #$0B
 <a name=BE40></a>BE40   B0 06      BCS $BE48
 <a name=BE42></a>BE42   69 FF      ADC #$FF
 <a name=BE44></a>BE44   AA         TAX
 <a name=BE45></a>BE45   A9 02      LDA #$02
 <a name=BE47></a>BE47   38         SEC
 <a name=BE48></a>BE48   E9 02      SBC #$02
 <a name=BE4A></a>BE4A   85 5E      STA $5E
 <a name=BE4C></a>BE4C   86 5D      STX $5D
 <a name=BE4E></a>BE4E   8A         TXA
 <a name=BE4F></a>BE4F   F0 02      BEQ $BE53
 <a name=BE51></a>BE51   10 13      BPL $BE66
 <a name=BE53></a>BE53   A4 71      LDY $71
 <a name=BE55></a>BE55   A9 2E      LDA #$2E   ; decimal point
 <a name=BE57></a>BE57   C8         INY
 <a name=BE58></a>BE58   99 FF 00   STA $00FF,Y
 <a name=BE5B></a>BE5B   8A         TXA
 <a name=BE5C></a>BE5C   F0 06      BEQ $BE64
 <a name=BE5E></a>BE5E   A9 30      LDA #$30   ; 0
 <a name=BE60></a>BE60   C8         INY
 <a name=BE61></a>BE61   99 FF 00   STA $00FF,Y
 <a name=BE64></a>BE64   84 71      STY $71
 <a name=BE66></a>BE66   A0 00      LDY #$00
 <A name=BE68>
 <a name=BE68></a>BE68   A2 80      LDX #$80
 </A>
 <a name=BE6A></a>BE6A   A5 65      LDA $65
 <a name=BE6C></a>BE6C   18         CLC
 <a name=BE6D></a>BE6D   79 19 BF   ADC $<A href="#BF16">BF19</A>,Y
 <a name=BE70></a>BE70   85 65      STA $65
 <a name=BE72></a>BE72   A5 64      LDA $64
 <a name=BE74></a>BE74   79 18 BF   ADC $<A href="#BF16">BF18</A>,Y
 <a name=BE77></a>BE77   85 64      STA $64
 <a name=BE79></a>BE79   A5 63      LDA $63
 <a name=BE7B></a>BE7B   79 17 BF   ADC $<A href="#BF16">BF17</A>,Y
 <a name=BE7E></a>BE7E   85 63      STA $63
 <a name=BE80></a>BE80   A5 62      LDA $62
 <a name=BE82></a>BE82   79 16 BF   ADC $<A href="#BF16">BF16</A>,Y
 <a name=BE85></a>BE85   85 62      STA $62
 <a name=BE87></a>BE87   E8         INX
 <a name=BE88></a>BE88   B0 04      BCS $BE8E
 <a name=BE8A></a>BE8A   10 DE      BPL $BE6A
 <a name=BE8C></a>BE8C   30 02      BMI $BE90
 <a name=BE8E></a>BE8E   30 DA      BMI $BE6A
 <a name=BE90></a>BE90   8A         TXA
 <a name=BE91></a>BE91   90 04      BCC $BE97
 <a name=BE93></a>BE93   49 FF      EOR #$FF
 <a name=BE95></a>BE95   69 0A      ADC #$0A
 <a name=BE97></a>BE97   69 2F      ADC #$2F
 <a name=BE99></a>BE99   C8         INY
 <a name=BE9A></a>BE9A   C8         INY
 <a name=BE9B></a>BE9B   C8         INY
 <a name=BE9C></a>BE9C   C8         INY
 <a name=BE9D></a>BE9D   84 47      STY $47
 <a name=BE9F></a>BE9F   A4 71      LDY $71
 <a name=BEA1></a>BEA1   C8         INY
 <a name=BEA2></a>BEA2   AA         TAX
 <a name=BEA3></a>BEA3   29 7F      AND #$7F
 <a name=BEA5></a>BEA5   99 FF 00   STA $00FF,Y
 <a name=BEA8></a>BEA8   C6 5D      DEC $5D
 <a name=BEAA></a>BEAA   D0 06      BNE $BEB2
 <a name=BEAC></a>BEAC   A9 2E      LDA #$2E
 <a name=BEAE></a>BEAE   C8         INY
 <a name=BEAF></a>BEAF   99 FF 00   STA $00FF,Y
 <a name=BEB2></a>BEB2   84 71      STY $71
 <a name=BEB4></a>BEB4   A4 47      LDY $47
 <a name=BEB6></a>BEB6   8A         TXA
 <a name=BEB7></a>BEB7   49 FF      EOR #$FF
 <a name=BEB9></a>BEB9   29 80      AND #$80
 <a name=BEBB></a>BEBB   AA         TAX
 <a name=BEBC></a>BEBC   C0 24      CPY #$24
 <a name=BEBE></a>BEBE   F0 04      BEQ $BEC4
 <a name=BEC0></a>BEC0   C0 3C      CPY #$3C
 <a name=BEC2></a>BEC2   D0 A6      BNE $BE6A
 <a name=BEC4></a>BEC4   A4 71      LDY $71
 <a name=BEC6></a>BEC6   B9 FF 00   LDA $00FF,Y
 <a name=BEC9></a>BEC9   88         DEY
 <a name=BECA></a>BECA   C9 30      CMP #$30   ; 0
 <a name=BECC></a>BECC   F0 F8      BEQ $BEC6
 <a name=BECE></a>BECE   C9 2E      CMP #$2E   ; decimal point
 <a name=BED0></a>BED0   F0 01      BEQ $BED3
 <a name=BED2></a>BED2   C8         INY
 <a name=BED3></a>BED3   A9 2B      LDA #$2B   ; plus
 <a name=BED5></a>BED5   A6 5E      LDX $5E
 <a name=BED7></a>BED7   F0 2E      BEQ $BF07
 <a name=BED9></a>BED9   10 08      BPL $BEE3
 <a name=BEDB></a>BEDB   A9 00      LDA #$00
 <a name=BEDD></a>BEDD   38         SEC
 <a name=BEDE></a>BEDE   E5 5E      SBC $5E
 <a name=BEE0></a>BEE0   AA         TAX
 <a name=BEE1></a>BEE1   A9 2D      LDA #$2D   ; minus
 <a name=BEE3></a>BEE3   99 01 01   STA $0101,Y
 <a name=BEE6></a>BEE6   A9 45      LDA #$45
 <a name=BEE8></a>BEE8   99 00 01   STA $0100,Y
 <a name=BEEB></a>BEEB   8A         TXA
 <a name=BEEC></a>BEEC   A2 2F      LDX #$2F
 <a name=BEEE></a>BEEE   38         SEC
 <a name=BEEF></a>BEEF   E8         INX
 <a name=BEF0></a>BEF0   E9 0A      SBC #$0A
 <a name=BEF2></a>BEF2   B0 FB      BCS $BEEF
 <a name=BEF4></a>BEF4   69 3A      ADC #$3A
 <a name=BEF6></a>BEF6   99 03 01   STA $0103,Y
 <a name=BEF9></a>BEF9   8A         TXA
 <a name=BEFA></a>BEFA   99 02 01   STA $0102,Y
 <a name=BEFD></a>BEFD   A9 00      LDA #$00
 <a name=BEFF></a>BEFF   99 04 01   STA $0104,Y
 <a name=BF02></a>BF02   F0 08      BEQ $BF0C
 <A name=BF04>
 <a name=BF04></a>BF04   99 FF 00   STA $00FF,Y
 </A>
 <a name=BF07></a>BF07   A9 00      LDA #$00
 <a name=BF09></a>BF09   99 00 01   STA $0100,Y
 <a name=BF0C></a>BF0C   A9 00      LDA #$00   ; low  0100
 <a name=BF0E></a>BF0E   A0 01      LDY #$01   ; high 0100
 <a name=BF10></a>BF10   60         RTS
 
 <A name=BF11>
 ; 0.5
 </A>
 <a name=BF11></a>BF11   .BY $80,$00,$00,$00,$00
 
 <A name=BF16>
 ; divisors for decimal conversion
 </A>
 <a name=BF16></a>BF16   .BY $FA,$0A,$1F,$00
 <a name=BF1A></a>BF1A   .BY $00,$98,$96,$80
 <a name=BF1E></a>BF1E   .BY $FF,$F0,$BD,$C0
 <a name=BF22></a>BF22   .BY $00,$01,$86,$A0
 <a name=BF26></a>BF26   .BY $FF,$FF,$D8,$F0
 <a name=BF2A></a>BF2A   .BY $00,$00,$03,$E8
 <a name=BF2E></a>BF2E   .BY $FF,$FF,$FF,$9C
 <a name=BF32></a>BF32   .BY $00,$00,$00,$0A
 <a name=BF36></a>BF36   .BY $FF,$FF,$FF,$FF
 
 <A name=BF3A>
 ; divisors for time conversion
 </A>
 <a name=BF3A></a>BF3A   .BY $FF,$DF,$0A,$80
 <a name=BF3E></a>BF3E   .BY $00,$03,$4B,$C0
 <a name=BF42></a>BF42   .BY $FF,$FF,$73,$60
 <a name=BF46></a>BF46   .BY $00,$00,$0E,$10
 <a name=BF4A></a>BF4A   .BY $FF,$FF,$FD,$A8
 <a name=BF4E></a>BF4E   .BY $00,$00,$00,$3C
 
 <A name=BF52>
 ; unused
 ; is this some version id?
 </A>
 <a name=BF52></a>BF52   .BY $EC
 
 <A name=BF53>
 ; unused
 </A>
 <a name=BF53></a>BF53   .BY $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
 <a name=BF5B></a>BF5B   .BY $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
 <a name=BF63></a>BF63   .BY $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
 <a name=BF6B></a>BF6B   .BY $AA,$AA,$AA,$AA,$AA,$AA
 
 <A name=BF71>
 ; SQR function
 </A>
 <a name=BF71></a>BF71   20 0C BC   JSR $<A href="#BC0C">BC0C</A>
 <a name=BF74></a>BF74   A9 11      LDA #$11
 <a name=BF76></a>BF76   A0 BF      LDY #$BF
 <a name=BF78></a>BF78   20 A2 BB   JSR $<A href="#BBA2">BBA2</A>
 
 <A name=BF7B>
 ; power operator
 </A>
 <a name=BF7B></a>BF7B   F0 70      BEQ $BFED
 <a name=BF7D></a>BF7D   A5 69      LDA $69
 <a name=BF7F></a>BF7F   D0 03      BNE $BF84
 <a name=BF81></a>BF81   4C F9 B8   JMP $<A href="#B8F9">B8F9</A>
 
 <a name=BF84></a>BF84   A2 4E      LDX #$4E   ; low  004E
 <a name=BF86></a>BF86   A0 00      LDY #$00   ; high 004E
 <a name=BF88></a>BF88   20 D4 BB   JSR $<A href="#BBD4">BBD4</A>
 <a name=BF8B></a>BF8B   A5 6E      LDA $6E
 <a name=BF8D></a>BF8D   10 0F      BPL $BF9E
 <a name=BF8F></a>BF8F   20 CC BC   JSR $<A href="#BCCC">BCCC</A>
 <a name=BF92></a>BF92   A9 4E      LDA #$4E   ; low  004E
 <a name=BF94></a>BF94   A0 00      LDY #$00   ; high 004E
 <a name=BF96></a>BF96   20 5B BC   JSR $<A href="#BC5B">BC5B</A>
 <a name=BF99></a>BF99   D0 03      BNE $BF9E
 <a name=BF9B></a>BF9B   98         TYA
 <a name=BF9C></a>BF9C   A4 07      LDY $07
 <a name=BF9E></a>BF9E   20 FE BB   JSR $<A href="#BBFE">BBFE</A>
 <a name=BFA1></a>BFA1   98         TYA
 <a name=BFA2></a>BFA2   48         PHA
 <a name=BFA3></a>BFA3   20 EA B9   JSR $<A href="#B9EA">B9EA</A>
 <a name=BFA6></a>BFA6   A9 4E      LDA #$4E   ; low  004E
 <a name=BFA8></a>BFA8   A0 00      LDY #$00   ; high 004E
 <a name=BFAA></a>BFAA   20 28 BA   JSR $<A href="#BA28">BA28</A>
 <a name=BFAD></a>BFAD   20 ED BF   JSR $<A href="#BFED">BFED</A>
 <a name=BFB0></a>BFB0   68         PLA
 <a name=BFB1></a>BFB1   4A         LSR
 <a name=BFB2></a>BFB2   90 0A      BCC $BFBE
 
 <A name=BFB4>
 ; minus operator
 <a name=BFB4></a>BFB4   A5 61      LDA $61
 <a name=BFB6></a>BFB6   F0 06      BEQ $BFBE
 <a name=BFB8></a>BFB8   A5 66      LDA $66
 <a name=BFBA></a>BFBA   49 FF      EOR #$FF
 <a name=BFBC></a>BFBC   85 66      STA $66
 <a name=BFBE></a>BFBE   60         RTS
 
 ; floating point constands for EXP
 <A name=BFBF>
 ; 1/LOG(2)
 </A>
 <a name=BFBF></a>BFBF   .BY $81,$38,$AA,$3B,$29
 
 <A name=BFC4>
 ; EXP polynomial table
 </A>
 <a name=BFC4></a>BFC4   .BY $07   ; degree 8
 <a name=BFC5></a>BFC5   .BY $71,$34,$58,$3E,$56
 <a name=BFCA></a>BFCA   .BY $74,$16,$7E,$B3,$1B
 <a name=BFCF></a>BFCF   .BY $77,$2F,$EE,$E3,$85
 <a name=BFD4></a>BFD4   .BY $7A,$1D,$84,$1C,$2A
 <a name=BFD9></a>BFD9   .BY $7C,$63,$59,$58,$0A
 <a name=BFDE></a>BFDE   .BY $7E,$75,$FD,$E7,$C6
 <a name=BFE3></a>BFE3   .BY $80,$31,$72,$18,$10
 <a name=BFE8></a>BFE8   .BY $81,$00,$00,$00,$00
 
 <A name=BFED>
 ; EXP command
 </A>
 <a name=BFED></a>BFED   A9 BF      LDA #$BF
 <a name=BFEF></a>BFEF   A0 BF      LDY #$BF
 <a name=BFF1></a>BFF1   20 28 BA   JSR $<A href="#BA28">BA28</A>
 <a name=BFF4></a>BFF4   A5 70      LDA $70
 <a name=BFF6></a>BFF6   69 50      ADC #$50
 <a name=BFF8></a>BFF8   90 03      BCC $BFFD
 <a name=BFFA></a>BFFA   20 23 BC   JSR $<A href="#BC23">BC23</A>
 <a name=BFFD></a>BFFD   4C 00 E0   JMP $<A href="#E000">E000</A>
 </PRE>
<HR>

<HR>
<A name=kernal>
<H2>Commodore 64 KERNAL ($03) ROM dissasembly</H2></A>
<H4>Version 1.0 (June 1994)</H4>
<HR>
<PRE> <A name=E000>
 ; continuation of EXP function
 </A>
 <a name=E000></a>E000   85 56      STA $56
 <a name=E002></a>E002   20 0F BC   JSR $<A href="#BC0F">BC0F</A>
 <a name=E005></a>E005   A5 61      LDA $61
 <a name=E007></a>E007   C9 88      CMP #$88
 <a name=E009></a>E009   90 03      BCC $E00E
 <a name=E00B></a>E00B   20 D4 BA   JSR $<A href="#BAD4">BAD4</A>
 <a name=E00E></a>E00E   20 CC BC   JSR $<A href="#BCCC">BCCC</A>
 <a name=E011></a>E011   A5 07      LDA $07
 <a name=E013></a>E013   18         CLC
 <a name=E014></a>E014   69 81      ADC #$81
 <a name=E016></a>E016   F0 F3      BEQ $E00B
 <a name=E018></a>E018   38         SEC
 <a name=E019></a>E019   E9 01      SBC #$01
 <a name=E01B></a>E01B   48         PHA
 <a name=E01C></a>E01C   A2 05      LDX #$05
 <a name=E01E></a>E01E   B5 69      LDA $69,X
 <a name=E020></a>E020   B4 61      LDY $61,X
 <a name=E022></a>E022   95 61      STA $61,X
 <a name=E024></a>E024   94 69      STY $69,X
 <a name=E026></a>E026   CA         DEX
 <a name=E027></a>E027   10 F5      BPL $E01E
 <a name=E029></a>E029   A5 56      LDA $56
 <a name=E02B></a>E02B   85 70      STA $70
 <a name=E02D></a>E02D   20 53 B8   JSR $<A href="#B853">B853</A>
 <a name=E030></a>E030   20 B4 BF   JSR $<A href="#BFB4">BFB4</A>
 <a name=E033></a>E033   A9 C4      LDA #$C4
 <a name=E035></a>E035   A0 BF      LDY #$BF
 <a name=E037></a>E037   20 59 E0   JSR $<A href="#E059">E059</A>
 <a name=E03A></a>E03A   A9 00      LDA #$00
 <a name=E03C></a>E03C   85 6F      STA $6F
 <a name=E03E></a>E03E   68         PLA
 <a name=E03F></a>E03F   20 B9 BA   JSR $<A href="#BAB9">BAB9</A>
 <a name=E042></a>E042   60         RTS
 
 <A name=E043>
 ; compute odd degrees for SIN and ATN
 </A>
 <a name=E043></a>E043   85 71      STA $71
 <a name=E045></a>E045   84 72      STY $72
 <a name=E047></a>E047   20 CA BB   JSR $<A href="#BBCA">BBCA</A>
 <a name=E04A></a>E04A   A9 57      LDA #$57
 <a name=E04C></a>E04C   20 28 BA   JSR $<A href="#BA28">BA28</A>
 <a name=E04F></a>E04F   20 5D E0   JSR $<A href="#E05D">E05D</A>
 <a name=E052></a>E052   A9 57      LDA #$57
 <a name=E054></a>E054   A0 00      LDY #$00
 <a name=E056></a>E056   4C 28 BA   JMP $<A href="#BA28">BA28</A>
 
 <A name=E059>
 ; compute polynomials according to table indexed by AY
 </A>
 <a name=E059></a>E059   85 71      STA $71
 <a name=E05B></a>E05B   84 72      STY $72
 <A name=E05D>
 <a name=E05D></a>E05D   20 C7 BB   JSR $<A href="#BBC7">BBC7</A>
 </A>
 <a name=E060></a>E060   B1 71      LDA ($71),Y
 <a name=E062></a>E062   85 67      STA $67
 <a name=E064></a>E064   A4 71      LDY $71
 <a name=E066></a>E066   C8         INY
 <a name=E067></a>E067   98         TYA
 <a name=E068></a>E068   D0 02      BNE $E06C
 <a name=E06A></a>E06A   E6 72      INC $72
 <a name=E06C></a>E06C   85 71      STA $71
 <a name=E06E></a>E06E   A4 72      LDY $72
 <a name=E070></a>E070   20 28 BA   JSR $<A href="#BA28">BA28</A>
 <a name=E073></a>E073   A5 71      LDA $71
 <a name=E075></a>E075   A4 72      LDY $72
 <a name=E077></a>E077   18         CLC
 <a name=E078></a>E078   69 05      ADC #$05
 <a name=E07A></a>E07A   90 01      BCC $E07D
 <a name=E07C></a>E07C   C8         INY
 <a name=E07D></a>E07D   85 71      STA $71
 <a name=E07F></a>E07F   84 72      STY $72
 <a name=E081></a>E081   20 67 B8   JSR $<A href="#B867">B867</A>
 <a name=E084></a>E084   A9 5C      LDA #$5C
 <a name=E086></a>E086   A0 00      LDY #$00
 <a name=E088></a>E088   C6 67      DEC $67
 <a name=E08A></a>E08A   D0 E4      BNE $E070
 <a name=E08C></a>E08C   60         RTS
 
 <A name=E08D>
 ; float numbers for RND
 </A>
 <a name=E08D></a>E08D   .BY $98,$35,$44,$7A,$00
 <a name=E092></a>E092   .BY $68,$28,$B1,$46,$00
 
 <A name=E097>
 ; RND function
 </A>
 <a name=E097></a>E097   20 2B BC   JSR $<A href="#BC2B">BC2B</A>
 <a name=E09A></a>E09A   30 37      BMI $E0D3
 <a name=E09C></a>E09C   D0 20      BNE $E0BE
 <a name=E09E></a>E09E   20 F3 FF   JSR $<A href="#FFF3">FFF3</A>
 <a name=E0A1></a>E0A1   86 22      STX $22
 <a name=E0A3></a>E0A3   84 23      STY $23
 <a name=E0A5></a>E0A5   A0 04      LDY #$04
 <a name=E0A7></a>E0A7   B1 22      LDA ($22),Y
 <a name=E0A9></a>E0A9   85 62      STA $62
 <a name=E0AB></a>E0AB   C8         INY
 <a name=E0AC></a>E0AC   B1 22      LDA ($22),Y
 <a name=E0AE></a>E0AE   85 64      STA $64
 <a name=E0B0></a>E0B0   A0 08      LDY #$08
 <a name=E0B2></a>E0B2   B1 22      LDA ($22),Y
 <a name=E0B4></a>E0B4   85 63      STA $63
 <a name=E0B6></a>E0B6   C8         INY
 <a name=E0B7></a>E0B7   B1 22      LDA ($22),Y
 <a name=E0B9></a>E0B9   85 65      STA $65
 <a name=E0BB></a>E0BB   4C E3 E0   JMP $<A href="#E0E3">E0E3</A>
 
 <a name=E0BE></a>E0BE   A9 8B      LDA #$8B
 <a name=E0C0></a>E0C0   A0 00      LDY #$00
 <a name=E0C2></a>E0C2   20 A2 BB   JSR $<A href="#BBA2">BBA2</A>
 <a name=E0C5></a>E0C5   A9 8D      LDA #$8D
 <a name=E0C7></a>E0C7   A0 E0      LDY #$E0
 <a name=E0C9></a>E0C9   20 28 BA   JSR $<A href="#BA28">BA28</A>
 <a name=E0CC></a>E0CC   A9 92      LDA #$92
 <a name=E0CE></a>E0CE   A0 E0      LDY #$E0
 <a name=E0D0></a>E0D0   20 67 B8   JSR $<A href="#B867">B867</A>
 <a name=E0D3></a>E0D3   A6 65      LDX $65
 <a name=E0D5></a>E0D5   A5 62      LDA $62
 <a name=E0D7></a>E0D7   85 65      STA $65
 <a name=E0D9></a>E0D9   86 62      STX $62
 <a name=E0DB></a>E0DB   A6 63      LDX $63
 <a name=E0DD></a>E0DD   A5 64      LDA $64
 <a name=E0DF></a>E0DF   85 63      STA $63
 <a name=E0E1></a>E0E1   86 64      STX $64
 <A name=E0E3>
 <a name=E0E3></a>E0E3   A9 00      LDA #$00

 <a name=E0E5></a>E0E5   85 66      STA $66
 <a name=E0E7></a>E0E7   A5 61      LDA $61
 <a name=E0E9></a>E0E9   85 70      STA $70
 <a name=E0EB></a>E0EB   A9 80      LDA #$80
 <a name=E0ED></a>E0ED   85 61      STA $61
 <a name=E0EF></a>E0EF   20 D7 B8   JSR $<A href="#B8D7">B8D7</A>
 <a name=E0F2></a>E0F2   A2 8B      LDX #$8B
 <a name=E0F4></a>E0F4   A0 00      LDY #$00

 <a name=E0F6></a>E0F6   4C D4 BB   JMP $<A href="#BBD4">BBD4</A>

 
 <A name=E0F9>
 ; handle errors for direct I/O
 ; calls from basic
 </A>
 <a name=E0F9></a>E0F9   C9 F0      CMP #$F0
 <a name=E0FB></a>E0FB   D0 07      BNE $E104
 <a name=E0FD></a>E0FD   84 38      STY $38
 <a name=E0FF></a>E0FF   86 37      STX $37
 <a name=E101></a>E101   4C 63 A6   JMP $<A href="#A663">A663</A>
 
 <a name=E104></a>E104   AA         TAX
 <a name=E105></a>E105   D0 02      BNE $E109
 <a name=E107></a>E107   A2 1E      LDX #$1E
 <a name=E109></a>E109   4C 37 A4   JMP $<A href="#A437">A437</A>
 
 <A name=E10C>
 <a name=E10C></a>E10C   20 D2 FF   JSR $<A href="#FFD2">FFD2</A>
 </A>
 <a name=E10F></a>E10F   B0 E8      BCS $E0F9
 <a name=E111></a>E111   60         RTS
 
 <A name=E112>
 <a name=E112></a>E112   20 CF FF   JSR $<A href="#FFCF">FFCF</A>
 </A>
 <a name=E115></a>E115   B0 E2      BCS $E0F9
 <a name=E117></a>E117   60         RTS
 
 <A name=E118>
 <a name=E118></a>E118   20 AD E4   JSR $<A href="#E4AD">E4AD</A>
 </A>
 <a name=E11B></a>E11B   B0 DC      BCS $E0F9
 <a name=E11D></a>E11D   60         RTS
 
 <A name=E11E>
 <a name=E11E></a>E11E   20 C6 FF   JSR $<A href="#FFC6">FFC6</A>
 </A>
 <a name=E121></a>E121   B0 D6      BCS $E0F9
 <a name=E123></a>E123   60         RTS
 
 <A name=E124>
 <a name=E124></a>E124   20 E4 FF   JSR $<A href="#FFE4">FFE4</A>
 </A>
 <a name=E127></a>E127   B0 D0      BCS $E0F9
 <a name=E129></a>E129   60         RTS
 
 <A name=E12A>
 ; SYS command
 </A>
 <a name=E12A></a>E12A   20 8A AD   JSR $<A href="#AD8A">AD8A</A>
 <a name=E12D></a>E12D   20 F7 B7   JSR $<A href="#B7F7">B7F7</A>
 <a name=E130></a>E130   A9 E1      LDA #$E1   ; low  <A href="#E147">E146</A>
 <a name=E132></a>E132   48         PHA
 <a name=E133></a>E133   A9 46      LDA #$46   ; high <A href="#E147">E146</A>
 <a name=E135></a>E135   48         PHA
 <a name=E136></a>E136   AD 0F 03   LDA $030F
 <a name=E139></a>E139   48         PHA
 <a name=E13A></a>E13A   AD 0C 03   LDA $030C
 <a name=E13D></a>E13D   AE 0D 03   LDX $030D
 <a name=E140></a>E140   AC 0E 03   LDY $030E
 <a name=E143></a>E143   28         PLP
 <a name=E144></a>E144   6C 14 00   JMP ($0014)
 
 <a name=E147></a>E147   08         PHP

 <a name=E148></a>E148   8D 0C 03   STA $030C
 <a name=E14B></a>E14B   8E 0D 03   STX $030D
 <a name=E14E></a>E14E   8C 0E 03   STY $030E
 <a name=E151></a>E151   68         PLA
 <a name=E152></a>E152   8D 0F 03   STA $030F
 <a name=E155></a>E155   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=E156> </A>
;<b> BASIC SAVE command </b>
;    Referenced by: <A href="#A00C">Command Address Table</A>
;
; Reads the command-line parameters and passes them to the Kernal save routine
;
; IN: BASIC text at <a href="ram.htm#007A">TXTPTR</a>
; OUT: Nothing.  Generates error on fail.  No real side-effects
                                               
 <a name=xxxx></a>E156   20 D4 E1   JSR $<A href="#E1D4">E1D4</A>  ; read parameters from BASIC text
 <a name=E159></a>E159   A6 2D      LDX $<A href="ram.htm#002D">2D</A>    ; Start of BASIC variables (stop saving at this point)
 <a name=E15B></a>E15B   A4 2E      LDY $<A href="ram.htm#002E">2E</A>    ; (pass to kernal load in .X/.Y)
 <a name=E15D></a>E15D   A9 2B      LDA #$2B   ; Save will start at addr in $2B-2C (<i>address of address</i> passed in .A)
 <a name=E15F></a>E15F   20 D8 FF   JSR $<A href="#FFD8">FFD8</A>  ; JSR <A href="#F5DD">F5DD</A>, Kernal 'save RAM to device'
 <a name=E162></a>E162   B0 95      BCS $<A href="#E0F9">E0F9</A>  ; .C=1?  Save failed.
 <a name=E164></a>E164   60         RTS        ;
 
<A name=E165></A> <A name=E167></A>
;<b> BASIC VERIFY command </b>
;    Reference by: <A href="#A00C">Command Address Table</A>
;
; VERIFY and LOAD use the same code, since they're mostly the same.
; See notes at <A href="#E168">LOAD</A>

 <a name=xxxx></a>E165   A9 01      LDA #$01             ; 1 = Verify flag
 <a name=xxxx></a>E167   .BY $2C                         ; 3-byte <a href="#rom_BIT_trick">BIT trick</a> opcode, skips over following 2-byte LDA

<A name=E168></A>
;<b> BASIC LOAD command </b>
;    Referenced by: <A href="#A00C">Command Address Table</A>, and falls through from VERIFY, above
;
; routine is shared with VERIFY.  Differentiated by flag in .A (see <a href=#E165>VERIFY</a>)
; Inputs: .A: 0 = load; 1 = verify (.A set based on entry point, $A165 or $A168)

 <a name=xxxx></a>E168   A9 00      LDA #$00        ; 0 = flag for load
 <a name=E16A></a>E16A   85 0A      STA $<a href="ram.htm#000A">0A</a>         ; Set Load/Verify flag
 <a name=E16C></a>E16C   20 D4 E1   JSR $<A href="#E1D4">E1D4</A>       ; read load/verify/save parameters from BASIC text
 <a name=E16F></a>E16F   A5 0A      LDA $<a href="ram.htm#000A">0A</a>         ; passing load/verify flag in A (was stored in $0A)
 <a name=E171></a>E171   A6 2B      LDX $<a href="ram.htm#002B">2B</a>         ; pass default load address in X/Y
 <a name=E173></a>E173   A4 2C      LDY $<A href="ram.htm#002C">2C</A>         ;    (read from pointer "start of basic text")
 <a name=E175></a>E175   20 D5 FF   JSR $<A href="#FFD5">FFD5</A>       ; redirects via $03xx (normally to $<a href="#F49E">F49E</a>): "Load RAM from device"
 <a name=E178></a>E178   B0 57      BCS $E1D1   +   ; error?  yes, redirect to $<A href="#E0F9">E0F9</A>: "Handle Errors"
 <a name=E17A></a>E17A   A5 0A      LDA $<a href="ram.htm#000A">0A</a>         ; no errors, read back load/verify flag
 <a name=E17C></a>E17C   F0 17      BEQ $E195   +   ; Was a LOAD?  Handle post-load

; handle post-verify
 <a name=E17E></a>E17E   A2 1C      LDX #$1C        ; no, was VERIFY.  Pre-load .X with code for "verify error"
 <a name=E180></a>E180   20 B7 FF   JSR $<A href="#FFB7">FFB7</A>       ; Redirects to $<A href="#FE07">FE07</A>; "read I/O status word" ??? Error indicated both by "load ram" returning w/ C set, AND by checking ST word??
 <a name=E183></a>E183   29 10      AND #$10        ; Isolate bit 4 (???)
 <a name=E185></a>E185   D0 17      BNE $E19E   +   ; Bit 4 set in ST... jump to output error (verify error)
 <a name=E187></a>E187   A5 7A      LDA $<A href="ram.htm#007A">7A</A>         ; LSB of TXTPTR
 <a name=E189></a>E189   C9 02      CMP #$02        ; 
 <a name=E18B></a>E18B   F0 07      BEQ $E194   +   ; ??? RTS if executing BASIC code at $xx02??  What???  !!quirk!!
 <a name=E18D></a>E18D   A9 64      LDA #$64
 <a name=E18F></a>E18F   A0 A3      LDY #$A3        ; .A/.Y = $<A href="#A364">A364</A> (address of "OK" message)
 <a name=E191></a>E191   4C 1E AB   JMP $<A href="#AB1E">AB1E</A>       ; Output BASIC "OK" message
*<a name=E194></a>E194   60         RTS
 
; Handle post-load
*<a name=E195></a>E195   20 B7 FF   JSR $<A href="#FFB7">FFB7</A>       ; Redirects to $<A href="#FE07">FE07</A>; "read I/O status word"
 <a name=E198></a>E198   29 BF      AND #$BF        ; Ignore bit 6 (???)
 <a name=E19A></a>E19A   F0 05      BEQ $E1A1   +   ; ST bits 0..5 and 7 are not set... no error
 <a name=E19C></a>E19C   A2 1D      LDX #$1D        ; code for "LOAD ERROR"
*<a name=E19E></a>E19E   4C 37 A4   JMP $<A href="#A437">A437</A>       ; Handle error message
 
*<a name=E1A1></a>E1A1   A5 7B      LDA $<A href="ram.htm#007B">7B</A>         ; MSB of TXTPTR
 <a name=E1A3></a>E1A3   C9 02      CMP #$02        ; Running from immediate mode buffer?
 <a name=E1A5></a>E1A5   D0 0E      BNE $E1B5   +   ;    no, loading from program. Don't set end of prg ptr (and do other stuff differently)
 <a name=E1A7></a>E1A7   86 2D      STX $<A href="ram.htm#002D">2D</A>         ; Immediate-mode load
 <a name=E1A9></a>E1A9   84 2E      STY $<A href="ram.htm#002E">2E</A>         ; Set end of program/beginning of vars
 <a name=E1AB></a>E1AB   A9 76      LDA #$76        ;
 <a name=E1AD></a>E1AD   A0 A3      LDY #$A3        ; .A/.Y = $<A href="#A376">A376</A> (address of "READY." message) ??? Why does LOAD output this???
 <a name=E1AF></a>E1AF   20 1E AB   JSR $<A href="#AB1E">AB1E</A>       ; Output BASIC message
 <a name=E1B2></a>E1B2   4C 2A A5   JMP $<A href="#A52A">A52A</A>       ; Re-link BASIC program (and other stuff?), then RTS
 
*<a name=E1B5></a>E1B5   20 8E A6   JSR $<A href="#A68E">A68E</A>       ; Set TXTPTR to start of program
 <a name=E1B8></a>E1B8   20 33 A5   JSR $<A href="#A533">A533</A>       ; Re-link BASIC program
 <a name=E1BB></a>E1BB   4C 77 A6   JMP $<A href="#A677">A677</A>       ; Essentially, RUN the program (perform RESTORE, reset stack & "program pointers", then RTS)  ??? How does this compare to what I did after PUCRUNCH? --AF
 
<A name=E1BE> </A>
;<b> BASIC OPEN command </b>

 <a name=xxxx></a>E1BE   20 19 E2   JSR $<A href="#E219">E219</A>       ; Get open/close params
 <a name=E1C1></a>E1C1   20 C0 FF   JSR $<A href="#FFC0">FFC0</A>       ; Redirects via $<a href="ram.htm#031A">031A</a> (normally to <A href="#F34A">F34A</A>, Kernal Open)
 <a name=E1C4></a>E1C4   B0 0B      BCS $E1D1   +   ; Error? handle
 <a name=E1C6></a>E1C6   60         RTS             ; No error
 
<A name=E1C7> </A>
;<b> BASIC CLOSE command </b>

 <a name=xxxx></a>E1C7   20 19 E2   JSR $<A href="#E219">E219</A>       ; Get open/close params
 <a name=E1CA></a>E1CA   A5 49      LDA $<A href="ram.htm#0049">49</A>         ; "FORPNT" LSB?  Must be a value filled in by $E219 call?
 <a name=E1CC></a>E1CC   20 C3 FF   JSR $<A href="#FFC3">FFC3</A>       ; Redirects via $<a href="ram.htm#031C">031C</a> (normally to <A href="#F34A">F291</A>, Kernal Close)
 <a name=E1CF></a>E1CF   90 C3      BCC $E194   -   ; No error?  RTS
*<a name=E1D1></a>E1D1   4C F9 E0   JMP $<A href="#E0F9">E0F9</A>       ; Handle Errors
 
<A name=E1D4></A>
;<b> Get parameters for LOAD/VERIFY/SAVE </b>
;    Referenced by:  <A href="#E156">E156</A> <A href="#E16C">E16C</A>
;
; Reads filename, device#, and secondary address from BASIC text
; <i>Sets defaults first</i> ("",1,0) in case any are omitted
; Inputs: BASIC code at (<A href="ram.htm#007A">TXTPTR</A>)
; Outputs: Stores the info in OS RAM at <A href="ram.htm#00B7">$B7..$BC</A>

 <a name=xxxx></a>E1D4   A9 00      LDA #$00         ; String length: 0
 <a name=E1D6></a>E1D6   20 BD FF   JSR $<A href="#FFBD">FFBD</A>        ; JSR $<A href="#FDF9">FDF9</A>.  Set Filename to ""
 <a name=E1D9></a>E1D9   A2 01      LDX #$01         ; Device = 1 (tape) 
 <a name=E1DB></a>E1DB   A0 00      LDY #$00         ; secondary addr = 0  
 <a name=E1DD></a>E1DD   20 BA FF   JSR $<A href="#FFBA">FFBA</A>        ; JSR $<A href="#FE00">FE00</A>  Set Default file params.             
 <a name=E1E0></a>E1E0   20 06 E2   JSR $<A href="#E206">E206</A>        ; check for EOL.  <i>may not return here</i>
 <a name=E1E3></a>E1E3   20 57 E2   JSR $<A href="#E257">E257</A>        ; Use last part of "Get Open/Close Parameters" (at E219) to get Filename
 <a name=E1E6></a>E1E6   20 06 E2   JSR $<A href="#E206">E206</A>        ; Check for EOL again
 <a name=E1E9></a>E1E9   20 00 E2   JSR $<A href="#E200">E200</A>        ; not EOL: Expect comma, integer that follows is returned in X
 <a name=E1EC></a>E1EC   A0 00      LDY #$00
 <a name=E1EE></a>E1EE   86 49      STX $<A href="ram.htm#0049">49</A>          ; Temp storage of device# (in FOR/NEXT var ptr)
 <a name=E1F0></a>E1F0   20 BA FF   JSR $<A href="#FFBA">FFBA</A>        ; JSR $<A href="#FE00">FE00</A>; Set actual device#, S.A. still default
 <a name=E1F3></a>E1F3   20 06 E2   JSR $<A href="#E206">E206</A>        ; Check for EOL again
 <a name=E1F6></a>E1F6   20 00 E2   JSR $<A href="#E200">E200</A>        ; not EOL; X = integer after comma (2nd addr)
 <a name=E1F9></a>E1F9   8A         TXA
 <a name=E1FA></a>E1FA   A8         TAY              ; Secondary address belongs in Y
 <a name=E1FB></a>E1FB   A6 49      LDX $<A href="ram.htm#0049">49</A>          ; Retrieve saved Device#
 <a name=E1FD></a>E1FD   4C BA FF   JMP $<A href="#FFBA">FFBA</A>        ; JMP $<A href="#FE00">FE00</A>; Set Device# & secondary addr, then RTS

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 2 </b></i>      <HR align=center width=50%>
</div> <div class="level2">
<!--------------------------------------------------------------------------------------------------------->
 
<A name=E200></A>
;<b> get 8-bit integer after comma </b>
;    Referenced by:  <A href="#E1E9">E1E9</A> <A href="#E1F6">E1F6</A> <A href="#E231">E231</A> <A href="#E245">E245</A>
;
; Inputs: BASIC code at (<A href="ram.htm#007A">TXTPTR</A>)
; Outputs: .X=Integer result of value or expression ???
; Errors:  The next token must be a comma, followed by an expression???
;          that yields 0..255; otherwise, an error will result

 <a name=xxxx></a>E200   20 0E E2   JSR $<A href="#E20E">E20E</A>           ; Confirm comma and skip
 <a name=E203></a>E203   4C 9E B7   JMP $<A href="#B79E">B79E</A>           ; Get value, then RTS
 
<A name=E206></A>              !!! More notes about various places where "return from parent" technique used
;<b> check for end of line </b>
;    Referenced by:   <A href="#E1E0">E1E0</A> <A href="#E1E6">E1E6</A> <A href="#E1F3">E1F3</A> <A href="#E22E">E22E</A> <A href="#E242">E242</A> <A href="#E251">E251</A>
;
; If current token is ":" or 0-byte (EOL), returns to the <i>caller's</i> caller
; If <i>not</i> end of line, returns to caller normally
; Inputs: BASIC code at (<A href="ram.htm#007A">TEXTPTR</A>)
; Outputs: A=current token;  .X/.Y preserved

 <a name=xxxx></a>E206   20 79 00   JSR $<A href="#0079">0079</A>        ; CHRGOT
 <a name=E209></a>E209   D0 02      BNE $E20D   *      ; .Z clear... not EOL.  return
 <a name=E20B></a>E20B   68         PLA                ; EOL found.  Break out of calling routine by removing return addresss
 <a name=E20C></a>E20C   68         PLA
*<a name=E20D></a>E20D   60         RTS

<A name=E20E></A>
;<b> check for comma and something following it </b>
;    Referenced by:  <A href="#E200">E200</A> <A href="#E254">E254</A>
;
; If current character at <A href="ram.htm#007A">TXTPTR</A> is a comma, 
; increment TXTPTR and check the next character.  Throw a syntax error if
; comma is not the current token, or if there is nothing after the comma.

 <a name=xxxx></a>E20E   20 FD AE   JSR $<A href="#AEF7">AEFD</A>           ; check/consume comma (no comma=error) 
; entry point called from $<A href="#E21E">E21E</A>
 <a name=E211></a>E211   20 79 00   JSR $<A href="#0079">0079</A>           ; CHRGOT: get character after comma
 <a name=E214></a>E214   D0 F7      BNE $E20D   *       ; more text after comma?  RTS
 <a name=E216></a>E216   4C 08 AF   JMP $<A href="#AF08">AF08</A>           ; comma at end of statement: syntax error

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 2   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

<A name=E219> </A>
; get open/close parameters

 <a name=xxxx></a>E219   A9 00      LDA #$00
 <a name=E21B></a>E21B   20 BD FF   JSR $<A href="#FFBD">FFBD</A>                                                                              
 <a name=E21E></a>E21E   20 11 E2   JSR $<A href="#E211">E211</A>
 <a name=E221></a>E221   20 9E B7   JSR $<A href="#B79E">B79E</A>
 <a name=E224></a>E224   86 49      STX $49
 <a name=E226></a>E226   8A         TXA
 <a name=E227></a>E227   A2 01      LDX #$01
 <a name=E229></a>E229   A0 00      LDY #$00
 <a name=E22B></a>E22B   20 BA FF   JSR $<A href="#FFBA">FFBA</A>                                                                              
 <a name=E22E></a>E22E   20 06 E2   JSR $<A href="#E206">E206</A>                                                                              
 <a name=E231></a>E231   20 00 E2   JSR $<A href="#E200">E200</A>                                                                              
 <a name=E234></a>E234   86 4A      STX $4A
 <a name=E236></a>E236   A0 00      LDY #$00
 <a name=E238></a>E238   A5 49      LDA $49
 <a name=E23A></a>E23A   E0 03      CPX #$03
 <a name=E23C></a>E23C   90 01      BCC $E23F    *
 <a name=E23E></a>E23E   88         DEY
*<a name=E23F></a>E23F   20 BA FF   JSR $<A href="#FFBA">FFBA</A>                                                                              
 <a name=E242></a>E242   20 06 E2   JSR $<A href="#E206">E206</A>                                                                              
 <a name=E245></a>E245   20 00 E2   JSR $<A href="#E200">E200</A>                                                                              
 <a name=E248></a>E248   8A         TXA
 <a name=E249></a>E249   A8         TAY
 <a name=E24A></a>E24A   A6 4A      LDX $4A
 <a name=E24C></a>E24C   A5 49      LDA $49
 <a name=E24E></a>E24E   20 BA FF   JSR $<A href="#FFBA">FFBA</A>                                                                              
 <a name=E251></a>E251   20 06 E2   JSR $<A href="#E206">E206</A>                                                                              
 <a name=E254></a>E254   20 0E E2   JSR $<A href="#E20E">E20E</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->


<a name=E257></a>
;<b> read string param as filename </b>
;    Referenced by: <A href="#E1E3">E1E3</A>
;
; Expects a string value (or expression) starting at current position in code.
; IN: BASIC code at <A href="ram.htm#007A">TXTPTR</A> only
; OUT: String address is stored at $<A href="ram.htm#0022">22/23</A>   !!! Double-check this

*<a name=xxxx></a>E257   20 9E AD   JSR $<A href="#AD9E">AD9E</A>       ; Evaluate expression (could return any data type...)    !!! Verify where this stores string values
 <a name=E25A></a>E25A   20 A3 B6   JSR $<A href="#B6A3">B6A3</A>       ; !!! What does this really do?  make sure last-read param is string, or throw it away?  /// required: A = str. len after call
 <a name=E25D></a>E25D   A6 22      LDX $<A href="ram.htm#0022">22</A>         ; Retrieve string addr from temp storage. 
                                   ; (Is this where "evaluate" stores result for String-type result???  Where is the length coming from??)
 <a name=E25F></a>E25F   A4 23      LDY $23
 <a name=E261></a>E261   4C BD FF   JMP $<A href="#FFBD">FFBD</A>       ; JMP $<A href="#FDF9">FDF9</A>: Set string for IO operation, then RTS  /// A = length, X/Y = address


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=E264>
 ; COS function
 </A>
 <a name=E264></a>E264   A9 E0      LDA #$E0   ; low  <A href="#E2E0">E2E0</A>
 <a name=E266></a>E266   A0 E2      LDY #$E2   ; high <A href="#E2E0">E2E0</A>
 <a name=E268></a>E268   20 67 B8   JSR $<A href="#B867">B867</A>
 
 <A name=E26B>
 ; SIN function
 </A>
 <a name=E26B></a>E26B   20 0C BC   JSR $<A href="#BC0C">BC0C</A>
 <a name=E26E></a>E26E   A9 E5      LDA #$E5   ; low  <A href="#E2E0">E2E5</A>
 <a name=E270></a>E270   A0 E2      LDY #$E2   ; high <A href="#E2E0">E2E5</A>
 <a name=E272></a>E272   A6 6E      LDX $6E
 <a name=E274></a>E274   20 07 BB   JSR $<A href="#BB07">BB07</A>
 <a name=E277></a>E277   20 0C BC   JSR $<A href="#BC0C">BC0C</A>
 <a name=E27A></a>E27A   20 CC BC   JSR $<A href="#BCCC">BCCC</A>
 <a name=E27D></a>E27D   A9 00      LDA #$00        ;
 <a name=E27F></a>E27F   85 6F      STA $6F         ;
 <a name=E281></a>E281   20 53 B8   JSR $<A href="#B853">B853</A>
 <a name=E284></a>E284   A9 EA      LDA #$EA   ; low  <A href="#E2E0">E2EA</A>
 <a name=E286></a>E286   A0 E2      LDY #$E2   ; high <A href="#E2E0">E2EA</A>
 <a name=E288></a>E288   20 50 B8   JSR $<A href="#B850">B850</A>
 <a name=E28B></a>E28B   A5 66      LDA $66
 <a name=E28D></a>E28D   48         PHA
 <a name=E28E></a>E28E   10 0D      BPL $E29D
 <a name=E290></a>E290   20 49 B8   JSR $<A href="#B849">B849</A>
 <a name=E293></a>E293   A5 66      LDA $66
 <a name=E295></a>E295   30 09      BMI $E2A0
 <a name=E297></a>E297   A5 12      LDA $12
 <a name=E299></a>E299   49 FF      EOR #$FF
 <a name=E29B></a>E29B   85 12      STA $12
 <A name=E29D>
 <a name=E29D></a>E29D   20 B4 BF   JSR $<A href="#BFB4">BFB4</A>
 </A>
 <a name=E2A0></a>E2A0   A9 EA      LDA #$EA   ; low  <A href="#E2E0">E2EA</A>
 <a name=E2A2></a>E2A2   A0 E2      LDY #$E2   ; high <A href="#E2E0">E2EA</A>
 <a name=E2A4></a>E2A4   20 67 B8   JSR $<A href="#B867">B867</A>
 <a name=E2A7></a>E2A7   68         PLA
 <a name=E2A8></a>E2A8   10 03      BPL $E2AD
 <a name=E2AA></a>E2AA   20 B4 BF   JSR $<A href="#BFB4">BFB4</A>
 <a name=E2AD></a>E2AD   A9 EF      LDA #$EF
 <a name=E2AF></a>E2AF   A0 E2      LDY #$E2
 <a name=E2B1></a>E2B1   4C 43 E0   JMP $<A href="#E043">E043</A>
 
 <A name=E2B4>
 ; TAN function
 </A>
 <a name=E2B4></a>E2B4   20 CA BB   JSR $<A href="#BBCA">BBCA</A>
 <a name=E2B7></a>E2B7   A9 00      LDA #$00
 <a name=E2B9></a>E2B9   85 12      STA $12
 <a name=E2BB></a>E2BB   20 6B E2   JSR $<A href="#E26B">E26B</A>
 <a name=E2BE></a>E2BE   A2 4E      LDX #$4E   ; low  004E
 <a name=E2C0></a>E2C0   A0 00      LDY #$00   ; high 004E
 <a name=E2C2></a>E2C2   20 F6 E0   JSR $<A href="#E0F6">E0F6</A>
 <a name=E2C5></a>E2C5   A9 57      LDA #$57   ; low  005F
 <a name=E2C7></a>E2C7   A0 00      LDY #$00   ; high 005F
 <a name=E2C9></a>E2C9   20 A2 BB   JSR $<A href="#BBA2">BBA2</A>
 <a name=E2CC></a>E2CC   A9 00      LDA #$00
 <a name=E2CE></a>E2CE   85 66      STA $66
 <a name=E2D0></a>E2D0   A5 12      LDA $12
 <a name=E2D2></a>E2D2   20 DC E2   JSR $<A href="#E2DC">E2DC</A>
 <a name=E2D5></a>E2D5   A9 4E      LDA #$4E   ; low  004E
 <a name=E2D7></a>E2D7   A0 00      LDY #$00   ; high 004E
 <a name=E2D9></a>E2D9   4C 0F BB   JMP $<A href="#BB0F">BB0F</A>
 
 <A name=E2DC>
 <a name=E2DC></a>E2DC   48         PHA
 </A>
 <a name=E2DD></a>E2DD   4C 9D E2   JMP $<A href="#E29D">E29D</A>
 
 <A name=E2E0>
 ; float numbers for SIN, COS and TAN
 </A>
 ; 0.5 * PI
 <a name=E2E0></a>E2E0   .BY $81,$49,$0F,$DA,$A2
 ; 2 * PI
 <a name=E2E5></a>E2E5   .BY $83,$49,$0F,$DA,$A2
 ; 0,25
 <a name=E2EA></a>E2EA   .BY $7F,$00,$00,$00,$00
 
 <A name=E2EF>
 ; polynomial table
 </A>
 <a name=E2EF></a>E2EF   .BY $05   ; degree 6
 <a name=E2F0></a>E2F0   .BY $84,$E6,$1A,$2D,$1B
 <a name=E2F5></a>E2F5   .BY $86,$28,$07,$FB,$F8
 <a name=E2FA></a>E2FA   .BY $87,$99,$68,$89,$01
 <a name=E2FF></a>E2FF   .BY $87,$23,$35,$DF,$E1
 <a name=E304></a>E304   .BY $86,$A5,$5D,$E7,$28
 <a name=E309></a>E309   .BY $83,$49,$0F,$DA,$A2
 
 <A name=E30E>
 ; ATN function
 </A>
 <a name=E30E></a>E30E   A5 66      LDA $66
 <a name=E310></a>E310   48         PHA
 <a name=E311></a>E311   10 03      BPL $E316
 <a name=E313></a>E313   20 B4 BF   JSR $<A href="#BFB4">BFB4</A>
 <a name=E316></a>E316   A5 61      LDA $61
 <a name=E318></a>E318   48         PHA
 <a name=E319></a>E319   C9 81      CMP #$81
 <a name=E31B></a>E31B   90 07      BCC $E324
 <a name=E31D></a>E31D   A9 BC      LDA #$BC   ; low  <A href="#B9BC">B9BC</A>
 <a name=E31F></a>E31F   A0 B9      LDY #$B9   ; high <A href="#B9BC">B9BC</A>
 <a name=E321></a>E321   20 0F BB   JSR $<A href="#BB0F">BB0F</A>
 <a name=E324></a>E324   A9 3E      LDA #$3E   ; low  <A href="#E33E">E33E</A>
 <a name=E326></a>E326   A0 E3      LDY #$E3   ; high <A href="#E33E">E33E</A>
 <a name=E328></a>E328   20 43 E0   JSR $<A href="#E043">E043</A>
 <a name=E32B></a>E32B   68         PLA
 <a name=E32C></a>E32C   C9 81      CMP #$81
 <a name=E32E></a>E32E   90 07      BCC $E337
 <a name=E330></a>E330   A9 E0      LDA #$E0   ; low  <A href="#E2E0">E2E0</A>
 <a name=E332></a>E332   A0 E2      LDY #$E2   ; high <A href="#E2E0">E2E0</A>
 <a name=E334></a>E334   20 50 B8   JSR $<A href="#B850">B850</A>
 <a name=E337></a>E337   68         PLA
 <a name=E338></a>E338   10 03      BPL $E33D
 <a name=E33A></a>E33A   4C B4 BF   JMP $<A href="#BFB4">BFB4</A>
 <a name=E33D></a>E33D   60         RTS
 
 <A name=E33E>
 ; float numbers for ATN
 ; polynomial table
 </A>
 <a name=E33E></a>E33E   .BY $0B   ; degree 12
 <a name=E33F></a>E33F   .BY $76,$B3,$83,$BD,$D3
 <a name=E344></a>E344   .BY $79,$1E,$F4,$A6,$F5
 <a name=E349></a>E349   .BY $7B,$83,$FC,$B0,$10
 <a name=E34E></a>E34E   .BY $7C,$0C,$1F,$67,$CA
 <a name=E353></a>E353   .BY $7C,$DE,$53,$CB,$C1
 <a name=E358></a>E358   .BY $7D,$14,$64,$70,$4C
 <a name=E35D></a>E35D   .BY $7D,$B7,$EA,$51,$7A
 <a name=E362></a>E362   .BY $7D,$63,$30,$88,$7E
 <a name=E367></a>E367   .BY $7E,$92,$44,$99,$3A
 <a name=E36C></a>E36C   .BY $7E,$4C,$CC,$91,$C7
 <a name=E371></a>E371   .BY $7F,$AA,$AA,$AA,$13
 <a name=E376></a>E376   .BY $81,$00,$00,$00,$00
 
 <A name=E37B>
 ; warm start entry
 </A>
 <a name=E37B></a>E37B   20 CC FF   JSR $<A href="#FFCC">FFCC</A>
 <a name=E37E></a>E37E   A9 00      LDA #$00
 <a name=E380></a>E380   85 13      STA $13
 <a name=E382></a>E382   20 7A A6   JSR $<A href="#A67A">A67A</A>
 <a name=E385></a>E385   58         CLI
 <A name=E386>
 <a name=E386></a>E386   A2 80      LDX #$80
 </A>
 <a name=E388></a>E388   6C 00 03   JMP ($0300)   ; normally <A href="#E38B">E38B</A>
 
 <A name=E38B>
 ; handle error messages
 </A>
 <a name=E38B></a>E38B   8A         TXA
 <a name=E38C></a>E38C   30 03      BMI $E391
 <a name=E38E></a>E38E   4C 3A A4   JMP $<A href="#A43A">A43A</A>
 
 <a name=E391></a>E391   4C 74 A4   JMP $<A href="#A474">A474</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
<A name=E394> </A>
; RESET routine (for BASIC).  System reset is $<A href="#FCE2">FCE2</A>
;
; referenced by:  <A href="#A000">A000</A>

 <a name=xxxx></a>E394   20 53 E4   JSR $<A href="#E453">E453</A>;init BASIC vectors, $300-30B
 <a name=E397></a>E397   20 BF E3   JSR $<A href="#E3BF">E3BF</A>;init BASIC locations, incl. top/bot mem, USR() func, and some flags / temp values
 <a name=E39A></a>E39A   20 22 E4   JSR $<A href="#E422">E422</A>;"print BASIC startup message"... does a lot more
 <a name=E39D></a>E39D   A2 FB      LDX #$FB
 <a name=E39F></a>E39F   9A         TXS
 <a name=E3A0></a>E3A0   D0 E4      BNE $E386
 
 <A name=E3A2>
 ; character fetch code for zero page $73..$8A      
 </A>                                           
 <a name=E3A2></a>E3A2   E6 7A      INC $7A     
 <a name=E3A4></a>E3A4   D0 02      BNE $E3A8
 <a name=E3A6></a>E3A6   E6 7B      INC $7B
 <a name=E3A8></a>E3A8   AD 60 EA   LDA $EA60
 <a name=E3AB></a>E3AB   C9 3A      CMP #$3A   ; colon
 <a name=E3AD></a>E3AD   B0 0A      BCS $E3B9
 <a name=E3AF></a>E3AF   C9 20      CMP #$20   ; space
 <a name=E3B1></a>E3B1   F0 EF      BEQ $E3A2
 <a name=E3B3></a>E3B3   38         SEC
 <a name=E3B4></a>E3B4   E9 30      SBC #$30   ; 0
 <a name=E3B6></a>E3B6   38         SEC
 <a name=E3B7></a>E3B7   E9 D0      SBC #$D0
 <a name=E3B9></a>E3B9   60         RTS

 <A name=E3BA>
 ; first RND seed value
 </A>
 <a name=E3BA></a>E3BA   .BY $80,$4F,$C7,$52,$58
 
 <A name=E3BF> </A>
 ; initialisation of basic

 <a name=E3BF></a>E3BF   A9 4C      LDA #$4C
 <a name=E3C1></a>E3C1   85 54      STA $54;temp ptr/data area...  Looks like JMP instruction to me
 <a name=E3C3></a>E3C3   8D 10 03   STA $0310;JMP for USR() function
 <a name=E3C6></a>E3C6   A9 48      LDA #$48   ; low  B248  (USR vector, causes "ILLEGAL QUANTITY" error by default
 <a name=E3C8></a>E3C8   A0 B2      LDY #$B2   ; high B248
 <a name=E3CA></a>E3CA   8D 11 03   STA $0311
 <a name=E3CD></a>E3CD   8C 12 03   STY $0312
 <a name=E3D0></a>E3D0   A9 91      LDA #$91   ; lowh B391  ($B391 = convert int. to float)
 <a name=E3D2></a>E3D2   A0 B3      LDY #$B3   ; high B391
 <a name=E3D4></a>E3D4   85 05      STA $05;vector: convert int. to float
 <a name=E3D6></a>E3D6   84 06      STY $06
 <a name=E3D8></a>E3D8   A9 AA      LDA #$AA   ; low  B1AA
 <a name=E3DA></a>E3DA   A0 B1      LDY #$B1   ; high B1AA
 <a name=E3DC></a>E3DC   85 03      STA $03;vector: convert float to int.
 <a name=E3DE></a>E3DE   84 04      STY $04
 <a name=E3E0></a>E3E0   A2 1C      LDX #$1C;copy CHRGET routine to zp
 <a name=E3E2></a>E3E2   BD A2 E3   LDA $<A href="#E3A2">E3A2</A>,X
 <a name=E3E5></a>E3E5   95 73      STA $73,X
 <a name=E3E7></a>E3E7   CA         DEX
 <a name=E3E8></a>E3E8   10 F8      BPL $E3E2
 <a name=E3EA></a>E3EA   A9 03      LDA #$03
 <a name=E3EC></a>E3EC   85 53      STA $53;tmp ptr/data area
 <a name=E3EE></a>E3EE   A9 00      LDA #$00
 <a name=E3F0></a>E3F0   85 68      STA $68;FP acc#1
 <a name=E3F2></a>E3F2   85 13      STA $13;flag: input prompt
 <a name=E3F4></a>E3F4   85 18      STA $18;last temp string addr, hi
 <a name=E3F6></a>E3F6   A2 01      LDX #$01;store $0101 at $01FC (on stack) ??
 <a name=E3F8></a>E3F8   8E FD 01   STX $01FD
 <a name=E3FB></a>E3FB   8E FC 01   STX $01FC
 <a name=E3FE></a>E3FE   A2 19      LDX #$19
 <a name=E400></a>E400   86 16      STX $16;ptr: temp string stack
 <a name=E402></a>E402   38         SEC;start of BASIC = bottom of OS mem.
 <a name=E403></a>E403   20 9C FF   JSR $<A href="#FF9C">FF9C</A>
 <a name=E406></a>E406   86 2B      STX $2B
 <a name=E408></a>E408   84 2C      STY $2C
 <a name=E40A></a>E40A   38         SEC;top of OS mem
 <a name=E40B></a>E40B   20 99 FF   JSR $<A href="#FF99">FF99</A>
 <a name=E40E></a>E40E   86 37      STX $37;..becomes top of BASIC mem,
 <a name=E410></a>E410   84 38      STY $38
 <a name=E412></a>E412   86 33      STX $33;..and bottom of BASIC strings (clears all strings)
 <a name=E414></a>E414   84 34      STY $34
 <a name=E416></a>E416   A0 00      LDY #$00
 <a name=E418></a>E418   98         TYA
 <a name=E419></a>E419   91 2B      STA ($2B),Y;place the 0 at 2048. (required to precede start of basic)
 <a name=E41B></a>E41B   E6 2B      INC $2B;and inc. start of basic to 2049
 <a name=E41D></a>E41D   D0 02      BNE $E421
 <a name=E41F></a>E41F   E6 2C      INC $2C
 <a name=E421></a>E421   60         RTS
 
 <A name=E422>
 ; print BASIC start up messages
 </A>
 <a name=E422></a>E422   A5 2B      LDA $2B;start of basic addr
 <a name=E424></a>E424   A4 2C      LDY $2C
 <a name=E426></a>E426   20 08 A4   JSR $<A href="#A408">A408</A>;arrays overflowed?
 <a name=E429></a>E429   A9 73      LDA #$73   ; low  <A href="#E473">E473</A>
 <a name=E42B></a>E42B   A0 E4      LDY #$E4   ; high <A href="#E473">E473</A>;COMMODORE 64 BASIC V2   64K RAM SYSTEM"message
 <a name=E42D></a>E42D   20 1E AB   JSR $<A href="#AB1E">AB1E</A>;output
 <a name=E430></a>E430   A5 37      LDA $37; calc. bytes free
 <a name=E432></a>E432   38         SEC
 <a name=E433></a>E433   E5 2B      SBC $2B
 <a name=E435></a>E435   AA         TAX
 <a name=E436></a>E436   A5 38      LDA $38
 <a name=E438></a>E438   E5 2C      SBC $2C
 <a name=E43A></a>E43A   20 CD BD   JSR $<A href="#BDCD">BDCD</A>; output decimal number to screen
 <a name=E43D></a>E43D   A9 60      LDA #$60   ; low  <A href="#E460">E460</A>
 <a name=E43F></a>E43F   A0 E4      LDY #$E4   ; high <A href="#E460">E460</A>;"BASIC BYTES FREE"
 <a name=E441></a>E441   20 1E AB   JSR $<A href="#AB1E">AB1E</A>;output
 <a name=E444></a>E444   4C 44 A6   JMP $<A href="#A644">A644</A>;perform NEW, then return


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=E447>
 ; vectors for $0300-$030B
 </A>
 <a name=E447></a>E447   .WD $<A href="#E38B">E38B</A>
 <a name=E449></a>E449   .WD $<A href="#A483">A483</A>
 <a name=E44B></a>E44B   .WD $<A href="#A57C">A57C</A>
 <a name=E44D></a>E44D   .WD $<A href="#A71A">A71A</A>
 <a name=E44F></a>E44F   .WD $<A href="#A7E4">A7E4</A>
 <a name=E451></a>E451   .WD $<A href="#AE86">AE86</A>
 
 <A name=E453>
 ; initialise vectors
 </A>
 <a name=E453></a>E453   A2 0B      LDX #$0B
 <a name=E455></a>E455   BD 47 E4   LDA $<A href="#E447">E447</A>,X
 <a name=E458></a>E458   9D 00 03   STA $0300,X
 <a name=E45B></a>E45B   CA         DEX
 <a name=E45C></a>E45C   10 F7      BPL $E455
 <a name=E45E></a>E45E   60         RTS
 
 <A name=E45F>
 ; startup messages
 </A>
 <a name=E45F></a>E45F   .BY $00
 <A name=E460>
 ; basic bytes free
 </A>
 <a name=E460></a>E460   .BY $20,$42,$41,$53,$49,$43
 <a name=E466></a>E466   .BY $20,$42,$59,$54,$45,$53
 <a name=E46C></a>E46C   .BY $20,$46,$52,$45,$45
 <a name=E471></a>E471   .BY $0D
 <a name=E472></a>E472   .BY $00
 <A name=E473>
 ; **** commodore 64 basic v2 ****
 </A>
 <a name=E473></a>E473   .BY $93,$0D,$20,$20,$20
 <a name=E478></a>E478   .BY $20,$2A,$2A,$2A,$2A
 <a name=E47D></a>E47D   .BY $20,$43,$4F,$4D,$4D,$4F,$44,$4F,$52,$45
 <a name=E487></a>E487   .BY $20,$36,$34
 <a name=E48A></a>E48A   .BY $20,$42,$41,$53,$49,$43
 <a name=E490></a>E490   .BY $20,$56,$32
 <a name=E493></a>E493   .BY $20,$2A,$2A,$2A,$2A
 <a name=E498></a>E498   .BY $0D,$0D
 <A name=E49A>
 ; 64k ram system
 </A>
 <a name=E49A></a>E49A   .BY $20,$36,$34,$4B
 <a name=E49E></a>E49E   .BY $20,$52,$41,$4D
 <a name=E4A2></a>E4A2   .BY $20,$53,$59,$53,$54,$45,$4D
 <a name=E4A9></a>E4A9   .BY $20,$20
 <a name=E4AB></a>E4AB   .BY $00
 
 <a name=E4AC></a>E4AC   .BY $81
 
 <A name=E4AD>
 ; set output device
 </A>
 <a name=E4AD></a>E4AD   48         PHA
 <a name=E4AE></a>E4AE   20 C9 FF   JSR $<A href="#FFC9">FFC9</A>
 <a name=E4B1></a>E4B1   AA         TAX
 <a name=E4B2></a>E4B2   68         PLA
 <a name=E4B3></a>E4B3   90 01      BCC $E4B6
 <a name=E4B5></a>E4B5   8A         TXA
 <a name=E4B6></a>E4B6   60         RTS
 
 <A name=E4B7>
 ; unused
 </A>
 <a name=E4B7></a>E4B7   .BY $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
 <a name=E4BF></a>E4BF   .BY $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
 <a name=E4C7></a>E4C7   .BY $AA,$AA,$AA,$AA,$AA,$AA,$AA,$AA
 <a name=E4CF></a>E4CF   .BY $AA,$AA,$AA,$AA
 
 <A name=E4D3>
 <a name=E4D3></a>E4D3   85 A9      STA $A9
 </A>
 <a name=E4D5></a>E4D5   A9 01      LDA #$01
 <a name=E4D7></a>E4D7   85 AB      STA $AB
 <a name=E4D9></a>E4D9   60         RTS
 
 <A name=E4DA>
 ; clear byte in color ram
 </A>
 <a name=E4DA></a>E4DA   AD 86 02   LDA $0286
 <a name=E4DD></a>E4DD   91 F3      STA ($F3),Y
 <a name=E4DF></a>E4DF   60         RTS
 
 <A name=E4E0>
 ; pause after finding a file on casette
 </A>
 <a name=E4E0></a>E4E0   69 02      ADC #$02
 <a name=E4E2></a>E4E2   A4 91      LDY $91
 <a name=E4E4></a>E4E4   C8         INY
 <a name=E4E5></a>E4E5   D0 04      BNE $E4EB
 <a name=E4E7></a>E4E7   C5 A1      CMP $A1
 <a name=E4E9></a>E4E9   D0 F7      BNE $E4E2
 <a name=E4EB></a>E4EB   60         RTS
 
 <A name=E4EC>
 ; baud rate factor table
 </A>
 <a name=E4EC></a>E4EC   .WD $2619   ; 50
 <a name=E4EE></a>E4EE   .WD $1944   ; 75
 <a name=E4F0></a>E4F0   .WD $111A   ; 110
 <a name=E4F2></a>E4F2   .WD $0DE8   ; 134.5
 <a name=E4F4></a>E4F4   .WD $0C70   ; 150
 <a name=E4F6></a>E4F6   .WD $0606   ; 300
 <a name=E4F8></a>E4F8   .WD $02D1   ; 600
 <a name=E4FA></a>E4FA   .WD $0137   ; 1200
 <a name=E4FC></a>E4FC   .WD $00AE   ; 1800
 <a name=E4FE></a>E4FE   .WD $0069   ; 2400
 
 <A name=E500>
 ; read base address of I/O device into XY
 </A>
 <a name=E500></a>E500   A2 00      LDX #$00   ; low  DC00
 <a name=E502></a>E502   A0 DC      LDY #$DC   ; high DC00
 <a name=E504></a>E504   60         RTS
 
 <A name=E505>
 ; read screen size
 </A>
 <a name=E505></a>E505   A2 28      LDX #$28   ; 40 columns
 <a name=E507></a>E507   A0 19      LDY #$19   ; 25 rows
 <a name=E509></a>E509   60         RTS
 
 <A name=E50A>
 ; read/set XY cursor position
 </A>
 <a name=E50A></a>E50A   B0 07      BCS $E513
 <a name=E50C></a>E50C   86 D6      STX $D6
 <a name=E50E></a>E50E   84 D3      STY $D3
 <a name=E510></a>E510   20 6C E5   JSR $<A href="#E56C">E56C</A>
 <a name=E513></a>E513   A6 D6      LDX $D6
 <a name=E515></a>E515   A4 D3      LDY $D3
 <a name=E517></a>E517   60         RTS
 
 <A name=E518>
 ; initialise screen and keyboard
 </A>
 <a name=E518></a>E518   20 A0 E5   JSR $<A href="#E5A0">E5A0</A>
 <a name=E51B></a>E51B   A9 00      LDA #$00
 <a name=E51D></a>E51D   8D 91 02   STA $0291
 <a name=E520></a>E520   85 CF      STA $CF
 <a name=E522></a>E522   A9 48      LDA #$48   ; low  EB48
 <a name=E524></a>E524   8D 8F 02   STA $028F
 <a name=E527></a>E527   A9 EB      LDA #$EB   ; high EB48
 <a name=E529></a>E529   8D 90 02   STA $0290
 <a name=E52C></a>E52C   A9 0A      LDA #$0A
 <a name=E52E></a>E52E   8D 89 02   STA $0289
 <a name=E531></a>E531   8D 8C 02   STA $028C
 <a name=E534></a>E534   A9 0E      LDA #$0E
 <a name=E536></a>E536   8D 86 02   STA $0286
 <a name=E539></a>E539   A9 04      LDA #$04
 <a name=E53B></a>E53B   8D 8B 02   STA $028B
 <a name=E53E></a>E53E   A9 0C      LDA #$0C
 <a name=E540></a>E540   85 CD      STA $CD
 <a name=E542></a>E542   85 CC      STA $CC
 <A name=E544>
 <a name=E544></a>E544   AD 88 02   LDA $0288
 </A>
 <a name=E547></a>E547   09 80      ORA #$80
 <a name=E549></a>E549   A8         TAY
 <a name=E54A></a>E54A   A9 00      LDA #$00
 <a name=E54C></a>E54C   AA         TAX
 <a name=E54D></a>E54D   94 D9      STY $D9,X
 <a name=E54F></a>E54F   18         CLC
 <a name=E550></a>E550   69 28      ADC #$28
 <a name=E552></a>E552   90 01      BCC $E555
 <a name=E554></a>E554   C8         INY
 <a name=E555></a>E555   E8         INX
 <a name=E556></a>E556   E0 1A      CPX #$1A
 <a name=E558></a>E558   D0 F3      BNE $E54D
 <a name=E55A></a>E55A   A9 FF      LDA #$FF
 <a name=E55C></a>E55C   95 D9      STA $D9,X
 <a name=E55E></a>E55E   A2 18      LDX #$18
 <a name=E560></a>E560   20 FF E9   JSR $<A href="#E9FF">E9FF</A>
 <a name=E563></a>E563   CA         DEX
 <a name=E564></a>E564   10 FA      BPL $E560
 <A name=E566>
 <a name=E566></a>E566   A0 00      LDY #$00
 </A>
 <a name=E568></a>E568   84 D3      STY $D3
 <a name=E56A></a>E56A   84 D6      STY $D6
 
 <A name=E56C>
 ; set address of curent screen line
 </A>
 <a name=E56C></a>E56C   A6 D6      LDX $D6
 <a name=E56E></a>E56E   A5 D3      LDA $D3
 <a name=E570></a>E570   B4 D9      LDY $D9,X
 <a name=E572></a>E572   30 08      BMI $E57C
 <a name=E574></a>E574   18         CLC
 <a name=E575></a>E575   69 28      ADC #$28
 <a name=E577></a>E577   85 D3      STA $D3
 <a name=E579></a>E579   CA         DEX
 <a name=E57A></a>E57A   10 F4      BPL $E570
 <a name=E57C></a>E57C   20 F0 E9   JSR $<A href="#E9F0">E9F0</A>
 <a name=E57F></a>E57F   A9 27      LDA #$27
 <a name=E581></a>E581   E8         INX
 <a name=E582></a>E582   B4 D9      LDY $D9,X
 <a name=E584></a>E584   30 06      BMI $E58C
 <a name=E586></a>E586   18         CLC
 <a name=E587></a>E587   69 28      ADC #$28
 <a name=E589></a>E589   E8         INX
 <a name=E58A></a>E58A   10 F6      BPL $E582
 <a name=E58C></a>E58C   85 D5      STA $D5
 <a name=E58E></a>E58E   4C 24 EA   JMP $<A href="#EA24">EA24</A>
 <A name=E591>
 <a name=E591></a>E591   E4 C9      CPX $C9
 </A>
 <a name=E593></a>E593   F0 03      BEQ $E598
 <a name=E595></a>E595   4C ED E6   JMP $<A href="#E6ED">E6ED</A>
 <a name=E598></a>E598   60         RTS
 
 <a name=E599></a>E599   EA         NOP
 
 <A name=E59A>
 ; this code is unused by kernel
 ; since no other part of the
 ; rom jumps to this location!
 </A>
 <a name=E59A></a>E59A   20 A0 E5   JSR $<A href="#E5A0">E5A0</A>
 <a name=E59D></a>E59D   4C 66 E5   JMP $<A href="#E566">E566</A>
 
 <A name=E5A0>
 ; initialise vic chip
 </A>
 <a name=E5A0></a>E5A0   A9 03      LDA #$03
 <a name=E5A2></a>E5A2   85 9A      STA $9A
 <a name=E5A4></a>E5A4   A9 00      LDA #$00
 <a name=E5A6></a>E5A6   85 99      STA $99
 <a name=E5A8></a>E5A8   A2 2F      LDX #$2F
 <a name=E5AA></a>E5AA   BD B8 EC   LDA $ECB8,X
 <a name=E5AD></a>E5AD   9D FF CF   STA $CFFF,X
 <a name=E5B0></a>E5B0   CA         DEX
 <a name=E5B1></a>E5B1   D0 F7      BNE $E5AA
 <a name=E5B3></a>E5B3   60         RTS
 
 <A name=E5B4>
 ; get character from keyboard buffer
 </A>
 <a name=E5B4></a>E5B4   AC 77 02   LDY $0277
 <a name=E5B7></a>E5B7   A2 00      LDX #$00
 <a name=E5B9></a>E5B9   BD 78 02   LDA $0278,X
 <a name=E5BC></a>E5BC   9D 77 02   STA $0277,X
 <a name=E5BF></a>E5BF   E8         INX
 <a name=E5C0></a>E5C0   E4 C6      CPX $C6
 <a name=E5C2></a>E5C2   D0 F5      BNE $E5B9
 <a name=E5C4></a>E5C4   C6 C6      DEC $C6
 <a name=E5C6></a>E5C6   98         TYA
 <a name=E5C7></a>E5C7   58         CLI
 <a name=E5C8></a>E5C8   18         CLC
 <a name=E5C9></a>E5C9   60         RTS
 
 ; wait for return for keyboard
 <a name=E5CA></a>E5CA   20 16 E7   JSR $<A href="#E716">E716</A>
 <a name=E5CD></a>E5CD   A5 C6      LDA $C6
 <a name=E5CF></a>E5CF   85 CC      STA $CC
 <a name=E5D1></a>E5D1   8D 92 02   STA $0292
 <a name=E5D4></a>E5D4   F0 F7      BEQ $E5CD
 <a name=E5D6></a>E5D6   78         SEI
 <a name=E5D7></a>E5D7   A5 CF      LDA $CF
 <a name=E5D9></a>E5D9   F0 0C      BEQ $E5E7
 <a name=E5DB></a>E5DB   A5 CE      LDA $CE
 <a name=E5DD></a>E5DD   AE 87 02   LDX $0287
 <a name=E5E0></a>E5E0   A0 00      LDY #$00
 <a name=E5E2></a>E5E2   84 CF      STY $CF
 <a name=E5E4></a>E5E4   20 13 EA   JSR $<A href="#EA13">EA13</A>
 <a name=E5E7></a>E5E7   20 B4 E5   JSR $<A href="#E5B4">E5B4</A>
 <a name=E5EA></a>E5EA   C9 83      CMP #$83
 <a name=E5EC></a>E5EC   D0 10      BNE $E5FE
 <a name=E5EE></a>E5EE   A2 09      LDX #$09
 <a name=E5F0></a>E5F0   78         SEI
 <a name=E5F1></a>E5F1   86 C6      STX $C6
 <a name=E5F3></a>E5F3   BD E6 EC   LDA $ECE6,X
 <a name=E5F6></a>E5F6   9D 76 02   STA $0276,X
 <a name=E5F9></a>E5F9   CA         DEX
 <a name=E5FA></a>E5FA   D0 F7      BNE $E5F3
 <a name=E5FC></a>E5FC   F0 CF      BEQ $E5CD
 <a name=E5FE></a>E5FE   C9 0D      CMP #$0D
 <a name=E600></a>E600   D0 C8      BNE $E5CA
 <a name=E602></a>E602   A4 D5      LDY $D5
 <a name=E604></a>E604   84 D0      STY $D0
 <a name=E606></a>E606   B1 D1      LDA ($D1),Y
 <a name=E608></a>E608   C9 20      CMP #$20
 <a name=E60A></a>E60A   D0 03      BNE $E60F
 <a name=E60C></a>E60C   88         DEY
 <a name=E60D></a>E60D   D0 F7      BNE $E606
 <a name=E60F></a>E60F   C8         INY
 <a name=E610></a>E610   84 C8      STY $C8
 <a name=E612></a>E612   A0 00      LDY #$00
 <a name=E614></a>E614   8C 92 02   STY $0292
 <a name=E617></a>E617   84 D3      STY $D3
 <a name=E619></a>E619   84 D4      STY $D4
 <a name=E61B></a>E61B   A5 C9      LDA $C9
 <a name=E61D></a>E61D   30 1B      BMI $E63A
 <a name=E61F></a>E61F   A6 D6      LDX $D6
 <a name=E621></a>E621   20 91 E5   JSR $<A href="#E591">E591</A>
 <a name=E624></a>E624   E4 C9      CPX $C9
 <a name=E626></a>E626   D0 12      BNE $E63A
 <a name=E628></a>E628   A5 CA      LDA $CA
 <a name=E62A></a>E62A   85 D3      STA $D3
 <a name=E62C></a>E62C   C5 C8      CMP $C8
 <a name=E62E></a>E62E   90 0A      BCC $E63A
 <a name=E630></a>E630   B0 2B      BCS $E65D
 
 <A name=E632>
 ; get character from device 0 or 3
 </A>
 <a name=E632></a>E632   98         TYA
 <a name=E633></a>E633   48         PHA
 <a name=E634></a>E634   8A         TXA
 <a name=E635></a>E635   48         PHA
 <a name=E636></a>E636   A5 D0      LDA $D0
 <a name=E638></a>E638   F0 93      BEQ $E5CD
 
 <A name=E63A>
 ; get character from current screen line
 </A>
 <a name=E63A></a>E63A   A4 D3      LDY $D3
 <a name=E63C></a>E63C   B1 D1      LDA ($D1),Y
 <a name=E63E></a>E63E   85 D7      STA $D7
 <a name=E640></a>E640   29 3F      AND #$3F
 <a name=E642></a>E642   06 D7      ASL $D7
 <a name=E644></a>E644   24 D7      BIT $D7
 <a name=E646></a>E646   10 02      BPL $E64A
 <a name=E648></a>E648   09 80      ORA #$80
 <a name=E64A></a>E64A   90 04      BCC $E650
 <a name=E64C></a>E64C   A6 D4      LDX $D4
 <a name=E64E></a>E64E   D0 04      BNE $E654
 <a name=E650></a>E650   70 02      BVS $E654
 <a name=E652></a>E652   09 40      ORA #$40
 <a name=E654></a>E654   E6 D3      INC $D3
 <a name=E656></a>E656   20 84 E6   JSR $<A href="#E684">E684</A>
 <a name=E659></a>E659   C4 C8      CPY $C8
 <a name=E65B></a>E65B   D0 17      BNE $E674
 <a name=E65D></a>E65D   A9 00      LDA #$00
 <a name=E65F></a>E65F   85 D0      STA $D0
 <a name=E661></a>E661   A9 0D      LDA #$0D
 <a name=E663></a>E663   A6 99      LDX $99
 <a name=E665></a>E665   E0 03      CPX #$03
 <a name=E667></a>E667   F0 06      BEQ $E66F
 <a name=E669></a>E669   A6 9A      LDX $9A
 <a name=E66B></a>E66B   E0 03      CPX #$03
 <a name=E66D></a>E66D   F0 03      BEQ $E672
 <a name=E66F></a>E66F   20 16 E7   JSR $<A href="#E716">E716</A>
 <a name=E672></a>E672   A9 0D      LDA #$0D
 <a name=E674></a>E674   85 D7      STA $D7
 <a name=E676></a>E676   68         PLA
 <a name=E677></a>E677   AA         TAX
 <a name=E678></a>E678   68         PLA
 <a name=E679></a>E679   A8         TAY
 <a name=E67A></a>E67A   A5 D7      LDA $D7
 <a name=E67C></a>E67C   C9 DE      CMP #$DE   ; screen PI code
 <a name=E67E></a>E67E   D0 02      BNE $E682
 <a name=E680></a>E680   A9 FF      LDA #$FF   ; petscii PI code
 <a name=E682></a>E682   18         CLC
 <a name=E683></a>E683   60         RTS
 
 <A name=E684>
 ; check for quote mark and set flag
 </A>
 <a name=E684></a>E684   C9 22      CMP #$22   ; quote mark
 <a name=E686></a>E686   D0 08      BNE $E690
 <a name=E688></a>E688   A5 D4      LDA $D4
 <a name=E68A></a>E68A   49 01      EOR #$01
 <a name=E68C></a>E68C   85 D4      STA $D4
 <a name=E68E></a>E68E   A9 22      LDA #$22   ; quote mark
 <a name=E690></a>E690   60         RTS
 
 <A name=E691>
 ; fill screen at current position
 </A>
 <a name=E691></a>E691   09 40      ORA #$40
 <A name=E693>
 <a name=E693></a>E693   A6 C7      LDX $C7
 </A>
 <a name=E695></a>E695   F0 02      BEQ $E699
 <A name=E697>
 <a name=E697></a>E697   09 80      ORA #$80
 </A>
 <a name=E699></a>E699   A6 D8      LDX $D8
 <a name=E69B></a>E69B   F0 02      BEQ $E69F
 <a name=E69D></a>E69D   C6 D8      DEC $D8
 <a name=E69F></a>E69F   AE 86 02   LDX $0286
 <a name=E6A2></a>E6A2   20 13 EA   JSR $<A href="#EA13">EA13</A>
 <a name=E6A5></a>E6A5   20 B6 E6   JSR $<A href="#E6B6">E6B6</A>
 
 <A name=E6A8>
 ; return from output to the screen
 </A>
 <a name=E6A8></a>E6A8   68         PLA
 <a name=E6A9></a>E6A9   A8         TAY
 <a name=E6AA></a>E6AA   A5 D8      LDA $D8
 <a name=E6AC></a>E6AC   F0 02      BEQ $E6B0
 <a name=E6AE></a>E6AE   46 D4      LSR $D4
 <a name=E6B0></a>E6B0   68         PLA
 <a name=E6B1></a>E6B1   AA         TAX
 <a name=E6B2></a>E6B2   68         PLA
 <a name=E6B3></a>E6B3   18         CLC
 <a name=E6B4></a>E6B4   58         CLI
 <a name=E6B5></a>E6B5   60         RTS
 
 <A name=E6B6>
 ; get/insert new line
 </A>
 <a name=E6B6></a>E6B6   20 B3 E8   JSR $<A href="#E8B3">E8B3</A>
 <a name=E6B9></a>E6B9   E6 D3      INC $D3
 <a name=E6BB></a>E6BB   A5 D5      LDA $D5
 <a name=E6BD></a>E6BD   C5 D3      CMP $D3
 <a name=E6BF></a>E6BF   B0 3F      BCS $E700
 <a name=E6C1></a>E6C1   C9 4F      CMP #$4F
 <a name=E6C3></a>E6C3   F0 32      BEQ $E6F7
 <a name=E6C5></a>E6C5   AD 92 02   LDA $0292
 <a name=E6C8></a>E6C8   F0 03      BEQ $E6CD
 <a name=E6CA></a>E6CA   4C 67 E9   JMP $<A href="#E967">E967</A>
 
 <a name=E6CD></a>E6CD   A6 D6      LDX $D6
 <a name=E6CF></a>E6CF   E0 19      CPX #$19
 <a name=E6D1></a>E6D1   90 07      BCC $E6DA
 <a name=E6D3></a>E6D3   20 EA E8   JSR $<A href="#E8EA">E8EA</A>
 <a name=E6D6></a>E6D6   C6 D6      DEC $D6
 <a name=E6D8></a>E6D8   A6 D6      LDX $D6
 <A name=E6DA>
 <a name=E6DA></a>E6DA   16 D9      ASL $D9,X
 </A>
 <a name=E6DC></a>E6DC   56 D9      LSR $D9,X
 <a name=E6DE></a>E6DE   E8         INX
 <a name=E6DF></a>E6DF   B5 D9      LDA $D9,X
 <a name=E6E1></a>E6E1   09 80      ORA #$80
 <a name=E6E3></a>E6E3   95 D9      STA $D9,X
 <a name=E6E5></a>E6E5   CA         DEX
 <a name=E6E6></a>E6E6   A5 D5      LDA $D5
 <a name=E6E8></a>E6E8   18         CLC
 <a name=E6E9></a>E6E9   69 28      ADC #$28
 <a name=E6EB></a>E6EB   85 D5      STA $D5
 <A name=E6ED>
 <a name=E6ED></a>E6ED   B5 D9      LDA $D9,X
 </A>
 <a name=E6EF></a>E6EF   30 03      BMI $E6F4
 <a name=E6F1></a>E6F1   CA         DEX
 <a name=E6F2></a>E6F2   D0 F9      BNE $E6ED
 <a name=E6F4></a>E6F4   4C F0 E9   JMP $<A href="#E9F0">E9F0</A>
 
 <a name=E6F7></a>E6F7   C6 D6      DEC $D6
 <a name=E6F9></a>E6F9   20 7C E8   JSR $<A href="#E87C">E87C</A>
 <a name=E6FC></a>E6FC   A9 00      LDA #$00
 <a name=E6FE></a>E6FE   85 D3      STA $D3
 <a name=E700></a>E700   60         RTS
 
 <A name=E701>
 ; move backwards over a line boundary
 </A>
 <a name=E701></a>E701   A6 D6      LDX $D6
 <a name=E703></a>E703   D0 06      BNE $E70B
 <a name=E705></a>E705   86 D3      STX $D3
 <a name=E707></a>E707   68         PLA
 <a name=E708></a>E708   68         PLA
 <a name=E709></a>E709   D0 9D      BNE $E6A8
 <a name=E70B></a>E70B   CA         DEX
 <a name=E70C></a>E70C   86 D6      STX $D6
 <a name=E70E></a>E70E   20 6C E5   JSR $<A href="#E56C">E56C</A>
 <a name=E711></a>E711   A4 D5      LDY $D5
 <a name=E713></a>E713   84 D3      STY $D3
 <a name=E715></a>E715   60         RTS
 
 <A name=E716>
 ; put a character to screen
 </A>
 <a name=E716></a>E716   48         PHA
 <a name=E717></a>E717   85 D7      STA $D7
 <a name=E719></a>E719   8A         TXA
 <a name=E71A></a>E71A   48         PHA
 <a name=E71B></a>E71B   98         TYA
 <a name=E71C></a>E71C   48         PHA
 <a name=E71D></a>E71D   A9 00      LDA #$00
 <a name=E71F></a>E71F   85 D0      STA $D0
 <a name=E721></a>E721   A4 D3      LDY $D3
 <a name=E723></a>E723   A5 D7      LDA $D7
 <a name=E725></a>E725   10 03      BPL $E72A
 <a name=E727></a>E727   4C D4 E7   JMP $<A href="#E7D4">E7D4</A>
 
 <a name=E72A></a>E72A   C9 0D      CMP #$0D             ; return code
 <a name=E72C></a>E72C   D0 03      BNE $E731
 <a name=E72E></a>E72E   4C 91 E8   JMP $<A href="#E891">E891</A>
 
 <a name=E731></a>E731   C9 20      CMP #$20
 <a name=E733></a>E733   90 10      BCC $E745
 <a name=E735></a>E735   C9 60      CMP #$60
 <a name=E737></a>E737   90 04      BCC $E73D
 <a name=E739></a>E739   29 DF      AND #$DF
 <a name=E73B></a>E73B   D0 02      BNE $E73F
 <a name=E73D></a>E73D   29 3F      AND #$3F
 <a name=E73F></a>E73F   20 84 E6   JSR $<A href="#E684">E684</A>
 <a name=E742></a>E742   4C 93 E6   JMP $<A href="#E693">E693</A>
 
 <a name=E745></a>E745   A6 D8      LDX $D8
 <a name=E747></a>E747   F0 03      BEQ $E74C
 <a name=E749></a>E749   4C 97 E6   JMP $<A href="#E697">E697</A>
 
 <a name=E74C></a>E74C   C9 14      CMP #$14             ; delete code
 <a name=E74E></a>E74E   D0 2E      BNE $E77E
 <a name=E750></a>E750   98         TYA
 <a name=E751></a>E751   D0 06      BNE $E759
 <a name=E753></a>E753   20 01 E7   JSR $<A href="#E701">E701</A>
 <a name=E756></a>E756   4C 73 E7   JMP $<A href="#E773">E773</A>
 
 <a name=E759></a>E759   20 A1 E8   JSR $<A href="#E8A1">E8A1</A>
 <a name=E75C></a>E75C   88         DEY
 <a name=E75D></a>E75D   84 D3      STY $D3
 <a name=E75F></a>E75F   20 24 EA   JSR $<A href="#EA24">EA24</A>
 <a name=E762></a>E762   C8         INY
 <a name=E763></a>E763   B1 D1      LDA ($D1),Y
 <a name=E765></a>E765   88         DEY
 <a name=E766></a>E766   91 D1      STA ($D1),Y
 <a name=E768></a>E768   C8         INY
 <a name=E769></a>E769   B1 F3      LDA ($F3),Y
 <a name=E76B></a>E76B   88         DEY
 <a name=E76C></a>E76C   91 F3      STA ($F3),Y
 <a name=E76E></a>E76E   C8         INY
 <a name=E76F></a>E76F   C4 D5      CPY $D5
 <a name=E771></a>E771   D0 EF      BNE $E762
 <A name=E773>
 <a name=E773></a>E773   A9 20      LDA #$20   ; space
 </A>
 <a name=E775></a>E775   91 D1      STA ($D1),Y
 <a name=E777></a>E777   AD 86 02   LDA $0286
 <a name=E77A></a>E77A   91 F3      STA ($F3),Y
 <a name=E77C></a>E77C   10 4D      BPL $E7CB
 <a name=E77E></a>E77E   A6 D4      LDX $D4
 <a name=E780></a>E780   F0 03      BEQ $E785
 <a name=E782></a>E782   4C 97 E6   JMP $<A href="#E697">E697</A>
 
 <a name=E785></a>E785   C9 12      CMP #$12   ;  reverse code
 <a name=E787></a>E787   D0 02      BNE $E78B
 <a name=E789></a>E789   85 C7      STA $C7
 <a name=E78B></a>E78B   C9 13      CMP #$13   ; home code
 <a name=E78D></a>E78D   D0 03      BNE $E792
 <a name=E78F></a>E78F   20 66 E5   JSR $<A href="#E566">E566</A>
 <a name=E792></a>E792   C9 1D      CMP #$1D   ; csr right
 <a name=E794></a>E794   D0 17      BNE $E7AD
 <a name=E796></a>E796   C8         INY
 <a name=E797></a>E797   20 B3 E8   JSR $<A href="#E8B3">E8B3</A>
 <a name=E79A></a>E79A   84 D3      STY $D3
 <a name=E79C></a>E79C   88         DEY
 <a name=E79D></a>E79D   C4 D5      CPY $D5
 <a name=E79F></a>E79F   90 09      BCC $E7AA
 <a name=E7A1></a>E7A1   C6 D6      DEC $D6
 <a name=E7A3></a>E7A3   20 7C E8   JSR $<A href="#E87C">E87C</A>
 <a name=E7A6></a>E7A6   A0 00      LDY #$00
 <a name=E7A8></a>E7A8   84 D3      STY $D3
 <a name=E7AA></a>E7AA   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <a name=E7AD></a>E7AD   C9 11      CMP #$11   ; csr down
 <a name=E7AF></a>E7AF   D0 1D      BNE $E7CE
 <a name=E7B1></a>E7B1   18         CLC
 <a name=E7B2></a>E7B2   98         TYA
 <a name=E7B3></a>E7B3   69 28      ADC #$28
 <a name=E7B5></a>E7B5   A8         TAY
 <a name=E7B6></a>E7B6   E6 D6      INC $D6
 <a name=E7B8></a>E7B8   C5 D5      CMP $D5
 <a name=E7BA></a>E7BA   90 EC      BCC $E7A8
 <a name=E7BC></a>E7BC   F0 EA      BEQ $E7A8
 <a name=E7BE></a>E7BE   C6 D6      DEC $D6
 <a name=E7C0></a>E7C0   E9 28      SBC #$28
 <a name=E7C2></a>E7C2   90 04      BCC $E7C8
 <a name=E7C4></a>E7C4   85 D3      STA $D3
 <a name=E7C6></a>E7C6   D0 F8      BNE $E7C0
 <a name=E7C8></a>E7C8   20 7C E8   JSR $<A href="#E87C">E87C</A>
 <a name=E7CB></a>E7CB   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <a name=E7CE></a>E7CE   20 CB E8   JSR $<A href="#E8CB">E8CB</A>
 <a name=E7D1></a>E7D1   4C 44 EC   JMP $<A href="#EC44">EC44</A>
 
 <A name=E7D4>
 ; put shifted chars to screen
 </A>
 <a name=E7D4></a>E7D4   29 7F      AND #$7F   ; remove shift bit
 <a name=E7D6></a>E7D6   C9 7F      CMP #$7F   ; code for PI
 <a name=E7D8></a>E7D8   D0 02      BNE $E7DC
 <a name=E7DA></a>E7DA   A9 5E      LDA #$5E   ; screen PI
 <a name=E7DC></a>E7DC   C9 20      CMP #$20
 <a name=E7DE></a>E7DE   90 03      BCC $E7E3
 <a name=E7E0></a>E7E0   4C 91 E6   JMP $<A href="#E691">E691</A>
 
 <a name=E7E3></a>E7E3   C9 0D      CMP #$0D   ; shift return
 <a name=E7E5></a>E7E5   D0 03      BNE $E7EA
 <a name=E7E7></a>E7E7   4C 91 E8   JMP $<A href="#E891">E891</A>
 <a name=E7EA></a>E7EA   A6 D4      LDX $D4
 <a name=E7EC></a>E7EC   D0 3F      BNE $E82D
 <a name=E7EE></a>E7EE   C9 14      CMP #$14   ; insert
 <a name=E7F0></a>E7F0   D0 37      BNE $E829
 <a name=E7F2></a>E7F2   A4 D5      LDY $D5
 <a name=E7F4></a>E7F4   B1 D1      LDA ($D1),Y
 <a name=E7F6></a>E7F6   C9 20      CMP #$20
 <a name=E7F8></a>E7F8   D0 04      BNE $E7FE
 <a name=E7FA></a>E7FA   C4 D3      CPY $D3
 <a name=E7FC></a>E7FC   D0 07      BNE $E805
 <a name=E7FE></a>E7FE   C0 4F      CPY #$4F
 <a name=E800></a>E800   F0 24      BEQ $E826
 <a name=E802></a>E802   20 65 E9   JSR $<A href="#E965">E965</A>
 <a name=E805></a>E805   A4 D5      LDY $D5
 <a name=E807></a>E807   20 24 EA   JSR $<A href="#EA24">EA24</A>
 <a name=E80A></a>E80A   88         DEY
 <a name=E80B></a>E80B   B1 D1      LDA ($D1),Y
 <a name=E80D></a>E80D   C8         INY
 <a name=E80E></a>E80E   91 D1      STA ($D1),Y
 <a name=E810></a>E810   88         DEY
 <a name=E811></a>E811   B1 F3      LDA ($F3),Y
 <a name=E813></a>E813   C8         INY
 <a name=E814></a>E814   91 F3      STA ($F3),Y
 <a name=E816></a>E816   88         DEY
 <a name=E817></a>E817   C4 D3      CPY $D3
 <a name=E819></a>E819   D0 EF      BNE $E80A
 <a name=E81B></a>E81B   A9 20      LDA #$20
 <a name=E81D></a>E81D   91 D1      STA ($D1),Y
 <a name=E81F></a>E81F   AD 86 02   LDA $0286
 <a name=E822></a>E822   91 F3      STA ($F3),Y
 <a name=E824></a>E824   E6 D8      INC $D8
 <a name=E826></a>E826   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <a name=E829></a>E829   A6 D8      LDX $D8
 <a name=E82B></a>E82B   F0 05      BEQ $E832
 <a name=E82D></a>E82D   09 40      ORA #$40
 <a name=E82F></a>E82F   4C 97 E6   JMP $<A href="#E697">E697</A>
 
 <a name=E832></a>E832   C9 11      CMP #$11   ; csr up
 <a name=E834></a>E834   D0 16      BNE $E84C
 <a name=E836></a>E836   A6 D6      LDX $D6
 <a name=E838></a>E838   F0 37      BEQ $E871
 <a name=E83A></a>E83A   C6 D6      DEC $D6
 <a name=E83C></a>E83C   A5 D3      LDA $D3
 <a name=E83E></a>E83E   38         SEC
 <a name=E83F></a>E83F   E9 28      SBC #$28
 <a name=E841></a>E841   90 04      BCC $E847
 <a name=E843></a>E843   85 D3      STA $D3
 <a name=E845></a>E845   10 2A      BPL $E871
 <a name=E847></a>E847   20 6C E5   JSR $<A href="#E56C">E56C</A>
 <a name=E84A></a>E84A   D0 25      BNE $E871
 <a name=E84C></a>E84C   C9 12      CMP #$12    ; reverse off
 <a name=E84E></a>E84E   D0 04      BNE $E854
 <a name=E850></a>E850   A9 00      LDA #$00
 <a name=E852></a>E852   85 C7      STA $C7
 <a name=E854></a>E854   C9 1D      CMP #$1D   ; csr left
 <a name=E856></a>E856   D0 12      BNE $E86A
 <a name=E858></a>E858   98         TYA
 <a name=E859></a>E859   F0 09      BEQ $E864
 <a name=E85B></a>E85B   20 A1 E8   JSR $<A href="#E8A1">E8A1</A>
 <a name=E85E></a>E85E   88         DEY
 <a name=E85F></a>E85F   84 D3      STY $D3
 <a name=E861></a>E861   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <a name=E864></a>E864   20 01 E7   JSR $<A href="#E701">E701</A>
 <a name=E867></a>E867   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <a name=E86A></a>E86A   C9 13      CMP #$13   ; clr code
 <a name=E86C></a>E86C   D0 06      BNE $E874
 <a name=E86E></a>E86E   20 44 E5   JSR $<A href="#E544">E544</A>
 <a name=E871></a>E871   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <a name=E874></a>E874   09 80      ORA #$80
 <a name=E876></a>E876   20 CB E8   JSR $<A href="#E8CB">E8CB</A>
 <a name=E879></a>E879   4C 4F EC   JMP $<A href="#EC4F">EC4F</A>
 
 <A name=E87C>
 ; set next line number
 </A>
 <a name=E87C></a>E87C   46 C9      LSR $C9
 <a name=E87E></a>E87E   A6 D6      LDX $D6
 <a name=E880></a>E880   E8         INX
 <a name=E881></a>E881   E0 19      CPX #$19
 <a name=E883></a>E883   D0 03      BNE $E888
 <a name=E885></a>E885   20 EA E8   JSR $<A href="#E8EA">E8EA</A>
 <a name=E888></a>E888   B5 D9      LDA $D9,X
 <a name=E88A></a>E88A   10 F4      BPL $E880
 <a name=E88C></a>E88C   86 D6      STX $D6
 <a name=E88E></a>E88E   4C 6C E5   JMP $<A href="#E56C">E56C</A>
 
 <A name=E891>
 ; action for return
 </A>
 <a name=E891></a>E891   A2 00      LDX #$00
 <a name=E893></a>E893   86 D8      STX $D8
 <a name=E895></a>E895   86 C7      STX $C7
 <a name=E897></a>E897   86 D4      STX $D4
 <a name=E899></a>E899   86 D3      STX $D3
 <a name=E89B></a>E89B   20 7C E8   JSR $<A href="#E87C">E87C</A>
 <a name=E89E></a>E89E   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <A name=E8A1>
 ; move cursor to previous line if
 ; at start of line
 </A>
 <a name=E8A1></a>E8A1   A2 02      LDX #$02
 <a name=E8A3></a>E8A3   A9 00      LDA #$00
 <a name=E8A5></a>E8A5   C5 D3      CMP $D3
 <a name=E8A7></a>E8A7   F0 07      BEQ $E8B0
 <a name=E8A9></a>E8A9   18         CLC
 <a name=E8AA></a>E8AA   69 28      ADC #$28
 <a name=E8AC></a>E8AC   CA         DEX
 <a name=E8AD></a>E8AD   D0 F6      BNE $E8A5
 <a name=E8AF></a>E8AF   60         RTS
 
 <a name=E8B0></a>E8B0   C6 D6      DEC $D6
 <a name=E8B2></a>E8B2   60         RTS
 
 <A name=E8B3>
 ; move cursor to next line if
 ; at end of line
 </A>
 <a name=E8B3></a>E8B3   A2 02      LDX #$02
 <a name=E8B5></a>E8B5   A9 27      LDA #$27
 <a name=E8B7></a>E8B7   C5 D3      CMP $D3
 <a name=E8B9></a>E8B9   F0 07      BEQ $E8C2
 <a name=E8BB></a>E8BB   18         CLC
 <a name=E8BC></a>E8BC   69 28      ADC #$28
 <a name=E8BE></a>E8BE   CA         DEX
 <a name=E8BF></a>E8BF   D0 F6      BNE $E8B7
 <a name=E8C1></a>E8C1   60         RTS
 
 <a name=E8C2></a>E8C2   A6 D6      LDX $D6
 <a name=E8C4></a>E8C4   E0 19      CPX #$19
 <a name=E8C6></a>E8C6   F0 02      BEQ $E8CA
 <a name=E8C8></a>E8C8   E6 D6      INC $D6
 <a name=E8CA></a>E8CA   60         RTS
 
 <A name=E8CB>
 ; check for colour change codes
 </A>
 <a name=E8CB></a>E8CB   A2 0F      LDX #$0F
 <a name=E8CD></a>E8CD   DD DA E8   CMP $<A href="#E8DA">E8DA</A>,X
 <a name=E8D0></a>E8D0   F0 04      BEQ $E8D6
 <a name=E8D2></a>E8D2   CA         DEX
 <a name=E8D3></a>E8D3   10 F8      BPL $E8CD
 <a name=E8D5></a>E8D5   60         RTS
 
 <a name=E8D6></a>E8D6   8E 86 02   STX $0286
 <a name=E8D9></a>E8D9   60         RTS
 
 <A name=E8DA>
 ; colour key codes
 </A>
 <a name=E8DA></a>E8DA   .BY $90,$05,$1C,$9F,$9C,$1E,$1F,$9E
 <a name=E8E2></a>E8E2   .BY $81,$95,$96,$97,$98,$99,$9A,$9B
 
 <A name=E8EA>
 ; scroll screen
 </A>
 <a name=E8EA></a>E8EA   A5 AC      LDA $AC
 <a name=E8EC></a>E8EC   48         PHA
 <a name=E8ED></a>E8ED   A5 AD      LDA $AD
 <a name=E8EF></a>E8EF   48         PHA
 <a name=E8F0></a>E8F0   A5 AE      LDA $AE
 <a name=E8F2></a>E8F2   48         PHA
 <a name=E8F3></a>E8F3   A5 AF      LDA $AF
 <a name=E8F5></a>E8F5   48         PHA
 <a name=E8F6></a>E8F6   A2 FF      LDX #$FF
 <a name=E8F8></a>E8F8   C6 D6      DEC $D6
 <a name=E8FA></a>E8FA   C6 C9      DEC $C9
 <a name=E8FC></a>E8FC   CE A5 02   DEC $02A5
 <a name=E8FF></a>E8FF   E8         INX
 <a name=E900></a>E900   20 F0 E9   JSR $<A href="#E9F0">E9F0</A>
 <a name=E903></a>E903   E0 18      CPX #$18
 <a name=E905></a>E905   B0 0C      BCS $E913
 <a name=E907></a>E907   BD F1 EC   LDA $ECF1,X
 <a name=E90A></a>E90A   85 AC      STA $AC
 <a name=E90C></a>E90C   B5 DA      LDA $DA,X
 <a name=E90E></a>E90E   20 C8 E9   JSR $<A href="#E9C8">E9C8</A>
 <a name=E911></a>E911   30 EC      BMI $E8FF
 <a name=E913></a>E913   20 FF E9   JSR $<A href="#E9FF">E9FF</A>
 <a name=E916></a>E916   A2 00      LDX #$00
 <a name=E918></a>E918   B5 D9      LDA $D9,X
 <a name=E91A></a>E91A   29 7F      AND #$7F
 <a name=E91C></a>E91C   B4 DA      LDY $DA,X
 <a name=E91E></a>E91E   10 02      BPL $E922
 <a name=E920></a>E920   09 80      ORA #$80
 <a name=E922></a>E922   95 D9      STA $D9,X
 <a name=E924></a>E924   E8         INX
 <a name=E925></a>E925   E0 18      CPX #$18
 <a name=E927></a>E927   D0 EF      BNE $E918
 <a name=E929></a>E929   A5 F1      LDA $F1
 <a name=E92B></a>E92B   09 80      ORA #$80
 <a name=E92D></a>E92D   85 F1      STA $F1
 <a name=E92F></a>E92F   A5 D9      LDA $D9
 <a name=E931></a>E931   10 C3      BPL $E8F6
 <a name=E933></a>E933   E6 D6      INC $D6
 <a name=E935></a>E935   EE A5 02   INC $02A5
 <a name=E938></a>E938   A9 7F      LDA #$7F
 <a name=E93A></a>E93A   8D 00 DC   STA $DC00
 <a name=E93D></a>E93D   AD 01 DC   LDA $DC01
 <a name=E940></a>E940   C9 FB      CMP #$FB
 <a name=E942></a>E942   08         PHP
 <a name=E943></a>E943   A9 7F      LDA #$7F
 <a name=E945></a>E945   8D 00 DC   STA $DC00
 <a name=E948></a>E948   28         PLP
 <a name=E949></a>E949   D0 0B      BNE $E956
 <a name=E94B></a>E94B   A0 00      LDY #$00
 <a name=E94D></a>E94D   EA         NOP
 <a name=E94E></a>E94E   CA         DEX
 <a name=E94F></a>E94F   D0 FC      BNE $E94D
 <a name=E951></a>E951   88         DEY
 <a name=E952></a>E952   D0 F9      BNE $E94D
 <a name=E954></a>E954   84 C6      STY $C6
 <a name=E956></a>E956   A6 D6      LDX $D6
 <A name=E958>
 <a name=E958></a>E958   68         PLA
 </A>
 <a name=E959></a>E959   85 AF      STA $AF
 <a name=E95B></a>E95B   68         PLA
 <a name=E95C></a>E95C   85 AE      STA $AE
 <a name=E95E></a>E95E   68         PLA
 <a name=E95F></a>E95F   85 AD      STA $AD
 <a name=E961></a>E961   68         PLA
 <a name=E962></a>E962   85 AC      STA $AC
 <a name=E964></a>E964   60         RTS
 
 <A name=E965>
 ; insert blank line in screen
 </A>
 <a name=E965></a>E965   A6 D6      LDX $D6
 <A name=E967>
 <a name=E967></a>E967   E8         INX
 </A>
 <a name=E968></a>E968   B5 D9      LDA $D9,X
 <a name=E96A></a>E96A   10 FB      BPL $E967
 <a name=E96C></a>E96C   8E A5 02   STX $02A5
 <a name=E96F></a>E96F   E0 18      CPX #$18
 <a name=E971></a>E971   F0 0E      BEQ $E981
 <a name=E973></a>E973   90 0C      BCC $E981
 <a name=E975></a>E975   20 EA E8   JSR $<A href="#E8EA">E8EA</A>
 <a name=E978></a>E978   AE A5 02   LDX $02A5
 <a name=E97B></a>E97B   CA         DEX
 <a name=E97C></a>E97C   C6 D6      DEC $D6
 <a name=E97E></a>E97E   4C DA E6   JMP $<A href="#E6DA">E6DA</A>
 
 <a name=E981></a>E981   A5 AC      LDA $AC
 <a name=E983></a>E983   48         PHA
 <a name=E984></a>E984   A5 AD      LDA $AD
 <a name=E986></a>E986   48         PHA
 <a name=E987></a>E987   A5 AE      LDA $AE
 <a name=E989></a>E989   48         PHA
 <a name=E98A></a>E98A   A5 AF      LDA $AF
 <a name=E98C></a>E98C   48         PHA
 <a name=E98D></a>E98D   A2 19      LDX #$19
 <a name=E98F></a>E98F   CA         DEX
 <a name=E990></a>E990   20 F0 E9   JSR $<A href="#E9F0">E9F0</A>
 <a name=E993></a>E993   EC A5 02   CPX $02A5
 <a name=E996></a>E996   90 0E      BCC $E9A6
 <a name=E998></a>E998   F0 0C      BEQ $E9A6
 <a name=E99A></a>E99A   BD EF EC   LDA $ECEF,X
 <a name=E99D></a>E99D   85 AC      STA $AC
 <a name=E99F></a>E99F   B5 D8      LDA $D8,X
 <a name=E9A1></a>E9A1   20 C8 E9   JSR $<A href="#E9C8">E9C8</A>
 <a name=E9A4></a>E9A4   30 E9      BMI $E98F
 <a name=E9A6></a>E9A6   20 FF E9   JSR $<A href="#E9FF">E9FF</A>
 <a name=E9A9></a>E9A9   A2 17      LDX #$17
 <a name=E9AB></a>E9AB   EC A5 02   CPX $02A5
 <a name=E9AE></a>E9AE   90 0F      BCC $E9BF
 <a name=E9B0></a>E9B0   B5 DA      LDA $DA,X
 <a name=E9B2></a>E9B2   29 7F      AND #$7F
 <a name=E9B4></a>E9B4   B4 D9      LDY $D9,X
 <a name=E9B6></a>E9B6   10 02      BPL $E9BA
 <a name=E9B8></a>E9B8   09 80      ORA #$80
 <a name=E9BA></a>E9BA   95 DA      STA $DA,X
 <a name=E9BC></a>E9BC   CA         DEX
 <a name=E9BD></a>E9BD   D0 EC      BNE $E9AB
 <a name=E9BF></a>E9BF   AE A5 02   LDX $02A5
 <a name=E9C2></a>E9C2   20 DA E6   JSR $<A href="#E6DA">E6DA</A>
 <a name=E9C5></a>E9C5   4C 58 E9   JMP $<A href="#E958">E958</A>
 
 <A name=E9C8>
 ; move one screen line
 </A>
 <a name=E9C8></a>E9C8   29 03      AND #$03
 <a name=E9CA></a>E9CA   0D 88 02   ORA $0288
 <a name=E9CD></a>E9CD   85 AD      STA $AD
 <a name=E9CF></a>E9CF   20 E0 E9   JSR $<A href="#E9E0">E9E0</A>
 <a name=E9D2></a>E9D2   A0 27      LDY #$27
 <a name=E9D4></a>E9D4   B1 AC      LDA ($AC),Y
 <a name=E9D6></a>E9D6   91 D1      STA ($D1),Y
 <a name=E9D8></a>E9D8   B1 AE      LDA ($AE),Y
 <a name=E9DA></a>E9DA   91 F3      STA ($F3),Y
 <a name=E9DC></a>E9DC   88         DEY
 <a name=E9DD></a>E9DD   10 F5      BPL $E9D4
 <a name=E9DF></a>E9DF   60         RTS
 
 <A name=E9E0>
 ; set colour and screen addresses
 </A>
 <a name=E9E0></a>E9E0   20 24 EA   JSR $<A href="#EA24">EA24</A>
 <a name=E9E3></a>E9E3   A5 AC      LDA $AC
 <a name=E9E5></a>E9E5   85 AE      STA $AE
 <a name=E9E7></a>E9E7   A5 AD      LDA $AD
 <a name=E9E9></a>E9E9   29 03      AND #$03
 <a name=E9EB></a>E9EB   09 D8      ORA #$D8
 <a name=E9ED></a>E9ED   85 AF      STA $AF
 <a name=E9EF></a>E9EF   60         RTS
 
 <A name=E9F0>
 ; fetch screen addresses
 </A>
 <a name=E9F0></a>E9F0   BD F0 EC   LDA $<A href="#ECF0">ECF0</A>,X
 <a name=E9F3></a>E9F3   85 D1      STA $D1
 <a name=E9F5></a>E9F5   B5 D9      LDA $D9,X
 <a name=E9F7></a>E9F7   29 03      AND #$03
 <a name=E9F9></a>E9F9   0D 88 02   ORA $0288
 <a name=E9FC></a>E9FC   85 D2      STA $D2
 <a name=E9FE></a>E9FE   60         RTS
 
 <A name=E9FF>
 ; clear one screen line
 </A>
 <a name=E9FF></a>E9FF   A0 27      LDY #$27
 <a name=EA01></a>EA01   20 F0 E9   JSR $<A href="#E9F0">E9F0</A>
 <a name=EA04></a>EA04   20 24 EA   JSR $<A href="#EA24">EA24</A>
 <a name=EA07></a>EA07   20 DA E4   JSR $<A href="#E4DA">E4DA</A>
 <a name=EA0A></a>EA0A   A9 20      LDA #$20
 <a name=EA0C></a>EA0C   91 D1      STA ($D1),Y
 <a name=EA0E></a>EA0E   88         DEY
 <a name=EA0F></a>EA0F   10 F6      BPL $EA07
 <a name=EA11></a>EA11   60         RTS
 
 <a name=EA12></a>EA12   EA         NOP
 
 <A name=EA13>
 ; set cursor flash timing and colour memory addresses
 </A>
 <a name=EA13></a>EA13   A8         TAY
 <a name=EA14></a>EA14   A9 02      LDA #$02
 <a name=EA16></a>EA16   85 CD      STA $CD
 <a name=EA18></a>EA18   20 24 EA   JSR $<A href="#EA24">EA24</A>
 <a name=EA1B></a>EA1B   98         TYA
 
 <A name=EA1C>
 ; put a char on the screen
 </A>
 <a name=EA1C></a>EA1C   A4 D3      LDY $D3
 <a name=EA1E></a>EA1E   91 D1      STA ($D1),Y
 <a name=EA20></a>EA20   8A         TXA
 <a name=EA21></a>EA21   91 F3      STA ($F3),Y
 <a name=EA23></a>EA23   60         RTS
 
 <A name=EA24>
 ; set colour memory adress parallel to screen
 </A>
 <a name=EA24></a>EA24   A5 D1      LDA $D1
 <a name=EA26></a>EA26   85 F3      STA $F3
 <a name=EA28></a>EA28   A5 D2      LDA $D2
 <a name=EA2A></a>EA2A   29 03      AND #$03
 <a name=EA2C></a>EA2C   09 D8      ORA #$D8
 <a name=EA2E></a>EA2E   85 F4      STA $F4
 <a name=EA30></a>EA30   60         RTS
 
 <A name=EA31>
 ; normal IRQ interrupt
 </A>
 <a name=EA31></a>EA31   20 EA FF   JSR $<A href="#FFEA">FFEA</A>   ; do clock
 <a name=EA34></a>EA34   A5 CC      LDA $CC   ; flash cursor
 <a name=EA36></a>EA36   D0 29      BNE $EA61
 <a name=EA38></a>EA38   C6 CD      DEC $CD
 <a name=EA3A></a>EA3A   D0 25      BNE $EA61
 <a name=EA3C></a>EA3C   A9 14      LDA #$14
 <a name=EA3E></a>EA3E   85 CD      STA $CD
 <a name=EA40></a>EA40   A4 D3      LDY $D3
 <a name=EA42></a>EA42   46 CF      LSR $CF
 <a name=EA44></a>EA44   AE 87 02   LDX $0287
 <a name=EA47></a>EA47   B1 D1      LDA ($D1),Y
 <a name=EA49></a>EA49   B0 11      BCS $EA5C
 <a name=EA4B></a>EA4B   E6 CF      INC $CF
 <a name=EA4D></a>EA4D   85 CE      STA $CE
 <a name=EA4F></a>EA4F   20 24 EA   JSR $<A href="#EA24">EA24</A>
 <a name=EA52></a>EA52   B1 F3      LDA ($F3),Y
 <a name=EA54></a>EA54   8D 87 02   STA $0287
 <a name=EA57></a>EA57   AE 86 02   LDX $0286
 <a name=EA5A></a>EA5A   A5 CE      LDA $CE
 <a name=EA5C></a>EA5C   49 80      EOR #$80
 <a name=EA5E></a>EA5E   20 1C EA   JSR $<A href="#EA1C">EA1C</A>   ; display cursor
 <a name=EA61></a>EA61   A5 01      LDA $01   ; checl cassette sense
 <a name=EA63></a>EA63   29 10      AND #$10
 <a name=EA65></a>EA65   F0 0A      BEQ $EA71
 <a name=EA67></a>EA67   A0 00      LDY #$00
 <a name=EA69></a>EA69   84 C0      STY $C0
 <a name=EA6B></a>EA6B   A5 01      LDA $01
 <a name=EA6D></a>EA6D   09 20      ORA #$20
 <a name=EA6F></a>EA6F   D0 08      BNE $EA79
 <a name=EA71></a>EA71   A5 C0      LDA $C0
 <a name=EA73></a>EA73   D0 06      BNE $EA7B
 <a name=EA75></a>EA75   A5 01      LDA $01
 <a name=EA77></a>EA77   29 1F      AND #$1F
 <a name=EA79></a>EA79   85 01      STA $01
 <a name=EA7B></a>EA7B   20 87 EA   JSR $<A href="#EA87">EA87</A>   ; scan keyboard
 <a name=EA7E></a>EA7E   AD 0D DC   LDA $DC0D
 <a name=EA81></a>EA81   68         PLA
 <a name=EA82></a>EA82   A8         TAY
 <a name=EA83></a>EA83   68         PLA
 <a name=EA84></a>EA84   AA         TAX
 <a name=EA85></a>EA85   68         PLA
 <a name=EA86></a>EA86   40         RTI


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->

 
<A name=EA87> </A>
;<b> scan keyboard </b>
;    Referenced by:  <A href="#EA7B">EA7B</A> ISR, <A href="#FF9F">FF9F</A> kernal jump table
;
; Determines which one (if any) of the 64 keys is pressed, and if a key is 
; now pressed that wasn't last time this was called, whether to add a new 
; keystroke to the keyboard buffer.
;
; NOTES:
;   * First checks to see if no keys are pressed at all, in which case the detailed scan is skipped
;   * No matter how many keys may be pressed at once, only one key is chosen.
;   * All 64 combinations of row/col are tested; the last key discovered (excluding modifiers) wins.
;   * The "unmodified" keyboard table holds a value of 1, 2, or 4 for the modifier keys.  This 
;     method works because unmodified keys will not produce these ASCII values.  The actual value 
;     stored in the table is the bit value that represents the modifier key (in address $<a href="ram.htm#028D">28D</a>).

 <a name=xxxx></a>EA87   A9 00      LDA #$00
 <a name=EA89></a>EA89   8D 8D 02   STA $<a href="ram.htm#028D">028D</a>       ; clear "shift flags" (modifier keys)
 <a name=EA8C></a>EA8C   A0 40      LDY #$40
 <a name=EA8E></a>EA8E   84 CB      STY $<A href="ram.htm#00CB">CB</A>         ; Matrix value of last Key pressed.  $40 = "no key", 0-3F corresponds to a key
 <a name=EA90></a>EA90   8D 00 DC   STA $<a href="io.htm#DC00">DC00</a>       ; light up all columns (all bits low--CIA1: Data Port A)
 <a name=EA93></a>EA93   AE 01 DC   LDX $<a href="io.htm#DC01">DC01</a>       ; Read rows (CIA1: Data Port B)
 <a name=EA96></a>EA96   E0 FF      CPX #$FF        ; All rows HI means no keys pressed
 <a name=EA98></a>EA98   F0 61      BEQ $EAFB   +   ; Shortcut around detailed scan
 <a name=EA9A></a>EA9A   A8         TAY             ; .Y=.A=0;  .Y is incremented after each combo checked, so always holds the code for the current key
 <a name=EA9B></a>EA9B   A9 81      LDA #$81        
 <a name=EA9D></a>EA9D   85 F5      STA $<A href="ram.htm#00F5">F5</A>
 <a name=EA9F></a>EA9F   A9 EB      LDA #$EB
 <a name=EAA1></a>EAA1   85 F6      STA $<A href="ram.htm#00F6">F6</A>         ; Point to standard (unshifted) keyboard table at $<A href="#EB81">EB81</A>
 <a name=EAA3></a>EAA3   A9 FE      LDA #$FE        ; start at bit 0 (only bit cleared)
 <a name=EAA5></a>EAA5   8D 00 DC   STA $<a href="io.htm#DC00">DC00</a>       ; "light up" (bring low) one column... (Port A)
*<a name=EAA8></a>EAA8   A2 08      LDX #$08        ; go through 8 rows fore each col
 <a name=EAAA></a>EAAA   48         PHA             ; Remember what row asserted, for next iterations
*<a name=EAAB></a>EAAB   AD 01 DC   LDA $<a href="io.htm#DC01">DC01</a>       ; ------ Read row values for active column -------
 <a name=EAAE></a>EAAE   CD 01 DC   CMP $<a href="io.htm#DC01">DC01</a>       ; Check for bounce? ??? How useful is this really if it's not done when checking for "at least one key pressed"? 
 <a name=EAB1></a>EAB1   D0 F8      BNE $EAAB   -   ; (loop until stable)
*<a name=EAB3></a>EAB3   4A         LSR             ; --> new row bit <-- Shift rows out, starting at 0
 <a name=EAB4></a>EAB4   B0 16      BCS $EACC   +   ; This key unpressed?  Go on to next
 <a name=EAB6></a>EAB6   48         PHA             ; Found a key pressed.  Preserve row data while .A used
 <a name=EAB7></a>EAB7   B1 F5      LDA ($<A href="ram.htm#00F5">F5</A>),Y     ; Get corresponding kbd table entry 
 <a name=EAB9></a>EAB9   C9 05      CMP #$05
 <a name=EABB></a>EABB   B0 0C      BCS $EAC9   +   ; data >4?  not modifier
 <a name=EABD></a>EABD   C9 03      CMP #$03 
 <a name=EABF></a>EABF   F0 08      BEQ $EAC9   +   ; data=3?  not modifier
 <a name=EAC1></a>EAC1   0D 8D 02   ORA $<a href="ram.htm#028D">028D</a>       ; Table held "modifier" code.. 1=shft,2=ctrl,4=cmdr
 <a name=EAC4></a>EAC4   8D 8D 02   STA $<a href="ram.htm#028D">028D</a>       ; set bit in "shift flags"
 <a name=EAC7></a>EAC7   10 02      BPL $EACB   +   ; (always) skip storing code in $CB because modifiers never count as "current key pressed"
*<a name=EAC9></a>EAC9   84 CB      STY $<A href="ram.htm#00CB">CB</A>         ; Matrix value of current key pressed
*<a name=EACB></a>EACB   68         PLA             ; get back row data
*<a name=EACC></a>EACC   C8         INY             ; Next index into keyboard table
 <a name=EACD></a>EACD   C0 41      CPY #$41        ; end of table?   EXIT LOOP TEST
 <a name=EACF></a>EACF   B0 0B      BCS $EADC   +   ;    yes. go figger out what we just figgered out
 <a name=EAD1></a>EAD1   CA         DEX             ; row count
 <a name=EAD2></a>EAD2   D0 DF      BNE $EAB3   *   ; --> (next row)
 <a name=EAD4></a>EAD4   38         SEC
 <a name=EAD5></a>EAD5   68         PLA             ; get back column write mask
 <a name=EAD6></a>EAD6   2A         ROL             ; --> (next col)
 <a name=EAD7></a>EAD7   8D 00 DC   STA $<a href="io.htm#DC00">DC00</a>       ; activate next column  (??? 3 bytes wasted? could have left this out and looped to EAA5 instead?!)
 <a name=EADA></a>EADA   D0 CC      BNE $EAA8   *   ; (always) top of col loop

; scan complete!
*<a name=EADC></a>EADC   68         PLA             ; remove column write mask
 <a name=EADD></a>EADD   6C 8F 02   JMP ($<a href="ram.htm#028F">028F</a>)     ; Call routine to fill in $<A href="ram.htm#00F5">F5/F6</A> (pointer to keyboard decode table)


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->


 <A name=EAE0> </A>
;<b> Return from keyboard table select routine </b> (Called from $<A href="#EADD">EADD</A>)
 <a name=EAE0></a>EAE0   A4 CB      LDY $CB         ;
 <a name=EAE2></a>EAE2   B1 F5      LDA ($F5),Y     ;
 <a name=EAE4></a>EAE4   AA         TAX             ;
 <a name=EAE5></a>EAE5   C4 C5      CPY $C5         ;
 <a name=EAE7></a>EAE7   F0 07      BEQ $EAF0   +   ;
 <a name=EAE9></a>EAE9   A0 10      LDY #$10        ;
 <a name=EAEB></a>EAEB   8C 8C 02   STY $028C       ;
 <a name=EAEE></a>EAEE   D0 36      BNE $EB26   +   ;
*<a name=EAF0></a>EAF0   29 7F      AND #$7F        ;
 <a name=EAF2></a>EAF2   2C 8A 02   BIT $028A       ;
 <a name=EAF5></a>EAF5   30 16      BMI $EB0D   +   ;
 <a name=EAF7></a>EAF7   70 49      BVS $EB42   +   ;
 <a name=EAF9></a>EAF9   C9 7F      CMP #$7F        ;
*<a name=EAFB></a>EAFB   F0 29      BEQ $EB26   +   ;
 <a name=EAFD></a>EAFD   C9 14      CMP #$14        ;   ; delete
 <a name=EAFF></a>EAFF   F0 0C      BEQ $EB0D   +   ;
 <a name=EB01></a>EB01   C9 20      CMP #$20        ;   ; space
 <a name=EB03></a>EB03   F0 08      BEQ $EB0D   +   ;
 <a name=EB05></a>EB05   C9 1D      CMP #$1D        ;   ; csr right/left
 <a name=EB07></a>EB07   F0 04      BEQ $EB0D   +   ;
 <a name=EB09></a>EB09   C9 11      CMP #$11        ;   ; csr up/down
 <a name=EB0B></a>EB0B   D0 35      BNE $EB42   +   ;
*<a name=EB0D></a>EB0D   AC 8C 02   LDY $028C       ;
 <a name=EB10></a>EB10   F0 05      BEQ $EB17   +   ;
 <a name=EB12></a>EB12   CE 8C 02   DEC $028C       ;
 <a name=EB15></a>EB15   D0 2B      BNE $EB42   +   ;
*<a name=EB17></a>EB17   CE 8B 02   DEC $028B       ;
 <a name=EB1A></a>EB1A   D0 26      BNE $EB42   +   ;
 <a name=EB1C></a>EB1C   A0 04      LDY #$04        ;
 <a name=EB1E></a>EB1E   8C 8B 02   STY $028B       ;
 <a name=EB21></a>EB21   A4 C6      LDY $C6         ;
 <a name=EB23></a>EB23   88         DEY             ;
 <a name=EB24></a>EB24   10 1C      BPL $EB42   +   ;
*<a name=EB26></a>EB26   A4 CB      LDY $CB         ;
 <a name=EB28></a>EB28   84 C5      STY $C5         ;
 <a name=EB2A></a>EB2A   AC 8D 02   LDY $028D       ;
 <a name=EB2D></a>EB2D   8C 8E 02   STY $028E       ;
 <a name=EB30></a>EB30   E0 FF      CPX #$FF        ;
 <a name=EB32></a>EB32   F0 0E      BEQ $EB42   +   ;
 <a name=EB34></a>EB34   8A         TXA             ;
 <a name=EB35></a>EB35   A6 C6      LDX $C6         ;
 <a name=EB37></a>EB37   EC 89 02   CPX $0289       ;
 <a name=EB3A></a>EB3A   B0 06      BCS $EB42   +   ;
 <a name=EB3C></a>EB3C   9D 77 02   STA $0277,X     ;
 <a name=EB3F></a>EB3F   E8         INX             ;
 <a name=EB40></a>EB40   86 C6      STX $C6         ;
*<a name=EB42></a>EB42   A9 7F      LDA #$7F        ;
 <a name=EB44></a>EB44   8D 00 DC   STA $DC00       ;
 <a name=EB47></a>EB47   60         RTS             ;

 <a name=EB48></a>EB48   AD 8D 02   LDA $028D       ;
 <a name=EB4B></a>EB4B   C9 03      CMP #$03        ;
 <a name=EB4D></a>EB4D   D0 15      BNE $EB64   +   ;
 <a name=EB4F></a>EB4F   CD 8E 02   CMP $028E       ;
 <a name=EB52></a>EB52   F0 EE      BEQ $EB42   -   ;
 <a name=EB54></a>EB54   AD 91 02   LDA $0291       ;
 <a name=EB57></a>EB57   30 1D      BMI $EB76   +   ;
 <a name=EB59></a>EB59   AD 18 D0   LDA $D018       ;
 <a name=EB5C></a>EB5C   49 02      EOR #$02        ;
 <a name=EB5E></a>EB5E   8D 18 D0   STA $D018       ;
 <a name=EB61></a>EB61   4C 76 EB   JMP $<A href="#EB76">EB76</A>       ;
 
 <A name=EB64>
 ; select keyboard table
 </A>
*<a name=EB64></a>EB64   0A         ASL
 <a name=EB65></a>EB65   C9 08      CMP #$08
 <a name=EB67></a>EB67   90 02      BCC $EB6B   +
 <a name=EB69></a>EB69   A9 06      LDA #$06
*<a name=EB6B></a>EB6B   AA         TAX
 <a name=EB6C></a>EB6C   BD 79 EB   LDA $<A href="#EB79">EB79</A>,X
 <a name=EB6F></a>EB6F   85 F5      STA $F5
 <a name=EB71></a>EB71   BD 7A EB   LDA $EB7A,X
 <a name=EB74></a>EB74   85 F6      STA $F6
 <A name=EB76>
*<a name=EB76></a>EB76   4C E0 EA   JMP $<A href="#EAE0">EAE0</A>
 </A>
 
 <A name=EB79>
 ; table addresses
 </A>
 <a name=EB79></a>EB79   .WD $<A href="#EB81">EB81</A>   ; standard
 <a name=EB7B></a>EB7B   .WD $<A href="#EBC2">EBC2</A>   ; shift
 <a name=EB7D></a>EB7D   .WD $<A href="#EC03">EC03</A>   ; commodore key
 <a name=EB7F></a>EB7F   .WD $<A href="#EC78">EC78</A>   ; control
 
 <A name=EB81>
 ; standard keyboard table
 </A>
 <a name=EB81></a>EB81   .BY $14,$0D,$1D,$88,$85,$86,$87,$11
 <a name=EB89></a>EB89   .BY $33,$57,$41,$34,$5A,$53,$45,$01
 <a name=EB91></a>EB91   .BY $35,$52,$44,$36,$43,$46,$54,$58
 <a name=EB99></a>EB99   .BY $37,$59,$47,$38,$42,$48,$55,$56
 <a name=EBA1></a>EBA1   .BY $39,$49,$4A,$30,$4D,$4B,$4F,$4E
 <a name=EBA9></a>EBA9   .BY $2B,$50,$4C,$2D,$2E,$3A,$40,$2C
 <a name=EBB1></a>EBB1   .BY $5C,$2A,$3B,$13,$01,$3D,$5E,$2F
 <a name=EBB9></a>EBB9   .BY $31,$5F,$04,$32,$20,$02,$51,$03
 <a name=EBC1></a>EBC1   .BY $FF
 
 <A name=EBC2>
 ; shift keyboard table
 </A>
 <a name=EBC2></a>EBC2   .BY $94,$8D,$9D,$8C,$89,$8A,$8B,$91
 <a name=EBCA></a>EBCA   .BY $23,$D7,$C1,$24,$DA,$D3,$C5,$01
 <a name=EBD2></a>EBD2   .BY $25,$D2,$C4,$26,$C3,$C6,$D4,$D8
 <a name=EBDA></a>EBDA   .BY $27,$D9,$C7,$28,$C2,$C8,$D5,$D6
 <a name=EBE2></a>EBE2   .BY $29,$C9,$CA,$30,$CD,$CB,$CF,$CE
 <a name=EBEA></a>EBEA   .BY $DB,$D0,$CC,$DD,$3E,$5B,$BA,$3C
 <a name=EBF2></a>EBF2   .BY $A9,$C0,$5D,$93,$01,$3D,$DE,$3F
 <a name=EBFA></a>EBFA   .BY $21,$5F,$04,$22,$A0,$02,$D1,$83
 <a name=EC02></a>EC02   .BY $FF
 
 <A name=EC03>
 ; commodore key keyboard table
 </A>
 <a name=EC03></a>EC03   .BY $94,$8D,$9D,$8C,$89,$8A,$8B,$91
 <a name=EC0B></a>EC0B   .BY $96,$B3,$B0,$97,$AD,$AE,$B1,$01
 <a name=EC13></a>EC13   .BY $98,$B2,$AC,$99,$BC,$BB,$A3,$BD
 <a name=EC1B></a>EC1B   .BY $9A,$B7,$A5,$9B,$BF,$B4,$B8,$BE
 <a name=EC23></a>EC23   .BY $29,$A2,$B5,$30,$A7,$A1,$B9,$AA
 <a name=EC2B></a>EC2B   .BY $A6,$AF,$B6,$DC,$3E,$5B,$A4,$3C
 <a name=EC33></a>EC33   .BY $A8,$DF,$5D,$93,$01,$3D,$DE,$3F
 <a name=EC3B></a>EC3B   .BY $81,$5F,$04,$95,$A0,$02,$AB,$83
 <a name=EC43></a>EC43   .BY $FF
 
 <A name=EC44>
 ; check for special petscii codes
 </A>
 <a name=EC44></a>EC44   C9 0E      CMP #$0E
 <a name=EC46></a>EC46   D0 07      BNE $EC4F
 <a name=EC48></a>EC48   AD 18 D0   LDA $D018
 <a name=EC4B></a>EC4B   09 02      ORA #$02
 <a name=EC4D></a>EC4D   D0 09      BNE $EC58
 <A name=EC4F>
 <a name=EC4F></a>EC4F   C9 8E      CMP #$8E
 </A>
 <a name=EC51></a>EC51   D0 0B      BNE $EC5E
 <a name=EC53></a>EC53   AD 18 D0   LDA $D018
 <a name=EC56></a>EC56   29 FD      AND #$FD
 <a name=EC58></a>EC58   8D 18 D0   STA $D018
 <a name=EC5B></a>EC5B   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <A name=EC5E>
 ; shift + commodore key check
 </A>
 <a name=EC5E></a>EC5E   C9 08      CMP #$08
 <a name=EC60></a>EC60   D0 07      BNE $EC69
 <a name=EC62></a>EC62   A9 80      LDA #$80
 <a name=EC64></a>EC64   0D 91 02   ORA $0291
 <a name=EC67></a>EC67   30 09      BMI $EC72
 <a name=EC69></a>EC69   C9 09      CMP #$09
 <a name=EC6B></a>EC6B   D0 EE      BNE $EC5B
 <a name=EC6D></a>EC6D   A9 7F      LDA #$7F
 <a name=EC6F></a>EC6F   2D 91 02   AND $0291
 <a name=EC72></a>EC72   8D 91 02   STA $0291
 <a name=EC75></a>EC75   4C A8 E6   JMP $<A href="#E6A8">E6A8</A>
 
 <A name=EC78>
 ; control keyboard table
 </A>
 <a name=EC78></a>EC78   .BY $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
 <a name=EC80></a>EC80   .BY $1C,$17,$01,$9F,$1A,$13,$05,$FF
 <a name=EC88></a>EC88   .BY $9C,$12,$04,$1E,$03,$06,$14,$18
 <a name=EC90></a>EC90   .BY $1F,$19,$07,$9E,$02,$08,$15,$16
 <a name=EC98></a>EC98   .BY $12,$09,$0A,$92,$0D,$0B,$0F,$0E
 <a name=ECA0></a>ECA0   .BY $FF,$10,$0C,$FF,$FF,$1B,$00,$FF
 <a name=ECA8></a>ECA8   .BY $1C,$FF,$1D,$FF,$FF,$1F,$1E,$FF
 <a name=ECB0></a>ECB0   .BY $90,$06,$FF,$05,$FF,$FF,$11,$FF
 <a name=ECB8></a>ECB8   .BY $FF
 
 <A name=ECB9>
 ; default values for VIC chip
 </A>
 <a name=ECB9></a>ECB9   .BY $00,$00   ; sprite 1 x,y
 <a name=ECBB></a>ECBB   .BY $00,$00   ; sprite 2 x,y
 <a name=ECBD></a>ECBD   .BY $00,$00   ; sprite 3 x,y
 <a name=ECBF></a>ECBF   .BY $00,$00   ; sprite 4 x,y
 <a name=ECC1></a>ECC1   .BY $00,$00   ; sprite 5 x,y
 <a name=ECC3></a>ECC3   .BY $00,$00   ; sprite 6 x,y
 <a name=ECC5></a>ECC5   .BY $00,$00   ; sprite 7 x,y
 <a name=ECC7></a>ECC7   .BY $00,$00   ; sprite 8 x,y
 <a name=ECC9></a>ECC9   .BY $00
 <a name=ECCA></a>ECCA   .BY $9B
 <a name=ECCB></a>ECCB   .BY $37
 <a name=ECCC></a>ECCC   .BY $00
 <a name=ECCD></a>ECCD   .BY $00
 <a name=ECCE></a>ECCE   .BY $00
 <a name=ECCF></a>ECCF   .BY $08
 <a name=ECD0></a>ECD0   .BY $00   ; sprite Y expand
 <a name=ECD1></a>ECD1   .BY $14
 <a name=ECD2></a>ECD2   .BY $0F
 <a name=ECD3></a>ECD3   .BY $00
 <a name=ECD4></a>ECD4   .BY $00
 <a name=ECD5></a>ECD5   .BY $00   ; sprite multi-colour
 <a name=ECD6></a>ECD6   .BY $00   ; sprite X expand
 <a name=ECD7></a>ECD7   .BY $00
 <a name=ECD8></a>ECD8   .BY $00
 <a name=ECD9></a>ECD9   .BY $0E   ; boarder colour
 <a name=ECDA></a>ECDA   .BY $06   ; background colour
 <a name=ECDB></a>ECDB   .BY $01
 <a name=ECDC></a>ECDC   .BY $02
 <a name=ECDD></a>ECDD   .BY $03
 <a name=ECDE></a>ECDE   .BY $04
 <a name=ECDF></a>ECDF   .BY $00   ; sprite colour
 <a name=ECE0></a>ECE0   .BY $01   ; sprite colour
 <a name=ECE1></a>ECE1   .BY $02   ; sprite colour
 <a name=ECE2></a>ECE2   .BY $03   ; sprite colour
 <a name=ECE3></a>ECE3   .BY $04   ; sprite colour
 <a name=ECE4></a>ECE4   .BY $05   ; sprite colour
 <a name=ECE5></a>ECE5   .BY $06   ; sprite colour
 <a name=ECE6></a>ECE6   .BY $07   ; sprite colour
 
 <A name=ECE7>
 ; load
 </A>
 <a name=ECE7></a>ECE7   .BY $4C,$4F,$41,$44,$0D
 <A name=ECEC>
 ; run
 </A>
 <a name=ECEC></a>ECEC   .BY $52,$55,$4E,$0D
 
 <A name=ECF0>
 ; low bytes of screen line addresses
 </A>
 <a name=ECF0></a>ECF0   .BY $00,$28,$50,$78,$A0
 <a name=ECF5></a>ECF5   .BY $C8,$F0,$18,$40,$68
 <a name=ECFA></a>ECFA   .BY $90,$B8,$E0,$08,$30
 <a name=ECFF></a>ECFF   .BY $58,$80,$A8,$D0,$F8
 <a name=ED04></a>ED04   .BY $20,$48,$70,$98,$C0
 
 <A name=ED09>
 ; send talk on serial bus
 </A>
 <a name=ED09></a>ED09   09 40      ORA #$40
 <a name=ED0B></a>ED0B   .BY $2C
 

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->


<A name=ED0C> </A>
; <b>send listen on serial bus</b>
; IN: .A = Device#
; <i>.Y preserved???</i>
;
; ($94) un-buffers!  Sends any buffered byte, clears buffered flag, then sends new byte
;
; Referenced by: <A href="#EDBB">EDBB</A> <A href="#EDC9">EDC9</A> <A href="#EE00">EE00</A> <A href="#F27A">F27A</A> <A href="#F3E3">F3E3</A> <A href="#F60D">F60D</A> <A href="#F648">F648</A> and Kernal jump table <A href="#FFB1">FFB1</A>

 <a name=xxxx></a>ED0C   09 20      ORA #$20        ; Add "listen" command code to device# (!!! refer to serial bus command code table)
 <a name=ED0E></a>ED0E   20 A4 F0   JSR $<A href="#F0A4">F0A4</A>       ; Disable RS-232 NMIs
<a name=ED11></a>
; <b>entry point called from </b><A href="#EE00">EE00</A>
; ($94) un-buffers!
 <a name=xxxx></a>ED11   48         PHA             ; Preserve serial bus command
 <a name=ED12></a>ED12   24 94      BIT $<A href="ram.htm#0094">94</A>         ; PRG...Flag: Serial Bus--Output Char. Buffered (???)  Why would a byte be left in $95 and not output yet?
 <a name=ED14></a>ED14   10 0A      BPL $ED20   +   ; bit 7 clear...  Means no char buffered???
 <a name=ED16></a>ED16   38         SEC             ; bit 7 was set...
 <a name=ED17></a>ED17   66 A3      ROR $<A href="ram.htm#00A3">A3</A>         ; Sets bit 7 of $A3.  ??? Who ever checks contents?
 <a name=ED19></a>ED19   20 40 ED   JSR $<A href="#ED40">ED40</A>       ; Send byte on serial bus (Where does ATN get asserted???)
 <a name=ED1C></a>ED1C   46 94      LSR $<A href="ram.htm#0094">94</A>         ; (???) Clear bit 7 of $94
 <a name=ED1E></a>ED1E   46 A3      LSR $<A href="ram.htm#00A3">A3</A>         ; (???) Clear bit 7 of $A3
*<a name=ED20></a>ED20   68         PLA             ; retrieve command byte
 <a name=ED21></a>ED21   85 95      STA $<A href="ram.htm#0095">95</A>         ; Byte to be transmitted
 <a name=ED23></a>ED23   78         SEI             ; DISABLE INTERRUPTS
 <a name=ED24></a>ED24   20 97 EE   JSR $<A href="#EE97">EE97</A>       ; Deassert DATA line.  Returns with CIA2 port A image in .A ($DD00)
 <a name=ED27></a>ED27   C9 3F      CMP #$3F        ; Check for specific value (??? assumes VIC bank is 0!!!) (What do the individual bits mean???)
 <a name=ED29></a>ED29   D0 03      BNE $ED2E   +   ; not $3F? skip next call
 <a name=ED2B></a>ED2B   20 85 EE   JSR $<A href="#EE85">EE85</A>       ; Set CLOCK line HI
*<a name=ED2E></a>ED2E   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ;  
 <a name=ED31></a>ED31   09 08      ORA #$08        ; Assert ATN (output is through inverter, so actually brings line low)
 <a name=ED33></a>ED33   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ; 

; <b>entry point called from <A href="#EDC9">EDC9</A> and <A href="#EDBB">EDBB</A> </b>
 <a name=ED36></a>ED36   78         SEI             ; DISABLE INTERRUPTS
 <a name=ED37></a>ED37   20 8E EE   JSR $<A href="#EE8E">EE8E</A>       ; Assert CLOCK line
 <a name=ED3A></a>ED3A   20 97 EE   JSR $<A href="#EE97">EE97</A>       ; Deassert DATA line (??? What does this posture mean?)
 <a name=ED3D></a>ED3D   20 B3 EE   JSR $<A href="#EEB3">EEB3</A>       ; Delay 1 ms. (??? Actual time is?  Why?)

<A name=ED40> </A>
; <b>send byte from $95 on serial bus</b>
;
; ($94) Does not check or alter.  Simply outputs whatever is stored in $95
;
; referenced by:  <A href="#ED19">ED19</A> <A href="#EDE7">EDE7</A> <i>and falls through from above</i>
 <a name=xxxx></a>ED40   78         SEI             ; 
 <a name=ED41></a>ED41   20 97 EE   JSR $<A href="#EE97">EE97</A>       ; Release DATA line (allow to go HI)
 <a name=ED44></a>ED44   20 A9 EE   JSR $<A href="#EEA9">EEA9</A>       ; Wait for bus to stabilize (and test /DATA line)
 <a name=ED47></a>ED47   B0 64      BCS $EDAD   +   ; DATA line not asserted by some other device??  Bug out & signal "device not present" in ST
 <a name=ED49></a>ED49   20 85 EE   JSR $<A href="#EE85">EE85</A>       ; Deassert CLOCK line
 <a name=ED4C></a>ED4C   24 A3      BIT $<A href="ram.htm#00A3">A3</A>         ; Check bit 7 of "temp data area" (???)
 <a name=ED4E></a>ED4E   10 0A      BPL $ED5A   +   ;    Not set? skip some stuff...
*<a name=ED50></a>ED50   20 A9 EE   JSR $<A href="#EEA9">EEA9</A>       ; Wait for bus to stabilize (and test DATA line)
 <a name=ED53></a>ED53   90 FB      BCC $ED50   -   ; loop until DATA line HI
*<a name=ED55></a>ED55   20 A9 EE   JSR $<A href="#EEA9">EEA9</A>       ; Wait for bus to stabilize (and test DATA line)
 <a name=ED58></a>ED58   B0 FB      BCS $ED55   -   ; loop until DATA line LO
*<a name=ED5A></a>ED5A   20 A9 EE   JSR $<A href="#EEA9">EEA9</A>       ; Wait for bus to stabilize (and test DATA line)
 <a name=ED5D></a>ED5D   90 FB      BCC $ED5A   -   ; loop until DATA line goes HI again
 <a name=ED5F></a>ED5F   20 8E EE   JSR $<A href="#EE8E">EE8E</A>       ; Assert CLOCK line
 <a name=ED62></a>ED62   A9 08      LDA #$08        ; 8 bits to be sent
 <a name=ED64></a>ED64   85 A5      STA $<A href="ram.htm#00A5">A5</A>         ; (init bit counter)
*<a name=ED66></a>ED66   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ; ??? Aren't these 4 instructions doing the same thing as jsr EEA9??
 <a name=ED69></a>ED69   CD 00 DD   CMP $<a href="io.htm#DD00">DD00</a>       ;
 <a name=ED6C></a>ED6C   D0 F8      BNE $ED66   -   ;
 <a name=ED6E></a>ED6E   0A         ASL             ;
 <a name=ED6F></a>ED6F   90 3F      BCC $EDB0   +   ; if DATA line LO, set bits 0 & 1 in STATUS
 <a name=ED71></a>ED71   66 95      ROR $<A href="ram.htm#0095">95</A>         ; .C = next bit to send
 <a name=ED73></a>ED73   B0 05      BCS $ED7A   +   ; 1-bit?  
 <a name=ED75></a>ED75   20 A0 EE   JSR $<A href="#EEA0">EEA0</A>       ; no, bit is 0.  Bring DATA line LO
 <a name=ED78></a>ED78   D0 03      BNE $ED7D   +   ; (always) 
*<a name=ED7A></a>ED7A   20 97 EE   JSR $<A href="#EE97">EE97</A>       ; Set DATA line HI
*<a name=ED7D></a>ED7D   20 85 EE   JSR $<A href="#EE85">EE85</A>       ; No matter what the data line is set to, set CLOCK line HI to signal data is ready
 <a name=ED80></a>ED80   EA         NOP             ; ??? NOPs for timing?     delay 8 us
 <a name=ED81></a>ED81   EA         NOP             ;
 <a name=ED82></a>ED82   EA         NOP             ;
 <a name=ED83></a>ED83   EA         NOP             ;
 <a name=ED84></a>ED84   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ; 
 <a name=ED87></a>ED87   29 DF      AND #$DF        ; Clear bit 5... (DATA out)
 <a name=ED89></a>ED89   09 10      ORA #$10        ; Set bit 4... (CLOCK out)
 <a name=ED8B></a>ED8B   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ; Release DATA line to HI, return CLOCK line to LO
 <a name=ED8E></a>ED8E   C6 A5      DEC $<A href="ram.htm#00A5">A5</A>         ; reduce bit count
 <a name=ED90></a>ED90   D0 D4      BNE $ED66   -   ; More bits to send? loop
 <a name=ED92></a>ED92   A9 04      LDA #$04        ; last bit sent...
 <a name=ED94></a>ED94   8D 07 DC   STA $<a href="io.htm#DC07">DC07</a>       ; CIA 1, timer B high.  Sets prescalar to $400, or about 1 ms
 <a name=ED97></a>ED97   A9 19      LDA #$19        ; bits 0, 3, & 4 set
 <a name=ED99></a>ED99   8D 0F DC   STA $<a href="io.htm#DC0F">DC0F</a>       ; CIA 1, Control Register B: force-load, 1-shot, start timer
 <a name=ED9C></a>ED9C   AD 0D DC   LDA $<a href="io.htm#DC0D">DC0D</a>       ; Read once: CIA 1 Interrupt Control Register... clears all flags.  Prevent reading old flag
*<a name=ED9F></a>ED9F   AD 0D DC   LDA $<a href="io.htm#DC0D">DC0D</a>       ; Re-read ICR for current status
 <a name=EDA2></a>EDA2   29 02      AND #$02        ; Isolate Timer B underflow bit
 <a name=EDA4></a>EDA4   D0 0A      BNE $EDB0   +   ; Has Timer B expired?  1 ms has gone by w/o DATA line going LO... Set bits 0 & 1 in STATUS
 <a name=EDA6></a>EDA6   20 A9 EE   JSR $<A href="#EEA9">EEA9</A>       ; Wait for bus to stabilize (and test DATA line)
 <a name=EDA9></a>EDA9   B0 F4      BCS $ED9F   -   ; DATA line still HI?  Loop.
 <a name=EDAB></a>EDAB   58         CLI             ; ENABLE INTERRUPTS
 <a name=EDAC></a>EDAC   60         RTS             ;


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->


; Error exits 
*<a name=EDAD></a>EDAD   A9 80      LDA #$80        ; Set bit 7 (device not present)
 <a name=EDAF></a>EDAF   .BY $2C                    ;
*<a name=EDB0></a>EDB0   A9 03      LDA #$03        ; Set bit 0 (write timeout) and bit 1 (read timeout)
; Ref'd by <A href="#EE44">EE44</A>   <A name=EDB2> </A>
 <a name=xxxx></a>EDB2   20 1C FE   JSR $<A href="#FE1C">FE1C</A>       ; Add bits to STATUS word
 <a name=EDB5></a>EDB5   58         CLI             ; 
 <a name=EDB6></a>EDB6   18         CLC             ;
 <a name=EDB7></a>EDB7   90 4A      BCC $<A href="#EE03">EE03</A>       ; (always)... De-assert ATN, set other lines (??? more detail needed)
 
<A name=EDB9> </A>
;<b> send secondary address (listen) on serial bus </b>
;    referenced by:  <A href="#F286">F286</A> <A href="#F3EA">F3EA</A> <A href="#F612">F612</A> <A href="#F651">F651</A> and Kernal jump table <A href="#FF93">FF93</A>
;
; ($94) Does not check or alter.  Assumes no byte is buffered, and directly outputs new byte

 <a name=xxxx></a>EDB9   85 95      STA $<A href="ram.htm#0095">95</A>         ; Store byte to send in $95
 <a name=EDBB></a>EDBB   20 36 ED   JSR $<A href="#ED36">ED36</A>       ; Set CLOCK LO, DATA HI, then send byte from $95
<A name=EDBE> </A>
; Ref'd by: <A href="#EDD0">EDD0</A> <A href="#EE03">EE03</A> <A href="#F281">F281</A>
 <a name=xxxx></a>EDBE   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EDC1></a>EDC1   29 F7      AND #$F7        ; Clear bit 3 (de-assert ATN)
 <a name=EDC3></a>EDC3   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EDC6></a>EDC6   60         RTS
 
<A name=EDC7> </A>
;<b> send secondary address (talk) on serial bus </b>
;    Referenced by: <A href="#F245">F245</A> <A href="#F4D2">F4D2</A> and Kernal jump table <A href="#FF96">FF96</A>
;
; ($94) Does not check or alter.  Assumes no byte is buffered, and directly outputs new byte

 <a name=xxxx></a>EDC7   85 95      STA $<A href="ram.htm#0095">95</A>         ; Store byte to send in $95
 <a name=EDC9></a>EDC9   20 36 ED   JSR $<A href="#ED36">ED36</A>       ; Set CLOCK LO, DATA HI, then send byte from $95
<A name=EDCC> </A>
; Ref'd by:  <A href="#F23F">F23F</A>
 <a name=xxxx></a>EDCC   78         SEI             ; 
 <a name=EDCD></a>EDCD   20 A0 EE   JSR $<A href="#EEA0">EEA0</A>       ; Bring DATA line LO
 <a name=EDD0></a>EDD0   20 BE ED   JSR $<A href="#EDBE">EDBE</A>       ; De-assert ATN line
 <a name=EDD3></a>EDD3   20 85 EE   JSR $<A href="#EE85">EE85</A>       ; Release CLOCK line to HI
 <a name=EDD6></a>EDD6   20 A9 EE   JSR $<A href="#EEA9">EEA9</A>       ; Wait for bus to stabilize (and test DATA line)
 <a name=EDD9></a>EDD9   30 FB      BMI $EDD6   -   ; loop until <i>bit 6</i> (CLOCK in) goes LO
 <a name=EDDB></a>EDDB   58         CLI             ;
 <a name=EDDC></a>EDDC   60         RTS
 
<A name=EDDD> </A>
;<b> output byte on serial bus </b>
;    Referenced by:  <A href="#F1D8">F1D8</A> <A href="#F3FE">F3FE</A> <A href="#F61C">F61C</A> <A href="#F621">F621</A> <A href="#F62B">F62B</A> and Kernal jump table <A href="#FFA8">FFA8</A>
;
; ($94) Always buffers, never un-buffers.  If byte already buffered, sends that one and buffers the new one.

 <a name=xxxx></a>EDDD   24 94      BIT $<A href="ram.htm#0094">94</A>         ; Flag: Serial Bus--Output Char. Buffered
 <a name=EDDF></a>EDDF   30 05      BMI $EDE6   +   ; bit 7 of $94 set ... go to output buffered byte
 <a name=EDE1></a>EDE1   38         SEC             ; bit 7 was NOT set... 
 <a name=EDE2></a>EDE2   66 94      ROR $<A href="ram.htm#0094">94</A>         ; then set it
 <a name=EDE4></a>EDE4   D0 05      BNE $EDEB   +   ; (always) 
 <a name=EDE6></a>EDE6   48         PHA             ; Save new byte to be output
 <a name=EDE7></a>EDE7   20 40 ED   JSR $<A href="#ED40">ED40</A>       ; output previously buffered byte
 <a name=EDEA></a>EDEA   68         PLA             ; 
 <a name=EDEB></a>EDEB   85 95      STA $<A href="ram.htm#0095">95</A>         ; and "buffer" new byte
 <a name=EDED></a>EDED   18         CLC             ;
 <a name=EDEE></a>EDEE   60         RTS

 <A name=EDEF> </A>
;<b> send untalk on serial bus </b>
;    Referenced by:  <A href="#F340">F340</A> <A href="#F528">F528</A> and Kernal jump table <A href="#FFAB">FFAB</A> 
;
; Untalk is accomplished by sending a "talk" to device 31 ($1F).  All devices see this and stop talking.

 <a name=xxxx></a>EDEF   78         SEI             ;
 <a name=EDF0></a>EDF0   20 8E EE   JSR $<A href="#EE8E">EE8E</A>       ; Set CLOCK line LO
 <a name=EDF3></a>EDF3   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EDF6></a>EDF6   09 08      ORA #$08        ; set bit 3
 <a name=EDF8></a>EDF8   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ; Assert ATN line
 <a name=EDFB></a>EDFB   A9 5F      LDA #$5F        ; serial bus command: $40 (talk) + device 31 = untalk
 <a name=EDFD></a>EDFD   .BY $2C                    ; Skip next LDA... share code with "send unlisten", below.
 
<A name=EDFE> </A>
;<b> send unlisten on serial bus </b>
;    Referenced by:  <A href="#F339">F339</A> <A href="#F63F">F63F</A> <A href="#F654">F654</A> and Kernal Jump Table <A href="#FFAE">FFAE</A> 
;
; Unlisten is accomplished by sending "listen" to device 31 ($1F).  All devices will see this and stop listening.
;
; ??? Why are both CLOCK and DATA lines released at end?
 <a name=xxxx></a>EDFE   A9 3F      LDA #$3F        ; serial bus command: $20 (listen) + device 31 = unlisten
 <a name=EE00></a>EE00   20 11 ED   JSR $<A href="#ED11">ED11</A>       ; Send command on Serial Bus (talk/listen)
 <a name=EE03></a>EE03   20 BE ED   JSR $<A href="#EDBE">EDBE</A>       ; De-assert ATN line (untalk/unlisten are not followed by a secondary address... no need to leave ATN line asserted)
<A name=EE06> </A>
; Ref'd by:  <A href="#EE7D">EE7D</A> 
 <a name=xxxx></a>EE06   8A         TXA             ; temp save .X (??? Are we trying to preserve caller's .X?  Which caller?)
 <a name=EE07></a>EE07   A2 0A      LDX #$0A        ;
 <a name=EE09></a>EE09   CA         DEX             ;
 <a name=EE0A></a>EE0A   D0 FD      BNE $EE09   -   ; short delay (about 52 usec)
 <a name=EE0C></a>EE0C   AA         TAX             ; restore .X
 <a name=EE0D></a>EE0D   20 85 EE   JSR $<A href="#EE85">EE85</A>       ; Set CLOCK line HI
 <a name=EE10></a>EE10   4C 97 EE   JMP $<A href="#EE97">EE97</A>       ; Set DATA line HI, return
 
<A name=EE13> </A>
;<b> input byte on serial bus </b>
;    Referenced by:  <A href="#F1B5">F1B5</A> <A href="#F4D5">F4D5</A> <A href="#F4E0">F4E0</A> <A href="#F501">F501</A> and Kernal Jump Table <A href="#FFA5">FFA5</A> 
 <a name=xxxx></a>EE13   78         SEI             ;
 <a name=EE14></a>EE14   A9 00      LDA #$00        ;
 <a name=EE16></a>EE16   85 A5      STA $<A href="ram.htm#00A5">A5</A>         ; Boolean: haven't registered EOI signal
 <a name=EE18></a>EE18   20 85 EE   JSR $<A href="#EE85">EE85</A>       ; Set CLOCK line HI
 <a name=EE1B></a>EE1B   20 A9 EE   JSR $<A href="#EEA9">EEA9</A>       ; Stabilize, and check clock line
 <a name=EE1E></a>EE1E   10 FB      BPL $EE1B   -   ; Loop unitl clock line HI
 <a name=EE20></a>EE20   A9 01      LDA #$01        ; 
 <a name=EE22></a>EE22   8D 07 DC   STA $<a href="io.htm#DC07">DC07</a>       ; CIA#1, timer B high byte (sets prescalar to 256, or about 250 usec)
 <a name=EE25></a>EE25   A9 19      LDA #$19        ; Bits 0, 3 & 4 set
 <a name=EE27></a>EE27   8D 0F DC   STA $<a href="io.htm#DC0F">DC0F</a>       ; Force load, set 1-shot mode, and start timer B on CIA#1
 <a name=EE2A></a>EE2A   20 97 EE   JSR $<A href="#EE97">EE97</A>       ; Set DATA line HI
 <a name=EE2D></a>EE2D   AD 0D DC   LDA $<a href="io.htm#DC0D">DC0D</a>       ; Load CIA1 Interrupt Control Register to clear previously set flags
 <a name=EE30></a>EE30   AD 0D DC   LDA $<a href="io.htm#DC0D">DC0D</a>       ; Get latest CIA1 ICR state
 <a name=EE33></a>EE33   29 02      AND #$02        ; isolate bit 1, "timer B"
 <a name=EE35></a>EE35   D0 07      BNE $EE3E   +   ; Timer B expired before CLOCK went LO?  Determine if EOI or timeout has occurred
 <a name=EE37></a>EE37   20 A9 EE   JSR $<A href="#EEA9">EEA9</A>       ; Stabilize, check clock line
 <a name=EE3A></a>EE3A   30 F4      BMI $EE30   -   ; CLOCK line still HI? keep waiting...
 <a name=EE3C></a>EE3C   10 18      BPL $EE56   +   ; CLOCK line went LO... move on to
 <a name=EE3E></a>EE3E   A5 A5      LDA $<A href="ram.htm#00A5">A5</A>         ; Check timed-out flag
 <a name=EE40></a>EE40   F0 05      BEQ $EE47   +   ; Not already timed out once? This could just be an EOI (end of file) signal.
 <a name=EE42></a>EE42   A9 02      LDA #$02        ; nope, this is second timeout period... fail with timeout error
 <a name=EE44></a>EE44   4C B2 ED   JMP $<A href="#EDB2">EDB2</A>       ; Set bits in STATUS & exit
 
 <a name=EE47></a>EE47   20 A0 EE   JSR $<A href="#EEA0">EEA0</A>       ; set DATA line LO
 <a name=EE4A></a>EE4A   20 85 EE   JSR $<A href="#EE85">EE85</A>       ; set CLOCK line HI
 <a name=EE4D></a>EE4D   A9 40      LDA #$40        ; bit 6
 <a name=EE4F></a>EE4F   20 1C FE   JSR $<A href="#FE1C">FE1C</A>       ; Set bits in STATUS (bit 6 = end of file)
 <a name=EE52></a>EE52   E6 A5      INC $<A href="ram.htm#00A5">A5</A>         ; Set $A5 to something non-zero, to signal timeout has already expired once.  One timeout period = EOI signal... Two timeouts is just AWOL
 <a name=EE54></a>EE54   D0 CA      BNE $EE20   -   ; (always) start waiting again for CLOCK to go LO
 <a name=EE56></a>EE56   A9 08      LDA #$08        ; bit count
 <a name=EE58></a>EE58   85 A5      STA $<A href="ram.htm#00A5">A5</A>         ; Set # bits to be receive
 <a name=EE5A></a>EE5A   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ; ??? Aren't these 4 instructions identical to JSR EEA9??
 <a name=EE5D></a>EE5D   CD 00 DD   CMP $<a href="io.htm#DD00">DD00</a>       ; value stable?
 <a name=EE60></a>EE60   D0 F8      BNE $EE5A   -   ;    nope, test again
 <a name=EE62></a>EE62   0A         ASL             ; .S (sign) = bit 6 of $DD00 (CLOCK line in), and .C = bit 7 (DATA line in)
 <a name=EE63></a>EE63   10 F5      BPL $EE5A   -   ; Keep checking until CLOCK line goes HI
 <a name=EE65></a>EE65   66 A4      ROR $<A href="ram.htm#00A4">A4</A>         ; Shift data bit into $A4
 <a name=EE67></a>EE67   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ; ??? Aren't these 4 instructions identical to JSR EEA9??
 <a name=EE6A></a>EE6A   CD 00 DD   CMP $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EE6D></a>EE6D   D0 F8      BNE $EE67   -   ;
 <a name=EE6F></a>EE6F   0A         ASL             ;
 <a name=EE70></a>EE70   30 F5      BMI $EE67   -   ; Wait for CLOCK to go back LO
 <a name=EE72></a>EE72   C6 A5      DEC $<A href="ram.htm#00A5">A5</A>         ; reduce bit count
 <a name=EE74></a>EE74   D0 E4      BNE $EE5A   -   ; Still bits to receive? loop
 <a name=EE76></a>EE76   20 A0 EE   JSR $<A href="#EEA0">EEA0</A>       ; Last bit received. Pull DATA line LO as handshake
 <a name=EE79></a>EE79   24 90      BIT $<A href="ram.htm#0090">90</A>         ; Check bit 6 of STATUS (end of file)
 <a name=EE7B></a>EE7B   50 03      BVC $EE80   +   ; Not end of file? Leave DATA line LO
 <a name=EE7D></a>EE7D   20 06 EE   JSR $<A href="#EE06">EE06</A>       ; delay 50 usec, then release CLOCK and DATA lines (allow both to go HI)
 <a name=EE80></a>EE80   A5 A4      LDA $<A href="ram.htm#00A4">A4</A>         ; Return byte received
 <a name=EE82></a>EE82   58         CLI             ;
 <a name=EE83></a>EE83   18         CLC             ;
 <a name=EE84></a>EE84   60         RTS
 
<A name=EE85> </A>
;<b> set serial clock line HI </b>
;    Referenced by:  <A href="#ED2B">ED2B</A> <A href="#ED49">ED49</A> <A href="#ED7D">ED7D</A> <A href="#EDD3">EDD3</A> <A href="#EE0D">EE0D</A> <A href="#EE18">EE18</A> <A href="#EE4A">EE4A</A> 
;
; Bus outputs go through an inverter, so clearing the CLOCK OUT bit actually sets the line HI.
 <a name=xxxx></a>EE85   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EE88></a>EE88   29 EF      AND #$EF        ; clear bit 4, CLOCK OUT
 <a name=EE8A></a>EE8A   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EE8D></a>EE8D   60         RTS
 
<A name=EE8E> </A>
;<b> set serial clock line LO </b>
;    Referenced by:  <A href="#ED37">ED37</A> <A href="#ED5F">ED5F</A> <A href="#EDF0">EDF0</A> <A href="#FF7D">FF7D</A> 
;
; Bus outputs go through an inverter, so setting the CLOCK OUT bit actually brings the line LO.
 <a name=xxxx></a>EE8E   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EE91></a>EE91   09 10      ORA #$10        ; set bit 4, CLOCK OUT
 <a name=EE93></a>EE93   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EE96></a>EE96   60         RTS
 
<A name=EE97> </A>
;<b> set serial data line HI </b>
;    Referenced by:  <A href="#ED24">ED24</A> <A href="#ED3A">ED3A</A> <A href="#ED41">ED41</A> <A href="#ED7A">ED7A</A> <A href="#EE10">EE10</A> <A href="#EE2A">EE2A</A> 
;
; Bus outputs go through an inverter, so clearing the DATA OUT bit actually sets the line HI.
 <a name=xxxx></a>EE97   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EE9A></a>EE9A   29 DF      AND #$DF        ; clear bit 5, DATA OUT
 <a name=EE9C></a>EE9C   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EE9F></a>EE9F   60         RTS
 
<A name=EEA0> </A>
;<b> set serial data line LO </b>
;    Referenced by:  <A href="#ED75">ED75</A> <A href="#EDCD">EDCD</A> <A href="#EE47">EE47</A> <A href="#EE76">EE76</A> 
;
; Bus outputs go through an inverter, so setting the DATA OUT bit actually brings the line LO.
 <a name=xxxx></a>EEA0   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EEA3></a>EEA3   09 20      ORA #$20        ; set bit 5, DATA OUT
 <a name=EEA5></a>EEA5   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EEA8></a>EEA8   60         RTS
 
<A name=EEA9> </A>
;<b> Stabilize bus signals and check CLOCK/DATA in </b>
;    Referenced by:  <A href="#ED44">ED44</A> <A href="#ED50">ED50</A> <A href="#ED55">ED55</A> <A href="#ED5A">ED5A</A> <A href="#EDA6">EDA6</A> <A href="#EDD6">EDD6</A> <A href="#EE1B">EE1B</A> <A href="#EE37">EE37</A> 
;
; Loops until 2 successive reads of the serial bus port come back identical.
; Finally, shifts the port value left by one, leaving bit 7 in .C and bit 6 in .S (sign)
; ??? Is the stabilization really necessary?  Is this to eliminate noise or wait for incoming transitions?  Or is it just done because "it's a good idea"?
; ??? Could this routine be utilized in more places, or would the JSR overhead make it too slow?  This exact code is in-lined in at least a couple other places
 <a name=xxxx></a>EEA9   AD 00 DD   LDA $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EEAC></a>EEAC   CD 00 DD   CMP $<a href="io.htm#DD00">DD00</a>       ;
 <a name=EEAF></a>EEAF   D0 F8      BNE $EEA9   -   ; Loop until stable
 <a name=EEB1></a>EEB1   0A         ASL             ; 
 <a name=EEB2></a>EEB2   60         RTS
 
<A name=EEB3> </A>
; <b>delay 1 millisecond</b>
; Actual delay, including JSR and RTS is 938 cycles, or about 917 usec (NTSC) / 952 usec (PAL)
;
; <i>preserves .X</i>
; referenced by:  only <A href="#ED3D">ED3D</A> 
 <a name=xxxx></a>EEB3   8A         TXA             ; 2cyc 
 <a name=EEB4></a>EEB4   A2 B8      LDX #$B8        ; 2cyc
 <a name=EEB6></a>EEB6   CA         DEX             ;   2cyc   \ ___ 5cyc * 184 reps = 920 cyc
 <a name=EEB7></a>EEB7   D0 FD      BNE $EEB6       ;   3cyc   /
 <a name=EEB9></a>EEB9   AA         TAX             ; 2cyc
 <a name=EEBA></a>EEBA   60         RTS             ; 6cyc + 6cyc JSR = 12cyc


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=EEBB></A>
 ; <b>set next bit to transmit on RS-232</b>

 <a name=xxxx></a>EEBB   A5 B4      LDA $B4
 <a name=EEBD></a>EEBD   F0 47      BEQ $EF06
 <a name=EEBF></a>EEBF   30 3F      BMI $EF00
 <a name=EEC1></a>EEC1   46 B6      LSR $B6
 <a name=EEC3></a>EEC3   A2 00      LDX #$00
 <a name=EEC5></a>EEC5   90 01      BCC $EEC8
 <a name=EEC7></a>EEC7   CA         DEX
 <a name=EEC8></a>EEC8   8A         TXA
 <a name=EEC9></a>EEC9   45 BD      EOR $BD
 <a name=EECB></a>EECB   85 BD      STA $BD
 <a name=EECD></a>EECD   C6 B4      DEC $B4
 <a name=EECF></a>EECF   F0 06      BEQ $EED7
 <a name=EED1></a>EED1   8A         TXA
 <a name=EED2></a>EED2   29 04      AND #$04
 <a name=EED4></a>EED4   85 B5      STA $B5
 <a name=EED6></a>EED6   60         RTS
 
 <a name=EED7></a>EED7   A9 20      LDA #$20
 <a name=EED9></a>EED9   2C 94 02   BIT $0294
 <a name=EEDC></a>EEDC   F0 14      BEQ $EEF2
 <a name=EEDE></a>EEDE   30 1C      BMI $EEFC
 <a name=EEE0></a>EEE0   70 14      BVS $EEF6
 <a name=EEE2></a>EEE2   A5 BD      LDA $BD
 <a name=EEE4></a>EEE4   D0 01      BNE $EEE7
 <a name=EEE6></a>EEE6   CA         DEX
 <a name=EEE7></a>EEE7   C6 B4      DEC $B4
 <a name=EEE9></a>EEE9   AD 93 02   LDA $0293
 <a name=EEEC></a>EEEC   10 E3      BPL $EED1
 <a name=EEEE></a>EEEE   C6 B4      DEC $B4
 <a name=EEF0></a>EEF0   D0 DF      BNE $EED1
 <a name=EEF2></a>EEF2   E6 B4      INC $B4
 <a name=EEF4></a>EEF4   D0 F0      BNE $EEE6
 <a name=EEF6></a>EEF6   A5 BD      LDA $BD
 <a name=EEF8></a>EEF8   F0 ED      BEQ $EEE7
 <a name=EEFA></a>EEFA   D0 EA      BNE $EEE6
 <a name=EEFC></a>EEFC   70 E9      BVS $EEE7
 <a name=EEFE></a>EEFE   50 E6      BVC $EEE6
 <a name=EF00></a>EF00   E6 B4      INC $B4
 <a name=EF02></a>EF02   A2 FF      LDX #$FF
 <a name=EF04></a>EF04   D0 CB      BNE $EED1
 <A name=EF06>
 <a name=EF06></a>EF06   AD 94 02   LDA $0294
 </A>
 <a name=EF09></a>EF09   4A         LSR
 <a name=EF0A></a>EF0A   90 07      BCC $EF13
 <a name=EF0C></a>EF0C   2C 01 DD   BIT $DD01
 <a name=EF0F></a>EF0F   10 1D      BPL $EF2E
 <a name=EF11></a>EF11   50 1E      BVC $EF31
 <a name=EF13></a>EF13   A9 00      LDA #$00
 <a name=EF15></a>EF15   85 BD      STA $BD
 <a name=EF17></a>EF17   85 B5      STA $B5
 <a name=EF19></a>EF19   AE 98 02   LDX $0298
 <a name=EF1C></a>EF1C   86 B4      STX $B4
 <a name=EF1E></a>EF1E   AC 9D 02   LDY $029D
 <a name=EF21></a>EF21   CC 9E 02   CPY $029E
 <a name=EF24></a>EF24   F0 13      BEQ $EF39
 <a name=EF26></a>EF26   B1 F9      LDA ($F9),Y
 <a name=EF28></a>EF28   85 B6      STA $B6
 <a name=EF2A></a>EF2A   EE 9D 02   INC $029D
 <a name=EF2D></a>EF2D   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=EF2E>
 ; handle RS-232 errors
 </A>
 THERE IS NO DECISION-MAKING HERE.  PROBABLY A MISNOMER OF "RECOVER FROM ERROR" or "RE-CONFIGURE AFTER RS-232 Rx/Tx"
 <a name=EF2E></a>EF2E   A9 40      LDA #$40        ; Bit 6 or...
 <a name=EF30></a>EF30   .BY $2C
 
 <a name=EF31></a>EF31   A9 10      LDA #$10        ; ... Bit 4
 
 <a name=EF33></a>EF33   0D 97 02   ORA $0297
 <a name=EF36></a>EF36   8D 97 02   STA $0297       ; set either bit 4 or bit 6 in "RS-232 enables" 
 <a name=EF39></a>EF39   A9 01      LDA #$01
 <A name=EF3B>
 <a name=EF3B></a>EF3B   8D 0D DD   STA $DD0D       ; Clear CIA #2 INT mask Bit 2: Timer A interrupt
 </A>
 <a name=EF3E></a>EF3E   4D A1 02   EOR $02A1       ; PRG...02A1 = RS-232 enables; ANAT...flag set?  !!! (PROBABLY BITS OF THE MASK THAT ARE USED BY RS-232)
 <a name=EF41></a>EF41   09 80      ORA #$80        ; bit 7 = 1: will SET the mask bits in CIA register
 <a name=EF43></a>EF43   8D A1 02   STA $02A1       ; set all RS-232 mask bits
 <a name=EF46></a>EF46   8D 0D DD   STA $DD0D       ; 
 <a name=EF49></a>EF49   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=EF4A>
 ; check control register
 </A>
 <a name=EF4A></a>EF4A   A2 09      LDX #$09
 <a name=EF4C></a>EF4C   A9 20      LDA #$20
 <a name=EF4E></a>EF4E   2C 93 02   BIT $0293
 <a name=EF51></a>EF51   F0 01      BEQ $EF54
 <a name=EF53></a>EF53   CA         DEX
 <a name=EF54></a>EF54   50 02      BVC $EF58
 <a name=EF56></a>EF56   CA         DEX
 <a name=EF57></a>EF57   CA         DEX
 <a name=EF58></a>EF58   60         RTS
 
 <A name=EF59>
 ; add bit input on RS-232 bus to word being input
 </A>
 <a name=EF59></a>EF59   A6 A9      LDX $A9
 <a name=EF5B></a>EF5B   D0 33      BNE $EF90
 <a name=EF5D></a>EF5D   C6 A8      DEC $A8
 <a name=EF5F></a>EF5F   F0 36      BEQ $EF97
 <a name=EF61></a>EF61   30 0D      BMI $EF70
 <a name=EF63></a>EF63   A5 A7      LDA $A7
 <a name=EF65></a>EF65   45 AB      EOR $AB
 <a name=EF67></a>EF67   85 AB      STA $AB
 <a name=EF69></a>EF69   46 A7      LSR $A7
 <a name=EF6B></a>EF6B   66 AA      ROR $AA
 <a name=EF6D></a>EF6D   60         RTS
 
 <A name=EF6E>
 ; handle end of word for RS-232 input
 </A>
 <a name=EF6E></a>EF6E   C6 A8      DEC $A8
 <a name=EF70></a>EF70   A5 A7      LDA $A7
 <a name=EF72></a>EF72   F0 67      BEQ $EFDB
 <a name=EF74></a>EF74   AD 93 02   LDA $0293
 <a name=EF77></a>EF77   0A         ASL
 <a name=EF78></a>EF78   A9 01      LDA #$01
 <a name=EF7A></a>EF7A   65 A8      ADC $A8
 <a name=EF7C></a>EF7C   D0 EF      BNE $EF6D


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=EF7E>
 ; enable byte reception
 </A>
 <a name=EF7E></a>EF7E   A9 90      LDA #$90        ; bit 4 and 7 set
 <a name=EF80></a>EF80   8D 0D DD   STA $DD0D       ; sets bit 4 in interrupt mask (enables CIA#2 FLAG1 NMI: RS-232 received data)
 <a name=EF83></a>EF83   0D A1 02   ORA $02A1       ; set bit 4 of RS-232 NMI enable mask (bit 7 doesn't matter?)
 <a name=EF86></a>EF86   8D A1 02   STA $02A1
 <a name=EF89></a>EF89   85 A9      STA $<A href="ram.htm#00A9">A9</A>         ; 
 <a name=EF8B></a>EF8B   A9 02      LDA #$02
 <a name=EF8D></a>EF8D   4C 3B EF   JMP $<A href="#EF3B">EF3B</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=EF90>
 ; receiver start bit test
 </A>
 <a name=EF90></a>EF90   A5 A7      LDA $A7
 <a name=EF92></a>EF92   D0 EA      BNE $EF7E
 <a name=EF94></a>EF94   4C D3 E4   JMP $<A href="#E4D3">E4D3</A>

 <A name=EF97> </A>
 ; put received data into RS-232 buffer
 ;
 ; References:  x

 <a name=xxxx></a>EF97   AC 9B 02   LDY $<a href="ram.htm#029B">029B</a>       ; 
 <a name=EF9A></a>EF9A   C8         INY             ;
 <a name=EF9B></a>EF9B   CC 9C 02   CPY $029C       ;
 <a name=EF9E></a>EF9E   F0 2A      BEQ $EFCA       ;
 <a name=EFA0></a>EFA0   8C 9B 02   STY $029B       ;
 <a name=EFA3></a>EFA3   88         DEY             ;
 <a name=EFA4></a>EFA4   A5 AA      LDA $AA         ;
 <a name=EFA6></a>EFA6   AE 98 02   LDX $0298       ;
 <a name=EFA9></a>EFA9   E0 09      CPX #$09        ;
 <a name=EFAB></a>EFAB   F0 04      BEQ $EFB1       ;
 <a name=EFAD></a>EFAD   4A         LSR             ;
 <a name=EFAE></a>EFAE   E8         INX             ;
 <a name=EFAF></a>EFAF   D0 F8      BNE $EFA9       ;
 <a name=EFB1></a>EFB1   91 F7      STA ($F7),Y     ;
 <a name=EFB3></a>EFB3   A9 20      LDA #$20        ;
 <a name=EFB5></a>EFB5   2C 94 02   BIT $0294       ;
 <a name=EFB8></a>EFB8   F0 B4      BEQ $EF6E       ;
 <a name=EFBA></a>EFBA   30 B1      BMI $EF6D       ;
 <a name=EFBC></a>EFBC   A5 A7      LDA $A7         ;
 <a name=EFBE></a>EFBE   45 AB      EOR $AB         ;
 <a name=EFC0></a>EFC0   F0 03      BEQ $EFC5       ;
 <a name=EFC2></a>EFC2   70 A9      BVS $EF6D       ;
 <a name=EFC4></a>EFC4   .BY $2C                    ;
 <a name=EFC5></a>EFC5   50 A6      BVC $EF6D       ;
 <a name=EFC7></a>EFC7   A9 01      LDA #$01        ;
 <a name=EFC9></a>EFC9   .BY $2C                    ;
 <a name=EFCA></a>EFCA   A9 04      LDA #$04        ;
 <a name=EFCC></a>EFCC   .BY $2C                    ;
 <a name=EFCD></a>EFCD   A9 80      LDA #$80        ;
 <a name=EFCF></a>EFCF   .BY $2C                    ;
 <a name=EFD0></a>EFD0   A9 02      LDA #$02        ;
 <a name=EFD2></a>EFD2   0D 97 02   ORA $0297       ;
 <a name=EFD5></a>EFD5   8D 97 02   STA $0297       ;
 <a name=EFD8></a>EFD8   4C 7E EF   JMP $<A href="#EF7E">EF7E</A>
 
 <a name=EFDB></a>EFDB   A5 AA      LDA $AA         ;
 <a name=EFDD></a>EFDD   D0 F1      BNE $EFD0       ;
 <a name=EFDF></a>EFDF   F0 EC      BEQ $EFCD       ;
 
 <A name=EFE1>
 ; output to RS-232 device
 </A>
 <a name=EFE1></a>EFE1   85 9A      STA $<A href="ram.htm#009A">9A</A>
 <a name=EFE3></a>EFE3   AD 94 02   LDA $<a href="ram.htm#0294">0294</a>
 <a name=EFE6></a>EFE6   4A         LSR
 <a name=EFE7></a>EFE7   90 29      BCC $F012
 <a name=EFE9></a>EFE9   A9 02      LDA #$02
 <a name=EFEB></a>EFEB   2C 01 DD   BIT $DD01
 <a name=EFEE></a>EFEE   10 1D      BPL $F00D
 <a name=EFF0></a>EFF0   D0 20      BNE $F012
 <a name=EFF2></a>EFF2   AD A1 02   LDA $<a href="ram.htm#02A1">02A1</a>       ; RS-232: CIA#2 NMI mask
 <a name=EFF5></a>EFF5   29 02      AND #$02
 <a name=EFF7></a>EFF7   D0 F9      BNE $EFF2
 <a name=EFF9></a>EFF9   2C 01 DD   BIT $DD01
 <a name=EFFC></a>EFFC   70 FB      BVS $EFF9
 <a name=EFFE></a>EFFE   AD 01 DD   LDA $DD01
 <a name=F001></a>F001   09 02      ORA #$02
 <a name=F003></a>F003   8D 01 DD   STA $DD01
 <a name=F006></a>F006   2C 01 DD   BIT $DD01
 <a name=F009></a>F009   70 07      BVS $F012
 <a name=F00B></a>F00B   30 F9      BMI $F006
 <A name=F00D>
 <a name=F00D></a>F00D   A9 40      LDA #$40
 </A>
 <a name=F00F></a>F00F   8D 97 02   STA $<a href="ram.htm#0297">0297</a>
 <a name=F012></a>F012   18         CLC
 <a name=F013></a>F013   60         RTS
 
 <A name=F017> </A>
 ; buffer char to output on RS-232
 ;
 ; Note: Actual entry-point is F017, inside a loop.  F014 is used when that loop repeats.
 ; References: <A href="#F208">F208</A>

*<a name=F014></a>F014   20 28 F0   JSR $<A href="#F028">F028</A>

 <a name=F017></a>F017   AC 9E 02   LDY $029E       ;

 <a name=F01A></a>F01A   C8         INY             ;
 <a name=F01B></a>F01B   CC 9D 02   CPY $029D       ;
 <a name=F01E></a>F01E   F0 F4      BEQ $F014   *   ;
 <a name=F020></a>F020   8C 9E 02   STY $029E       ;
 <a name=F023></a>F023   88         DEY             ;
 <a name=F024></a>F024   A5 9E      LDA $9E         ;
 <a name=F026></a>F026   91 F9      STA ($F9),Y     ;
 <A name=F028>
 <a name=F028></a>F028   AD A1 02   LDA $<a href="ram.htm#02A1">02A1</a>       ; RS-232: CIA#2 NMI mask
 </A>
 <a name=F02B></a>F02B   4A         LSR             ;
 <a name=F02C></a>F02C   B0 1E      BCS $F04C   *   ;
 <a name=F02E></a>F02E   A9 10      LDA #$10        ;
 <a name=F030></a>F030   8D 0E DD   STA $DD0E       ;
 <a name=F033></a>F033   AD 99 02   LDA $0299       ;
 <a name=F036></a>F036   8D 04 DD   STA $DD04       ;
 <a name=F039></a>F039   AD 9A 02   LDA $029A       ;
 <a name=F03C></a>F03C   8D 05 DD   STA $DD05       ;
 <a name=F03F></a>F03F   A9 81      LDA #$81        ; 
 <a name=F041></a>F041   20 3B EF   JSR $<A href="#EF3B">EF3B</A>       ;
 <a name=F044></a>F044   20 06 EF   JSR $<A href="#EF06">EF06</A>       ;
 <a name=F047></a>F047   A9 11      LDA #$11
 <a name=F049></a>F049   8D 0E DD   STA $DD0E
*<a name=F04C></a>F04C   60         RTS
 
 <A name=F04D>
 ; initalise RS-232 input
 </A>
 <a name=F04D></a>F04D   85 99      STA $99         ;
 <a name=F04F></a>F04F   AD 94 02   LDA $0294       ;
 <a name=F052></a>F052   4A         LSR             ;
 <a name=F053></a>F053   90 28      BCC $F07D       ;
 <a name=F055></a>F055   29 08      AND #$08        ;
 <a name=F057></a>F057   F0 24      BEQ $F07D       ;
 <a name=F059></a>F059   A9 02      LDA #$02        ;
 <a name=F05B></a>F05B   2C 01 DD   BIT $DD01       ;
 <a name=F05E></a>F05E   10 AD      BPL $F00D       ;
 <a name=F060></a>F060   F0 22      BEQ $F084       ;
 <a name=F062></a>F062   AD A1 02   LDA $02A1       ; RS-232: CIA#2 NMI mask
 <a name=F065></a>F065   4A         LSR             ;
 <a name=F066></a>F066   B0 FA      BCS $F062       ;
 <a name=F068></a>F068   AD 01 DD   LDA $DD01       ;
 <a name=F06B></a>F06B   29 FD      AND #$FD        ;
 <a name=F06D></a>F06D   8D 01 DD   STA $DD01       ;
 <a name=F070></a>F070   AD 01 DD   LDA $DD01       ;
 <a name=F073></a>F073   29 04      AND #$04        ;
 <a name=F075></a>F075   F0 F9      BEQ $F070       ;
 <a name=F077></a>F077   A9 90      LDA #$90        ;
 <a name=F079></a>F079   18         CLC             ;
 <a name=F07A></a>F07A   4C 3B EF   JMP $<A href="#EF3B">EF3B</A>       ;
 
 <a name=F07D></a>F07D   AD A1 02   LDA $02A1       ; RS-232: CIA#2 NMI mask
 <a name=F080></a>F080   29 12      AND #$12        ;
 <a name=F082></a>F082   F0 F3      BEQ $F077       ;
 <a name=F084></a>F084   18         CLC             ;
 <a name=F085></a>F085   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->

 
<A name=F086> </A>
; <b>get next character from RS-232 input buffer</b>
;
; References:  <A href="#F150">F150</A>

 <a name=xxxx></a>F086   AD 97 02   LDA $<a href="ram.htm#0297">0297</a>       ; "6551" status register image...
 <a name=F089></a>F089   AC 9C 02   LDY $<a href="ram.htm#029C">029C</a>       ; RS-232 input buffer: index to start of data
 <a name=F08C></a>F08C   CC 9B 02   CPY $<a href="ram.htm#029B">029B</a>       ; index to end of data
 <a name=F08F></a>F08F   F0 0B      BEQ $F09C   *   ; buffer head = tail?  buffer empty
 <a name=F091></a>F091   29 F7      AND #$F7        ; clear bit 3 (???) of status
 <a name=F093></a>F093   8D 97 02   STA $<a href="ram.htm#0297">0297</a>       ; set status of "6551 status register image"
 <a name=F096></a>F096   B1 F7      LDA ($<A href="ram.htm#00F7">F7</A>),Y     ; get byte from buffer
 <a name=F098></a>F098   EE 9C 02   INC $<a href="ram.htm#029C">029C</a>       ; increment buffer tail pointer
 <a name=F09B></a>F09B   60         RTS             ; RETURN ... character in .A

*<a name=F09C></a>F09C   09 08      ORA #$08        ; Buffer empty... Set bit 3 in status
 <a name=F09E></a>F09E   8D 97 02   STA $<a href="ram.htm#0297">0297</a>       ; "6551 status register image"
 <a name=F0A1></a>F0A1   A9 00      LDA #$00        ; ANAT...transfer zero   ???  return 0 in .A
 <a name=F0A3></a>F0A3   60         RTS
 

<A name=F0A4> </A>
; <b>protect serial/cassette routine from RS-232 NMIs</b>
; If RS-232 I/O is currently using any interrupt sources on CIA#2, wait until
; RS-232 ISR relinquishes both timers A and B in its interrupt mask.  When that
; happens, this will clear all bits in the RS-232 mask and directly disable the
; interrupt input on the user port.
;
; <i>.A is preserved</i>
;     
; References:  <A href="#ED0E">ED0E</A> <A href="#F88A">F88A</A> <A href="#F88A">F88A</A> 

 <a name=xxxx></a>F0A4   48         PHA             ; preserve .A
 <a name=F0A5></a>F0A5   AD A1 02   LDA $<a href="ram.htm#02A1">02A1</a>       ; RS-232 interrupt NMI mask
 <a name=F0A8></a>F0A8   F0 11      BEQ $F0BB   *   ; no RS-232 interrupts enabled?  No interrupt will occur, so don't wait for one
*<a name=F0AA></a>F0AA   AD A1 02   LDA $<a href="ram.htm#02A1">02A1</a>       ; Watch RS-232 NMI mask for a change during interrupt
 <a name=F0AD></a>F0AD   29 03      AND #$03        ; ignore all but bits 0 and 1 (CIA#2 timers A and B)
 <a name=F0AF></a>F0AF   D0 F9      BNE $F0AA   *   ; if RS-232 is still using a timer, keep waiting.
 <a name=F0B1></a>F0B1   A9 10      LDA #$10        ; both CIA#2 timer interrupts have been surrendered by RS-232 system
 <a name=F0B3></a>F0B3   8D 0D DD   STA $DD0D       ; $10 clears bit 4, disabling #FLAG interrupt line
 <a name=F0B6></a>F0B6   A9 00      LDA #$00        ;
 <a name=F0B8></a>F0B8   8D A1 02   STA $02A1       ; completely clear interrupt mask for RS-232
*<a name=F0BB></a>F0BB   68         PLA             ; restore .A
 <a name=F0BC></a>F0BC   60         RTS

<A name=F0BD></A>
;<b>kernal I/O messages</b>
; Referenced by <A href="#F12B">F12B</A>: "print kernel message"

; I/O error                         <b>offset $00</b>
 <a name=F0BD></a>F0BD   .BY $0D
 <a name=F0BE></a>F0BE   .BY $49,$2F,$4F
 <a name=F0C1></a>F0C1   .BY $20,$45,$52,$52,$4F,$52
 <a name=F0C7></a>F0C7   .BY $20,$A3

; searching for                     <b>offset $0C</b>
 <a name=F0C9></a>F0C9   .BY $0D
 <a name=F0CA></a>F0CA   .BY $53,$45,$41,$52,$43,$48,$49,$4E,$47,$A0
 <a name=F0D4></a>F0D4   .BY $46,$4F,$52,$A0

; press play on tape                <b>offset $1B</b>
 <a name=F0D8></a>F0D8   .BY $0D
 <a name=F0D9></a>F0D9   .BY $50,$52,$45,$53,$53
 <a name=F0DE></a>F0DE   .BY $20,$50,$4C,$41,$59
 <a name=F0E3></a>F0E3   .BY $20,$4F,$4E
 <a name=F0E6></a>F0E6   .BY $20,$54,$41,$50,$C5

; press record and play on tape     <b>offset $2E</b>
 <a name=F0EB></a>F0EB   .BY $50,$52,$45,$53,$53
 <a name=F0F0></a>F0F0   .BY $20,$52,$45,$43,$4F,$52,$44
 <a name=F0F7></a>F0F7   .BY $20,$26
 <a name=F0F9></a>F0F9   .BY $20,$50,$4C,$41,$59
 <a name=F0FE></a>F0FE   .BY $20,$4F,$4E
 <a name=F101></a>F101   .BY $20,$54,$41,$50,$C5

; loading                           <b>offset $49</b>
 <a name=F106></a>F106   .BY $0D
 <a name=F107></a>F107   .BY $4C,$4F,$41,$44,$49,$4E,$C7

; saving                            <b>offset $51</b>
 <a name=F10E></a>F10E   .BY $0D
 <a name=F10F></a>F10F   .BY $53,$41,$56,$49,$4E,$47,$A0

; verifying                         <b>offset $59</b>
 <a name=F116></a>F116   .BY $0D
 <a name=F117></a>F117   .BY $56,$45,$52,$49,$46,$59,$49,$4E,$C7

; found                             <b>offset $63</b>
 <a name=F120></a>F120   .BY $0D
 <a name=F121></a>F121   .BY $46,$4F,$55,$4E,$44,$A0

; ok                                <b>offset $6A</b>
 <a name=F127></a>F127   .BY $0D
 <a name=F128></a>F128   .BY $4F,$4B,$8D

<A name=F12B></A> <a name=F12F></a>
; <b>print kernal I/O message</b>
; Outputs a message from the "kernal I/O messages" table, 
; identified by the offset passed in .Y .  If in program mode,
; the message is suppressed.
; IN: .Y = index relative to start of Kernal Messages table (at <A href="#F0BD">F0BD</A>)
;         NOTE: This is a <i>byte offset</i>, not a message number.
; OUT: .C -- Looks like Carry flag conveys some meaning back to caller... All paths to RTS cause .C to be cleared.  ???
;
; References:  <A href="#F5B5">F5B5</A> <A href="#F5BE">F5BE</A> <A href="#F5DA">F5DA</A> <A href="#F695">F695</A> <A href="#F71F">F71F</A> <A href="#F752">F752</A> <A href="#F81E">F81E</A> <A href="#F82B">F82B</A> 

 <a name=xxxx></a>F12B   24 9D      BIT $<A href="ram.htm#009D">9D</A>         ; simply checking for sign (bit 7) bit (0=prg/$80=dirct mode)
 <a name=F12D></a>F12D   10 0D      BPL $F13C   *   ; bit 7 clear?  yes, program mode. Exit w/o displaying message

; <b>Entry to skip check (assumes direct mode)</b>
*<a name=xxxx></a>F12F   B9 BD F0   LDA $<A href="#F0BD">F0BD</A>,Y     ; Get next character.  after load, .S = (bit 7)
 <a name=F132></a>F132   08         PHP             ; saves flags to check for Sign flag at end of loop
 <a name=F133></a>F133   29 7F      AND #$7F        ; Clear bit 7 (in case this <i>is</i> the last char)
 <a name=F135></a>F135   20 D2 FF   JSR $<A href="#FFD2">FFD2</A>       ; JSR $<A href="#F1CA">F1CA</A> by default; "output character"; goes through vector ($<a href="ram.htm#0326">0326</a>)
 <a name=F138></a>F138   C8         INY             ; advance to next char loc.
 <a name=F139></a>F139   28         PLP             ; retrieve flags that reflect loading the char, above
 <a name=F13A></a>F13A   10 F3      BPL $F12F   *   ; if .S = 0, not last char.  Loop
*<a name=F13C></a>F13C   18         CLC             ; ??? Why?
 <a name=F13D></a>F13D   60         RTS             ; 


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=F13E>
 ; get a character
 </A>
 <a name=F13E></a>F13E   A5 99      LDA $99
 <a name=F140></a>F140   D0 08      BNE $F14A
 <a name=F142></a>F142   A5 C6      LDA $C6
 <a name=F144></a>F144   F0 0F      BEQ $F155
 <a name=F146></a>F146   78         SEI
 <a name=F147></a>F147   4C B4 E5   JMP $<A href="#E5B4">E5B4</A>
 
 <a name=F14A></a>F14A   C9 02      CMP #$02
 <a name=F14C></a>F14C   D0 18      BNE $F166
 <A name=F14E>
 <a name=F14E></a>F14E   84 97      STY $97
 </A>
 <a name=F150></a>F150   20 86 F0   JSR $<A href="#F086">F086</A>
 <a name=F153></a>F153   A4 97      LDY $97
 <a name=F155></a>F155   18         CLC
 <a name=F156></a>F156   60         RTS
 
 <A name=F157>
 ; input a character
 </A>
 <a name=F157></a>F157   A5 99      LDA $99
 <a name=F159></a>F159   D0 0B      BNE $F166
 <a name=F15B></a>F15B   A5 D3      LDA $D3
 <a name=F15D></a>F15D   85 CA      STA $CA
 <a name=F15F></a>F15F   A5 D6      LDA $D6
 <a name=F161></a>F161   85 C9      STA $C9
 <a name=F163></a>F163   4C 32 E6   JMP $<A href="#E632">E632</A>
 
 <a name=F166></a>F166   C9 03      CMP #$03
 <a name=F168></a>F168   D0 09      BNE $F173
 <a name=F16A></a>F16A   85 D0      STA $D0
 <a name=F16C></a>F16C   A5 D5      LDA $D5
 <a name=F16E></a>F16E   85 C8      STA $C8
 <a name=F170></a>F170   4C 32 E6   JMP $<A href="#E632">E632</A>
 
 <a name=F173></a>F173   B0 38      BCS $F1AD
 <a name=F175></a>F175   C9 02      CMP #$02
 <a name=F177></a>F177   F0 3F      BEQ $F1B8
 <a name=F179></a>F179   86 97      STX $97
 <a name=F17B></a>F17B   20 99 F1   JSR $<A href="#F199">F199</A>
 <a name=F17E></a>F17E   B0 16      BCS $F196
 <a name=F180></a>F180   48         PHA
 <a name=F181></a>F181   20 99 F1   JSR $<A href="#F199">F199</A>
 <a name=F184></a>F184   B0 0D      BCS $F193
 <a name=F186></a>F186   D0 05      BNE $F18D
 <a name=F188></a>F188   A9 40      LDA #$40
 <a name=F18A></a>F18A   20 1C FE   JSR $<A href="#FE1C">FE1C</A>
 <a name=F18D></a>F18D   C6 A6      DEC $A6
 <a name=F18F></a>F18F   A6 97      LDX $97
 <a name=F191></a>F191   68         PLA
 <a name=F192></a>F192   60         RTS
 
 <a name=F193></a>F193   AA         TAX
 <a name=F194></a>F194   68         PLA
 <a name=F195></a>F195   8A         TXA
 <a name=F196></a>F196   A6 97      LDX $97
 <a name=F198></a>F198   60         RTS
 
 <A name=F199>
 ; read a byte from cassette buffer
 </A>
 <a name=F199></a>F199   20 0D F8   JSR $<A href="#F80D">F80D</A>
 <a name=F19C></a>F19C   D0 0B      BNE $F1A9
 <a name=F19E></a>F19E   20 41 F8   JSR $<A href="#F841">F841</A>
 <a name=F1A1></a>F1A1   B0 11      BCS $F1B4
 <a name=F1A3></a>F1A3   A9 00      LDA #$00
 <a name=F1A5></a>F1A5   85 A6      STA $A6
 <a name=F1A7></a>F1A7   F0 F0      BEQ $F199
 <a name=F1A9></a>F1A9   B1 B2      LDA ($B2),Y
 <a name=F1AB></a>F1AB   18         CLC
 <a name=F1AC></a>F1AC   60         RTS
 
 <a name=F1AD></a>F1AD   A5 90      LDA $90
 <a name=F1AF></a>F1AF   F0 04      BEQ $F1B5
 <a name=F1B1></a>F1B1   A9 0D      LDA #$0D
 <a name=F1B3></a>F1B3   18         CLC
 <a name=F1B4></a>F1B4   60         RTS
 
 <A name=F1B5>
 ; read a byte from serial bus
 </A>
 <a name=F1B5></a>F1B5   4C 13 EE   JMP $<A href="#EE13">EE13</A>
 
 <A name=F1B8>
 ; read a byte from RS-232 bus
 </A>
 <a name=F1B8></a>F1B8   20 4E F1   JSR $<A href="#F14E">F14E</A>
 <a name=F1BB></a>F1BB   B0 F7      BCS $F1B4
 <a name=F1BD></a>F1BD   C9 00      CMP #$00
 <a name=F1BF></a>F1BF   D0 F2      BNE $F1B3
 <a name=F1C1></a>F1C1   AD 97 02   LDA $0297
 <a name=F1C4></a>F1C4   29 60      AND #$60
 <a name=F1C6></a>F1C6   D0 E9      BNE $F1B1
 <a name=F1C8></a>F1C8   F0 EE      BEQ $F1B8
 
 <A name=F1CA>
 ; output a character
 </A>
 <a name=F1CA></a>F1CA   48         PHA
 <a name=F1CB></a>F1CB   A5 9A      LDA $9A
 <a name=F1CD></a>F1CD   C9 03      CMP #$03
 <a name=F1CF></a>F1CF   D0 04      BNE $F1D5
 <a name=F1D1></a>F1D1   68         PLA
 <a name=F1D2></a>F1D2   4C 16 E7   JMP $<A href="#E716">E716</A>
 
 <a name=F1D5></a>F1D5   90 04      BCC $F1DB
 <a name=F1D7></a>F1D7   68         PLA
 <a name=F1D8></a>F1D8   4C DD ED   JMP $<A href="#EDDD">EDDD</A>
 
 <a name=F1DB></a>F1DB   4A         LSR
 <a name=F1DC></a>F1DC   68         PLA
 <A name=F1DD>
 <a name=F1DD></a>F1DD   85 9E      STA $9E
 </A>
 <a name=F1DF></a>F1DF   8A         TXA
 <a name=F1E0></a>F1E0   48         PHA
 <a name=F1E1></a>F1E1   98         TYA
 <a name=F1E2></a>F1E2   48         PHA
 <a name=F1E3></a>F1E3   90 23      BCC $F208
 <a name=F1E5></a>F1E5   20 0D F8   JSR $<A href="#F80D">F80D</A>
 <a name=F1E8></a>F1E8   D0 0E      BNE $F1F8
 <a name=F1EA></a>F1EA   20 64 F8   JSR $<A href="#F864">F864</A>
 <a name=F1ED></a>F1ED   B0 0E      BCS $F1FD
 <a name=F1EF></a>F1EF   A9 02      LDA #$02
 <a name=F1F1></a>F1F1   A0 00      LDY #$00
 <a name=F1F3></a>F1F3   91 B2      STA ($B2),Y
 <a name=F1F5></a>F1F5   C8         INY
 <a name=F1F6></a>F1F6   84 A6      STY $A6
 <a name=F1F8></a>F1F8   A5 9E      LDA $9E
 <a name=F1FA></a>F1FA   91 B2      STA ($B2),Y
 <A name=F1FC>
 <a name=F1FC></a>F1FC   18         CLC
 </A>
 <a name=F1FD></a>F1FD   68         PLA
 <a name=F1FE></a>F1FE   A8         TAY
 <a name=F1FF></a>F1FF   68         PLA
 <a name=F200></a>F200   AA         TAX
 <a name=F201></a>F201   A5 9E      LDA $9E
 <a name=F203></a>F203   90 02      BCC $F207
 <a name=F205></a>F205   A9 00      LDA #$00
 <a name=F207></a>F207   60         RTS
 
 <a name=F208></a>F208   20 17 F0   JSR $<A href="#F017">F017</A>
 <a name=F20B></a>F20B   4C FC F1   JMP $<A href="#F1FC">F1FC</A>
 
 <A name=F20E>
 ; set input device
 </A>
 <a name=F20E></a>F20E   20 0F F3   JSR $<A href="#F30F">F30F</A>
 <a name=F211></a>F211   F0 03      BEQ $F216
 <a name=F213></a>F213   4C 01 F7   JMP $<A href="#F701">F701</A>
 
 <a name=F216></a>F216   20 1F F3   JSR $<A href="#F31F">F31F</A>
 <a name=F219></a>F219   A5 BA      LDA $BA
 <a name=F21B></a>F21B   F0 16      BEQ $F233
 <a name=F21D></a>F21D   C9 03      CMP #$03
 <a name=F21F></a>F21F   F0 12      BEQ $F233
 <a name=F221></a>F221   B0 14      BCS $F237
 <a name=F223></a>F223   C9 02      CMP #$02
 <a name=F225></a>F225   D0 03      BNE $F22A
 <a name=F227></a>F227   4C 4D F0   JMP $<A href="#F04D">F04D</A>
 
 <a name=F22A></a>F22A   A6 B9      LDX $B9
 <a name=F22C></a>F22C   E0 60      CPX #$60
 <a name=F22E></a>F22E   F0 03      BEQ $F233
 <a name=F230></a>F230   4C 0A F7   JMP $<A href="#F70A">F70A</A>
 
 <a name=F233></a>F233   85 99      STA $99
 <a name=F235></a>F235   18         CLC
 <a name=F236></a>F236   60         RTS
 
 <A name=F237>
 ; set serial bus input device
 </A>
 <a name=F237></a>F237   AA         TAX
 <a name=F238></a>F238   20 09 ED   JSR $<A href="#ED09">ED09</A>
 <a name=F23B></a>F23B   A5 B9      LDA $B9
 <a name=F23D></a>F23D   10 06      BPL $F245
 <a name=F23F></a>F23F   20 CC ED   JSR $<A href="#EDCC">EDCC</A>
 <a name=F242></a>F242   4C 48 F2   JMP $<A href="#F248">F248</A>
 
 <a name=F245></a>F245   20 C7 ED   JSR $<A href="#EDC7">EDC7</A>
 <A name=F248>
 <a name=F248></a>F248   8A         TXA
 </A>
 <a name=F249></a>F249   24 90      BIT $90
 <a name=F24B></a>F24B   10 E6      BPL $F233
 <a name=F24D></a>F24D   4C 07 F7   JMP $<A href="#F707">F707</A>
 
 <A name=F250>
 ; set output device
 </A>
 <a name=F250></a>F250   20 0F F3   JSR $<A href="#F30F">F30F</A>
 <a name=F253></a>F253   F0 03      BEQ $F258
 <a name=F255></a>F255   4C 01 F7   JMP $<A href="#F701">F701</A>
 
 <a name=F258></a>F258   20 1F F3   JSR $<A href="#F31F">F31F</A>
 <a name=F25B></a>F25B   A5 BA      LDA $BA
 <a name=F25D></a>F25D   D0 03      BNE $F262
 <a name=F25F></a>F25F   4C 0D F7   JMP $<A href="#F70D">F70D</A>
 
 <a name=F262></a>F262   C9 03      CMP #$03
 <a name=F264></a>F264   F0 0F      BEQ $F275
 <a name=F266></a>F266   B0 11      BCS $F279
 <a name=F268></a>F268   C9 02      CMP #$02
 <a name=F26A></a>F26A   D0 03      BNE $F26F
 <a name=F26C></a>F26C   4C E1 EF   JMP $<A href="#EFE1">EFE1</A>
 
 <a name=F26F></a>F26F   A6 B9      LDX $B9
 <a name=F271></a>F271   E0 60      CPX #$60
 <a name=F273></a>F273   F0 EA      BEQ $F25F
 <a name=F275></a>F275   85 9A      STA $9A
 <a name=F277></a>F277   18         CLC
 <a name=F278></a>F278   60         RTS
 
 <A name=F279>
 ; set serial bus output device
 </A>
 <a name=F279></a>F279   AA         TAX
 <a name=F27A></a>F27A   20 0C ED   JSR $<A href="#ED0C">ED0C</A>
 <a name=F27D></a>F27D   A5 B9      LDA $B9
 <a name=F27F></a>F27F   10 05      BPL $F286
 <a name=F281></a>F281   20 BE ED   JSR $<A href="#EDBE">EDBE</A>       ; De-assert ATN line
 <a name=F284></a>F284   D0 03      BNE $F289
 <a name=F286></a>F286   20 B9 ED   JSR $<A href="#EDB9">EDB9</A>
 <a name=F289></a>F289   8A         TXA
 <a name=F28A></a>F28A   24 90      BIT $90
 <a name=F28C></a>F28C   10 E7      BPL $F275
 <a name=F28E></a>F28E   4C 07 F7   JMP $<A href="#F707">F707</A>
 
 <A name=F291>
 ; close a file
 </A>
 <a name=F291></a>F291   20 14 F3   JSR $<A href="#F314">F314</A>
 <a name=F294></a>F294   F0 02      BEQ $F298
 <a name=F296></a>F296   18         CLC
 <a name=F297></a>F297   60         RTS
 
 <a name=F298></a>F298   20 1F F3   JSR $<A href="#F31F">F31F</A>
 <a name=F29B></a>F29B   8A         TXA
 <a name=F29C></a>F29C   48         PHA
 <a name=F29D></a>F29D   A5 BA      LDA $BA
 <a name=F29F></a>F29F   F0 50      BEQ $F2F1
 <a name=F2A1></a>F2A1   C9 03      CMP #$03
 <a name=F2A3></a>F2A3   F0 4C      BEQ $F2F1
 <a name=F2A5></a>F2A5   B0 47      BCS $F2EE
 <a name=F2A7></a>F2A7   C9 02      CMP #$02
 <a name=F2A9></a>F2A9   D0 1D      BNE $F2C8
 <a name=F2AB></a>F2AB   68         PLA
 <a name=F2AC></a>F2AC   20 F2 F2   JSR $<A href="#F2F2">F2F2</A>
 <a name=F2AF></a>F2AF   20 83 F4   JSR $<A href="#F483">F483</A>
 <a name=F2B2></a>F2B2   20 27 FE   JSR $<A href="#FE27">FE27</A>
 <a name=F2B5></a>F2B5   A5 F8      LDA $F8
 <a name=F2B7></a>F2B7   F0 01      BEQ $F2BA
 <a name=F2B9></a>F2B9   C8         INY
 <a name=F2BA></a>F2BA   A5 FA      LDA $FA
 <a name=F2BC></a>F2BC   F0 01      BEQ $F2BF
 <a name=F2BE></a>F2BE   C8         INY
 <a name=F2BF></a>F2BF   A9 00      LDA #$00
 <a name=F2C1></a>F2C1   85 F8      STA $F8
 <a name=F2C3></a>F2C3   85 FA      STA $FA
 <a name=F2C5></a>F2C5   4C 7D F4   JMP $<A href="#F47D">F47D</A>
 
 <A name=F2C8>
 ; close cassette device
 </A>
 <a name=F2C8></a>F2C8   A5 B9      LDA $B9
 <a name=F2CA></a>F2CA   29 0F      AND #$0F
 <a name=F2CC></a>F2CC   F0 23      BEQ $F2F1
 <a name=F2CE></a>F2CE   20 D0 F7   JSR $<A href="#F7D0">F7D0</A>
 <a name=F2D1></a>F2D1   A9 00      LDA #$00
 <a name=F2D3></a>F2D3   38         SEC
 <a name=F2D4></a>F2D4   20 DD F1   JSR $<A href="#F1DD">F1DD</A>
 <a name=F2D7></a>F2D7   20 64 F8   JSR $<A href="#F864">F864</A>
 <a name=F2DA></a>F2DA   90 04      BCC $F2E0
 <a name=F2DC></a>F2DC   68         PLA
 <a name=F2DD></a>F2DD   A9 00      LDA #$00
 <a name=F2DF></a>F2DF   60         RTS
 
 <a name=F2E0></a>F2E0   A5 B9      LDA $B9
 <a name=F2E2></a>F2E2   C9 62      CMP #$62
 <a name=F2E4></a>F2E4   D0 0B      BNE $F2F1
 <a name=F2E6></a>F2E6   A9 05      LDA #$05
 <a name=F2E8></a>F2E8   20 6A F7   JSR $<A href="#F76A">F76A</A>
 <a name=F2EB></a>F2EB   4C F1 F2   JMP $<A href="#F2F1">F2F1</A>
 
 <A name=F2EE>
 ; close serial bus device
 </A>
 <a name=F2EE></a>F2EE   20 42 F6   JSR $<A href="#F642">F642</A>
 <A name=F2F1>
 <a name=F2F1></a>F2F1   68         PLA
 </A>
 
 <A name=F2F2>
 ; reorganise file tables
 </A>
 <a name=F2F2></a>F2F2   AA         TAX
 <a name=F2F3></a>F2F3   C6 98      DEC $98
 <a name=F2F5></a>F2F5   E4 98      CPX $98
 <a name=F2F7></a>F2F7   F0 14      BEQ $F30D
 <a name=F2F9></a>F2F9   A4 98      LDY $98
 <a name=F2FB></a>F2FB   B9 59 02   LDA $0259,Y
 <a name=F2FE></a>F2FE   9D 59 02   STA $0259,X
 <a name=F301></a>F301   B9 63 02   LDA $0263,Y
 <a name=F304></a>F304   9D 63 02   STA $0263,X
 <a name=F307></a>F307   B9 6D 02   LDA $026D,Y
 <a name=F30A></a>F30A   9D 6D 02   STA $026D,X
 <a name=F30D></a>F30D   18         CLC
 <a name=F30E></a>F30E   60         RTS
 
 <A name=F30F>
 ; check X against logical file table
 </A>
 <a name=F30F></a>F30F   A9 00      LDA #$00
 <a name=F311></a>F311   85 90      STA $90
 <a name=F313></a>F313   8A         TXA
 <A name=F314>
 <a name=F314></a>F314   A6 98      LDX $98
 </A>
 <a name=F316></a>F316   CA         DEX
 <a name=F317></a>F317   30 15      BMI $F32E
 <a name=F319></a>F319   DD 59 02   CMP $0259,X
 <a name=F31C></a>F31C   D0 F8      BNE $F316
 <a name=F31E></a>F31E   60         RTS
 
 <A name=F31F>
 ; set file parameters depending on X
 </A>
 <a name=F31F></a>F31F   BD 59 02   LDA $0259,X
 <a name=F322></a>F322   85 B8      STA $B8
 <a name=F324></a>F324   BD 63 02   LDA $0263,X
 <a name=F327></a>F327   85 BA      STA $BA
 <a name=F329></a>F329   BD 6D 02   LDA $026D,X
 <a name=F32C></a>F32C   85 B9      STA $B9
 <a name=F32E></a>F32E   60         RTS
 
 <A name=F32F>
 ; close all files
 </A>
 <a name=F32F></a>F32F   A9 00      LDA #$00
 <a name=F331></a>F331   85 98      STA $98
 
 <A name=F333>
 ; restore I/O to default devices
 </A>
 <a name=F333></a>F333   A2 03      LDX #$03
 <a name=F335></a>F335   E4 9A      CPX $9A
 <a name=F337></a>F337   B0 03      BCS $F33C
 <a name=F339></a>F339   20 FE ED   JSR $<A href="#EDFE">EDFE</A>
 <a name=F33C></a>F33C   E4 99      CPX $99
 <a name=F33E></a>F33E   B0 03      BCS $F343
 <a name=F340></a>F340   20 EF ED   JSR $<A href="#EDEF">EDEF</A>
 <a name=F343></a>F343   86 9A      STX $9A
 <a name=F345></a>F345   A9 00      LDA #$00
 <a name=F347></a>F347   85 99      STA $99
 <a name=F349></a>F349   60         RTS
 
 <A name=F34A>
 ; open a file
 </A>
 <a name=F34A></a>F34A   A6 B8      LDX $B8
 <a name=F34C></a>F34C   D0 03      BNE $F351
 <a name=F34E></a>F34E   4C 0A F7   JMP $<A href="#F70A">F70A</A>
 
 <a name=F351></a>F351   20 0F F3   JSR $<A href="#F30F">F30F</A>
 <a name=F354></a>F354   D0 03      BNE $F359
 <a name=F356></a>F356   4C FE F6   JMP $<A href="#F6FE">F6FE</A>
 
 <a name=F359></a>F359   A6 98      LDX $98
 <a name=F35B></a>F35B   E0 0A      CPX #$0A
 <a name=F35D></a>F35D   90 03      BCC $F362
 <a name=F35F></a>F35F   4C FB F6   JMP $<A href="#F6FB">F6FB</A>
 
 <a name=F362></a>F362   E6 98      INC $98
 <a name=F364></a>F364   A5 B8      LDA $B8
 <a name=F366></a>F366   9D 59 02   STA $0259,X
 <a name=F369></a>F369   A5 B9      LDA $B9
 <a name=F36B></a>F36B   09 60      ORA #$60
 <a name=F36D></a>F36D   85 B9      STA $B9
 <a name=F36F></a>F36F   9D 6D 02   STA $026D,X
 <a name=F372></a>F372   A5 BA      LDA $BA
 <a name=F374></a>F374   9D 63 02   STA $0263,X
 <a name=F377></a>F377   F0 5A      BEQ $F3D3
 <a name=F379></a>F379   C9 03      CMP #$03
 <a name=F37B></a>F37B   F0 56      BEQ $F3D3
 <a name=F37D></a>F37D   90 05      BCC $F384
 <a name=F37F></a>F37F   20 D5 F3   JSR $<A href="#F3D5">F3D5</A>
 <a name=F382></a>F382   90 4F      BCC $F3D3
 <a name=F384></a>F384   C9 02      CMP #$02
 <a name=F386></a>F386   D0 03      BNE $F38B
 <a name=F388></a>F388   4C 09 F4   JMP $<A href="#F409">F409</A>
 
 <A name=F38B>
 ; open for cassette device
 </A>
 <a name=F38B></a>F38B   20 D0 F7   JSR $<A href="#F7D0">F7D0</A>
 <a name=F38E></a>F38E   B0 03      BCS $F393
 <a name=F390></a>F390   4C 13 F7   JMP $<A href="#F713">F713</A>
 
 <a name=F393></a>F393   A5 B9      LDA $B9
 <a name=F395></a>F395   29 0F      AND #$0F
 <a name=F397></a>F397   D0 1F      BNE $F3B8
 <a name=F399></a>F399   20 17 F8   JSR $<A href="#F817">F817</A>
 <a name=F39C></a>F39C   B0 36      BCS $F3D4
 <a name=F39E></a>F39E   20 AF F5   JSR $<A href="#F5AF">F5AF</A>
 <a name=F3A1></a>F3A1   A5 B7      LDA $B7
 <a name=F3A3></a>F3A3   F0 0A      BEQ $F3AF
 <a name=F3A5></a>F3A5   20 EA F7   JSR $<A href="#F7EA">F7EA</A>
 <a name=F3A8></a>F3A8   90 18      BCC $F3C2
 <a name=F3AA></a>F3AA   F0 28      BEQ $F3D4
 <a name=F3AC></a>F3AC   4C 04 F7   JMP $<A href="#F704">F704</A>
 
 <a name=F3AF></a>F3AF   20 2C F7   JSR $<A href="#F72C">F72C</A>
 <a name=F3B2></a>F3B2   F0 20      BEQ $F3D4
 <a name=F3B4></a>F3B4   90 0C      BCC $F3C2
 <a name=F3B6></a>F3B6   B0 F4      BCS $F3AC
 
 <A name=F3B8>
 ; open cassette for input
 </A>
 <a name=F3B8></a>F3B8   20 38 F8   JSR $<A href="#F838">F838</A>
 <a name=F3BB></a>F3BB   B0 17      BCS $F3D4
 <a name=F3BD></a>F3BD   A9 04      LDA #$04
 <a name=F3BF></a>F3BF   20 6A F7   JSR $<A href="#F76A">F76A</A>
 <a name=F3C2></a>F3C2   A9 BF      LDA #$BF
 <a name=F3C4></a>F3C4   A4 B9      LDY $B9
 <a name=F3C6></a>F3C6   C0 60      CPY #$60
 <a name=F3C8></a>F3C8   F0 07      BEQ $F3D1
 <a name=F3CA></a>F3CA   A0 00      LDY #$00
 <a name=F3CC></a>F3CC   A9 02      LDA #$02
 <a name=F3CE></a>F3CE   91 B2      STA ($B2),Y
 <a name=F3D0></a>F3D0   98         TYA
 <a name=F3D1></a>F3D1   85 A6      STA $A6
*<a name=F3D3></a>F3D3   18         CLC
*<a name=F3D4></a>F3D4   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=F3D5> </A>
;<b> open for serial bus devices </b>
;    Referenced by:  <A href="#F37F">F37F</A> <A href="#F4C8">F4C8</A> <A href="#F605">F605</A> 

 <a name=xxxx></a>F3D5   A5 B9      LDA $<A href="ram.htm#00B9">B9</A>         ; secondary address
 <a name=F3D7></a>F3D7   30 FA      BMI $F3D3   -   ; SA >= $80?  clear .C then RTS    (???  What's the significance of SA >= 128???)
 <a name=F3D9></a>F3D9   A4 B7      LDY $<A href="ram.htm#00B7">B7</A>         ; filename length
 <a name=F3DB></a>F3DB   F0 F6      BEQ $F3D3   -   ; Empty string?  Clear .C then RTS (???  What are some usage cases for opening file w/o filename?  Doing so automatically succeeds)
 <a name=F3DD></a>F3DD   A9 00      LDA #$00        ; 
*<a name=F3DF></a>F3DF   85 90      STA $<A href="ram.htm#0090">90</A>         ; clear status word
 <a name=F3E1></a>F3E1   A5 BA      LDA $<A href="ram.htm#00BA">BA</A>         ; get device number
 <a name=F3E3></a>F3E3   20 0C ED   JSR $<A href="#ED0C">ED0C</A>       ; anat: LISTEN
 <a name=F3E6></a>F3E6   A5 B9      LDA $<A href="ram.htm#00B9">B9</A>         ; secondary address
 <a name=F3E8></a>F3E8   09 F0      ORA #$F0        ; Add secondary command "open" ($F0)
 <a name=F3EA></a>F3EA   20 B9 ED   JSR $<A href="#EDB9">EDB9</A>       ; Send secondary address (after listen)
 <a name=F3ED></a>F3ED   A5 90      LDA $<A href="ram.htm#0090">90</A>         ; status word
 <a name=F3EF></a>F3EF   10 05      BPL $F3F6   +   ; Check bit 7, "device not present".  Clear = OK
 <a name=F3F1></a>F3F1   68         PLA             ; Error: No devices answered... remove return address...
 <a name=F3F2></a>F3F2   68         PLA             ; (??? Is this really necessary?  Doesn't the stack get reset after error messages anyway??)
 <a name=F3F3></a>F3F3   4C 07 F7   JMP $<A href="#F707">F707</A>       ; "Device not present" error
 
*<a name=F3F6></a>F3F6   A5 B7      LDA $<A href="ram.htm#00B7">B7</A>         ; USELESS...
 <a name=F3F8></a>F3F8   F0 0C      BEQ $F406   +   ; WILL NEVER BE TAKEN (empty filename already checked above)
 <a name=F3FA></a>F3FA   A0 00      LDY #$00        ; Loop counter/index to chr in string
*<a name=F3FC></a>F3FC   B1 BB      LDA ($<A href="ram.htm#00BB">BB</A>),Y     ; filename
 <a name=F3FE></a>F3FE   20 DD ED   JSR $<A href="#EDDD">EDDD</A>       ; Output byte on serial bus
 <a name=F401></a>F401   C8         INY             ; next character
 <a name=F402></a>F402   C4 B7      CPY $<A href="ram.htm#00B7">B7</A>         ; end of name?
 <a name=F404></a>F404   D0 F6      BNE $F3FC   -   ; nope, loop
*<a name=F406></a>F406   4C 54 F6   JMP $<A href="#F654">F654</A>       ; Send unlisten, CLC and RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=F409>
 ; open RS-232 device
 </A>
 <a name=F409></a>F409   20 83 F4   JSR $<A href="#F483">F483</A>
 <a name=F40C></a>F40C   8C 97 02   STY $0297
 <a name=F40F></a>F40F   C4 B7      CPY $B7
 <a name=F411></a>F411   F0 0A      BEQ $F41D
 <a name=F413></a>F413   B1 BB      LDA ($BB),Y
 <a name=F415></a>F415   99 93 02   STA $0293,Y
 <a name=F418></a>F418   C8         INY
 <a name=F419></a>F419   C0 04      CPY #$04
 <a name=F41B></a>F41B   D0 F2      BNE $F40F
 <a name=F41D></a>F41D   20 4A EF   JSR $<A href="#EF4A">EF4A</A>
 <a name=F420></a>F420   8E 98 02   STX $0298
 <a name=F423></a>F423   AD 93 02   LDA $0293
 <a name=F426></a>F426   29 0F      AND #$0F
 <a name=F428></a>F428   F0 1C      BEQ $F446
 <a name=F42A></a>F42A   0A         ASL
 <a name=F42B></a>F42B   AA         TAX
 <a name=F42C></a>F42C   AD A6 02   LDA $02A6
 <a name=F42F></a>F42F   D0 09      BNE $F43A
 <a name=F431></a>F431   BC C1 FE   LDY $FEC1,X
 <a name=F434></a>F434   BD C0 FE   LDA $FEC0,X
 <a name=F437></a>F437   4C 40 F4   JMP $<A href="#F440">F440</A>
 <a name=F43A></a>F43A   BC EB E4   LDY $E4EB,X
 <a name=F43D></a>F43D   BD EA E4   LDA $E4EA,X
 <A name=F440>
 <a name=F440></a>F440   8C 96 02   STY $0296
 </A>
 <a name=F443></a>F443   8D 95 02   STA $0295
 <a name=F446></a>F446   AD 95 02   LDA $0295
 <a name=F449></a>F449   0A         ASL
 <a name=F44A></a>F44A   20 2E FF   JSR $<A href="#FF2E">FF2E</A>
 <a name=F44D></a>F44D   AD 94 02   LDA $0294
 <a name=F450></a>F450   4A         LSR
 <a name=F451></a>F451   90 09      BCC $F45C
 <a name=F453></a>F453   AD 01 DD   LDA $DD01
 <a name=F456></a>F456   0A         ASL
 <a name=F457></a>F457   B0 03      BCS $F45C
 <a name=F459></a>F459   20 0D F0   JSR $<A href="#F00D">F00D</A>
 <a name=F45C></a>F45C   AD 9B 02   LDA $029B
 <a name=F45F></a>F45F   8D 9C 02   STA $029C
 <a name=F462></a>F462   AD 9E 02   LDA $029E
 <a name=F465></a>F465   8D 9D 02   STA $029D
 <a name=F468></a>F468   20 27 FE   JSR $<A href="#FE27">FE27</A>
 <a name=F46B></a>F46B   A5 F8      LDA $F8
 <a name=F46D></a>F46D   D0 05      BNE $F474
 <a name=F46F></a>F46F   88         DEY
 <a name=F470></a>F470   84 F8      STY $F8
 <a name=F472></a>F472   86 F7      STX $F7
 <a name=F474></a>F474   A5 FA      LDA $FA
 <a name=F476></a>F476   D0 05      BNE $F47D
 <a name=F478></a>F478   88         DEY
 <a name=F479></a>F479   84 FA      STY $FA
 <a name=F47B></a>F47B   86 F9      STX $F9
 <A name=F47D>
 <a name=F47D></a>F47D   38         SEC
 </A>
 <a name=F47E></a>F47E   A9 F0      LDA #$F0
 <a name=F480></a>F480   4C 2D FE   JMP $<A href="#FE2D">FE2D</A>
 
 <A name=F483>
 ; initialise CIA2
 </A>
 <a name=xxxx></a>F483   A9 7F      LDA #$7F        
 <a name=F485></a>F485   8D 0D DD   STA $DD0D       ; Disable all NMI sources in CIA#2
 <a name=F488></a>F488   A9 06      LDA #$06
 <a name=F48A></a>F48A   8D 03 DD   STA $DD03       ;
 <a name=F48D></a>F48D   8D 01 DD   STA $DD01
 <a name=F490></a>F490   A9 04      LDA #$04
 <a name=F492></a>F492   0D 00 DD   ORA $DD00
 <a name=F495></a>F495   8D 00 DD   STA $DD00
 <a name=F498></a>F498   A0 00      LDY #$00
 <a name=F49A></a>F49A   8C A1 02   STY $02A1       ; Clear all enables in RS-232 NMI mask
 <a name=F49D></a>F49D   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->

 
<A name=F49E></A>
;<b> load ram from a device </b>
;    References:   JMP vector <A href="#FFD5">FFD5</A>, which is referenced only by <a name=E175>E175</a>
;
; IN: .X/.Y = default load address;  
;     .A = Load/Verify flag
;
; Before redirecting to the core load routine, saves "default" load address to 
; $<A href="ram.htm#00C3">C3/C4</A>.

 <a name=xxxx></a>F49E   86 C3      STX $<a href="ram.htm#00C3">C3</a>         ; Save default load address into "Tape Load Temps"
 <a name=F4A0></a>F4A0   84 C4      STY $<a href="ram.htm#00C4">C4</a>
 <a name=F4A2></a>F4A2   6C 30 03   JMP ($<a href="ram.htm#0330">0330</a>)     ; normally $<A href="#F4A5">F4A5</A>, stay here at "standard load" 

<A name=F4A5></A>
; standard <b>load ram from device</b>
; IN: .A = Load/Verify flag
;     $C3/C4 holds requested (default) start address
;     Filename, device#, and secondary address are in addresses locations $B7..BC

 <a name=xxxx></a>F4A5   85 93      STA $<a href="ram.htm#0093">93</a>         ; Store Load/Verify flag in $93 (as opposed to <a href="ram.htm#000A">0A</a> ???) 
 <a name=F4A7></a>F4A7   A9 00      LDA #$00
 <a name=F4A9></a>F4A9   85 90      STA $<a href="ram.htm#0090">90</a>         ; Clear status word
 <a name=F4AB></a>F4AB   A5 BA      LDA $<a href="ram.htm#00BA">BA</a>         ; Retrieve current device number
 <a name=F4AD></a>F4AD   D0 03      BNE $F4B2   +   ; device zero (keyboard)?  no: skip error
*<a name=F4AF></a>F4AF   4C 13 F7   JMP $<A href="#F713">F713</A>       ; "ILLEGAL DEVICE NUMBER"
 
*<a name=F4B2></a>F4B2   C9 03      CMP #$03        ; Device 3 (screen)?
 <a name=F4B4></a>F4B4   F0 F9      BEQ $F4AF   -   ; yes: ILLEGAL DEVICE
 <a name=F4B6></a>F4B6   90 7B      BCC $<A href="#F533">F533</A>       ; Device < 3? Do cassette load

;<b> IEC bus load </b>
 <a name=F4B8></a>F4B8   A4 B7      LDY $<A href="ram.htm#00B7">B7</A>         ; length of filename
 <a name=F4BA></a>F4BA   D0 03      BNE $F4BF   +   ; is there a filename?  yes, skip error
 <a name=F4BC></a>F4BC   4C 10 F7   JMP $<A href="#F710">F710</A>       ; IEC bus loads require a filename.  "FILENAME MISSING" error

*<a name=F4BF></a>F4BF   A6 B9      LDX $<A href="ram.htm#00B9">B9</A>         ; Preserve "secondary address" in .X (not used until F4E5)
 <a name=F4C1></a>F4C1   20 AF F5   JSR $<A href="#F5AF">F5AF</A>       ; outputs "searching for <i>filename</i>"        ??? Why is 2nd adr loaded before printing this??
 <a name=F4C4></a>F4C4   A9 60      LDA #$60        ;  (!!! refer to Serial Bus commands table)
 <a name=F4C6></a>F4C6   85 B9      STA $<A href="ram.htm#00B9">B9</A>         ; Load always uses channel 0, not secondary address given by user
 <a name=F4C8></a>F4C8   20 D5 F3   JSR $<A href="#F3D5">F3D5</A>       ; Open for serial bus devices
 <a name=F4CB></a>F4CB   A5 BA      LDA $<A href="ram.htm#00BA">BA</A>         ; device number
 <a name=F4CD></a>F4CD   20 09 ED   JSR $<A href="#ED09">ED09</A>       ; Send TALK on serial bus
 <a name=F4D0></a>F4D0   A5 B9      LDA $<A href="ram.htm#00B9">B9</A>         ; 
 <a name=F4D2></a>F4D2   20 C7 ED   JSR $<A href="#EDC7">EDC7</A>       ; Send secondary address after TALK
 <a name=F4D5></a>F4D5   20 13 EE   JSR $<A href="#EE13">EE13</A>       ; Input byte on serial bus
 <a name=F4D8></a>F4D8   85 AE      STA $<A href="ram.htm#00AE">AE</A>         ; 1st byte of load address
 <a name=F4DA></a>F4DA   A5 90      LDA $<A href="ram.htm#0090">90</A>         ; Status word
 <a name=F4DC></a>F4DC   4A         LSR             ;
 <a name=F4DD></a>F4DD   4A         LSR             ; Check bit 1 (timeout on read)
 <a name=F4DE></a>F4DE   B0 50      BCS $F530   +   ;    Set? give "file not found"
 <a name=F4E0></a>F4E0   20 13 EE   JSR $<A href="#EE13">EE13</A>       ; Input byte on serial bus
 <a name=F4E3></a>F4E3   85 AF      STA $<A href="ram.htm#00AF">AF</A>         ; 2nd byte of load address
 <a name=F4E5></a>F4E5   8A         TXA             ; Get original "secondary address" from save command
 <a name=F4E6></a>F4E6   D0 08      BNE $F4F0   +   ; nonzero SA uses load address from file...
 <a name=F4E8></a>F4E8   A5 C3      LDA $<A href="ram.htm#00C3">C3</A>         ;
 <a name=F4EA></a>F4EA   85 AE      STA $<A href="ram.htm#00AE">AE</A>         ;
 <a name=F4EC></a>F4EC   A5 C4      LDA $<A href="ram.htm#00C4">C4</A>         ;
 <a name=F4EE></a>F4EE   85 AF      STA $<A href="ram.htm#00AF">AF</A>         ; Copy "default" load address, passed into kernal save, over load address found in file
*<a name=F4F0></a>F4F0   20 D2 F5   JSR $<A href="#F5D2">F5D2</A>       ; Output loading/verifying message
*<a name=F4F3></a>F4F3   A9 FD      LDA #$FD        ; TOP OF LOAD LOOP
*<a name=F4F5></a>F4F5   25 90      AND $<A href="ram.htm#0090">90</A>         ; clear bit 1 (end of file) in Status word
 <a name=F4F7></a>F4F7   85 90      STA $<A href="ram.htm#0090">90</A>         ; ??? Why ignore/clear end of file bit?
 <a name=F4F9></a>F4F9   20 E1 FF   JSR $<A href="#FFE1">FFE1</A>       ; Check stop key... redirects via vector at $<a href="ram.htm#0328">0328</a> (normally to <A href="#F6ED">F6ED</A>)
 <a name=F4FC></a>F4FC   D0 03      BNE $F501   +   ;    not pressed?
 <a name=F4FE></a>F4FE   4C 33 F6   JMP $<A href="#F633">F633</A>       ; STOP key pressed: close file & output BREAK message
 
*<a name=F501></a>F501   20 13 EE   JSR $<A href="#EE13">EE13</A>       ; Input byte on serial bus
 <a name=F504></a>F504   AA         TAX             ; save data byte while checking status
 <a name=F505></a>F505   A5 90      LDA $<A href="ram.htm#0090">90</A>         ; Status word
 <a name=F507></a>F507   4A         LSR             ;
 <a name=F508></a>F508   4A         LSR             ; Check bit 1
 <a name=F509></a>F509   B0 E8      BCS $F4F3   -   ; Timeout on read. Keep trying!!! ???
 <a name=F50B></a>F50B   8A         TXA             ; data byte is valid
 <a name=F50C></a>F50C   A4 93      LDY $<A href="ram.htm#0093">93</A>         ; load / verify flag
 <a name=F50E></a>F50E   F0 0C      BEQ $F51C   +   ; 0=load... skip compare
 <a name=F510></a>F510   A0 00      LDY #$00        ; ??? Why is this done for compare, but not for load??
 <a name=F512></a>F512   D1 AE      CMP ($<A href="ram.htm#00AE">AE</A>),Y     ; Compare byte to memory
 <a name=F514></a>F514   F0 08      BEQ $F51E   +   ; Same? move on
 <a name=F516></a>F516   A9 10      LDA #$10        ; Miscompare...
 <a name=F518></a>F518   20 1C FE   JSR $<A href="#FE1C">FE1C</A>       ; Set bit in STATUS
 <a name=F51B></a>F51B   .BY $2C                    ; (Skip load operation if we were verifying)  !!! BIT trick
*<a name=F51C></a>F51C   91 AE      STA ($<A href="ram.htm#00AE">AE</A>),Y     ; LOAD: store the byte in memory
*<a name=F51E></a>F51E   E6 AE      INC $<A href="ram.htm#00AE">AE</A>         ; Increment load address LO
 <a name=F520></a>F520   D0 02      BNE $F524   +   ; (no carry)
 <a name=F522></a>F522   E6 AF      INC $<A href="ram.htm#00AF">AF</A>         ; Increment load address HI
*<a name=F524></a>F524   24 90      BIT $<A href="ram.htm#0090">90</A>         ; Test bit 6 (end of file)
 <a name=F526></a>F526   50 CB      BVC $F4F3   -   ; not EOF? loop
 <a name=F528></a>F528   20 EF ED   JSR $<A href="#EDEF">EDEF</A>       ; Send Untalk on serial bus
 <a name=F52B></a>F52B   20 42 F6   JSR $<A href="#F642">F642</A>       ; Close serial bus device
 <a name=F52E></a>F52E   90 79      BCC $F5A9   +   ; Success? skip to end
*<a name=F530></a>F530   4C 04 F7   JMP $<A href="#F704">F704</A>       ; "File not found" error if close fails ???

; differentiate cassette / RS-232                         <a name=F533></a>
*<a name=xxxx></a>F533   4A         LSR             ; Device # will be in A, and will be 1 or 2.  Check LSb
 <a name=F534></a>F534   B0 03      BCS $F539   +   ; if .C=1, dev# is 1 (odd).  Continue load from cassette
 <a name=F536></a>F536   4C 13 F7   JMP $<A href="#F713">F713</A>       ; device = 2 (RS-232).  "ILLEGAL DEVICE"


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->

<a name=F539></a> 
;<b> load from cassette </b>

*<a name=xxxx></a>F539   20 D0 F7   JSR $<A href="#F7D0">F7D0</A>       ; 
 <a name=F53C></a>F53C   B0 03      BCS $F541   +   ;
 <a name=F53E></a>F53E   4C 13 F7   JMP $<A href="#F713">F713</A>       ;
*<a name=F541></a>F541   20 17 F8   JSR $<A href="#F817">F817</A>       ;
 <a name=F544></a>F544   B0 68      BCS $F5AE   +   ;
 <a name=F546></a>F546   20 AF F5   JSR $<A href="#F5AF">F5AF</A>       ;
*<a name=F549></a>F549   A5 B7      LDA $<A href="ram.htm#00B7">B7</A>         ;
 <a name=F54B></a>F54B   F0 09      BEQ $F556   +   ;
 <a name=F54D></a>F54D   20 EA F7   JSR $<A href="#F7EA">F7EA</A>       ;
 <a name=F550></a>F550   90 0B      BCC $F55D   +   ;
 <a name=F552></a>F552   F0 5A      BEQ $F5AE   +   ;
 <a name=F554></a>F554   B0 DA      BCS $F530   -   ;
*<a name=F556></a>F556   20 2C F7   JSR $<A href="#F72C">F72C</A>       ;
 <a name=F559></a>F559   F0 53      BEQ $F5AE   +   ;
 <a name=F55B></a>F55B   B0 D3      BCS $F530   -   ;
*<a name=F55D></a>F55D   A5 90      LDA $<A href="ram.htm#0090">90</A>         ;
 <a name=F55F></a>F55F   29 10      AND #$10        ;
 <a name=F561></a>F561   38         SEC             ;
 <a name=F562></a>F562   D0 4A      BNE $F5AE   +   ;
 <a name=F564></a>F564   E0 01      CPX #$01        ;
 <a name=F566></a>F566   F0 11      BEQ $F579   +   ;
 <a name=F568></a>F568   E0 03      CPX #$03        ;
 <a name=F56A></a>F56A   D0 DD      BNE $F549   -   ;
*<a name=F56C></a>F56C   A0 01      LDY #$01        ;
 <a name=F56E></a>F56E   B1 B2      LDA ($<A href="ram.htm#00B2">B2</A>),Y     ;
 <a name=F570></a>F570   85 C3      STA $<A href="ram.htm#00C3">C3</A>         ;
 <a name=F572></a>F572   C8         INY             ;
 <a name=F573></a>F573   B1 B2      LDA ($<A href="ram.htm#00B2">B2</A>),Y     ;
 <a name=F575></a>F575   85 C4      STA $<A href="ram.htm#00C4">C4</A>         ;
 <a name=F577></a>F577   B0 04      BCS $F57D   +   ;
*<a name=F579></a>F579   A5 B9      LDA $<A href="ram.htm#00B9">B9</A>         ;
 <a name=F57B></a>F57B   D0 EF      BNE $F56C   -   ;
*<a name=F57D></a>F57D   A0 03      LDY #$03        ;
 <a name=F57F></a>F57F   B1 B2      LDA ($<A href="ram.htm#00B2">B2</A>),Y     ;
 <a name=F581></a>F581   A0 01      LDY #$01        ;
 <a name=F583></a>F583   F1 B2      SBC ($<A href="ram.htm#00B2">B2</A>),Y     ;
 <a name=F585></a>F585   AA         TAX             ;
 <a name=F586></a>F586   A0 04      LDY #$04        ;
 <a name=F588></a>F588   B1 B2      LDA ($<A href="ram.htm#00B2">B2</A>),Y     ;
 <a name=F58A></a>F58A   A0 02      LDY #$02        ;
 <a name=F58C></a>F58C   F1 B2      SBC ($<A href="ram.htm#00B2">B2</A>),Y     ;
 <a name=F58E></a>F58E   A8         TAY             ;
 <a name=F58F></a>F58F   18         CLC             ;
 <a name=F590></a>F590   8A         TXA             ;
 <a name=F591></a>F591   65 C3      ADC $<A href="ram.htm#00C3">C3</A>         ;
 <a name=F593></a>F593   85 AE      STA $<A href="ram.htm#00AE">AE</A>         ;
 <a name=F595></a>F595   98         TYA             ;
 <a name=F596></a>F596   65 C4      ADC $<A href="ram.htm#00C4">C4</A>         ;
 <a name=F598></a>F598   85 AF      STA $<A href="ram.htm#00AF">AF</A>         ;
 <a name=F59A></a>F59A   A5 C3      LDA $<A href="ram.htm#00C3">C3</A>         ;
 <a name=F59C></a>F59C   85 C1      STA $<A href="ram.htm#00C1">C1</A>         ;
 <a name=F59E></a>F59E   A5 C4      LDA $<A href="ram.htm#00C4">C4</A>         ;
 <a name=F5A0></a>F5A0   85 C2      STA $<A href="ram.htm#00C2">C2</A>         ;
 <a name=F5A2></a>F5A2   20 D2 F5   JSR $<A href="#F5D2">F5D2</A>       ;
 <a name=F5A5></a>F5A5   20 4A F8   JSR $<A href="#F84A">F84A</A>       ;
 <a name=F5A8></a>F5A8   .BY $24                    ;
*<a name=F5A9></a>F5A9   18         CLC             ;
 <a name=F5AA></a>F5AA   A6 AE      LDX $<A href="ram.htm#00AE">AE</A>         ;
 <a name=F5AC></a>F5AC   A4 AF      LDY $<A href="ram.htm#00AF">AF</A>         ;
*<a name=F5AE></a>F5AE   60         RTS             ;


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->

 
<A name=F5AF> </A>
;<b> Output "searching" message </b>
;    Referenced by: <A href="#F39E">F39E</A> <A href="#F4C1">F4C1</A> <A href="#F546">F546</A> 
;
; IN: .X holds secondary address for some reason ??? (coincidence)

 <a name=xxxx></a>F5AF   A5 9D      LDA $<A href="ram.htm#009D">9D</A>         ; "direct mode" flag.
 <a name=F5B1></a>F5B1   10 1E      BPL $F5D1   +   ; in program mode?  return w/o showing message.
 <a name=F5B3></a>F5B3   A0 0C      LDY #$0C        ; offset to "searching for"
 <a name=F5B5></a>F5B5   20 2F F1   JSR $<A href="#F12F">F12F</A>       ; output msg
 <a name=F5B8></a>F5B8   A5 B7      LDA $<A href="ram.htm#00B7">B7</A>         ; length of current filename
 <a name=F5BA></a>F5BA   F0 15      BEQ $F5D1   +   ; filename null?  yes: RTS
 <a name=F5BC></a>F5BC   A0 17      LDY #$17        ; "for "
 <a name=F5BE></a>F5BE   20 2F F1   JSR $<A href="#F12F">F12F</A>       ; output
<a name=F5C1></a>
; <b>Output filename</b>  Code below is shared w/ Save (called from <A href="#F698">F698</A>)
 <a name=xxxx></a>F5C1   A4 B7      LDY $<A href="ram.htm#00B7">B7</A>         ; filename length
 <a name=F5C3></a>F5C3   F0 0C      BEQ $F5D1   +   ; null string?  RTS
 <a name=F5C5></a>F5C5   A0 00      LDY #$00        ; Loop: output filename...  Start at first char
*<a name=F5C7></a>F5C7   B1 BB      LDA ($<A href="ram.htm#00BB">BB</A>),Y     ; Get a char using filename address at $BB
 <a name=F5C9></a>F5C9   20 D2 FF   JSR $<A href="#FFD2">FFD2</A>       ; Output it
 <a name=F5CC></a>F5CC   C8         INY
 <a name=F5CD></a>F5CD   C4 B7      CPY $<A href="ram.htm#00B7">B7</A>         ; End of string?
 <a name=F5CF></a>F5CF   D0 F6      BNE $F5C7   -   ;    no, loop
*<a name=F5D1></a>F5D1   60         RTS

 <A name=F5D2></A>
;<b> do loading/verifying message </b>
;    Referenced by: <A href="#F4F0">F4F0</A>, <A href="#F5A2">F5A2</A>

 <a name=xxxx></a>F5D2   A0 49      LDY #$49        ; offset for "LOADING "
 <a name=F5D4></a>F5D4   A5 93      LDA $<A href="ram.htm#0093">93</A>         ; load/verify flag
 <a name=F5D6></a>F5D6   F0 02      BEQ $F5DA   +   ; 0=load, keep offset
 <a name=F5D8></a>F5D8   A0 59      LDY #$59        ; 1=verify: offset for "VERIFYING "
*<a name=F5DA></a>F5DA   4C 2B F1   JMP $<A href="#F12B">F12B</A>       ; output message (unless in program mode)


<A name=F5DD></A>
; <b>save ram to a device</b>
;    Referenced by:  only kernal entry <A href="#FFD8">FFD8</A>
; 
; Wrapper around the core save routine.  Sets up params & calls vector.
;
; Givens:  Filename, device#, secondary addr are in the normal places
;          RAM Start address is stored in a ZP location pointed to by .A
;          RAM "stop" address is in .X/.Y
;
; Before transferring to the core routine, beginning of save block must be 
; stored at $<A href="ram.htm#00C1">C1</A>, and $<A href="ram.htm#00AE">AE</A> holds start+size.
 
 <a name=xxxx></a>F5DD   86 AE      STX $<A href="ram.htm#00AE">AE</A>         ; stop addr (.X/.Y) --> $AE
 <a name=F5DF></a>F5DF   84 AF      STY $<A href="ram.htm#00AF">AF</A>         
 <a name=F5E1></a>F5E1   AA         TAX             
 <a name=F5E2></a>F5E2   B5 00      LDA $00,X       ; x holds LOCATION (zp) of save start pointer
 <a name=F5E4></a>F5E4   85 C1      STA $<A href="ram.htm#00C1">C1</A>         ; $C1 = "I/O start address"
 <a name=F5E6></a>F5E6   B5 01      LDA $01,X       
 <a name=F5E8></a>F5E8   85 C2      STA $<A href="ram.htm#00C2">C2</A>         
 <a name=F5EA></a>F5EA   6C 32 03   JMP ($<a href="ram.htm#0332">0332</a>)     ; normally <A href="#F5ED">F5ED</A>
 
<A name=F5ED> </A>
;<b> kernal "save ram" routine </b>
;    Referenced by:  <A href="#F5EA">F5EA</A>
;
; IN:  Filename passed in normal location
;      device # stored at $B9
;      RAM start address in $<A href="ram.htm#00C1">C1/C2</A>
;      RAM stop address (1 past end of data to save) in $<A href="ram.htm#00AE">AE/AF</A>
;
; OUT: On error, set .C and .A holds error code
;      After successful save, return with .C=0

 <a name=xxxx></a>F5ED   A5 BA      LDA $<A href="ram.htm#00BA">BA</A>         ; current dev
 <a name=F5EF></a>F5EF   D0 03      BNE $F5F4   +
*<a name=F5F1></a>F5F1   4C 13 F7   JMP $<A href="#F713">F713</A>       ; 0 (keyboard), illegal dev
 
*<a name=F5F4></a>F5F4   C9 03      CMP #$03        
 <a name=F5F6></a>F5F6   F0 F9      BEQ $F5F1   -   ; 3=screen, illegal
 <a name=F5F8></a>F5F8   90 5F      BCC $F659   +   ; < 3?  Assume cassette
 <a name=F5FA></a>F5FA   A9 61      LDA #$61        ; > 3: continue (IEC bus dev)
 <a name=F5FC></a>F5FC   85 B9      STA $<A href="ram.htm#00B9">B9</A>         ; IEC saves always on chan 1 ($60 mask = open???)   <A href="#secondary_addresses_flags">secondary_addresses_flags</A>
 <a name=F5FE></a>F5FE   A4 B7      LDY $<A href="ram.htm#00B7">B7</A>         ; filename length
 <a name=F600></a>F600   D0 03      BNE $F605   +   ; OK, not null
 <a name=F602></a>F602   4C 10 F7   JMP $<A href="#F710">F710</A>       ; "file name missing" error

*<a name=F605></a>F605   20 D5 F3   JSR $<A href="#F3D5">F3D5</A>       ; open filename on chan 1 of serial device
 <a name=F608></a>F608   20 8F F6   JSR $<A href="#F68F">F68F</A>       ; output "Saving xxxxx"
 <a name=F60B></a>F60B   A5 BA      LDA $<A href="ram.htm#00BA">BA</A>         ; Current dev
 <a name=F60D></a>F60D   20 0C ED   JSR $<A href="#ED0C">ED0C</A>       ; send listen
 <a name=F610></a>F610   A5 B9      LDA $<A href="ram.htm#00B9">B9</A>         ; Secondary Address
 <a name=F612></a>F612   20 B9 ED   JSR $<A href="#EDB9">EDB9</A>       ; send SA for listen
 <a name=F615></a>F615   A0 00      LDY #$00        ;    ??? no clear purpose
 <a name=F617></a>F617   20 8E FB   JSR $<A href="#FB8E">FB8E</A>       ; move save ptr from I/O start addr ($C1)   to temp ptr ($AC)
 <a name=F61A></a>F61A   A5 AC      LDA $<A href="ram.htm#00AC">AC</A>         ; Start by saving start address at beginning of file (lo byte)
 <a name=F61C></a>F61C   20 DD ED   JSR $<A href="#EDDD">EDDD</A>       ; output byte on serial bus
 <a name=F61F></a>F61F   A5 AD      LDA $<A href="ram.htm#00AD">AD</A>         ; hi byte
 <a name=F621></a>F621   20 DD ED   JSR $<A href="#EDDD">EDDD</A>       ;      (???apparently, this always returns with .C cleared...)
*<a name=F624></a>F624   20 D1 FC   JSR $<A href="#FCD1">FCD1</A>       ; Check if save address = stop address
 <a name=F627></a>F627   B0 16      BCS $F63F   +   ; SAVE LOOP condition: .C=1 if done...
 <a name=F629></a>F629   B1 AC      LDA ($<A href="ram.htm#00AC">AC</A>),Y     ; Next byte to save
 <a name=F62B></a>F62B   20 DD ED   JSR $<A href="#EDDD">EDDD</A>       ; Send
 <a name=F62E></a>F62E   20 E1 FF   JSR $<A href="#FFE1">FFE1</A>       ; check stop key
 <a name=F631></a>F631   D0 07      BNE $F63A   +   ; STOP pressed, fall thru.  not pressed... branch
 <a name=F633></a>F633   20 42 F6   JSR $<A href="#F642">F642</A>       ; close serial bus
 <a name=F636></a>F636   A9 00      LDA #$00        ; code for BREAK message
 <a name=F638></a>F638   38         SEC             ; error flag  ???
 <a name=F639></a>F639   60         RTS             
 
*<a name=F63A></a>F63A   20 DB FC   JSR $<A href="#FCDB">FCDB</A>       ; Increment save pointer
 <a name=F63D></a>F63D   D0 E5      BNE $F624   -   ; If OK, loop
*<a name=F63F></a>F63F   20 FE ED   JSR $<A href="#EDFE">EDFE</A>       ; Serial bus unlisten (Wrapped around to 0!!! ??  mimic normal finish)

 
<A name=F642> </A>
;<b> close serial bus device </b>
;    Referenced by:  <A href="#F2EE">F2EE</A> <A href="#F52B">F52B</A> <A href="#F633">F633</A> 

 <a name=xxxx></a>F642   24 B9      BIT $<A href="ram.htm#00B9">B9</A>         ; 2nd adr (plus some status bits)  <A href="#secondary_addresses_flags">secondary_addresses_flags</A>
 <a name=F644></a>F644   30 11      BMI $F657   +   ; BIT 7 set??  skip over listen/unlisten (must already be closed)
 <a name=F646></a>F646   A5 BA      LDA $<A href="ram.htm#00BA">BA</A>         ; Device num
 <a name=F648></a>F648   20 0C ED   JSR $<A href="#ED0C">ED0C</A>       ;Send LISTEN ??
 <a name=F64B></a>F64B   A5 B9      LDA $<A href="ram.htm#00B9">B9</A>         ; 2nd adr
 <a name=F64D></a>F64D   29 EF      AND #$EF        ; The AND & OR together set the upper 3 bits to $E (secondary address command "close channel")
 <a name=F64F></a>F64F   09 E0      ORA #$E0        ;       <A href="#secondary_addresses_flags">secondary_addresses_flags</A>
 <a name=F651></a>F651   20 B9 ED   JSR $<A href="#EDB9">EDB9</A>       ;Send listen on IEC
<a name=F654></a>
; referenced by: <A href="#F406">F406</A>
 <a name=xxxx></a>F654   20 FE ED   JSR $<A href="#EDFE">EDFE</A>       ; Send unlisten on IEC

*<a name=F657></a>F657   18         CLC             ; clear error flag
 <a name=F658></a>F658   60         RTS             ; normal exit
 
*<a name=F659></a>F659   4A         LSR             ; Check for dev. 1  (.A possible values: 1,2)
 <a name=F65A></a>F65A   B0 03      BCS $F65F   +   ; odd = dev 1.  Go to cassette save
 <a name=F65C></a>F65C   4C 13 F7   JMP $<A href="#F713">F713</A>       ; "illegal device" error 


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=F65F>
 ; save ram to cassette
 </A>
*<a name=F65F></a>F65F   20 D0 F7   JSR $<A href="#F7D0">F7D0</A>
 <a name=F662></a>F662   90 8D      BCC $F5F1
 <a name=F664></a>F664   20 38 F8   JSR $<A href="#F838">F838</A>
 <a name=F667></a>F667   B0 25      BCS $F68E
 <a name=F669></a>F669   20 8F F6   JSR $<A href="#F68F">F68F</A>
 <a name=F66C></a>F66C   A2 03      LDX #$03
 <a name=F66E></a>F66E   A5 B9      LDA $B9
 <a name=F670></a>F670   29 01      AND #$01
 <a name=F672></a>F672   D0 02      BNE $F676
 <a name=F674></a>F674   A2 01      LDX #$01
 <a name=F676></a>F676   8A         TXA
 <a name=F677></a>F677   20 6A F7   JSR $<A href="#F76A">F76A</A>
 <a name=F67A></a>F67A   B0 12      BCS $F68E
 <a name=F67C></a>F67C   20 67 F8   JSR $<A href="#F867">F867</A>
 <a name=F67F></a>F67F   B0 0D      BCS $F68E
 <a name=F681></a>F681   A5 B9      LDA $B9
 <a name=F683></a>F683   29 02      AND #$02
 <a name=F685></a>F685   F0 06      BEQ $F68D
 <a name=F687></a>F687   A9 05      LDA #$05
 <a name=F689></a>F689   20 6A F7   JSR $<A href="#F76A">F76A</A>
 <a name=F68C></a>F68C   .BY $24
 <a name=F68D></a>F68D   18         CLC
 <a name=F68E></a>F68E   60         RTS
 
 <A name=F68F>
 ; do saving message and filename
 </A>
 <a name=F68F></a>F68F   A5 9D      LDA $9D
 <a name=F691></a>F691   10 FB      BPL $F68E
 <a name=F693></a>F693   A0 51      LDY #$51
 <a name=F695></a>F695   20 2F F1   JSR $<A href="#F12F">F12F</A>
 <a name=F698></a>F698   4C C1 F5   JMP $<A href="#F5C1">F5C1</A>
 
 <A name=F69B>
 ; increment real time clock
 </A>
 <a name=F69B></a>F69B   A2 00      LDX #$00
 <a name=F69D></a>F69D   E6 A2      INC $A2
 <a name=F69F></a>F69F   D0 06      BNE $F6A7
 <a name=F6A1></a>F6A1   E6 A1      INC $A1
 <a name=F6A3></a>F6A3   D0 02      BNE $F6A7
 <a name=F6A5></a>F6A5   E6 A0      INC $A0
 <a name=F6A7></a>F6A7   38         SEC
 <a name=F6A8></a>F6A8   A5 A2      LDA $A2
 <a name=F6AA></a>F6AA   E9 01      SBC #$01
 <a name=F6AC></a>F6AC   A5 A1      LDA $A1
 <a name=F6AE></a>F6AE   E9 1A      SBC #$1A
 <a name=F6B0></a>F6B0   A5 A0      LDA $A0
 <a name=F6B2></a>F6B2   E9 4F      SBC #$4F
 <a name=F6B4></a>F6B4   90 06      BCC $F6BC
 <a name=F6B6></a>F6B6   86 A0      STX $A0
 <a name=F6B8></a>F6B8   86 A1      STX $A1
 <a name=F6BA></a>F6BA   86 A2      STX $A2
 <A name=F6BC>
 <a name=F6BC></a>F6BC   AD 01 DC   LDA $DC01
 </A>
 <a name=F6BF></a>F6BF   CD 01 DC   CMP $DC01
 <a name=F6C2></a>F6C2   D0 F8      BNE $F6BC
 <a name=F6C4></a>F6C4   AA         TAX
 <a name=F6C5></a>F6C5   30 13      BMI $F6DA
 <a name=F6C7></a>F6C7   A2 BD      LDX #$BD
 <a name=F6C9></a>F6C9   8E 00 DC   STX $DC00
 <a name=F6CC></a>F6CC   AE 01 DC   LDX $DC01
 <a name=F6CF></a>F6CF   EC 01 DC   CPX $DC01
 <a name=F6D2></a>F6D2   D0 F8      BNE $F6CC
 <a name=F6D4></a>F6D4   8D 00 DC   STA $DC00
 <a name=F6D7></a>F6D7   E8         INX
 <a name=F6D8></a>F6D8   D0 02      BNE $F6DC
 <a name=F6DA></a>F6DA   85 91      STA $91
 <a name=F6DC></a>F6DC   60         RTS
 
 <A name=F6DD>
 ; read real time clock
 </A>
 <a name=F6DD></a>F6DD   78         SEI
 <a name=F6DE></a>F6DE   A5 A2      LDA $A2
 <a name=F6E0></a>F6E0   A6 A1      LDX $A1
 <a name=F6E2></a>F6E2   A4 A0      LDY $A0
 
 <A name=F6E4>
 ; set real time clock
 </A>
 <a name=F6E4></a>F6E4   78         SEI
 <a name=F6E5></a>F6E5   85 A2      STA $A2
 <a name=F6E7></a>F6E7   86 A1      STX $A1
 <a name=F6E9></a>F6E9   84 A0      STY $A0
 <a name=F6EB></a>F6EB   58         CLI
 <a name=F6EC></a>F6EC   60         RTS
 
 <A name=F6ED>
 ; test STOP key
 </A>
 <a name=F6ED></a>F6ED   A5 91      LDA $91
 <a name=F6EF></a>F6EF   C9 7F      CMP #$7F
 <a name=F6F1></a>F6F1   D0 07      BNE $F6FA
 <a name=F6F3></a>F6F3   08         PHP
 <a name=F6F4></a>F6F4   20 CC FF   JSR $<A href="#FFCC">FFCC</A>
 <a name=F6F7></a>F6F7   85 C6      STA $C6
 <a name=F6F9></a>F6F9   28         PLP
 <a name=F6FA></a>F6FA   60         RTS
 
 <A name=F6FB>
 ; handle I/O errors
 </A>
 <a name=F6FB></a>F6FB   A9 01      LDA #$01   ; too many files
 <a name=F6FD></a>F6FD   .BY $2C
 <A name=F6FE>
 <a name=F6FE></a>F6FE   A9 02      LDA #$02   ; file open
 </A>
 <a name=F700></a>F700   .BY $2C
 <A name=F701>
 <a name=F701></a>F701   A9 03      LDA #$03   ; file not open
 </A>
 <a name=F703></a>F703   .BY $2C
 <A name=F704>
 <a name=F704></a>F704   A9 04      LDA #$04   ; file not found
 </A>
 <a name=F706></a>F706   .BY $2C
 <A name=F707>
 <a name=F707></a>F707   A9 05      LDA #$05   ; device not present
 </A>
 <a name=F709></a>F709   .BY $2C
 <A name=F70A>
 <a name=F70A></a>F70A   A9 06      LDA #$06   ; not input file
 </A>
 <a name=F70C></a>F70C   .BY $2C
 <A name=F70D>
 <a name=F70D></a>F70D   A9 07      LDA #$07   ; not output file
 </A>
 <a name=F70F></a>F70F   .BY $2C
 <A name=F710>
 <a name=F710></a>F710   A9 08      LDA #$08   ; file name missing
 </A>
 <a name=F712></a>F712   .BY $2C
 <A name=F713>
 <a name=F713></a>F713   A9 09      LDA #$09   ; illegal device no.
 </A>
 <a name=F715></a>F715   48         PHA
 <a name=F716></a>F716   20 CC FF   JSR $<A href="#FFCC">FFCC</A>
 <a name=F719></a>F719   A0 00      LDY #$00
 <a name=F71B></a>F71B   24 9D      BIT $9D
 <a name=F71D></a>F71D   50 0A      BVC $F729
 <a name=F71F></a>F71F   20 2F F1   JSR $<A href="#F12F">F12F</A>
 <a name=F722></a>F722   68         PLA
 <a name=F723></a>F723   48         PHA
 <a name=F724></a>F724   09 30      ORA #$30
 <a name=F726></a>F726   20 D2 FF   JSR $<A href="#FFD2">FFD2</A>
 <a name=F729></a>F729   68         PLA
 <a name=F72A></a>F72A   38         SEC
 <a name=F72B></a>F72B   60         RTS
 
 <A name=F72C>
 ; get next file header from cassette
 </A>
 <a name=F72C></a>F72C   A5 93      LDA $93
 <a name=F72E></a>F72E   48         PHA
 <a name=F72F></a>F72F   20 41 F8   JSR $<A href="#F841">F841</A>
 <a name=F732></a>F732   68         PLA
 <a name=F733></a>F733   85 93      STA $93
 <a name=F735></a>F735   B0 32      BCS $F769
 <a name=F737></a>F737   A0 00      LDY #$00
 <a name=F739></a>F739   B1 B2      LDA ($B2),Y
 <a name=F73B></a>F73B   C9 05      CMP #$05
 <a name=F73D></a>F73D   F0 2A      BEQ $F769
 <a name=F73F></a>F73F   C9 01      CMP #$01
 <a name=F741></a>F741   F0 08      BEQ $F74B
 <a name=F743></a>F743   C9 03      CMP #$03
 <a name=F745></a>F745   F0 04      BEQ $F74B
 <a name=F747></a>F747   C9 04      CMP #$04
 <a name=F749></a>F749   D0 E1      BNE $F72C
 <a name=F74B></a>F74B   AA         TAX
 <a name=F74C></a>F74C   24 9D      BIT $9D
 <a name=F74E></a>F74E   10 17      BPL $F767
 <a name=F750></a>F750   A0 63      LDY #$63
 <a name=F752></a>F752   20 2F F1   JSR $<A href="#F12F">F12F</A>
 <a name=F755></a>F755   A0 05      LDY #$05
 <a name=F757></a>F757   B1 B2      LDA ($B2),Y
 <a name=F759></a>F759   20 D2 FF   JSR $<A href="#FFD2">FFD2</A>
 <a name=F75C></a>F75C   C8         INY
 <a name=F75D></a>F75D   C0 15      CPY #$15
 <a name=F75F></a>F75F   D0 F6      BNE $F757
 <a name=F761></a>F761   A5 A1      LDA $A1
 <a name=F763></a>F763   20 E0 E4   JSR $<A href="#E4E0">E4E0</A>
 <a name=F766></a>F766   EA         NOP
 <a name=F767></a>F767   18         CLC
 <a name=F768></a>F768   88         DEY
 <a name=F769></a>F769   60         RTS
 
 <A name=F76A>
 ; write a special block to cassette with code in A
 </A>
 <a name=F76A></a>F76A   85 9E      STA $9E
 <a name=F76C></a>F76C   20 D0 F7   JSR $<A href="#F7D0">F7D0</A>
 <a name=F76F></a>F76F   90 5E      BCC $F7CF
 <a name=F771></a>F771   A5 C2      LDA $C2
 <a name=F773></a>F773   48         PHA
 <a name=F774></a>F774   A5 C1      LDA $C1
 <a name=F776></a>F776   48         PHA
 <a name=F777></a>F777   A5 AF      LDA $AF
 <a name=F779></a>F779   48         PHA
 <a name=F77A></a>F77A   A5 AE      LDA $AE
 <a name=F77C></a>F77C   48         PHA
 <a name=F77D></a>F77D   A0 BF      LDY #$BF
 <a name=F77F></a>F77F   A9 20      LDA #$20
 <a name=F781></a>F781   91 B2      STA ($B2),Y
 <a name=F783></a>F783   88         DEY
 <a name=F784></a>F784   D0 FB      BNE $F781
 <a name=F786></a>F786   A5 9E      LDA $9E
 <a name=F788></a>F788   91 B2      STA ($B2),Y
 <a name=F78A></a>F78A   C8         INY
 <a name=F78B></a>F78B   A5 C1      LDA $C1
 <a name=F78D></a>F78D   91 B2      STA ($B2),Y
 <a name=F78F></a>F78F   C8         INY
 <a name=F790></a>F790   A5 C2      LDA $C2
 <a name=F792></a>F792   91 B2      STA ($B2),Y
 <a name=F794></a>F794   C8         INY
 <a name=F795></a>F795   A5 AE      LDA $AE
 <a name=F797></a>F797   91 B2      STA ($B2),Y
 <a name=F799></a>F799   C8         INY
 <a name=F79A></a>F79A   A5 AF      LDA $AF
 <a name=F79C></a>F79C   91 B2      STA ($B2),Y
 <a name=F79E></a>F79E   C8         INY
 <a name=F79F></a>F79F   84 9F      STY $9F
 <a name=F7A1></a>F7A1   A0 00      LDY #$00
 <a name=F7A3></a>F7A3   84 9E      STY $9E
 <a name=F7A5></a>F7A5   A4 9E      LDY $9E
 <a name=F7A7></a>F7A7   C4 B7      CPY $B7
 <a name=F7A9></a>F7A9   F0 0C      BEQ $F7B7
 <a name=F7AB></a>F7AB   B1 BB      LDA ($BB),Y
 <a name=F7AD></a>F7AD   A4 9F      LDY $9F
 <a name=F7AF></a>F7AF   91 B2      STA ($B2),Y
 <a name=F7B1></a>F7B1   E6 9E      INC $9E
 <a name=F7B3></a>F7B3   E6 9F      INC $9F
 <a name=F7B5></a>F7B5   D0 EE      BNE $F7A5
 <a name=F7B7></a>F7B7   20 D7 F7   JSR $<A href="#F7D7">F7D7</A>
 <a name=F7BA></a>F7BA   A9 69      LDA #$69
 <a name=F7BC></a>F7BC   85 AB      STA $AB
 <a name=F7BE></a>F7BE   20 6B F8   JSR $<A href="#F86B">F86B</A>
 <a name=F7C1></a>F7C1   A8         TAY
 <a name=F7C2></a>F7C2   68         PLA
 <a name=F7C3></a>F7C3   85 AE      STA $AE
 <a name=F7C5></a>F7C5   68         PLA
 <a name=F7C6></a>F7C6   85 AF      STA $AF
 <a name=F7C8></a>F7C8   68         PLA
 <a name=F7C9></a>F7C9   85 C1      STA $C1
 <a name=F7CB></a>F7CB   68         PLA
 <a name=F7CC></a>F7CC   85 C2      STA $C2
 <a name=F7CE></a>F7CE   98         TYA
 <a name=F7CF></a>F7CF   60         RTS
 
 <A name=F7D0>
 ; set tape buffer pointer in XY
 </A>
 <a name=F7D0></a>F7D0   A6 B2      LDX $B2
 <a name=F7D2></a>F7D2   A4 B3      LDY $B3
 <a name=F7D4></a>F7D4   C0 02      CPY #$02
 <a name=F7D6></a>F7D6   60         RTS
 
 <A name=F7D7>
 ; set cassette buffer to I/O area
 </A>
 <a name=F7D7></a>F7D7   20 D0 F7   JSR $<A href="#F7D0">F7D0</A>
 <a name=F7DA></a>F7DA   8A         TXA
 <a name=F7DB></a>F7DB   85 C1      STA $C1
 <a name=F7DD></a>F7DD   18         CLC
 <a name=F7DE></a>F7DE   69 C0      ADC #$C0
 <a name=F7E0></a>F7E0   85 AE      STA $AE
 <a name=F7E2></a>F7E2   98         TYA
 <a name=F7E3></a>F7E3   85 C2      STA $C2
 <a name=F7E5></a>F7E5   69 00      ADC #$00
 <a name=F7E7></a>F7E7   85 AF      STA $AF
 <a name=F7E9></a>F7E9   60         RTS
 
 <A name=F7EA>
 ; search tape for a file name
 </A>
 <a name=F7EA></a>F7EA   20 2C F7   JSR $<A href="#F72C">F72C</A>
 <a name=F7ED></a>F7ED   B0 1D      BCS $F80C
 <a name=F7EF></a>F7EF   A0 05      LDY #$05
 <a name=F7F1></a>F7F1   84 9F      STY $9F
 <a name=F7F3></a>F7F3   A0 00      LDY #$00
 <a name=F7F5></a>F7F5   84 9E      STY $9E
 <a name=F7F7></a>F7F7   C4 B7      CPY $B7
 <a name=F7F9></a>F7F9   F0 10      BEQ $F80B
 <a name=F7FB></a>F7FB   B1 BB      LDA ($BB),Y
 <a name=F7FD></a>F7FD   A4 9F      LDY $9F
 <a name=F7FF></a>F7FF   D1 B2      CMP ($B2),Y
 <a name=F801></a>F801   D0 E7      BNE $F7EA
 <a name=F803></a>F803   E6 9E      INC $9E
 <a name=F805></a>F805   E6 9F      INC $9F
 <a name=F807></a>F807   A4 9E      LDY $9E
 <a name=F809></a>F809   D0 EC      BNE $F7F7
 <a name=F80B></a>F80B   18         CLC
 <a name=F80C></a>F80C   60         RTS
 
 <A name=F80D>
 ; add 1 to tape index and test for overflow
 </A>
 <a name=F80D></a>F80D   20 D0 F7   JSR $<A href="#F7D0">F7D0</A>
 <a name=F810></a>F810   E6 A6      INC $A6
 <a name=F812></a>F812   A4 A6      LDY $A6
 <a name=F814></a>F814   C0 C0      CPY #$C0
 <a name=F816></a>F816   60         RTS
 
 <A name=F817>
 ; handle messages and
 ; test cassette buttons for read
 </A>
 <a name=F817></a>F817   20 2E F8   JSR $<A href="#F82E">F82E</A>
 <a name=F81A></a>F81A   F0 1A      BEQ $F836
 <a name=F81C></a>F81C   A0 1B      LDY #$1B
 <a name=F81E></a>F81E   20 2F F1   JSR $<A href="#F12F">F12F</A>
 <a name=F821></a>F821   20 D0 F8   JSR $<A href="#F8D0">F8D0</A>
 <a name=F824></a>F824   20 2E F8   JSR $<A href="#F82E">F82E</A>
 <a name=F827></a>F827   D0 F8      BNE $F821
 <a name=F829></a>F829   A0 6A      LDY #$6A
 <a name=F82B></a>F82B   4C 2F F1   JMP $<A href="#F12F">F12F</A>
 
 <A name=F82E>
 ; test sense line for a button
 ; depressed on cassette
 </A>
 <a name=F82E></a>F82E   A9 10      LDA #$10
 <a name=F830></a>F830   24 01      BIT $01
 <a name=F832></a>F832   D0 02      BNE $F836
 <a name=F834></a>F834   24 01      BIT $01
 <a name=F836></a>F836   18         CLC
 <a name=F837></a>F837   60         RTS
 
 <A name=F838>
 ; set messages and test cassette line
 ; for input
 </A>
 <a name=F838></a>F838   20 2E F8   JSR $<A href="#F82E">F82E</A>
 <a name=F83B></a>F83B   F0 F9      BEQ $F836
 <a name=F83D></a>F83D   A0 2E      LDY #$2E
 <a name=F83F></a>F83F   D0 DD      BNE $F81E
 
 <A name=F841>
 ; read a block from cassette
 </A>
 <a name=F841></a>F841   A9 00      LDA #$00
 <a name=F843></a>F843   85 90      STA $90
 <a name=F845></a>F845   85 93      STA $93
 <a name=F847></a>F847   20 D7 F7   JSR $<A href="#F7D7">F7D7</A>
 <A name=F84A>
 <a name=F84A></a>F84A   20 17 F8   JSR $<A href="#F817">F817</A>
 </A>
 <a name=F84D></a>F84D   B0 1F      BCS $F86E
 <a name=F84F></a>F84F   78         SEI
 <a name=F850></a>F850   A9 00      LDA #$00
 <a name=F852></a>F852   85 AA      STA $AA
 <a name=F854></a>F854   85 B4      STA $B4
 <a name=F856></a>F856   85 B0      STA $B0
 <a name=F858></a>F858   85 9E      STA $9E
 <a name=F85A></a>F85A   85 9F      STA $9F
 <a name=F85C></a>F85C   85 9C      STA $9C
 <a name=F85E></a>F85E   A9 90      LDA #$90
 <a name=F860></a>F860   A2 0E      LDX #$0E
 <a name=F862></a>F862   D0 11      BNE $F875
 
 <A name=F864>
 ; write a block from cassette
 </A>
 <a name=F864></a>F864   20 D7 F7   JSR $<A href="#F7D7">F7D7</A>
 <A name=F867>
 <a name=F867></a>F867   A9 14      LDA #$14
 </A>
 <a name=F869></a>F869   85 AB      STA $AB
 <A name=F86B>
 <a name=F86B></a>F86B   20 38 F8   JSR $<A href="#F838">F838</A>
 </A>
 <a name=F86E></a>F86E   B0 6C      BCS $F8DC
 <a name=F870></a>F870   78         SEI
 <a name=F871></a>F871   A9 82      LDA #$82
 <a name=F873></a>F873   A2 08      LDX #$08
 
 <A name=F875>
 ; common code for cassette read and write
 </A>
 <a name=F875></a>F875   A0 7F      LDY #$7F
 <a name=F877></a>F877   8C 0D DC   STY $DC0D
 <a name=F87A></a>F87A   8D 0D DC   STA $DC0D
 <a name=F87D></a>F87D   AD 0E DC   LDA $DC0E
 <a name=F880></a>F880   09 19      ORA #$19
 <a name=F882></a>F882   8D 0F DC   STA $DC0F
 <a name=F885></a>F885   29 91      AND #$91
 <a name=F887></a>F887   8D A2 02   STA $02A2
 <a name=F88A></a>F88A   20 A4 F0   JSR $<A href="#F0A4">F0A4</A>
 <a name=F88D></a>F88D   AD 11 D0   LDA $D011
 <a name=F890></a>F890   29 EF      AND #$EF
 <a name=F892></a>F892   8D 11 D0   STA $D011
 <a name=F895></a>F895   AD 14 03   LDA $0314
 <a name=F898></a>F898   8D 9F 02   STA $029F
 <a name=F89B></a>F89B   AD 15 03   LDA $0315
 <a name=F89E></a>F89E   8D A0 02   STA $02A0
 <a name=F8A1></a>F8A1   20 BD FC   JSR $<A href="#FCBD">FCBD</A>
 <a name=F8A4></a>F8A4   A9 02      LDA #$02
 <a name=F8A6></a>F8A6   85 BE      STA $BE
 <a name=F8A8></a>F8A8   20 97 FB   JSR $<A href="#FB97">FB97</A>
 <a name=F8AB></a>F8AB   A5 01      LDA $01
 <a name=F8AD></a>F8AD   29 1F      AND #$1F
 <a name=F8AF></a>F8AF   85 01      STA $01
 <a name=F8B1></a>F8B1   85 C0      STA $C0
 <a name=F8B3></a>F8B3   A2 FF      LDX #$FF
 <a name=F8B5></a>F8B5   A0 FF      LDY #$FF
 <a name=F8B7></a>F8B7   88         DEY
 <a name=F8B8></a>F8B8   D0 FD      BNE $F8B7
 <a name=F8BA></a>F8BA   CA         DEX
 <a name=F8BB></a>F8BB   D0 F8      BNE $F8B5
 <a name=F8BD></a>F8BD   58         CLI
 <A name=F8BE>
 <a name=F8BE></a>F8BE   AD A0 02   LDA $02A0
 </A>
 <a name=F8C1></a>F8C1   CD 15 03   CMP $0315
 <a name=F8C4></a>F8C4   18         CLC
 <a name=F8C5></a>F8C5   F0 15      BEQ $F8DC
 <a name=F8C7></a>F8C7   20 D0 F8   JSR $<A href="#F8D0">F8D0</A>
 <a name=F8CA></a>F8CA   20 BC F6   JSR $<A href="#F6BC">F6BC</A>
 <a name=F8CD></a>F8CD   4C BE F8   JMP $<A href="#F8BE">F8BE</A>
 
 <A name=F8D0>
 ; handle stop key during cassette operations
 </A>
 <a name=F8D0></a>F8D0   20 E1 FF   JSR $<A href="#FFE1">FFE1</A>
 <a name=F8D3></a>F8D3   18         CLC
 <a name=F8D4></a>F8D4   D0 0B      BNE $F8E1
 <a name=F8D6></a>F8D6   20 93 FC   JSR $<A href="#FC93">FC93</A>
 <a name=F8D9></a>F8D9   38         SEC
 <a name=F8DA></a>F8DA   68         PLA
 <a name=F8DB></a>F8DB   68         PLA
 <a name=F8DC></a>F8DC   A9 00      LDA #$00
 <a name=F8DE></a>F8DE   8D A0 02   STA $02A0
 <a name=F8E1></a>F8E1   60         RTS
 
 <A name=F8E2>
 ; schedule CIA1 timer A depending on X
 </A>
 <a name=F8E2></a>F8E2   86 B1      STX $B1
 <a name=F8E4></a>F8E4   A5 B0      LDA $B0
 <a name=F8E6></a>F8E6   0A         ASL
 <a name=F8E7></a>F8E7   0A         ASL
 <a name=F8E8></a>F8E8   18         CLC
 <a name=F8E9></a>F8E9   65 B0      ADC $B0
 <a name=F8EB></a>F8EB   18         CLC
 <a name=F8EC></a>F8EC   65 B1      ADC $B1
 <a name=F8EE></a>F8EE   85 B1      STA $B1
 <a name=F8F0></a>F8F0   A9 00      LDA #$00
 <a name=F8F2></a>F8F2   24 B0      BIT $B0
 <a name=F8F4></a>F8F4   30 01      BMI $F8F7
 <a name=F8F6></a>F8F6   2A         ROL
 <a name=F8F7></a>F8F7   06 B1      ASL $B1
 <a name=F8F9></a>F8F9   2A         ROL
 <a name=F8FA></a>F8FA   06 B1      ASL $B1
 <a name=F8FC></a>F8FC   2A         ROL
 <a name=F8FD></a>F8FD   AA         TAX
 <a name=F8FE></a>F8FE   AD 06 DC   LDA $DC06
 <a name=F901></a>F901   C9 16      CMP #$16
 <a name=F903></a>F903   90 F9      BCC $F8FE
 <a name=F905></a>F905   65 B1      ADC $B1
 <a name=F907></a>F907   8D 04 DC   STA $DC04
 <a name=F90A></a>F90A   8A         TXA
 <a name=F90B></a>F90B   6D 07 DC   ADC $DC07
 <a name=F90E></a>F90E   8D 05 DC   STA $DC05
 <a name=F911></a>F911   AD A2 02   LDA $02A2
 <a name=F914></a>F914   8D 0E DC   STA $DC0E
 <a name=F917></a>F917   8D A4 02   STA $02A4
 <a name=F91A></a>F91A   AD 0D DC   LDA $DC0D
 <a name=F91D></a>F91D   29 10      AND #$10
 <a name=F91F></a>F91F   F0 09      BEQ $F92A
 <a name=F921></a>F921   A9 F9      LDA #$F9
 <a name=F923></a>F923   48         PHA
 <a name=F924></a>F924   A9 2A      LDA #$2A
 <a name=F926></a>F926   48         PHA
 <a name=F927></a>F927   4C 43 FF   JMP $<A href="#FF43">FF43</A>
 <a name=F92A></a>F92A   58         CLI
 <a name=F92B></a>F92B   60         RTS
 
 <A name=F92C>
 ; cassette read IRQ routine
 </A>
 <a name=F92C></a>F92C   AE 07 DC   LDX $DC07
 <a name=F92F></a>F92F   A0 FF      LDY #$FF
 <a name=F931></a>F931   98         TYA
 <a name=F932></a>F932   ED 06 DC   SBC $DC06
 <a name=F935></a>F935   EC 07 DC   CPX $DC07
 <a name=F938></a>F938   D0 F2      BNE $F92C
 <a name=F93A></a>F93A   86 B1      STX $B1
 <a name=F93C></a>F93C   AA         TAX
 <a name=F93D></a>F93D   8C 06 DC   STY $DC06
 <a name=F940></a>F940   8C 07 DC   STY $DC07
 <a name=F943></a>F943   A9 19      LDA #$19
 <a name=F945></a>F945   8D 0F DC   STA $DC0F
 <a name=F948></a>F948   AD 0D DC   LDA $DC0D
 <a name=F94B></a>F94B   8D A3 02   STA $02A3
 <a name=F94E></a>F94E   98         TYA
 <a name=F94F></a>F94F   E5 B1      SBC $B1
 <a name=F951></a>F951   86 B1      STX $B1
 <a name=F953></a>F953   4A         LSR
 <a name=F954></a>F954   66 B1      ROR $B1
 <a name=F956></a>F956   4A         LSR
 <a name=F957></a>F957   66 B1      ROR $B1
 <a name=F959></a>F959   A5 B0      LDA $B0
 <a name=F95B></a>F95B   18         CLC
 <a name=F95C></a>F95C   69 3C      ADC #$3C
 <a name=F95E></a>F95E   C5 B1      CMP $B1
 <a name=F960></a>F960   B0 4A      BCS $F9AC
 <a name=F962></a>F962   A6 9C      LDX $9C
 <a name=F964></a>F964   F0 03      BEQ $F969
 <a name=F966></a>F966   4C 60 FA   JMP $<A href="#FA60">FA60</A>
 
 <a name=F969></a>F969   A6 A3      LDX $A3
 <a name=F96B></a>F96B   30 1B      BMI $F988
 <a name=F96D></a>F96D   A2 00      LDX #$00
 <a name=F96F></a>F96F   69 30      ADC #$30
 <a name=F971></a>F971   65 B0      ADC $B0
 <a name=F973></a>F973   C5 B1      CMP $B1
 <a name=F975></a>F975   B0 1C      BCS $F993
 <a name=F977></a>F977   E8         INX
 <a name=F978></a>F978   69 26      ADC #$26
 <a name=F97A></a>F97A   65 B0      ADC $B0
 <a name=F97C></a>F97C   C5 B1      CMP $B1
 <a name=F97E></a>F97E   B0 17      BCS $F997
 <a name=F980></a>F980   69 2C      ADC #$2C
 <a name=F982></a>F982   65 B0      ADC $B0
 <a name=F984></a>F984   C5 B1      CMP $B1
 <a name=F986></a>F986   90 03      BCC $F98B
 <a name=F988></a>F988   4C 10 FA   JMP $<A href="#FA10">FA10</A>
 
 <a name=F98B></a>F98B   A5 B4      LDA $B4
 <a name=F98D></a>F98D   F0 1D      BEQ $F9AC
 <a name=F98F></a>F98F   85 A8      STA $A8
 <a name=F991></a>F991   D0 19      BNE $F9AC
 <a name=F993></a>F993   E6 A9      INC $A9
 <a name=F995></a>F995   B0 02      BCS $F999
 <A name=F997>
 <a name=F997></a>F997   C6 A9      DEC $A9
 </A>
 <a name=F999></a>F999   38         SEC
 <a name=F99A></a>F99A   E9 13      SBC #$13
 <a name=F99C></a>F99C   E5 B1      SBC $B1
 <a name=F99E></a>F99E   65 92      ADC $92
 <a name=F9A0></a>F9A0   85 92      STA $92
 <a name=F9A2></a>F9A2   A5 A4      LDA $A4
 <a name=F9A4></a>F9A4   49 01      EOR #$01
 <a name=F9A6></a>F9A6   85 A4      STA $A4
 <a name=F9A8></a>F9A8   F0 2B      BEQ $F9D5
 <a name=F9AA></a>F9AA   86 D7      STX $D7
 <a name=F9AC></a>F9AC   A5 B4      LDA $B4
 <a name=F9AE></a>F9AE   F0 22      BEQ $F9D2
 <a name=F9B0></a>F9B0   AD A3 02   LDA $02A3
 <a name=F9B3></a>F9B3   29 01      AND #$01
 <a name=F9B5></a>F9B5   D0 05      BNE $F9BC
 <a name=F9B7></a>F9B7   AD A4 02   LDA $02A4
 <a name=F9BA></a>F9BA   D0 16      BNE $F9D2
 <a name=F9BC></a>F9BC   A9 00      LDA #$00
 <a name=F9BE></a>F9BE   85 A4      STA $A4
 <a name=F9C0></a>F9C0   8D A4 02   STA $02A4
 <a name=F9C3></a>F9C3   A5 A3      LDA $A3
 <a name=F9C5></a>F9C5   10 30      BPL $F9F7
 <a name=F9C7></a>F9C7   30 BF      BMI $F988
 <a name=F9C9></a>F9C9   A2 A6      LDX #$A6
 <a name=F9CB></a>F9CB   20 E2 F8   JSR $<A href="#F8E2">F8E2</A>
 <a name=F9CE></a>F9CE   A5 9B      LDA $9B
 <a name=F9D0></a>F9D0   D0 B9      BNE $F98B
 <a name=F9D2></a>F9D2   4C BC FE   JMP $<A href="#FEBC">FEBC</A>
 
 <a name=F9D5></a>F9D5   A5 92      LDA $92
 <a name=F9D7></a>F9D7   F0 07      BEQ $F9E0
 <a name=F9D9></a>F9D9   30 03      BMI $F9DE
 <a name=F9DB></a>F9DB   C6 B0      DEC $B0
 <a name=F9DD></a>F9DD   .BY $2C
 <a name=F9DE></a>F9DE   E6 B0      INC $B0
 <a name=F9E0></a>F9E0   A9 00      LDA #$00
 <a name=F9E2></a>F9E2   85 92      STA $92
 <a name=F9E4></a>F9E4   E4 D7      CPX $D7
 <a name=F9E6></a>F9E6   D0 0F      BNE $F9F7
 <a name=F9E8></a>F9E8   8A         TXA
 <a name=F9E9></a>F9E9   D0 A0      BNE $F98B
 <a name=F9EB></a>F9EB   A5 A9      LDA $A9
 <a name=F9ED></a>F9ED   30 BD      BMI $F9AC
 <a name=F9EF></a>F9EF   C9 10      CMP #$10
 <a name=F9F1></a>F9F1   90 B9      BCC $F9AC
 <a name=F9F3></a>F9F3   85 96      STA $96
 <a name=F9F5></a>F9F5   B0 B5      BCS $F9AC
 <a name=F9F7></a>F9F7   8A         TXA
 <a name=F9F8></a>F9F8   45 9B      EOR $9B
 <a name=F9FA></a>F9FA   85 9B      STA $9B
 <a name=F9FC></a>F9FC   A5 B4      LDA $B4
 <a name=F9FE></a>F9FE   F0 D2      BEQ $F9D2
 <a name=FA00></a>FA00   C6 A3      DEC $A3
 <a name=FA02></a>FA02   30 C5      BMI $F9C9
 <a name=FA04></a>FA04   46 D7      LSR $D7
 <a name=FA06></a>FA06   66 BF      ROR $BF
 <a name=FA08></a>FA08   A2 DA      LDX #$DA
 <a name=FA0A></a>FA0A   20 E2 F8   JSR $<A href="#F8E2">F8E2</A>
 <a name=FA0D></a>FA0D   4C BC FE   JMP $<A href="#FEBC">FEBC</A>
 
 <A name=FA10>
 <a name=FA10></a>FA10   A5 96      LDA $96
 </A>
 <a name=FA12></a>FA12   F0 04      BEQ $FA18
 <a name=FA14></a>FA14   A5 B4      LDA $B4
 <a name=FA16></a>FA16   F0 07      BEQ $FA1F
 <a name=FA18></a>FA18   A5 A3      LDA $A3
 <a name=FA1A></a>FA1A   30 03      BMI $FA1F
 <a name=FA1C></a>FA1C   4C 97 F9   JMP $<A href="#F997">F997</A>
 
 <a name=FA1F></a>FA1F   46 B1      LSR $B1
 <a name=FA21></a>FA21   A9 93      LDA #$93
 <a name=FA23></a>FA23   38         SEC
 <a name=FA24></a>FA24   E5 B1      SBC $B1
 <a name=FA26></a>FA26   65 B0      ADC $B0
 <a name=FA28></a>FA28   0A         ASL
 <a name=FA29></a>FA29   AA         TAX
 <a name=FA2A></a>FA2A   20 E2 F8   JSR $<A href="#F8E2">F8E2</A>
 <a name=FA2D></a>FA2D   E6 9C      INC $9C
 <a name=FA2F></a>FA2F   A5 B4      LDA $B4
 <a name=FA31></a>FA31   D0 11      BNE $FA44
 <a name=FA33></a>FA33   A5 96      LDA $96
 <a name=FA35></a>FA35   F0 26      BEQ $FA5D
 <a name=FA37></a>FA37   85 A8      STA $A8
 <a name=FA39></a>FA39   A9 00      LDA #$00
 <a name=FA3B></a>FA3B   85 96      STA $96
 <a name=FA3D></a>FA3D   A9 81      LDA #$81
 <a name=FA3F></a>FA3F   8D 0D DC   STA $DC0D
 <a name=FA42></a>FA42   85 B4      STA $B4
 <a name=FA44></a>FA44   A5 96      LDA $96
 <a name=FA46></a>FA46   85 B5      STA $B5
 <a name=FA48></a>FA48   F0 09      BEQ $FA53
 <a name=FA4A></a>FA4A   A9 00      LDA #$00
 <a name=FA4C></a>FA4C   85 B4      STA $B4
 <a name=FA4E></a>FA4E   A9 01      LDA #$01
 <a name=FA50></a>FA50   8D 0D DC   STA $DC0D
 <a name=FA53></a>FA53   A5 BF      LDA $BF
 <a name=FA55></a>FA55   85 BD      STA $BD
 <a name=FA57></a>FA57   A5 A8      LDA $A8
 <a name=FA59></a>FA59   05 A9      ORA $A9
 <a name=FA5B></a>FA5B   85 B6      STA $B6
 <a name=FA5D></a>FA5D   4C BC FE   JMP $<A href="#FEBC">FEBC</A>
 
 <A name=FA60>
 ; receive next byte from cassette
 </A>
 <a name=FA60></a>FA60   20 97 FB   JSR $<A href="#FB97">FB97</A>
 <a name=FA63></a>FA63   85 9C      STA $9C
 <a name=FA65></a>FA65   A2 DA      LDX #$DA
 <a name=FA67></a>FA67   20 E2 F8   JSR $<A href="#F8E2">F8E2</A>
 <a name=FA6A></a>FA6A   A5 BE      LDA $BE
 <a name=FA6C></a>FA6C   F0 02      BEQ $FA70
 <a name=FA6E></a>FA6E   85 A7      STA $A7
 <a name=FA70></a>FA70   A9 0F      LDA #$0F
 <a name=FA72></a>FA72   24 AA      BIT $AA
 <a name=FA74></a>FA74   10 17      BPL $FA8D
 <a name=FA76></a>FA76   A5 B5      LDA $B5
 <a name=FA78></a>FA78   D0 0C      BNE $FA86
 <a name=FA7A></a>FA7A   A6 BE      LDX $BE
 <a name=FA7C></a>FA7C   CA         DEX
 <a name=FA7D></a>FA7D   D0 0B      BNE $FA8A
 <a name=FA7F></a>FA7F   A9 08      LDA #$08
 <a name=FA81></a>FA81   20 1C FE   JSR $<A href="#FE1C">FE1C</A>
 <a name=FA84></a>FA84   D0 04      BNE $FA8A
 <a name=FA86></a>FA86   A9 00      LDA #$00
 <a name=FA88></a>FA88   85 AA      STA $AA
 <a name=FA8A></a>FA8A   4C BC FE   JMP $<A href="#FEBC">FEBC</A>
 
 <a name=FA8D></a>FA8D   70 31      BVS $FAC0
 <a name=FA8F></a>FA8F   D0 18      BNE $FAA9
 <a name=FA91></a>FA91   A5 B5      LDA $B5
 <a name=FA93></a>FA93   D0 F5      BNE $FA8A
 <a name=FA95></a>FA95   A5 B6      LDA $B6
 <a name=FA97></a>FA97   D0 F1      BNE $FA8A
 <a name=FA99></a>FA99   A5 A7      LDA $A7
 <a name=FA9B></a>FA9B   4A         LSR
 <a name=FA9C></a>FA9C   A5 BD      LDA $BD
 <a name=FA9E></a>FA9E   30 03      BMI $FAA3
 <a name=FAA0></a>FAA0   90 18      BCC $FABA
 <a name=FAA2></a>FAA2   18         CLC
 <a name=FAA3></a>FAA3   B0 15      BCS $FABA
 <a name=FAA5></a>FAA5   29 0F      AND #$0F
 <a name=FAA7></a>FAA7   85 AA      STA $AA
 <a name=FAA9></a>FAA9   C6 AA      DEC $AA
 <a name=FAAB></a>FAAB   D0 DD      BNE $FA8A
 <a name=FAAD></a>FAAD   A9 40      LDA #$40
 <a name=FAAF></a>FAAF   85 AA      STA $AA
 <a name=FAB1></a>FAB1   20 8E FB   JSR $<A href="#FB8E">FB8E</A>
 <a name=FAB4></a>FAB4   A9 00      LDA #$00
 <a name=FAB6></a>FAB6   85 AB      STA $AB
 <a name=FAB8></a>FAB8   F0 D0      BEQ $FA8A
 <a name=FABA></a>FABA   A9 80      LDA #$80
 <a name=FABC></a>FABC   85 AA      STA $AA
 <a name=FABE></a>FABE   D0 CA      BNE $FA8A
 <a name=FAC0></a>FAC0   A5 B5      LDA $B5
 <a name=FAC2></a>FAC2   F0 0A      BEQ $FACE
 <a name=FAC4></a>FAC4   A9 04      LDA #$04
 <a name=FAC6></a>FAC6   20 1C FE   JSR $<A href="#FE1C">FE1C</A>
 <a name=FAC9></a>FAC9   A9 00      LDA #$00
 <a name=FACB></a>FACB   4C 4A FB   JMP $<A href="#FB4A">FB4A</A>
 
 <a name=FACE></a>FACE   20 D1 FC   JSR $<A href="#FCD1">FCD1</A>
 <a name=FAD1></a>FAD1   90 03      BCC $FAD6
 <a name=FAD3></a>FAD3   4C 48 FB   JMP $<A href="#FB48">FB48</A>
 <a name=FAD6></a>FAD6   A6 A7      LDX $A7
 <a name=FAD8></a>FAD8   CA         DEX
 <a name=FAD9></a>FAD9   F0 2D      BEQ $FB08
 <a name=FADB></a>FADB   A5 93      LDA $93
 <a name=FADD></a>FADD   F0 0C      BEQ $FAEB
 <a name=FADF></a>FADF   A0 00      LDY #$00
 <a name=FAE1></a>FAE1   A5 BD      LDA $BD
 <a name=FAE3></a>FAE3   D1 AC      CMP ($AC),Y
 <a name=FAE5></a>FAE5   F0 04      BEQ $FAEB
 <a name=FAE7></a>FAE7   A9 01      LDA #$01
 <a name=FAE9></a>FAE9   85 B6      STA $B6
 <a name=FAEB></a>FAEB   A5 B6      LDA $B6
 <a name=FAED></a>FAED   F0 4B      BEQ $FB3A
 <a name=FAEF></a>FAEF   A2 3D      LDX #$3D
 <a name=FAF1></a>FAF1   E4 9E      CPX $9E
 <a name=FAF3></a>FAF3   90 3E      BCC $FB33
 <a name=FAF5></a>FAF5   A6 9E      LDX $9E
 <a name=FAF7></a>FAF7   A5 AD      LDA $AD
 <a name=FAF9></a>FAF9   9D 01 01   STA $0101,X
 <a name=FAFC></a>FAFC   A5 AC      LDA $AC
 <a name=FAFE></a>FAFE   9D 00 01   STA $0100,X
 <a name=FB01></a>FB01   E8         INX
 <a name=FB02></a>FB02   E8         INX
 <a name=FB03></a>FB03   86 9E      STX $9E
 <a name=FB05></a>FB05   4C 3A FB   JMP $<A href="#FB3A">FB3A</A>
 
 <a name=FB08></a>FB08   A6 9F      LDX $9F
 <a name=FB0A></a>FB0A   E4 9E      CPX $9E
 <a name=FB0C></a>FB0C   F0 35      BEQ $FB43
 <a name=FB0E></a>FB0E   A5 AC      LDA $AC
 <a name=FB10></a>FB10   DD 00 01   CMP $0100,X
 <a name=FB13></a>FB13   D0 2E      BNE $FB43
 <a name=FB15></a>FB15   A5 AD      LDA $AD
 <a name=FB17></a>FB17   DD 01 01   CMP $0101,X
 <a name=FB1A></a>FB1A   D0 27      BNE $FB43
 <a name=FB1C></a>FB1C   E6 9F      INC $9F
 <a name=FB1E></a>FB1E   E6 9F      INC $9F
 <a name=FB20></a>FB20   A5 93      LDA $93
 <a name=FB22></a>FB22   F0 0B      BEQ $FB2F
 <a name=FB24></a>FB24   A5 BD      LDA $BD
 <a name=FB26></a>FB26   A0 00      LDY #$00
 <a name=FB28></a>FB28   D1 AC      CMP ($AC),Y
 <a name=FB2A></a>FB2A   F0 17      BEQ $FB43
 <a name=FB2C></a>FB2C   C8         INY
 <a name=FB2D></a>FB2D   84 B6      STY $B6
 <a name=FB2F></a>FB2F   A5 B6      LDA $B6
 <a name=FB31></a>FB31   F0 07      BEQ $FB3A
 <a name=FB33></a>FB33   A9 10      LDA #$10
 <a name=FB35></a>FB35   20 1C FE   JSR $<A href="#FE1C">FE1C</A>
 <a name=FB38></a>FB38   D0 09      BNE $FB43
 <A name=FB3A>
 <a name=FB3A></a>FB3A   A5 93      LDA $93
 </A>
 <a name=FB3C></a>FB3C   D0 05      BNE $FB43
 <a name=FB3E></a>FB3E   A8         TAY
 <a name=FB3F></a>FB3F   A5 BD      LDA $BD
 <a name=FB41></a>FB41   91 AC      STA ($AC),Y
 <a name=FB43></a>FB43   20 DB FC   JSR $<A href="#FCDB">FCDB</A>
 <a name=FB46></a>FB46   D0 43      BNE $FB8B
 <A name=FB48>
 <a name=FB48></a>FB48   A9 80      LDA #$80
 </A>
 <A name=FB4A>
 <a name=FB4A></a>FB4A   85 AA      STA $AA
 </A>
 <a name=FB4C></a>FB4C   78         SEI
 <a name=FB4D></a>FB4D   A2 01      LDX #$01
 <a name=FB4F></a>FB4F   8E 0D DC   STX $DC0D
 <a name=FB52></a>FB52   AE 0D DC   LDX $DC0D
 <a name=FB55></a>FB55   A6 BE      LDX $BE
 <a name=FB57></a>FB57   CA         DEX
 <a name=FB58></a>FB58   30 02      BMI $FB5C
 <a name=FB5A></a>FB5A   86 BE      STX $BE
 <a name=FB5C></a>FB5C   C6 A7      DEC $A7
 <a name=FB5E></a>FB5E   F0 08      BEQ $FB68
 <a name=FB60></a>FB60   A5 9E      LDA $9E
 <a name=FB62></a>FB62   D0 27      BNE $FB8B
 <a name=FB64></a>FB64   85 BE      STA $BE
 <a name=FB66></a>FB66   F0 23      BEQ $FB8B
 <a name=FB68></a>FB68   20 93 FC   JSR $<A href="#FC93">FC93</A>
 <a name=FB6B></a>FB6B   20 8E FB   JSR $<A href="#FB8E">FB8E</A>
 <a name=FB6E></a>FB6E   A0 00      LDY #$00
 <a name=FB70></a>FB70   84 AB      STY $AB
 <a name=FB72></a>FB72   B1 AC      LDA ($AC),Y
 <a name=FB74></a>FB74   45 AB      EOR $AB
 <a name=FB76></a>FB76   85 AB      STA $AB
 <a name=FB78></a>FB78   20 DB FC   JSR $<A href="#FCDB">FCDB</A>
 <a name=FB7B></a>FB7B   20 D1 FC   JSR $<A href="#FCD1">FCD1</A>
 <a name=FB7E></a>FB7E   90 F2      BCC $FB72
 <a name=FB80></a>FB80   A5 AB      LDA $AB
 <a name=FB82></a>FB82   45 BD      EOR $BD
 <a name=FB84></a>FB84   F0 05      BEQ $FB8B
 <a name=FB86></a>FB86   A9 20      LDA #$20
 <a name=FB88></a>FB88   20 1C FE   JSR $<A href="#FE1C">FE1C</A>
 <a name=FB8B></a>FB8B   4C BC FE   JMP $<A href="#FEBC">FEBC</A>
 
 <A name=FB8E>
 ; move save/load address into $AC/$AD
 </A>
 <a name=FB8E></a>FB8E   A5 C2      LDA $C2
 <a name=FB90></a>FB90   85 AD      STA $AD
 <a name=FB92></a>FB92   A5 C1      LDA $C1
 <a name=FB94></a>FB94   85 AC      STA $AC
 <a name=FB96></a>FB96   60         RTS
 
 <A name=FB97>
 ; initalise cassette read/write variables
 </A>
 <a name=FB97></a>FB97   A9 08      LDA #$08
 <a name=FB99></a>FB99   85 A3      STA $A3
 <a name=FB9B></a>FB9B   A9 00      LDA #$00
 <a name=FB9D></a>FB9D   85 A4      STA $A4
 <a name=FB9F></a>FB9F   85 A8      STA $A8
 <a name=FBA1></a>FBA1   85 9B      STA $9B
 <a name=FBA3></a>FBA3   85 A9      STA $A9
 <a name=FBA5></a>FBA5   60         RTS
 
 <A name=FBA6>
 ; schedule CIA1 timer B and
 ; invert casette write line
 </A>
 <a name=FBA6></a>FBA6   A5 BD      LDA $BD
 <a name=FBA8></a>FBA8   4A         LSR
 <a name=FBA9></a>FBA9   A9 60      LDA #$60
 <a name=FBAB></a>FBAB   90 02      BCC $FBAF
 <A name=FBAD>
 <a name=FBAD></a>FBAD   A9 B0      LDA #$B0
 </A>
 <A name=FBAF>
 <a name=FBAF></a>FBAF   A2 00      LDX #$00
 </A>
 <A name=FBB1>
 <a name=FBB1></a>FBB1   8D 06 DC   STA $DC06
 </A>
 <a name=FBB4></a>FBB4   8E 07 DC   STX $DC07
 <a name=FBB7></a>FBB7   AD 0D DC   LDA $DC0D
 <a name=FBBA></a>FBBA   A9 19      LDA #$19
 <a name=FBBC></a>FBBC   8D 0F DC   STA $DC0F
 <a name=FBBF></a>FBBF   A5 01      LDA $01
 <a name=FBC1></a>FBC1   49 08      EOR #$08
 <a name=FBC3></a>FBC3   85 01      STA $01
 <a name=FBC5></a>FBC5   29 08      AND #$08
 <a name=FBC7></a>FBC7   60         RTS
 
 <A name=FBC8>
 ; IRQ routine for cassette write B
 </A>
 <a name=FBC8></a>FBC8   38         SEC
 <a name=FBC9></a>FBC9   66 B6      ROR $B6
 <a name=FBCB></a>FBCB   30 3C      BMI $FC09
 <A name=FBCD>
 <a name=FBCD></a>FBCD   A5 A8      LDA $A8
 </A>
 <a name=FBCF></a>FBCF   D0 12      BNE $FBE3
 <a name=FBD1></a>FBD1   A9 10      LDA #$10
 <a name=FBD3></a>FBD3   A2 01      LDX #$01
 <a name=FBD5></a>FBD5   20 B1 FB   JSR $<A href="#FBB1">FBB1</A>
 <a name=FBD8></a>FBD8   D0 2F      BNE $FC09
 <a name=FBDA></a>FBDA   E6 A8      INC $A8
 <a name=FBDC></a>FBDC   A5 B6      LDA $B6
 <a name=FBDE></a>FBDE   10 29      BPL $FC09
 <a name=FBE0></a>FBE0   4C 57 FC   JMP $<A href="#FC57">FC57</A>
 
 <a name=FBE3></a>FBE3   A5 A9      LDA $A9
 <a name=FBE5></a>FBE5   D0 09      BNE $FBF0
 <a name=FBE7></a>FBE7   20 AD FB   JSR $<A href="#FBAD">FBAD</A>
 <a name=FBEA></a>FBEA   D0 1D      BNE $FC09
 <a name=FBEC></a>FBEC   E6 A9      INC $A9
 <a name=FBEE></a>FBEE   D0 19      BNE $FC09
 <a name=FBF0></a>FBF0   20 A6 FB   JSR $<A href="#FBA6">FBA6</A>
 <a name=FBF3></a>FBF3   D0 14      BNE $FC09
 <a name=FBF5></a>FBF5   A5 A4      LDA $A4
 <a name=FBF7></a>FBF7   49 01      EOR #$01
 <a name=FBF9></a>FBF9   85 A4      STA $A4
 <a name=FBFB></a>FBFB   F0 0F      BEQ $FC0C
 <a name=FBFD></a>FBFD   A5 BD      LDA $BD
 <a name=FBFF></a>FBFF   49 01      EOR #$01
 <a name=FC01></a>FC01   85 BD      STA $BD
 <a name=FC03></a>FC03   29 01      AND #$01
 <a name=FC05></a>FC05   45 9B      EOR $9B
 <a name=FC07></a>FC07   85 9B      STA $9B
 <a name=FC09></a>FC09   4C BC FE   JMP $<A href="#FEBC">FEBC</A>
 
 <a name=FC0C></a>FC0C   46 BD      LSR $BD
 <a name=FC0E></a>FC0E   C6 A3      DEC $A3
 <a name=FC10></a>FC10   A5 A3      LDA $A3
 <a name=FC12></a>FC12   F0 3A      BEQ $FC4E
 <a name=FC14></a>FC14   10 F3      BPL $FC09
 <a name=FC16></a>FC16   20 97 FB   JSR $<A href="#FB97">FB97</A>
 <a name=FC19></a>FC19   58         CLI
 <a name=FC1A></a>FC1A   A5 A5      LDA $A5
 <a name=FC1C></a>FC1C   F0 12      BEQ $FC30
 <a name=FC1E></a>FC1E   A2 00      LDX #$00
 <a name=FC20></a>FC20   86 D7      STX $D7
 <a name=FC22></a>FC22   C6 A5      DEC $A5
 <a name=FC24></a>FC24   A6 BE      LDX $BE
 <a name=FC26></a>FC26   E0 02      CPX #$02
 <a name=FC28></a>FC28   D0 02      BNE $FC2C
 <a name=FC2A></a>FC2A   09 80      ORA #$80
 <a name=FC2C></a>FC2C   85 BD      STA $BD
 <a name=FC2E></a>FC2E   D0 D9      BNE $FC09
 <a name=FC30></a>FC30   20 D1 FC   JSR $<A href="#FCD1">FCD1</A>
 <a name=FC33></a>FC33   90 0A      BCC $FC3F
 <a name=FC35></a>FC35   D0 91      BNE $FBC8
 <a name=FC37></a>FC37   E6 AD      INC $AD
 <a name=FC39></a>FC39   A5 D7      LDA $D7
 <a name=FC3B></a>FC3B   85 BD      STA $BD
 <a name=FC3D></a>FC3D   B0 CA      BCS $FC09
 <a name=FC3F></a>FC3F   A0 00      LDY #$00
 <a name=FC41></a>FC41   B1 AC      LDA ($AC),Y
 <a name=FC43></a>FC43   85 BD      STA $BD
 <a name=FC45></a>FC45   45 D7      EOR $D7
 <a name=FC47></a>FC47   85 D7      STA $D7
 <a name=FC49></a>FC49   20 DB FC   JSR $<A href="#FCDB">FCDB</A>
 <a name=FC4C></a>FC4C   D0 BB      BNE $FC09
 <a name=FC4E></a>FC4E   A5 9B      LDA $9B
 <a name=FC50></a>FC50   49 01      EOR #$01
 <a name=FC52></a>FC52   85 BD      STA $BD
 <a name=FC54></a>FC54   4C BC FE   JMP $<A href="#FEBC">FEBC</A>
 
 <A name=FC57>
 <a name=FC57></a>FC57   C6 BE      DEC $BE
 </A>
 <a name=FC59></a>FC59   D0 03      BNE $FC5E
 <a name=FC5B></a>FC5B   20 CA FC   JSR $<A href="#FCCA">FCCA</A>
 <a name=FC5E></a>FC5E   A9 50      LDA #$50
 <a name=FC60></a>FC60   85 A7      STA $A7
 <a name=FC62></a>FC62   A2 08      LDX #$08
 <a name=FC64></a>FC64   78         SEI
 <a name=FC65></a>FC65   20 BD FC   JSR $<A href="#FCBD">FCBD</A>
 <a name=FC68></a>FC68   D0 EA      BNE $FC54
 
 <A name=FC6A>
 ; IRQ routine for cassette write A
 </A>
 <a name=FC6A></a>FC6A   A9 78      LDA #$78
 <a name=FC6C></a>FC6C   20 AF FB   JSR $<A href="#FBAF">FBAF</A>
 <a name=FC6F></a>FC6F   D0 E3      BNE $FC54
 <a name=FC71></a>FC71   C6 A7      DEC $A7
 <a name=FC73></a>FC73   D0 DF      BNE $FC54
 <a name=FC75></a>FC75   20 97 FB   JSR $<A href="#FB97">FB97</A>
 <a name=FC78></a>FC78   C6 AB      DEC $AB
 <a name=FC7A></a>FC7A   10 D8      BPL $FC54
 <a name=FC7C></a>FC7C   A2 0A      LDX #$0A
 <a name=FC7E></a>FC7E   20 BD FC   JSR $<A href="#FCBD">FCBD</A>
 <a name=FC81></a>FC81   58         CLI
 <a name=FC82></a>FC82   E6 AB      INC $AB
 <a name=FC84></a>FC84   A5 BE      LDA $BE
 <a name=FC86></a>FC86   F0 30      BEQ $FCB8
 <a name=FC88></a>FC88   20 8E FB   JSR $<A href="#FB8E">FB8E</A>
 <a name=FC8B></a>FC8B   A2 09      LDX #$09
 <a name=FC8D></a>FC8D   86 A5      STX $A5
 <a name=FC8F></a>FC8F   86 B6      STX $B6
 <a name=FC91></a>FC91   D0 83      BNE $FC16
 
 <A name=FC93>
 ; switch from cassette IRQ to default IRQ
 </A>
 <a name=FC93></a>FC93   08         PHP
 <a name=FC94></a>FC94   78         SEI
 <a name=FC95></a>FC95   AD 11 D0   LDA $D011
 <a name=FC98></a>FC98   09 10      ORA #$10
 <a name=FC9A></a>FC9A   8D 11 D0   STA $D011
 <a name=FC9D></a>FC9D   20 CA FC   JSR $<A href="#FCCA">FCCA</A>
 <a name=FCA0></a>FCA0   A9 7F      LDA #$7F
 <a name=FCA2></a>FCA2   8D 0D DC   STA $DC0D
 <a name=FCA5></a>FCA5   20 DD FD   JSR $<A href="#FDDD">FDDD</A>
 <a name=FCA8></a>FCA8   AD A0 02   LDA $02A0
 <a name=FCAB></a>FCAB   F0 09      BEQ $FCB6
 <a name=FCAD></a>FCAD   8D 15 03   STA $0315
 <a name=FCB0></a>FCB0   AD 9F 02   LDA $029F
 <a name=FCB3></a>FCB3   8D 14 03   STA $0314
 <a name=FCB6></a>FCB6   28         PLP
 <a name=FCB7></a>FCB7   60         RTS
 
 <A name=FCB8>
 ; terminate cassette I/O
 </A>
 <a name=FCB8></a>FCB8   20 93 FC   JSR $<A href="#FC93">FC93</A>
 <a name=FCBB></a>FCBB   F0 97      BEQ $FC54
 
 <A name=FCBD>
 ; set IRQ vector depending on X
 </A>
 <a name=FCBD></a>FCBD   BD 93 FD   LDA $FD93,X
 <a name=FCC0></a>FCC0   8D 14 03   STA $0314
 <a name=FCC3></a>FCC3   BD 94 FD   LDA $FD94,X
 <a name=FCC6></a>FCC6   8D 15 03   STA $0315
 <a name=FCC9></a>FCC9   60         RTS
 
 <A name=FCCA>
 ; stop cassette motor
 </A>
 <a name=FCCA></a>FCCA   A5 01      LDA $01
 <a name=FCCC></a>FCCC   09 20      ORA #$20
 <a name=FCCE></a>FCCE   85 01      STA $01
 <a name=FCD0></a>FCD0   60         RTS
 
 <A name=FCD1>
 ; compare $AC/$AD with $AE/$AF
 </A>
 <a name=FCD1></a>FCD1   38         SEC
 <a name=FCD2></a>FCD2   A5 AC      LDA $AC
 <a name=FCD4></a>FCD4   E5 AE      SBC $AE
 <a name=FCD6></a>FCD6   A5 AD      LDA $AD
 <a name=FCD8></a>FCD8   E5 AF      SBC $AF
 <a name=FCDA></a>FCDA   60         RTS
 
 <A name=FCDB>
 ; increment $AC/$AD
 </A>
 <a name=FCDB></a>FCDB   E6 AC      INC $AC
 <a name=FCDD></a>FCDD   D0 02      BNE $FCE1
 <a name=FCDF></a>FCDF   E6 AD      INC $AD
 <a name=FCE1></a>FCE1   60         RTS

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->
 
<A name=FCE2> </A>
;<b> System Reset routine </b>
; 6510 reset vector (Kernal address $FFFC) points here.
;
; If cartridge detected at $8000, redirects to its cold-start routine.  Otherwise, 
; initializes memory and I/O, then transfers control to BASIC cold-start.

 <a name=xxxx></a>FCE2   A2 FF      LDX #$FF        ;
 <a name=FCE4></a>FCE4   78         SEI             ; disable interrupts
 <a name=FCE5></a>FCE5   9A         TXS             ; .SP=$FF (emptiest value)
 <a name=FCE6></a>FCE6   D8         CLD             ;
 <a name=FCE7></a>FCE7   20 02 FD   JSR $<A href="#FD02">FD02</A>       ; check for cart. at $8000
 <a name=FCEA></a>FCEA   D0 03      BNE $FCEF     + ; .Z=0?  auto-start cart not detected
 <a name=FCEC></a>FCEC   6C 00 80   JMP (<A href="#no_CartridgeInfo">$8000</A>)     ; cartridge cold-start vector
*<a name=FCEF></a>FCEF   8E 16 D0   STX $<a href="io.htm#D016">D016</a>       ; (haphazard!): .X = chr index where CBM80 miscompared (1..5).  Sets multicolor off, 38 cols, and smooth-X to ?
 <a name=FCF2></a>FCF2   20 A3 FD   JSR $<A href="#FDA3">FDA3</A>       ; init I/O "devices" (chips)
 <a name=FCF5></a>FCF5   20 50 FD   JSR $<A href="#FD50">FD50</A>       ; init mem ptrs
 <a name=FCF8></a>FCF8   20 15 FD   JSR $<A href="#FD15">FD15</A>       ; Set I/o vectors ($0314..$0333) to kernal defaults
 <a name=FCFB></a>FCFB   20 5B FF   JSR $<A href="#FF5B">FF5B</A>       ; Do more init... mostly set system IRQ to correct value and start
 <a name=FCFE></a>FCFE   58         CLI             ; enable interrupts
 <a name=FCFF></a>FCFF   6C 00 A0   JMP ($<A href="#A000">A000</A>)     ; start basic (normally <A href="#E394">E394</A>)

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 5 </b></i>      <HR align=center width=50%>
</div> <div class="level5">
<!--------------------------------------------------------------------------------------------------------->

<A name=FD02> </A>
; <b>check for a cartridge</b>
;   Referenced by: <A href="#FCE7">FCE7</A> <A href="#FE56">FE56</A>
;
; Checks for the string "CBM80" at address 8004..8008.  Sets .Z=1 on match.
;
; The presence of CBM80 at $8004 is assumed to mean that an auto-start cartridge image is plugged in
; and visible from 8000..9FFF or 8000..BFFF, and locations 8000 and 8002 are assumed to be valid cold-
; and warm- start vectors.  Note however, that the kernal can be "fooled" into thinking there's a 
; cartridge present if CBM80 is put into RAM at the same address, and will act the same.

 <a name=xxxx></a>FD02   A2 05      LDX #$05        ; start comparing at 5th charactr
*<a name=FD04></a>FD04   BD 0F FD   LDA $FD0F,X     ; Actually CBM80 starts at FD10/8004... 
 <a name=FD07></a>FD07   DD 03 80   CMP $8003,X     ;    1-based indexes are used so that a match automatically leaves .Z set
 <a name=FD0A></a>FD0A   D0 03      BNE $FD0F     + ; Any mismatch leaves with .Z=0 "not equal", and .X is index 
 <a name=FD0C></a>FD0C   CA         DEX             ;    of miscompare (starting from end)
 <a name=FD0D></a>FD0D   D0 F5      BNE $FD04     - ; loop
*<a name=FD0F></a>FD0F   60         RTS
 
<A name=FD10> </A>
; <b>CBM80</b>
;   Referenced by <A href="#FD04">FD04</A>

 <a name=FD10></a>FD10   .BY $C3,$C2,$CD,$38,$30    ; Note that the high bits of the letters are set, corresponding 
                                   ; to uppercase letters in the alternate charset.

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 5   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->
 
 <A name=FD15>
 ; restore I/O vectors
 </A>
 <a name=FD15></a>FD15   A2 30      LDX #$30   ; low  <A href="#FD30">FD30</A>
 <a name=FD17></a>FD17   A0 FD      LDY #$FD   ; high <A href="#FD30">FD30</A>
 <a name=FD19></a>FD19   18         CLC
 
 <A name=FD1A>
 ; set I/O vectors depending on XY
 </A>
 <a name=FD1A></a>FD1A   86 C3      STX $C3
 <a name=FD1C></a>FD1C   84 C4      STY $C4
 <a name=FD1E></a>FD1E   A0 1F      LDY #$1F
 <a name=FD20></a>FD20   B9 14 03   LDA $0314,Y
 <a name=FD23></a>FD23   B0 02      BCS $FD27
 <a name=FD25></a>FD25   B1 C3      LDA ($C3),Y
 <a name=FD27></a>FD27   91 C3      STA ($C3),Y
 <a name=FD29></a>FD29   99 14 03   STA $0314,Y
 <a name=FD2C></a>FD2C   88         DEY
 <a name=FD2D></a>FD2D   10 F1      BPL $FD20
 <a name=FD2F></a>FD2F   60         RTS
 
 <A name=FD30>
 ; vectors for OS at $0314-$0333
 </A>
 <a name=FD30></a>FD30   .WD $<A href="#EA31">EA31</A>                  ; IRQ
 <a name=FD32></a>FD32   .WD $<A href="#FE66">FE66</A>                  ; BRK
 <a name=FD34></a>FD34   .WD $<A href="#FE47">FE47</A>                  ; NMI
 <a name=FD36></a>FD36   .WD $<A href="#F34A">F34A</A>                  ; IOPEN: open logical file
 <a name=FD38></a>FD38   .WD $<A href="#F291">F291</A>                  ; ICLOSE: close logical file
 <a name=FD3A></a>FD3A   .WD $<A href="#F20E">F20E</A>                  ; set input dev
 <a name=FD3C></a>FD3C   .WD $<A href="#F250">F250</A>                  ; set output dev
 <a name=FD3E></a>FD3E   .WD $<A href="#F333">F333</A>                  ; restore I/O
 <a name=FD40></a>FD40   .WD $<A href="#F157">F157</A>                  ; CHRIN: input char
 <a name=FD42></a>FD42   .WD $<A href="#F1CA">F1CA</A>                  ; CHROUT: output char
 <a name=FD44></a>FD44   .WD $<A href="#F6ED">F6ED</A>                  ; test stop key
 <a name=FD46></a>FD46   .WD $<A href="#F13E">F13E</A>                  ; CHRGET: get char
 <a name=FD48></a>FD48   .WD $<A href="#F32F">F32F</A>                  ; abort I/O
 <a name=FD4A></a>FD4A   .WD $<A href="#FE66">FE66</A>                  ; unused (BRK)
 <a name=FD4C></a>FD4C   .WD $<A href="#F4A5">F4A5</A>                  ; load ram
 <a name=FD4E></a>FD4E   .WD $<A href="#F5ED">F5ED</A>                  ; save ram
 
 <A name=FD50>
 ; initalise memory pointers
 </A>
 <a name=FD50></a>FD50   A9 00      LDA #$00
 <a name=FD52></a>FD52   A8         TAY
 <a name=FD53></a>FD53   99 02 00   STA $0002,Y
 <a name=FD56></a>FD56   99 00 02   STA $0200,Y
 <a name=FD59></a>FD59   99 00 03   STA $0300,Y
 <a name=FD5C></a>FD5C   C8         INY
 <a name=FD5D></a>FD5D   D0 F4      BNE $FD53
 <a name=FD5F></a>FD5F   A2 3C      LDX #$3C
 <a name=FD61></a>FD61   A0 03      LDY #$03
 <a name=FD63></a>FD63   86 B2      STX $B2
 <a name=FD65></a>FD65   84 B3      STY $B3
 <a name=FD67></a>FD67   A8         TAY
 <a name=FD68></a>FD68   A9 03      LDA #$03
 <a name=FD6A></a>FD6A   85 C2      STA $C2
 <a name=FD6C></a>FD6C   E6 C2      INC $C2
 <a name=FD6E></a>FD6E   B1 C1      LDA ($C1),Y
 <a name=FD70></a>FD70   AA         TAX
 <a name=FD71></a>FD71   A9 55      LDA #$55
 <a name=FD73></a>FD73   91 C1      STA ($C1),Y
 <a name=FD75></a>FD75   D1 C1      CMP ($C1),Y
 <a name=FD77></a>FD77   D0 0F      BNE $FD88
 <a name=FD79></a>FD79   2A         ROL
 <a name=FD7A></a>FD7A   91 C1      STA ($C1),Y
 <a name=FD7C></a>FD7C   D1 C1      CMP ($C1),Y
 <a name=FD7E></a>FD7E   D0 08      BNE $FD88
 <a name=FD80></a>FD80   8A         TXA
 <a name=FD81></a>FD81   91 C1      STA ($C1),Y
 <a name=FD83></a>FD83   C8         INY
 <a name=FD84></a>FD84   D0 E8      BNE $FD6E
 <a name=FD86></a>FD86   F0 E4      BEQ $FD6C
 <a name=FD88></a>FD88   98         TYA
 <a name=FD89></a>FD89   AA         TAX
 <a name=FD8A></a>FD8A   A4 C2      LDY $C2
 <a name=FD8C></a>FD8C   18         CLC
 <a name=FD8D></a>FD8D   20 2D FE   JSR $<A href="#FE2D">FE2D</A>
 <a name=FD90></a>FD90   A9 08      LDA #$08
 <a name=FD92></a>FD92   8D 82 02   STA $0282
 <a name=FD95></a>FD95   A9 04      LDA #$04
 <a name=FD97></a>FD97   8D 88 02   STA $0288
 <a name=FD9A></a>FD9A   60         RTS
 
 <A name=FD9B>
 ; IRQ vectors
 </A>
 <a name=FD9B></a>FD9B   .WD $<A href="#FC6A">FC6A</A>   ; cassette write A
 <a name=FD9D></a>FD9D   .WD $<A href="#FBCD">FBCD</A>   ; cassette write B
 <a name=FD9F></a>FD9F   .WD $<A href="#EA31">EA31</A>   ; standard IRQ
 <a name=FDA1></a>FDA1   .WD $<A href="#F92C">F92C</A>   ; cassette read

<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 3 </b></i>      <HR align=center width=50%>
</div> <div class="level3">
<!--------------------------------------------------------------------------------------------------------->
 
<A name=FDA3> </A>
; <b> initialize I/O devices </b>
;    Referenced by: <A href="#FE69">FE69</A> <A href="#FF84">FF84</A> <A href="#FCF2">FCF2</A> 
;
; Initialize all interface chips.  Called by reset routine, default BRK handler (blue screen)
; and from the Kernal jump table.

 <a name=xxxx></a>FDA3   A9 7F      LDA #$7F        ; Value to disable all interrupts:
 <a name=FDA5></a>FDA5   8D 0D DC   STA $<a href="io.htm#DC0D">DC0D</a>       ;   CIA1 interrupt control register
 <a name=FDA8></a>FDA8   8D 0D DD   STA $<a href="io.htm#DD0D">DD0D</a>       ;   CIA2 interrupt control register
 <a name=FDAB></a>FDAB   8D 00 DC   STA $<a href="io.htm#DC00">DC00</a>       ; normal state, column 7 low (asserted) for keyboard scan
 <a name=FDAE></a>FDAE   A9 08      LDA #$08        ; timers stopped, 1-shot mode, don't output timer on port, count CPU cycles
 <a name=FDB0></a>FDB0   8D 0E DC   STA $<a href="io.htm#DC0E">DC0E</a>       ; CIA1 control register A (also: serial port=input, 60 Hz TOD mode)
 <a name=FDB3></a>FDB3   8D 0E DD   STA $<a href="io.htm#DD0E">DD0E</a>       ; CIA2 control register A (also: set alarm on TOD write)
 <a name=FDB6></a>FDB6   8D 0F DC   STA $<a href="io.htm#DC0F">DC0F</a>       ; CIA1 control register B (also: serial port=input, 60 Hz TOD mode)
 <a name=FDB9></a>FDB9   8D 0F DD   STA $<a href="io.htm#DD0F">DD0F</a>       ; CIA2 control register B (also: set alarm on TOD write)
 <a name=FDBC></a>FDBC   A2 00      LDX #$00        ; 
 <a name=FDBE></a>FDBE   8E 03 DC   STX $<a href="io.htm#DC03">DC03</a>       ; CIA1 data direction register, port B, all inputs
 <a name=FDC1></a>FDC1   8E 03 DD   STX $<a href="io.htm#DD03">DD03</a>       ; CIA2 data direction register, port B, all inputs
 <a name=FDC4></a>FDC4   8E 18 D4   STX $<a href="io.htm#D418">D418</a>       ; SID chip: master volume = 0, filters off, enable voice 3 output
 <a name=FDC7></a>FDC7   CA         DEX             ; (LDX #$FF)
 <a name=FDC8></a>FDC8   8E 02 DC   STX $<a href="io.htm#DC02">DC02</a>       ; CIA1 data direction register, port A, all outputs (key scan columns)
 <a name=FDCB></a>FDCB   A9 07      LDA #$07        ; Set CIA2 port A: bits 0..2 high (VIC bank=00, RS-232 Tx line high)
 <a name=FDCD></a>FDCD   8D 00 DD   STA $<a href="io.htm#DD00">DD00</a>       ;    bits 3..7 low (all serial bus outputs de-asserted)
 <a name=FDD0></a>FDD0   A9 3F      LDA #$3F        ; 
 <a name=FDD2></a>FDD2   8D 02 DD   STA $<a href="io.htm#DD02">DD02</a>       ; CIA2 data direction register, port A: all outputs except bits 6,7 (IEC clock/data in)
 <a name=FDD5></a>FDD5   A9 E7      LDA #$E7        ; on-chip IO port init:
 <a name=FDD7></a>FDD7   85 01      STA $01         ;    BASIC/Kernal/IO banked in, charset not.  Tape data out low, motor off
 <a name=FDD9></a>FDD9   A9 2F      LDA #$2F        ; on-chip IO data direction: 
 <a name=FDDB></a>FDDB   85 00      STA $00         ;    LORAM/HIRAM/CHAREN/tape data out/motor control = out, tape switch sense = in
<A name=FDDD> </A>
;<b> program CIA1 Timer A to generate 1/60 second system interrupt </b>
;    Referenced by: <A href="#FCA5">FCA5</A> <A href="#FF6B">FF6B</A> 
;
; Oddly, this routine references the NTSC/PAL flag at $02A6, but is called from the Kernal reset
; routine (falls through from above) BEFORE it is set.  This works out because FDDD ends up 
; getting called again later, after the flag has been set correctly.  This raises the question, 
; why call it twice??  Perhaps because some level of init is required early, but the exact
; timing (PAL vs. NTSC) doesn't matter until init completes... Maybe just to save 1 byte by 
; omitting an RTS... or maybe it's because this needs to happen from the BRK handler / Kernal 
; call, and it is assumed that once the PAL/NTSC flag is set, it will always remain valid.

 <a name=xxxx></a>FDDD   AD A6 02   LDA $<a href="ram.htm#02A6">02A6</a>       ; PAL/NTSC mode flag
 <a name=FDE0></a>FDE0   F0 0A      BEQ $FDEC     + ; 0=NTSC
 <a name=FDE2></a>FDE2   A9 25      LDA #$25        ; set PAL equiv. for 1/60th s.
 <a name=FDE4></a>FDE4   8D 04 DC   STA $DC04       ; (985250 / 60 = 16,420.833 = $4025)
 <a name=FDE7></a>FDE7   A9 40      LDA #$40        ;
 <a name=FDE9></a>FDE9   4C F3 FD   JMP $FDF3     + ;
 
*<a name=FDEC></a>FDEC   A9 95      LDA #$95        ; set NTSC equiv. for 1/60th s.
 <a name=FDEE></a>FDEE   8D 04 DC   STA $DC04       ; (1022730 / 60 = 17,045.5 = $4295)
 <a name=FDF1></a>FDF1   A9 42      LDA #$42        ;
*<a name=FDF3></a>FDF3   8D 05 DC   STA $DC05       ;
 <a name=FDF6></a>FDF6   4C 6E FF   JMP $<A href="#FF6E">FF6E</A>       ; Cont. init... start IRQ timer, init IEC clk line


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 3   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->


<A name=FDF9> </A>
; <b>set filename for next I/O operation</b>
; All registers and flags <i>preserved</i>
;
; References: <A href="#E1D6">E1D6</A> <A href="#E21B">E21B</A> <A href="#E261">E261</A> (via jump vector <A href="#FFBD">FFBD</A>)

 <a name=xxxx></a>FDF9   85 B7      STA $<A href="ram.htm#00B7">B7</A>   ; string length
 <a name=FDFB></a>FDFB   86 BB      STX $<A href="ram.htm#00BB">BB</A>   ; Address, X=lsb
 <a name=FDFD></a>FDFD   84 BC      STY $<A href="ram.htm#00BC">BC</A>
 <a name=FDFF></a>FDFF   60         RTS
 
<A name=FE00></A>
; <b>Set file parameters for next I/O operation</b>
; All registers and flags <i>preserved</i>
;
; References: <A href="#E1DD">E1DD</A> <A href="#E1F0">E1F0</A> <A href="#E1FD">E1FD</A> <A href="#E22B">E22B</A> <A href="#E23F">E23F</A> <A href="#E24E">E24E</A> (via jump vector <A href="#FFBA">FFBA</A>)

 <a name=FE00></a>FE00   85 B8      STA $<A href="ram.htm#00B8">B8</A>              ; Logical file#
 <a name=FE02></a>FE02   86 BA      STX $<A href="ram.htm#00BA">BA</A>              ; Device
 <a name=FE04></a>FE04   84 B9      STY $<A href="ram.htm#00B9">B9</A>              ; Secondary addr.
 <a name=FE06></a>FE06   60         RTS

 <A name=FE07> </A>
 ; <b>read I/O status word</b>
 ; Inputs: None
 ; Outputs: A = status word;  X/Y <i>preserved</i>;  Also clears the Status
 ;
 ; References: <A href="#ABDD">ABDD</A> <A href="#AF9A">AF9A</A> <A href="#E180">E180</A> <A href="#E195">E195</A> (via jump vector <A href="#FFB7">FFB7</A>)

 <a name=FE07></a>FE07   A5 BA      LDA $<A href="ram.htm#00BA">BA</A>       ; Current Device#
 <a name=FE09></a>FE09   C9 02      CMP #$02       ; RS-232?
 <a name=FE0B></a>FE0B   D0 0D      BNE $FE1A   *  ; ??? if not rs-232, go do strange stuff below
 <a name=FE0D></a>FE0D   AD 97 02   LDA $<a href="ram.htm#0297">0297</a>
 <a name=FE10></a>FE10   48         PHA
 <a name=FE11></a>FE11   A9 00      LDA #$00
 <a name=FE13></a>FE13   8D 97 02   STA $0297
 <a name=FE16></a>FE16   68         PLA
 <a name=FE17></a>FE17   60         RTS


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=FE18>
 ; control kernel messages
 </A>
 <a name=FE18></a>FE18   85 9D      STA $9D          ; ???
 
 <A name=FE1A>
 ; read ST
 </A>
*<a name=FE1A></a>FE1A   A5 90      LDA $90
 
 <A name=FE1C>
 ; add A to ST
 </A>
 <a name=FE1C></a>FE1C   05 90      ORA $90
 <a name=FE1E></a>FE1E   85 90      STA $90
 <a name=FE20></a>FE20   60         RTS
 
 <A name=FE21>
 ; set timeout on serail bus
 </A>
 <a name=FE21></a>FE21   8D 85 02   STA $0285
 <a name=FE24></a>FE24   60         RTS
 
 <A name=FE25>
 ; read/set top of memory
 </A>
 <a name=FE25></a>FE25   90 06      BCC $FE2D
 <A name=FE27>
 <a name=FE27></a>FE27   AE 83 02   LDX $0283
 </A>
 <a name=FE2A></a>FE2A   AC 84 02   LDY $0284
 <A name=FE2D>
 <a name=FE2D></a>FE2D   8E 83 02   STX $0283
 </A>
 <a name=FE30></a>FE30   8C 84 02   STY $0284
 <a name=FE33></a>FE33   60         RTS
 
 <A name=FE34>
 ; read/set bottom of memory
 </A>
 <a name=FE34></a>FE34   90 06      BCC $FE3C
 <a name=FE36></a>FE36   AE 81 02   LDX $0281
 <a name=FE39></a>FE39   AC 82 02   LDY $0282
 <a name=FE3C></a>FE3C   8E 81 02   STX $0281
 <a name=FE3F></a>FE3F   8C 82 02   STY $0282
 <a name=FE42></a>FE42   60         RTS
 
 <A name=FE43>
 ; NMI entry
 </A>
 <a name=FE43></a>FE43   78         SEI
 <a name=FE44></a>FE44   6C 18 03   JMP ($0318)   ; normally <A href="#FE47">FE47</A>
 
 <A name=FE47>
 ; standard NMI routine
 </A><A name=#no_CartridgeInfo></A>
 <a name=FE47></a>FE47   48         PHA
 <a name=FE48></a>FE48   8A         TXA
 <a name=FE49></a>FE49   48         PHA
 <a name=FE4A></a>FE4A   98         TYA
 <a name=FE4B></a>FE4B   48         PHA
 <a name=FE4C></a>FE4C   A9 7F      LDA #$7F
 <a name=FE4E></a>FE4E   8D 0D DD   STA $DD0D
 <a name=FE51></a>FE51   AC 0D DD   LDY $DD0D
 <a name=FE54></a>FE54   30 1C      BMI $FE72
 <a name=FE56></a>FE56   20 02 FD   JSR $<A href="#FD02">FD02</A>
 <a name=FE59></a>FE59   D0 03      BNE $FE5E
 <a name=FE5B></a>FE5B   6C 02 80   JMP (<A href="#no_CartridgeInfo">$8002</A>)   ; cartridge warm start
 
 <a name=FE5E></a>FE5E   20 BC F6   JSR $<A href="#F6BC">F6BC</A>
 <a name=FE61></a>FE61   20 E1 FF   JSR $<A href="#FFE1">FFE1</A>
 <a name=FE64></a>FE64   D0 0C      BNE $FE72
 
 <A name=FE66>
 ; BRK routine
 </A>
 <a name=FE66></a>FE66   20 15 FD   JSR $<A href="#FD15">FD15</A>
 <a name=FE69></a>FE69   20 A3 FD   JSR $<A href="#FDA3">FDA3</A>
 <a name=FE6C></a>FE6C   20 18 E5   JSR $<A href="#E518">E518</A>
 <a name=FE6F></a>FE6F   6C 02 A0   JMP $(<A href="#A002">A002</A>)      ; normally <A href="#E37B">E37B</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=FE72>
 ; internal NMI
 </A>
 <a name=FE72></a>FE72   98         TYA             ; .Y apparently starts out w/ contents of CIA#2 INT status
 <a name=FE73></a>FE73   2D A1 02   AND $02A1       ; mask bits that are not currently in use by RS-232
 <a name=FE76></a>FE76   AA         TAX
 <a name=FE77></a>FE77   29 01      AND #$01        ; Check bit 0: 
 <a name=FE79></a>FE79   F0 28      BEQ $FEA3
 <a name=FE7B></a>FE7B   AD 00 DD   LDA $DD00
 <a name=FE7E></a>FE7E   29 FB      AND #$FB
 <a name=FE80></a>FE80   05 B5      ORA $B5
 <a name=FE82></a>FE82   8D 00 DD   STA $DD00
 <a name=FE85></a>FE85   AD A1 02   LDA $02A1       ; RS-232: NMI enables mask
 <a name=FE88></a>FE88   8D 0D DD   STA $DD0D
 <a name=FE8B></a>FE8B   8A         TXA
 <a name=FE8C></a>FE8C   29 12      AND #$12
 <a name=FE8E></a>FE8E   F0 0D      BEQ $FE9D
 <a name=FE90></a>FE90   29 02      AND #$02
 <a name=FE92></a>FE92   F0 06      BEQ $FE9A
 <a name=FE94></a>FE94   20 D6 FE   JSR $<A href="#FED6">FED6</A>
 <a name=FE97></a>FE97   4C 9D FE   JMP $<A href="#FE9D">FE9D</A>      
 <a name=FE9A></a>FE9A   20 07 FF   JSR $<A href="#FF07">FF07</A>
 <a name=FE9D></a>FE9D   20 BB EE   JSR $<A href="#EEBB">EEBB</A>
 <a name=FEA0></a>FEA0   4C B6 FE   JMP $<A href="#FEB6">FEB6</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <a name=FEA3></a>FEA3   8A         TXA
 <a name=FEA4></a>FEA4   29 02      AND #$02
 <a name=FEA6></a>FEA6   F0 06      BEQ $FEAE
 <a name=FEA8></a>FEA8   20 D6 FE   JSR $<A href="#FED6">FED6</A>
 <a name=FEAB></a>FEAB   4C B6 FE   JMP $<A href="#FEB6">FEB6</A>
 
 <a name=FEAE></a>FEAE   8A         TXA
 <a name=FEAF></a>FEAF   29 10      AND #$10
 <a name=FEB1></a>FEB1   F0 03      BEQ $FEB6
 <a name=FEB3></a>FEB3   20 07 FF   JSR $<A href="#FF07">FF07</A>
 <A name=FEB6>
 <a name=FEB6></a>FEB6   AD A1 02   LDA $02A1       ; RS-232: NMI enables mask
 </A>
 <a name=FEB9></a>FEB9   8D 0D DD   STA $DD0D
 <A name=FEBC>
 <a name=FEBC></a>FEBC   68         PLA
 </A>
 <a name=FEBD></a>FEBD   A8         TAY
 <a name=FEBE></a>FEBE   68         PLA
 <a name=FEBF></a>FEBF   AA         TAX
 <a name=FEC0></a>FEC0   68         PLA
 <a name=FEC1></a>FEC1   40         RTI
 
 <A name=FEC2>
 ; baud rate tables
 </A>
 <a name=FEC2></a>FEC2   .WD $27C1   ; 50
 <a name=FEC4></a>FEC4   .WD $1A3E   ; 75
 <a name=FEC6></a>FEC6   .WD $11C5   ; 110
 <a name=FEC8></a>FEC8   .WD $0E74   ; 134.5
 <a name=FECA></a>FECA   .WD $0CED   ; 150
 <a name=FECC></a>FECC   .WD $0645   ; 300
 <a name=FECE></a>FECE   .WD $02F0   ; 600
 <a name=FED0></a>FED0   .WD $0146   ; 1200
 <a name=FED2></a>FED2   .WD $00B8   ; 1800
 <a name=FED4></a>FED4   .WD $0071   ; 2400
 
 <A name=FED6>
 ; input next bit on RS-232 and schedule TB2
 </A>
 <a name=FED6></a>FED6   AD 01 DD   LDA $DD01
 <a name=FED9></a>FED9   29 01      AND #$01
 <a name=FEDB></a>FEDB   85 A7      STA $A7
 <a name=FEDD></a>FEDD   AD 06 DD   LDA $DD06
 <a name=FEE0></a>FEE0   E9 1C      SBC #$1C
 <a name=FEE2></a>FEE2   6D 99 02   ADC $0299
 <a name=FEE5></a>FEE5   8D 06 DD   STA $DD06
 <a name=FEE8></a>FEE8   AD 07 DD   LDA $DD07
 <a name=FEEB></a>FEEB   6D 9A 02   ADC $029A
 <a name=FEEE></a>FEEE   8D 07 DD   STA $DD07
 <a name=FEF1></a>FEF1   A9 11      LDA #$11
 <a name=FEF3></a>FEF3   8D 0F DD   STA $DD0F
 <a name=FEF6></a>FEF6   AD A1 02   LDA $02A1       ; RS-232: NMI enables mask
 <a name=FEF9></a>FEF9   8D 0D DD   STA $DD0D
 <a name=FEFC></a>FEFC   A9 FF      LDA #$FF
 <a name=FEFE></a>FEFE   8D 06 DD   STA $DD06
 <a name=FF01></a>FF01   8D 07 DD   STA $DD07
 <a name=FF04></a>FF04   4C 59 EF   JMP $<A href="#EF59">EF59</A>
 
 <A name=FF07>
 ; schedule TB2 using baud rate factor
 </A>
 <a name=FF07></a>FF07   AD 95 02   LDA $0295
 <a name=FF0A></a>FF0A   8D 06 DD   STA $DD06
 <a name=FF0D></a>FF0D   AD 96 02   LDA $0296
 <a name=FF10></a>FF10   8D 07 DD   STA $DD07
 <a name=FF13></a>FF13   A9 11      LDA #$11
 <a name=FF15></a>FF15   8D 0F DD   STA $DD0F
 <a name=FF18></a>FF18   A9 12      LDA #$12
 <a name=FF1A></a>FF1A   4D A1 02   EOR $02A1       ; RS-232: NMI enables mask
 <a name=FF1D></a>FF1D   8D A1 02   STA $02A1
 <a name=FF20></a>FF20   A9 FF      LDA #$FF
 <a name=FF22></a>FF22   8D 06 DD   STA $DD06
 <a name=FF25></a>FF25   8D 07 DD   STA $DD07
 <a name=FF28></a>FF28   AE 98 02   LDX $0298
 <a name=FF2B></a>FF2B   86 A8      STX $A8
 <a name=FF2D></a>FF2D   60         RTS
 
 <A name=FF2E> </A>
 ; continuation of baud rate calculation

 <a name=FF2E></a>FF2E   AA         TAX
 <a name=FF2F></a>FF2F   AD 96 02   LDA $0296
 <a name=FF32></a>FF32   2A         ROL
 <a name=FF33></a>FF33   A8         TAY
 <a name=FF34></a>FF34   8A         TXA
 <a name=FF35></a>FF35   69 C8      ADC #$C8
 <a name=FF37></a>FF37   8D 99 02   STA $0299
 <a name=FF3A></a>FF3A   98         TYA
 <a name=FF3B></a>FF3B   69 00      ADC #$00
 <a name=FF3D></a>FF3D   8D 9A 02   STA $029A
 <a name=FF40></a>FF40   60         RTS

 ; The following no-ops don't appear to ever be referenced...
 
 <a name=FF41></a>FF41   EA         NOP
 <a name=FF42></a>FF42   EA         NOP

 ; Looks like this is a way to re-enter the interrupt
 ; handler when you're already in the it
 ; [ Used only at <A href="F927">F927</A> ]

 <A name=FF43> </A>
 <a name=FF43></a>FF43   08         PHP
 <a name=FF44></a>FF44   68         PLA
 <a name=FF45></a>FF45   29 EF      AND #$EF
 <a name=FF47></a>FF47   48         PHA
 
 <A name=FF48> </A>
 ; IRQ entry point

 <a name=FF48></a>FF48   48         PHA
 <a name=FF49></a>FF49   8A         TXA
 <a name=FF4A></a>FF4A   48         PHA
 <a name=FF4B></a>FF4B   98         TYA
 <a name=FF4C></a>FF4C   48         PHA
 <a name=FF4D></a>FF4D   BA         TSX
 <a name=FF4E></a>FF4E   BD 04 01   LDA $0104,X
 <a name=FF51></a>FF51   29 10      AND #$10
 <a name=FF53></a>FF53   F0 03      BEQ $FF58
 <a name=FF55></a>FF55   6C 16 03   JMP ($0316)   ; normally <A href="#FE66">FE66</A>
 
 <a name=FF58></a>FF58   6C 14 03   JMP ($0314)   ; normally <A href="#EA31">EA31</A>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->

 
<A name=FF5B> </A>
;<b> initialize screen and keyboard </b>

 <a name=FF5B></a>FF5B   20 18 E5   JSR $<A href="#E518">E518</A>       ; init screen and kbd
 <a name=FF5E></a>FF5E   AD 12 D0   LDA $D012       ; bits 0..7 of raster IRQ compare (vertical)
 <a name=FF61></a>FF61   D0 FB      BNE $FF5E       ; wait forever until something zeros it (part of PAL/NTSC check?)
 <a name=FF63></a>FF63   AD 19 D0   LDA $D019       ; VIC interrupt flags...
 <a name=FF66></a>FF66   29 01      AND #$01        ; bit0 = raster
 <a name=FF68></a>FF68   8D A6 02   STA $02A6       ; PAL/NTSC flag
 <a name=FF6B></a>FF6B   4C DD FD   JMP $<A href="#FDDD">FDDD</A>       ; more init... mostly system IRQ; also init IEC bus clk line
 
 <A name=FF6E>
 ; end of scheduling TA for 1/60 second IRQ's 
 ; (just a continuation of I/O init, JMP from FDF6)
 </A>
 <a name=FF6E></a>FF6E   A9 81      LDA #$81        ;
 <a name=FF70></a>FF70   8D 0D DC   STA $DC0D       ; CIA 1 IRQ mask: enable timer A interrupt
 <a name=FF73></a>FF73   AD 0E DC   LDA $DC0E       ; CIA 1 ctrl reg
 <a name=FF76></a>FF76   29 80      AND #$80        ; preserve only 50/60Hz setting
 <a name=FF78></a>FF78   09 11      ORA #$11        ; set: SP=in, count system clock, force load tmr A, no output on PB6, start running
 <a name=FF7A></a>FF7A   8D 0E DC   STA $DC0E       ;
 <a name=FF7D></a>FF7D   4C 8E EE   JMP $<A href="#EE8E">EE8E</A>       ; set IEC clk line hi, then return
 
 <a name=FF80></a>FF80   .BY $03                    ; kernal version number


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->

 
 <A name=FF81>
 ; kernal vectors
 </A>
 <a name=FF81></a>FF81   4C 5B FF   JMP $<A href="#FF5B">FF5B</A>       ; initalise screen and keyboard
 <a name=FF84></a>FF84   4C A3 FD   JMP $<A href="#FDA3">FDA3</A>       ; initalise I/O devices
 <a name=FF87></a>FF87   4C 50 FD   JMP $<A href="#FD50">FD50</A>       ; initalise memory pointers
 <a name=FF8A></a>FF8A   4C 15 FD   JMP $<A href="#FD15">FD15</A>       ; restore I/O vectors
 <a name=FF8D></a>FF8D   4C 1A FD   JMP $<A href="#FD1A">FD1A</A>       ; set I/O vectors from XY
 <a name=FF90></a>FF90   4C 18 FE   JMP $<A href="#FE18">FE18</A>       ; control kernal messages
 <a name=FF93></a>FF93   4C B9 ED   JMP $<A href="#EDB9">EDB9</A>       ; read secondary address after listen
 <a name=FF96></a>FF96   4C C7 ED   JMP $<A href="#EDC7">EDC7</A>       ; read secondary address after talk
 <a name=FF99></a>FF99   4C 25 FE   JMP $<A href="#FE25">FE25</A>       ; read/set top of memory
 <a name=FF9C></a>FF9C   4C 34 FE   JMP $<A href="#FE34">FE34</A>       ; read/set bottom of memory
 <a name=FF9F></a>FF9F   4C 87 EA   JMP $<A href="#EA87">EA87</A>       ; scan keyboard
 <a name=FFA2></a>FFA2   4C 21 FE   JMP $<A href="#FE21">FE21</A>       ; set timout for serial bus
 <a name=FFA5></a>FFA5   4C 13 EE   JMP $<A href="#EE13">EE13</A>       ; input on serial bus
 <a name=FFA8></a>FFA8   4C DD ED   JMP $<A href="#EDDD">EDDD</A>       ; output byte on serial bus
 <a name=FFAB></a>FFAB   4C EF ED   JMP $<A href="#EDEF">EDEF</A>       ; send untalk on serial bus
 <a name=FFAE></a>FFAE   4C FE ED   JMP $<A href="#EDFE">EDFE</A>       ; send unlisten on serial bus
 <a name=FFB1></a>FFB1   4C 0C ED   JMP $<A href="#ED0C">ED0C</A>       ; send listen on serial bus
 <a name=FFB4></a>FFB4   4C 09 ED   JMP $<A href="#ED09">ED09</A>       ; send talk on serial bus
 <a name=FFB7></a>FFB7   4C 07 FE   JMP $<A href="#FE07">FE07</A>       ; read I/O status word -- References: <A href="#ABDD">ABDD</A> <A href="#AF9A">AF9A</A> <A href="#E180">E180</A> <A href="#E195">E195</A>
 <a name=FFBA></a>FFBA   4C 00 FE   JMP $<A href="#FE00">FE00</A>       ; set file parameters -- References: <A href="#E1DD">E1DD</A> <A href="#E1F0">E1F0</A> <A href="#E1FD">E1FD</A> <A href="#E22B">E22B</A> <A href="#E23F">E23F</A> <A href="#E24E">E24E</A>
 <a name=FFBD></a>FFBD   4C F9 FD   JMP $<A href="#FDF9">FDF9</A>       ; set filename -- References: <A href="#E1D6">E1D6</A> <A href="#E21B">E21B</A> <A href="#E261">E261</A>
 <a name=FFC0></a>FFC0   6C 1A 03   JMP ($031A)     ; ($<A href="#F34A">F34A</A>) open a file
 <a name=FFC3></a>FFC3   6C 1C 03   JMP ($031C)     ; ($<A href="#F291">F291</A>) close a file
 <a name=FFC6></a>FFC6   6C 1E 03   JMP ($031E)     ; ($<A href="#F20E">F20E</A>) set input device
 <a name=FFC9></a>FFC9   6C 20 03   JMP ($0320)     ; ($<A href="#F250">F250</A>) set output device
 <a name=FFCC></a>FFCC   6C 22 03   JMP ($<a href="ram.htm#0322">0322</a>)     ; ($<A href="#F333">F333</A>) restore I/O devices to default
 <a name=FFCF></a>FFCF   6C 24 03   JMP ($0324)     ; ($<A href="#F157">F157</A>) input char on current device
 <a name=FFD2></a>FFD2   6C 26 03   JMP ($<a href="ram.htm#0326">0326</a>)     ;  output char on current device; $<A href="#F1CA">F1CA</A> by default -- References: <A href="#E10C">E10C</A> <A href="#F135">F135</A> <A href="#F5C9">F5C9</A> <A href="#F726">F726</A> <A href="#F759">F759</A>
 <a name=FFD5></a>FFD5   4C 9E F4   JMP $<A href="#F49E">F49E</A>       ; load ram from device -- References:  <a href="#E175">E175</a>
 <a name=FFD8></a>FFD8   4C DD F5   JMP $<A href="#F5DD">F5DD</A>       ; save ram to device -- References: <A href="#FFD8">FFD8</A>
 <a name=FFDB></a>FFDB   4C E4 F6   JMP $<A href="#F6E4">F6E4</A>       ; set real time clock
 <a name=FFDE></a>FFDE   4C DD F6   JMP $<A href="#F6DD">F6DD</A>       ; read real time clock
 <a name=FFE1></a>FFE1   6C 28 03   JMP ($0328)     ; ($<A href="#F6ED">F6ED</A>) check stop key
 <a name=FFE4></a>FFE4   6C 2A 03   JMP ($032A)     ; ($<A href="#F13E">F13E</A>) get a character
 <a name=FFE7></a>FFE7   6C 2C 03   JMP ($032C)     ; ($<A href="#F32F">F32F</A>) close all channels and files
 <a name=FFEA></a>FFEA   4C 9B F6   JMP $<A href="#F69B">F69B</A>       ; increment real time clock
 <a name=FFED></a>FFED   4C 05 E5   JMP $<A href="#E505">E505</A>       ; read organisation of screen into XY
 <a name=FFF0></a>FFF0   4C 0A E5   JMP $<A href="#E50A">E50A</A>       ; read/set XY cursor position
 <a name=FFF3></a>FFF3   4C 00 E5   JMP $<A href="#E500">E500</A>       ; read base address of I/O devices
 
; Initials of the ROM writers
; (Not Referenced)

 <a name=FFF6></a>FFF6   .BY $52,$52,$42,$59         ; R. R. and B. Y.

; These three vector addresses are used directly by the 6510

 <a name=FFFA></a>FFFA   .WD $<A href="#FE43">FE43</A>   ; NMI vector
 <a name=FFFC></a>FFFC   .WD $<A href="#FCE2">FCE2</A>   ; RESET vector
 <a name=FFFE></a>FFFE   .WD $<A href="#FF48">FF48</A>   ; IRQ/BRK vector


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->

 
 <HR>
 <HR>
<a name=0073></a><a name=0079></a> 
 <h2> CHRGET routine found at $73 to $8A </h2>

; <b>CHRGET = <A href="#0073">0073</A>.  Advances <A href="ram.htm#007A">TXTPTR</A> to point at the next sequential char, then returns that value</b>
; <b>CHRGOT = <A href="#0079">0079</A>.  Returns the char that <A href="ram.htm#007A">TXTPTR</A> is already pointing to</b>
;
; The CHRGET/CHRGOT calls are used to process BASIC text.  The term "text" is used loosely to mean 
;    one of two types of values.  (1) <i>When tokenizing</i> ASCII format statements into executable code, 
;    the CHRGET routines will read each character of the user input when called by the tokenize 
;    routine.  (This tokenization will occur whether you're entering statements into a program, or 
;    executing commands in immediate mode.)  (2) When processing <i>already-tokenized BASIC</i> code 
;    (immediate or programmed) the routines are used to get both tokens <i>and</i> ASCII characters, since 
;    not all characters get converted into tokens.  Still, when working with a token stream, you 
;    could just as well call everything a token for ease of expression.
; Since CHRGET and CHRGOT work the same whether they're reading pure text or fetching tokens, there 
;    is no point in standardizing on a single term.  For this reason, you will very often see the 
;    terms "character", "token", "text", "code", and "value" used interchangeably in this document 
;    when referring to what the CHRGET routines return.  In ROM code where it is pretty clear what 
;    the returned value is used for, I've attempted to choose the most fitting term, but that's 
;    just not possible everywhere.
;    
; Inputs:  Address at $7A/$7B only
; Outputs:  A=byte retrieved;  C=0 only for ASCII digits ($30..$39);  
;           Z=0 unless char is $00 or $3A (ASCII colon).  These two chars are "statement enders"
;           X,Y <i>preserved</i>
;
; For references, see lists at bottom of routine.  
; There are many references, both to the CHRGET/CHRGOT entry 
;    points, and to the pointer at <A href="ram.htm#007A">$7A</A>
 <h4> Copied from ROM address  <A href="#E3A2">E3A2</A> </h4>
 <hr>


*<a name=0073></a>0073   E6 7A       INC $<A href="ram.htm#007A">7A</A>        ; Inc TXTPTR Lo (move on to next chr)
 <a name=0075></a>0075   D0 02       BNE $79    *
 <a name=0077></a>0077   E6 7B       INC $<A href="ram.htm#007B">7B</A>        ; Carried into TXTPTR Hi
*<a name=0079></a>0079   AD 01 08    LDA <i>$0000</i>      ; CHRGOT: Get cur token in A.  "0000" could be any address
 <a name=007C></a>007C   C9 3A       CMP #$3A      ; A < colon? (":" comes right after ASCII "9" digit)
 <a name=007E></a>007E   B0 0A       BCS $008A  *  ; Not < ":" ... RTS <i>w/ Carry set</i>. <b>only "0".."9" return w/ C=0</b>
 <a name=0080></a>0080   C9 20       CMP #$20
 <a name=0082></a>0082   F0 EF       BEQ $0073  *  ; Ignore spaces...
 <a name=0084></a>0084   38          SEC           ; These 2 SBC ops cancel eachother, so A is unchanged. They are 
 <a name=0085></a>0085   E9 30       SBC #$30      ;   there to set the flags correctly. All digits are >= $30, so 
 <a name=0087></a>0087   38          SEC           ;   chrs < $30 need Carry set. A simple CMP can't do that. The 
 <a name=0088></a>0088   E9 30       SBC #$D0      ;   subtractions reverse C flag for us. Also: sets Z if chr=$00. 
*<a name=008A></a>008A   60          RTS


  <b> References to:</b>
 
  <b>CHRGET:</b>   (<A href="#0073">$73</A>)
        <A href="#A48A">A48A</A> <A href="#A6B3">A6B3</A> <A href="#A799">A799</A> <A href="#A7E4">A7E4</A> <A href="#A801">A801</A> <A href="#A812">A812</A> <A href="#A95F">A95F</A> <A href="#A99F">A99F</A> <A href="#AB13">AB13</A> <A href="#AB82">AB82</A> <A href="#AC51">AC51</A> <A href="#AD84">AD84</A> <A href="#ADD1">ADD1</A> <A href="#AE8A">AE8A</A> <A href="#AEA5">AEA5</A> <A href="#AF05">AF05</A> 
        <A href="#AFAA">AFAA</A> <A href="#B0A5">B0A5</A> <A href="#B0B0">B0B0</A> <A href="#B0D8">B0D8</A> <A href="#E3A2">E3A2</A> <A href="#B1B2">B1B2</A> <A href="#B79B">B79B</A> <A href="#BD0A">BD0A</A> <A href="#BD17">BD17</A> <A href="#BD30">BD30</A> 
 
  <b>CHRGOT:</b>   (<A href="#0079">$79</A>)   
        <A href="#A6AA">A6AA</A> <A href="#A792">A792</A> <A href="#A897">A897</A> <A href="#A92B">A92B</A> <A href="#A940">A940</A> <A href="#AA9D">AA9D</A> <A href="#AC2C">AC2C</A> <A href="#AC91">AC91</A> <A href="#AC91">AC91</A> <A href="#ACAD">ACAD</A> <A href="#ACD4">ACD4</A> <A href="#AD7D">AD7D</A> <A href="#ADB8">ADB8</A> <A href="#B08D">B08D</A> <A href="#B094">B094</A> <A href="#B73B">B73B</A> 
        <A href="#B73B">B73B</A> <A href="#B7AA">B7AA</A> <A href="#B7D7">B7D7</A> <A href="#B7D7">B7D7</A> <A href="#B834">B834</A> <A href="#E206">E206</A> <A href="#E211">E211</A>
 
  <b>TEXTPTR: *</b>  (<A href="ram.htm#007A">$7A..$7B</A>)
        <A href="#A486">A486</A> <A href="#A57C">A57C</A> <A href="#A5B3">A5B3</A> <A href="#A5F5">A5F5</A> <A href="#A60C">A60C</A> <A href="#A68E">A68E</A> <A href="#A75F">A75F</A> <A href="#A7B1">A7B1</A> <A href="#A7C0">A7C0</A> <A href="#A7CE">A7CE</A> <A href="#A834">A834</A> <A href="#A864">A864</A> <A href="#A888">A888</A> <A href="#A8B3">A8B3</A> <A href="#A8C9">A8C9</A> <A href="#A8EB">A8EB</A> 
        <A href="#A919">A919</A> <A href="#AB76">AB76</A> <A href="#AC1C">AC1C</A> <A href="#AC4D">AC4D</A> <A href="#AC5D">AC5D</A> <A href="#AC74">AC74</A> <A href="#AC9D">AC9D</A> <A href="#ACA9">ACA9</A> <A href="#ACC2">ACC2</A> <A href="#AD6E">AD6E</A> <A href="#AE0B">AE0B</A> <A href="#AEBD">AEBD</A> <A href="#AF01">AF01</A> <A href="#B3D5">B3D5</A> <A href="#B423">B423</A> <A href="#B44A">B44A</A> 
        <A href="#B7B5">B7B5</A> <A href="#B7E6">B7E6</A> <A href="#BDA9">BDA9</A> <A href="#E187">E187</A> <A href="#E1A1">E1A1</A> <A href="#E3A6">E3A6</A> 
   <i>* in order to keep the TXTPR reference list at a useful level, multiple references within a short 
     distance of each other have been collapsed into one link (always the first reference of the group).</i>
 <hr>


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->


<ADDRESS>
<A href="http://myoperatingsystem.org/~msmakela/">Marko Makelda</A>
(Marko.Makela@HUT.FI)
</ADDRESS>


<A name=No_FuncEval>No_FuncEval</A>
<a name=No_go_to>No_go_to</a>
<a name=No_List>No_List</a>
<a name=No_Tokenize>No_Tokenize</a>
<A name=No_ShowError>No_ShowError</A>
<A name=#no_CartridgeInfo></A>
                
<a name=rom_RTS_trick>rom_RTS_trick</a>
<a name=rom_BIT_trick>rom_BIT_trick</a>

<a name=secondary_addresses_flags>secondary_addresses_flags</a>

<H5>If a link brought you here, one of the above anchors is unresolved.</H5>
















<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 1   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 0 </b></i>      <HR align=center width=50%>
</div> <div class="level0">
<!--------------------------------------------------------------------------------------------------------->


<!--------------------------------------------------------------------------------------------------------->
<div class="boundary">
 <HR align=center width=50%>    <i><b> END: Annotation Level 0   </b></i>   <!------------------------>

<HR><HR>  
 <!------------------------>    <i><b> BEGIN: Annotation Level 1 </b></i>      <HR align=center width=50%>
</div> <div class="level1">
<!--------------------------------------------------------------------------------------------------------->



<input type="button" name="doit" value="doit" OnClick="DoIt()">
<a href="#" onmouseover="" onMouseout="popup()">Hover Me!</a>




</PRE>

</BODY>


</HTML>
